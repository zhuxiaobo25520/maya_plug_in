//                               1                 2                  3           4            5                    6                      7              8                    9                    10                       11                12                     13         14            15              16          17           18           19        20               21            22         23           24        25             26               27           28                     29                     30               31                   32               33                      34                      35               36           37       38               39               40         41           42          43
global string$UI_array[]={"UI_head_mode","UI_head_controller","UI_head_bn","UI_zxb_eye","UI_zxb_eye_point_up","UI_zxb_eye_point_dw","UI_jaw_bn","UI_jaw_controller","UI_mouth_outer_wire","UI_mouth_inside_wire","UI_mouth_oral_wire","UI_oral_inside_wire","UI_mouth_annular","UI_nose","UI_noseguard","UI_basis_nasi","UI_nose_R","UI_smile","UI_cheek","UI_cheekbone_R","UI_jwa_point","UI_upjaw","UI_dwjaw","UI_pomum","UI_Jawknot","UI_eye_L_mode","UI_eye_R_mode","UI_eye_outer_wire","UI_eye_middle_wire","UI_eye_inside_wire","UI_annular_side","UI_eye_boundary_R","UI_eye_boundary_L","UI_eye_all_lash","UI_all_head_vertex","UI_cheek_face","UI_all_face","UI_Collisionline","UI_tooth_up","UI_tooth_dw","UI_tongue","UI_eyelash","UI_eyebrow"};

global proc zxb_image_proc (string$image_temp)
{
	//

global string $gShelfTopLevel;
string $currentShelf = `tabLayout -query -selectTab $gShelfTopLevel`;
setParent $currentShelf;
string $asInstallScriptLocation=`asInstallScriptLocation`;
if (`gmatch $asInstallScriptLocation "*\*"`)
	$asInstallScriptLocation=`substituteAllString $asInstallScriptLocation "\\" "/"`;
string $sourceFile=$asInstallScriptLocation+"image/"+$image_temp+".png";


if(`window -ex zxb_image_Win`) deleteUI  zxb_image_Win;
string $myWindow = `window  -t"帮助"  zxb_image_Win `;
formLayout formLayou_zxb_image;
image -i $sourceFile ;
showWindow $myWindow ;

}

global proc zxb_fase_window_proc(){

if(`window -ex zxb_jisuanlianbu_ciji_Win`) deleteUI  zxb_jisuanlianbu_ciji_Win;
string $myWindow = `window  zxb_jisuanlianbu_ciji_Win `;
scrollLayout; 
columnLayout; 
columnLayout -adjustableColumn 0; 
frameLayout -label "准备"   -collapsable 3 -cl 1   -labelWidth 20 -width 400   ; 
rowColumnLayout -nc 1 -cw 1 400  ;
if (`exists dockControl`)
	if (`dockControl -q -ex zxb_chibangWin_columnLayoutaa`)
		deleteUI -control zxb_chibangWin_columnLayoutaa;


dockControl -area "left"
	-content $myWindow
	-allowedArea "left"
	-allowedArea "right"
	-l "面部绑定"
	zxb_chibangWin_columnLayoutaa;


text -l "--------------准备--------------"   ;
checkBox -l "眼睛镜像方式(方向)" -value 1 xingwei;
checkBox -l "不检查头部对称" -value 1 hede_vs;
checkBox -l "对称角色" -value 1 duicheng;
separator;
rowColumnLayout -nc 4 -cw 1 200 -cw 2 40  -cw 3 70  -cw 4 40 ;



global string$UI_array[];    
///                   1            2         3             4        5             6           7          8            9          10            11             12           13          14       15      16       17        18          19          20      21         22      23        24        25          26         27             28           29          30             31             32                33          34                 35            36        37             38           39         40          41      42    43
string$UI_name[]={"1头部模型","2头部控制器","3头部关节","4眼睛关节","5眼皮最高点","6眼皮最低点","7下巴关节","8下巴控制器","9嘴唇外环线","10嘴唇中间环线","11嘴唇内环线","12口腔内环线","13嘴巴环形线","14鼻子","15鼻头","16鼻底","17鼻翼R","18两个微笑顶点","19脸颊","20颧骨R","21下巴","22上颌骨","23下颌骨","24喉结","25侧面下巴","26L眼球模型","27R眼球模型","28眼眶线外","29眼眶线中间","30眼眶线内","31眼眶环形边","32眼眶上下分界线R","33眼眶上下分界线L","34睫毛泪腺模型","35头部所有顶点","36脸颊面","37面部表情面","38睫毛眼睛碰撞线","39上牙模型","40下牙模型","41舌头","42睫毛","43眉毛"};
          //     1   2   3   4   5   6   7   8   9   10 11  12  13  14  15  16  17  18  19  20   21  22 23   24  25  26  27  28  29  30  31  32  33  34  35  36 37   38  39  40  41  42  43                      
string$UI_EX[]={"0","0","0","0","0","0","0","0","1","1","1","1","1","0","0","0","0","1","0","0","0","0","0","0","0","0","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"};
int$ui_size=size($UI_array);
int$uiname_size=size($UI_name);
if($ui_size!=$uiname_size){error ("UI数组不一致\n");}
for ($i=0;$i<size($UI_array);$i++)
{
 string$UI_in_maya=$UI_array[$i];
 string$UI_in_vs=$UI_name[$i];
 int$jiaobiao=$UI_EX[$i];
 string$UI_in_maya_button=$UI_array[$i]+"_button";
textFieldGrp  -cw2 100 150 -l $UI_in_vs  -ed 0  $UI_in_maya;
button -l  "载入"  -c ("zxb_zairufangfa_int_proc(\""+$UI_in_maya+"\",\""+$UI_in_maya_button+"\","+$jiaobiao+")") $UI_in_maya_button ;
button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$UI_in_maya_button+"\",\""+$UI_in_maya+"\")") ;

button -l  "提示"  -c ("zxb_image_proc(\""+$UI_in_maya+"\")");

 }


setParent ..; 
setParent ..; 
separator;
rowColumnLayout -nc 2 -cw 1 200 -cw 2 40  ;
button -l  "创建下巴曲线"  -c "proczxb_jaw_to_curve";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
button -l  "创建眼皮模型"  -c "zxb_changcheng_eye_mode_proc";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
button -l  "创建睫毛曲线"  -c "zxb_jiemao_qvxian_ex";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
button -l  "创建抿嘴曲线"  -c "zxb_extract_Curves_lip";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
button -l  "重新计算眼睛次级权重"  -c "zxb_eye_lip_quanzhong_jisuan";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
button -l  "重新计算嘴巴次级权重"  -c "zxb_zuiba_lipjoint_quanzhongchongxiangjisuan_proc";
button -l  "提示"  -c ("zxb_image_proc(\""+"aa"+"\")");
setParent ..; 
setParent ..; 
setParent ..; 
separator;
frameLayout -label "创建"   -collapsable 3 -cl 1   -labelWidth 20 -width 400  ; // 可折叠 
rowColumnLayout -nc 1 -cw 1 500  ;

text -l "--------------创建--------------"   ;
separator;
rowColumnLayout -nc 1 -cw 1 250 -cw 2 250 ;

string$UI_establish[]={"zuibazhengti_button","zuibazhengti_button_delete","hedebs_button","headhunhebianxing_button","headhunhebianxing_edit_button","headhunhebianxing_add_button","hedemianbankuan_button","hedemianbankuan_delete_button","hedemianbankuan_wancheng_button","hedemianbankuan_bianji_button","hedemianbankuan_Add_button","hedemianbankuan_Add_delete_button","hede_open_reverse_button","lip_BN_button","lip_controller_button","lip_Curve_button","lip_bs_button","UI_face_Cluster_button","eye_button","eyelid_button","eye_secondary_button","UI_lip_zuibalalian","UI_lip_zuiba_boliang","UI_fuzhao_eye_pde_ciji","UI_qvxiangensui_mode","UI_serve_button"};
                         //          1        2  计算嘴巴权重   3 创建嘴巴拉链绑定   4 创建拉链线包裹 5创建嘴巴次级控制器     6创建表情面板      7创建面部次级控制器   8 删除表情面板        9                10               11                  12删除表情控制控框制器               13链接嘴巴混合变形                   14            15              16             17                 18              19             20            21              22             23          24               25                  26                                       
string$UI_establish_name[]={"1创建嘴巴整体绑定","2计算嘴巴权重 ","3创建嘴巴拉链绑定 ","4创建拉链线包裹","5创建嘴巴次级控制器","6创建面部次级控制器","7创建眼睛控制器","8眼皮次级控制创建","9生成表情面板","10生成睫毛碰撞骨骼","11翻转着嘴巴骨骼创建",""                          ,"创建嘴巴次级关节","创建嘴巴次级控制器","创建抿嘴曲线","创建抿嘴曲线混合变形","创建面部簇","创建眼睛目标约束","创建眼皮绑定","创建眼皮次级绑定","            ","创建嘴巴波浪","眼睛次模型级自动附着","碰撞曲线跟随模型","保存UI上的名称",""};
//                                   1                       2                                  3                    4                        5                        6                              7                        8                           9                            10                              11                       12                            13                       14                           15                    16                   17                                18                        19                                              20                                     21                                      22            23       24                  25
string$UI_establish_proc[]={"zxb_xiababangding_proc","zxb_jaw_jisuanquanzhong","zxb_zuibalalian_all_proc","zxb_lalianbaoguo_A_poc","zxb_button_lipjoint_proc","zxb_face_to_Cluster_proc","zxb_eye_con_bn_proc","zxb_yanjing_yanpi_qvxian_fangfa_proc","zxb_zxb_all_faceFrame_proc","zxb_eye_eyelash_curve_proc","zxb_extract_Curves_lipbs_a","zxb_open_reverse_proc","zxb_button_lipjoint_proc","zxb_secondary_controller","zxb_extract_Curves_lip","zxb_extract_Curves_bs_lip","zxb_face_to_Cluster_proc","zxb_chuangjianyanjingguyanjie_fangfa_proc","zxb_chuangjianyanpiguanjie_fangfa_proc","zxb_yanjing_yanpi_qvxian_fangfa_proc","                     ","","zxb_fuzhao_mode_proc","zxb_mesh_nurbsSurface_to_obj_proc","zxb_UI_mingzi_serve",""};
int$ui_establish_size=size($UI_establish);
int$uiname_establish_size=size($UI_establish_name);
int$UI_establish_proc_size=size($UI_establish_proc);
if($ui_establish_size==$uiname_establish_size&&$ui_establish_size==$UI_establish_proc_size)
  {
  for ($i=0;$i<size($UI_establish);$i++)
      {
       string$establish_button=$UI_establish[$i];
       string$establish_name=$UI_establish_name[$i];
       string$establish_proc=$UI_establish_proc[$i];
       button -l  $establish_name  -c $establish_proc  -en 1 $establish_button;
      }
      
       
  }
else
    {error ("UI数组不一致\n");}






setParent ..; 
frameLayout -label "瞳孔"   -collapsable 3 -cl 1   -labelWidth 20 -width 400   ; 
rowColumnLayout -nc 3 -cw 1 240 -cw 2 140  -cw 3 100 ;
string$UI_pupil[]={"UI_pupil_middle","UI_pupil_up","UI_eyr_mode_L","UI_eyr_mode_R","UI_eye_create_mesh","UI_eye_create_Surfaces","UI_eye_mode_mesh"};
string$UI_pupil_name[]={"瞳孔中间点","瞳孔最高点","->L眼球模型","<-R眼球模型","生成模型","曲面模型","当前模型"};
int$ui_pupil_size=size($UI_pupil);
int$uiname_pupil_size=size($UI_pupil_name);
if($ui_pupil_size!=$uiname_pupil_size){error ("UI数组不一致\n");}
for ($i=0;$i<size($UI_pupil);$i++)
{
 string$UI_in_maya=$UI_pupil[$i];
 string$UI_in_vs=$UI_pupil_name[$i];
 string$UI_in_maya_button=$UI_array[$i]+"_button";
if($i>3)
   {
    textFieldGrp  -cw2 100 130 -l $UI_in_vs  -ed 0  $UI_in_maya;
    text -l "----------------------------"   ;
    text -l "----------------------------"   ;
//button -l  "载入"  -c ("zxb_zairufangfa_B_proc(\""+$UI_in_maya+"\",\""+$UI_in_maya_button+"\")") $UI_in_maya_button ;
//button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$UI_in_maya_button+"\",\""+$UI_in_maya+"\")") ;
    }
else if($i>1)
      {
       textFieldGrp  -cw2 100 130 -l $UI_in_vs  -ed 0  $UI_in_maya;
       button -l  "载入"  -c ("zxb_zairufangfa_suzu_A_proc(\""+$UI_in_maya+"\",\""+$UI_in_maya_button+"\")") $UI_in_maya_button ;
       button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$UI_in_maya_button+"\",\""+$UI_in_maya+"\")") ;  
      }
      if($i<2)
      {
       textFieldGrp  -cw2 100 130 -l $UI_in_vs  -ed 0  $UI_in_maya;
       button -l  "载入"  -c ("zxb_zairufangfa_B_proc(\""+$UI_in_maya+"\",\""+$UI_in_maya_button+"\")") $UI_in_maya_button ;
       button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$UI_in_maya_button+"\",\""+$UI_in_maya+"\")") ;  
      }
  
 }
setParent ..; 
textFieldGrp  -cw2 100 400 -l "预设混合变形" -tx " tongBSA tongBSB tongBSC tongBSD tongBSE "   UI_eye_name_preinstall_BS;


columnLayout -adj 1 -w 300 ;
button -l  "生成曲面以及模型"  -c "zxb_pupil_bs_mode_extract_proc"  -en 1 UI_pupil_bs_mode_extract_button ;
button -l  "生成瞳孔绑定"  -c "zxb_tongkongsuofang_shengcbangd_proc"  -en 1 UI_pupil_binding_extract_button ;
rowColumnLayout -nc 2 -cw 1 240 -cw 2 240;

textFieldGrp  -cw2 130 130 -l "添加属性控制器" -tx "" -ed 0  kongzhiqi;
string$kongzhiqi="kongzhiqi";
button -l "添加属性控制器" -c ("zxb_zairufangfa_A_proc(\""+$kongzhiqi+"\")") ;
textFieldGrp  -cw2 130 130 -l "载入AB控制器:内瞳孔" -tx "" -ed 0  kongzhiqi_ab;
string$kongzhiqi_ab="kongzhiqi_ab";
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+$kongzhiqi_ab+"\")") ;

textFieldGrp  -cw2 130 130 -l "载入A控制器:外瞳孔" -tx "" -ed 0  kongzhiqi_a;
string$kongzhiqi_a="kongzhiqi_a";
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+$kongzhiqi_a+"\")") ;

textFieldGrp  -cw2 100 100 -l "放大 " -tx "2"   fangda;
textFieldGrp  -cw2 100 100 -l "缩小 " -tx "0.2"   suoxiao;
textFieldGrp  -cw2 100 100 -l "缩小x轴" -tx "0.2"   suoxiaox;
textFieldGrp  -cw2 100 100 -l "放大x轴" -tx "1.5"   fangdax;

textFieldGrp  -cw2 100 100 -l "缩小Y轴" -tx "0.2"   suoxiaoy;
textFieldGrp  -cw2 100 100 -l "放大Y轴" -tx "1.5"   fangday;
//floatSlider; 
setParent ..; 
textFieldGrp  -cw2 100 400 -l "放大缩小 " -tx " tongBSAA tongBSBB tongBSCC tongBSDD tongBSEE tongBSFF " -ed 0   yueshe_BS_A;

button -l  "生成瞳孔混合变形"  -c "zxb_tongkong_BSProc"  -en 1 UI_pupil_bs_extract_button ;
setParent ..; 
setParent ..; 
columnLayout -adj 1 -w 300 gtBSColumlayout;
frameLayout -label "创建拉链"   -collapsable 3 -cl 1   -labelWidth 20 -width 400   ; // 可折叠 



text -l "--------------提取曲线--------------" -h 25;

rowColumnLayout -nc 2 -cw 1 240 -cw 2 140;

textFieldGrp  -cw2 200 50 -l "选中线中线（最平的一段）" -tx "  " -ed 0  UI_mouth_temp_wire;
string$xian="UI_mouth_temp_wire";
button -l "载入线" -c ("zxb_zairufangfa_A_proc(\""+$xian+"\")") lalian_button_zairuxian ;


textFieldGrp  -cw2 100 130 -l "曲线前缀" -tx "lalian"   UI_mouth_zipper_prefix;

text -l "  " ;

textFieldGrp  -cw2 200 70 -l "反向嘴巴模型（闭合模型）" -tx "  " -ed 0  zxb_zairumode;
string$mode="zxb_zairumode";
button -l "载模型" -c ("zxb_zairufangfa_A_proc(\""+$mode+"\")") lalian_button_fanxiang;


 setParent..;
button -l "创建张嘴曲线A" -c "zxb_zuiba_tiqv_lalian_open_proc" lalian_button_qvxianA;   
button -l "创建闭嘴曲线无后缀" -c "zxb_zuiba_tiqv_lalian_close_proc" lalian_button_qvxian;
button -l "创建跟随曲线D" -c "zxb_zuiba_tiqv_lalian_follow_proc" lalian_button_qvxianD;
text -l "--------------创建拉链--------------" -h 20  -bgc 0.3 0.7 0.3;
rowColumnLayout -nc 2 -cw 1 240 -cw 2 140;




checkBox -l "选中点" -value 0 panduan_dian;
checkBox -l "反选控定位器（拉链效果默认闭合的话勾选他）" -value 1 fanxuan;

textFieldGrp  -cw2 150 100 -l "跟随曲线（D曲线）" -tx " "   UI_mouth_zipper_wire_follow_D;
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+"UI_mouth_zipper_wire_follow_D"+"\")") UI_mouth_zipper_wire_follow_D_button;


textFieldGrp  -cw2 150 100 -l "张开 闭合 曲线" -tx " "   UI_mouth_zipper_wire_close_open;
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+"UI_mouth_zipper_wire_close_open"+"\")") UI_mouth_zipper_wire_close_open_button;



textFieldGrp  -cw2 150 100 -l "张开曲线(曲线A)" -tx " "   UI_mouth_zipper_wire_open_A;
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+"UI_mouth_zipper_wire_open_A"+"\")")  UI_mouth_zipper_wire_open_A_button;



textFieldGrp  -cw2 150 100 -l "闭合曲线(曲线B)" -tx " "   UI_mouth_zipper_wire_close_B;
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+"UI_mouth_zipper_wire_close_B"+"\")")   UI_mouth_zipper_wire_close_B_button;


//button -l "提取反向嘴曲线(暂时无用)" -c "zxb_xuanzebutongmoxing_jiluxuanzhededian";
//textFieldGrp  -cw2 100 130 -l "载入基础模型" -tx "模型" -ed 0  zxb_zairumodea;
//string$mode="zxb_zairumode";
//button -l "载入基础模型" -c ("zxb_zairufangfa_A_proc(\""+$mode+"\")") ;
setParent ..; 
button -l "定位器控制曲线（D曲线）" -c "zxb_dingweiqi_kongzhiqvxian" UI_mouth_zipper_follow_DD_button ; 
button -l "曲线控制定位器(张开 闭合 曲线)" -c "zxb_dingweiqi_gensuiqvxian" UI_mouth_zipper_open_AABB_button;
button -l "创建拉链" -c "zxb_global_bolangzui" UI_mouth_zipper_Create_button;



text -l "--------------创建线包裹--------------" -h 20  -bgc 0.3 0.7 0.3;
rowColumnLayout -nc 2 -cw 1 240 -cw 2 140;



textFieldGrp  -cw2 150 130 -l "载入基础模型" -tx "模型" -ed 0  zxb_zairumodeA;
string$modeA="zxb_zairumodeA";
button -l "载入模型" -c ("zxb_zairufangfa_A_proc(\""+$modeA+"\")") ;

textFieldGrp  -cw2 150 130 -l "载入D曲线 按顺序选中" -tx "曲线" -ed 0  Dqvxian;
string$Dqvxian="Dqvxian";
button -l "载入D曲线" -c ("zxb_zairufangfa_A_proc(\""+$Dqvxian+"\")") ;



textFieldGrp  -cw2 150 130 -l "载入张嘴曲线 按顺序选中" -tx "曲线" -ed 0  zhangzuiqvxian;
string$zhangzuiqvxian="zhangzuiqvxian";
button -l "张嘴曲线" -c ("zxb_zairufangfa_A_proc(\""+$zhangzuiqvxian+"\")") ;

setParent ..; 
button -l "生成包裹" -c "zxb_lalianbaoguo_poc";




text -l "--------------设置驱动--------------" -h 20  -bgc 0.3 0.7 0.3;
rowColumnLayout -nc 2 -cw 1 240 -cw 2 140;



textFieldGrp  -cw2 100 130 -l "载入控制器" -tx "控制器" -ed 0  zxb_zairukongzhiqi;
string$mkongzhiqi="zxb_zairukongzhiqi";
button -l "控制器" -c ("zxb_zairufangfa_A_proc(\""+$mkongzhiqi+"\")") ;

textFieldGrp  -cw2 100 130 -l "载入定位器" -tx "定位器" -ed 0  zxb_dingweiqi;
string$dingweqi="zxb_dingweiqi";
button -l "定位器" -c ("zxb_zairufangfa_A_proc(\""+$dingweqi+"\")") ;



setParent ..; 


button -l "设置驱动" -c "zxb_zd_sheziqvdong_poc";





text -l "--------------骨骼跟随曲线--------------" -h 20  -bgc 0.3 0.7 0.3;
button -l "生成" -c "xiao_gugegengsuiqvxian_proc_columnLayout";

separator;

setParent ..; 

frameLayout -label "创建嘴巴波浪"   -collapsable 3 -cl 1   -labelWidth 20 -width 400  ; // 可折叠 

text -l "--------------生成波浪--------------" -h 20  -bgc 0.3 0.7 0.3;
button -l "选中D曲线" -c "zxb_bolangzui";
setParent ..; 
frameLayout -label "创建睫毛碰撞"   -collapsable 3 -cl 1   -labelWidth 20 -width 400  ; // 可折叠 
rowColumnLayout -nc 3 -cw 1 240 -cw 2 140  -cw 3 100 ;
textFieldGrp  -cw2 150 100 -l "睫毛次级ROOT关节" -tx " "   UI_jiemao_root_bn;
button -l "载入跟关节" -c ("zxb_zairufangfa_A_proc(\""+"UI_jiemao_root_bn"+"\")") UI_jiemao_root_bn_button;
text -l " " ;
setParent ..; 
button -l "创建睫毛FK" -c "zxb_jiemao_ciji_kongzhiqi";
rowColumnLayout -nc 3 -cw 1 240 -cw 2 140  -cw 3 100 ;
string$pengzhuang_qvxian_ss[]={"UI_jiemao_pengzhuang_qvxian_up_L","UI_jiemao_pengzhuang_qvxian_dw_L","UI_jiemao_pengzhuang_qvxian_up_R","UI_jiemao_pengzhuang_qvxian_dw_R"};

string$pengzhuang_qvxian_ss_tex[]={"碰撞曲线上L","碰撞曲线下L","碰撞曲线上R","碰撞曲线下R"};
for ($i=0;$i<size($pengzhuang_qvxian_ss);$i++)
     {
         
      string$qvxian=$pengzhuang_qvxian_ss[$i];
       string$qvxian_button=$qvxian+"_button";
      string$pengzhuang_tex=$pengzhuang_qvxian_ss_tex[$i];
      textFieldGrp  -cw2 150 100 -l $pengzhuang_tex -tx " "   $qvxian;
      button -l "载入曲线" -c ("zxb_zairufangfa_A_proc(\""+$qvxian+"\")") $qvxian_button;
      button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$qvxian_button+"\",\""+$qvxian+"\")") ;
      }







setParent ..; 








button -l "创建碰撞曲线跟随模型" -c "zxb_mesh_nurbsSurface_to_obj_proc";


rowColumnLayout -nc 1 -cw 1 500  ;
rowColumnLayout -nc 2 -cw 1 240 -cw 2 140;



textFieldGrp  -cw2 150 100 -l "载入在原地位置的曲线" -tx "曲线" -ed 0  UI_yuandi_qvxian;
string$qvxian="UI_yuandi_qvxian";
button -l "载入在原地位置的曲线" -c ("zxb_zairufangfa_A_proc(\""+$qvxian+"\")") ;

textFieldGrp  -cw2 100 130 -l "定位器个数" -tx "20"   UI_yuandi_loc;
string$dingweiqi="UI_yuandi_loc";
button -l "载入定位器个数" -c ("zxb_zairufangfa_A_proc(\""+$dingweiqi+"\")") ;

textFieldGrp  -cw2 100 130 -l "旋转角度" -tx "360"   UI_yuandi_jiaodu;
string$jiaodu="UI_yuandi_jiaodu";
button -l "载入角度" -c ("zxb_zairufangfa_A_proc(\""+$jiaodu+"\")") ;
setParent ..; 

button -l "设置关节碰撞角度（选中关节）" -c "zxb_jiemao_pengzhuangguanjie_chengxu_proc";






rowColumnLayout -nc 3 -cw 1 240 -cw 2 140  -cw 3 100 ;


string$pengzhuang_qvxian_ss[]={"UI_jiemao_pengzhuang_bn_up_L","UI_jiemao_pengzhuang_bn_dw_L","UI_jiemao_pengzhuang_bn_up_R","UI_jiemao_pengzhuang_bn_dw_R"};

string$pengzhuang_qvxian_ss_tex[]={"碰撞关节上L","碰撞关节下L","碰撞关节上R","碰撞关节下R"};
for ($i=0;$i<size($pengzhuang_qvxian_ss);$i++)
     {
         
      string$qvxian=$pengzhuang_qvxian_ss[$i];
       string$qvxian_button=$qvxian+"_button";
      string$pengzhuang_tex=$pengzhuang_qvxian_ss_tex[$i];
      textFieldGrp  -cw2 150 100 -l $pengzhuang_tex -tx " "   $qvxian;
      button -l "载入跟关节" -c ("zxb_zairufangfa_A_proc(\""+$qvxian+"\")") $qvxian_button;
      button -l  "重新载入"  -c ("zxb_zairufangfa_C_proc(\""+$qvxian_button+"\",\""+$qvxian+"\")") ;
      }







setParent ..; 

button -l "创建睫毛关节碰撞" -c "zxb_jiemao_pengzhuang_proc";
setParent ..; 
setParent ..; 
showWindow  ;
zxb_ui_jiazai;
}



global proc zxb_ui_jiazai_chuangjian_loc() 
{
string$face_loc="zxb_face_loc";
string$UI_arraySS=`zxb_UI_mingzi`;
string$UI_array[]=stringToStringArray($UI_arraySS," ");
string$UI_ex="UI_ex_judge";

int$ex=`objExists $face_loc`;    ///判断
if($ex==0)
  {
    spaceLocator -p 0 0 0 -n $face_loc;
    
    string$BUYIDONGZU="Face_Group";
    int$ex=`objExists $BUYIDONGZU`;    ///判断
    if($ex==0)
       {
       group  -em  -n $BUYIDONGZU;
       }
    parent $face_loc $BUYIDONGZU;
    
    for($iii=0;$iii<size($UI_array);$iii++)
       {
       string$temp_shuxing=$UI_array[$iii];
       zxb_ADD_shuxing_string_proc($face_loc,$temp_shuxing); 
       
        }

    
    zxb_ADD_shuxing_double_proc($face_loc,$UI_ex);
 }

}

global proc zxb_ui_jiazai() 
{
string$face_loc="zxb_face_loc";
string$UI_arraySS=`zxb_UI_mingzi`;
string$UI_array[]=stringToStringArray($UI_arraySS," ");
string$UI_ex="UI_ex_judge";

int$ex_zxb_a=`objExists ($face_loc+"."+$UI_ex)`; 
if($ex_zxb_a==1)
  {
   float$ex_A=`getAttr($face_loc+"."+$UI_ex)`;
   if($ex_A==1)
    {
      for($iii=0;$iii<size($UI_array);$iii++)
         {
           string$shuxing=$UI_array[$iii];
           int$ex_zxb=`objExists ($face_loc+"."+$shuxing)`;   
           if($ex_zxb==1)
             {
              string$temp_shuxing=`getAttr ($face_loc+"."+$shuxing)`;
              textFieldGrp -e -tx $temp_shuxing $shuxing; 
              button -e -en 0 ($shuxing+"_button");       
             }

        
    
     
         }
 
            
    }
  }  


    
}





global proc string zxb_UI_mingzi()
{
string$mingzi="";
global string$UI_array[];
//string$UI_array[]={"UI_head_mode","UI_head_controller","UI_jaw_bn","UI_jaw_controller","UI_mouth_outer_wire","UI_mouth_inside_wire","UI_mouth_temp_wire","UI_mouth_zipper_prefix","UI_mouth_zipper_wire_follow_D","UI_mouth_zipper_wire_open_A","UI_mouth_zipper_wire_close_B","UI_mouth_zipper_wire_close_open"};

for($i=0;$i<size($UI_array);$i++)
   {
   $mingzi+=($UI_array[$i]+" ");
   }
   
   return $mingzi;
}


global proc  zxb_UI_mingzi_serve()
{
  int $ex=`objExists "zxb_face_loc"`;//查询这个物体是否纯在
  if($ex==0)
    {
    zxb_ui_jiazai_chuangjian_loc;    
    zxb_ui_jiazai;
    string$UI_arraySS=`zxb_UI_mingzi`;
    string$UI_array[]=stringToStringArray($UI_arraySS," ");
    string$face_loc="zxb_face_loc";
    setAttr "zxb_face_loc.UI_ex_judge" 1;
    for($iii=0;$iii<size($UI_array);$iii++)
           {
            string$shuxing=$UI_array[$iii];
            string$teststring=`textFieldGrp -q -tx $shuxing `;
            setAttr -type "string" ($face_loc+"."+$shuxing) $teststring;
     
           }
  }
  else{
      string$UI_arraySS=`zxb_UI_mingzi`;
      string$UI_array[]=stringToStringArray($UI_arraySS," ");
      string$face_loc="zxb_face_loc";
     setAttr "zxb_face_loc.UI_ex_judge" 1;
     for($iii=0;$iii<size($UI_array);$iii++)
           {
            string$shuxing=$UI_array[$iii];
            int $ex_temp_jia=`objExists($face_loc+"."+$shuxing)`;
            if($ex_temp_jia==0){zxb_ADD_shuxing_string_proc($face_loc,$shuxing); }
            string$teststring=`textFieldGrp -q -tx $shuxing `;
            setAttr -type "string" ($face_loc+"."+$shuxing) $teststring;
     
           }
    
      }

 button -e -en 0 UI_serve_button ;

}

////////////////////////////////////自己固定程序绑定方法/////////////////////////////////////////////
////////////////////////////////////自己固定程序绑定方法/////////////////////////////////////////////
////////////////////////////////////自己固定程序绑定方法/////////////////////////////////////////////
////////////////////////////////////自己固定程序绑定方法/////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////

/////////////////////计算物体长度////////////////////////


global proc float zxb_banjing_shuzhi_x(string$kaishi_temp,string$jiesu_temp)
{
string$temp_qvxian_a="temp_qvxian_a";
string$qvxian_curveInfo="qvxian_curveInfo_temp";
float $temp_Pos_a[]=`xform -q -ws -t $kaishi_temp`;
float $temp_Pos_b[]=`xform -q -ws -t $jiesu_temp`;
curve -d 1 -p $temp_Pos_a[0] $temp_Pos_a[1] $temp_Pos_a[2] -p $temp_Pos_b[0] $temp_Pos_b[1] $temp_Pos_b[2] -k 0 -k 1 -n $temp_qvxian_a;
shadingNode -asUtility curveInfo -n $qvxian_curveInfo; //曲线信息
string $curveShape_temp_a[]=`listRelatives -s $temp_qvxian_a`; 
connectAttr -force  ($curveShape_temp_a[0]+".worldSpace[0]") ($qvxian_curveInfo+".inputCurve");
float$chang_temp=`getAttr ($qvxian_curveInfo+".arcLength")`;
delete  $temp_qvxian_a   $qvxian_curveInfo;
return $chang_temp;
}
///////////////////////////通过模型找到顶点////////////////////////
///////////////////////////通过模型找到顶点////////////////////////
///////////////////////////通过模型找到顶点////////////////////////
global proc zxb_xuandian()
{

string $bianliangzu[]=`ls -sl`;//
string $mesh_A=$bianliangzu[0];
string $mesh_B=$bianliangzu[1];

int $panduan=`objExists "temp_zuiba_closestPointOnMesh"`;//查询这个物体是否纯在
if($panduan==1){delete "temp_zuiba_closestPointOnMesh"; }
createNode "closestPointOnMesh" -n "temp_zuiba_closestPointOnMesh";
string $mesh_B_shp[]=`listRelatives -s $mesh_B`;
connectAttr -f ($mesh_B_shp[0]+".worldMesh[0]") "temp_zuiba_closestPointOnMesh.inMesh";
select -r ($mesh_A+".vtx[0:99999999999]") ;
string $dian[]=`ls -sl -fl `;
string $dianmingzi[];
clear $dianmingzi;

global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("查找顶点...") -bp -ii 1 -min 0 -max `size($dian)` $gMainProgressBar;
for ($i=0;$i<size($dian);$i++)
{
if(`progressBar -q -ic $gMainProgressBar`)
break;
progressBar -e -s 1 $gMainProgressBar;
float $pos[]=`xform -q -ws -t $dian[$i]`;
setAttr -typ float3 "temp_zuiba_closestPointOnMesh.inPosition" $pos[0] $pos[1] $pos[2];
int $index=`getAttr "temp_zuiba_closestPointOnMesh.result.closestVertexIndex"`;
$dianmingzi[$i]=($mesh_B+".vtx["+$index+"]");
}
progressBar -e -ep $gMainProgressBar;
select -r $dianmingzi ;

delete "temp_zuiba_closestPointOnMesh";
}






//////////////////////////相同点序的模型切换不同模型顶点////////////////////////////////////////
//////////////////////////相同点序的模型切换不同模型顶点////////////////////////////////////////
//////////////////////////相同点序的模型切换不同模型顶点////////////////////////////////////////
global proc string zxb_mode_huanxian(string$xian_s[],string$mode)
{
string$xian_ss="";
for ($i=0;$i<size($xian_s);$i++)
    {
     string$xian=$xian_s[$i];
     string$mingzi[];
      clear $mingzi;//清除数组
     int $nemt=`tokenize $xian "." $mingzi`;//分离字符串存到变量
     $xian_ss+=$mode+"."+$mingzi[1]+" ";
     }
return $xian_ss;
}


/////////////////Y轴法线向上的顶点//////////////////////////////////////////
/////////////////Y轴法线向上的顶点//////////////////////////////////////////
/////////////////Y轴法线向上的顶点//////////////////////////////////////////
global proc string zxb_normal_fangxiang(string$mode)
{
string$tempString[]=`ls -sl -fl`;
string$temp_mode=$mode;

string$up_cvs="";
string$mode_shps[]=`listRelatives -s $temp_mode`; 
for ($y=0;$y<size($tempString);$y++)
	{
	string$mesh_OnMesh="Temp_closestPointOnMesh";
	zxb_ADD_createNode_proc($mesh_OnMesh, "closestPointOnMesh");
	connectAttr -force ($mode_shps[0]+".worldMesh[0]") ($mesh_OnMesh+".inMesh");
	string$temp_cv=$tempString[$y];
	float $cv_pos[]=`xform -q -ws -t $temp_cv`;
	setAttr -type float3 ($mesh_OnMesh+".inPosition") $cv_pos[0] $cv_pos[1] $cv_pos[2];
	float$a=getAttr ($mesh_OnMesh+".result.normal.normalY");
    delete $mesh_OnMesh;
    if($a>0){$up_cvs+=$temp_cv+" ";}
    
	}
return $up_cvs;
}


//////////////////通过顶点找顶点/////////////////////////////////////////
//////////////////通过顶点找顶点/////////////////////////////////////////
//////////////////通过顶点找顶点/////////////////////////////////////////
global proc zxb_vex_xuan(string$mode_a,string$cvsss[])
{

//string $bianliangzu[]=`ls -sl`;//
//string $mesh_A=$bianliangzu[0];
string $mesh_B=$mode_a;

int $panduan=`objExists "temp_zuiba_closestPointOnMesh"`;//查询这个物体是否纯在
if($panduan==1){delete "temp_zuiba_closestPointOnMesh"; }
createNode "closestPointOnMesh" -n "temp_zuiba_closestPointOnMesh";
string $mesh_B_shp[]=`listRelatives -s $mesh_B`;
connectAttr -f ($mesh_B_shp[0]+".worldMesh[0]") "temp_zuiba_closestPointOnMesh.inMesh";
select -r $cvsss ;
string $dian[]=`ls -sl -fl `;
string $dianmingzi[];
clear $dianmingzi;

global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("查找顶点...") -bp -ii 1 -min 0 -max `size($dian)` $gMainProgressBar;
for ($i=0;$i<size($dian);$i++)
{
if(`progressBar -q -ic $gMainProgressBar`)
break;
progressBar -e -s 1 $gMainProgressBar;
float $pos[]=`xform -q -ws -t $dian[$i]`;
setAttr -typ float3 "temp_zuiba_closestPointOnMesh.inPosition" $pos[0] $pos[1] $pos[2];
int $index=`getAttr "temp_zuiba_closestPointOnMesh.result.closestVertexIndex"`;
$dianmingzi[$i]=($mesh_B+".vtx["+$index+"]");
}
progressBar -e -ep $gMainProgressBar;
select -r $dianmingzi ;

delete "temp_zuiba_closestPointOnMesh";
}


//////////////////查找顶点的最左跟最右/////////////////////////////////////////
//////////////////查找顶点的最左跟最右/////////////////////////////////////////
//////////////////查找顶点的最左跟最右/////////////////////////////////////////
global proc string zxb_vex_RL_PROC(string$vex_s[])
{
  string $dingdian[]=$vex_s;
string$R_cv="";
string$L_cv="";
string$vtxs[]=$dingdian;
float$dd=-100000000000000;
float$xx=1000000000000000;
float$uppp=0;
string$dian_L="";
string$dian_R="";
string$dian_up="";
for ($i=0;$i<size($vtxs);$i++)
    {
    string$vtx=$vtxs[$i];
    float$bn_pos[]=`xform -q -ws -t $vtx`;
    if($bn_pos[0]>$dd)
      {
      $dd=$bn_pos[0];
      $dian_L=$vtx;
      }
   if($bn_pos[0]<$xx)
    {
     $xx=$bn_pos[0];
     $dian_R=$vtx;
    }
    if($bn_pos[2]>$uppp)  
      {
        $uppp=$bn_pos[2];
        $dian_up=$vtx;
       }      
   }
$L_cv=$dian_L;   
$R_cv=$dian_R;
string$shuzu_RL=$dian_L+" "+$dian_R+" ";
return $shuzu_RL;
}



///////载入文字//////////////////
global proc zxb_zairufangfa_A_proc(string$tempname)
{
string $sel[]=`ls -sl`;
string $obj="";
for($i=0;$i<size($sel);$i++)
    {
    $obj+=($sel[$i]+" ");
    }
textFieldGrp -e -tx ($obj) $tempname;
}


/////////显示按钮按钮并清空文字///////
global proc zxb_zairufangfa_C_proc(string$butt,string $tempname)
{

button -e -en 1 $butt;
textFieldGrp -e -tx "" $tempname;

}
/////////显示按钮按钮///////
global proc zxb_zairufangfa_vsanniu_proc(string$butt)
{

button -e -en 1 $butt;

}

////////////关闭按钮///////////////
global proc zxb_zairufangfa_vsanniu_on_proc(string$butt)
{

button -e -en 0 $butt;

}

////////////关闭按钮///////////////
global proc zxb_zairufangfa_D_proc(string$butt)
{

button -e -en 0 $butt;
}
/////////编辑文字并隐藏按钮///////
global proc zxb_zairufangfa_B_proc(string$tempname,string$butt)
{
string $sel[]=`ls -sl`;
textFieldGrp -e -tx $sel[0] $tempname;
button -e -en 0 $butt;
}


/////////编辑文字并隐藏按钮///////
 global proc zxb_zairufangfa_int_proc(string$tempname,string$butt,int$vs)
{
string $sel[];
clear $sel;
if($vs==0)
  {
  $sel=`ls -sl`;
  textFieldGrp -e -tx $sel[0] $tempname;
  button -e -en 0 $butt;
  }
if($vs==1)
  {
  $sel=`ls -sl -fl`;
  string$temp="";
  for ($i=0;$i<size($sel);$i++)
      {
        $temp+=$sel[$i]+" ";
        }
  textFieldGrp -e -tx $temp $tempname;
  button -e -en 0 $butt;
  }

}


/////////////载入数组///////////////
global proc zxb_zairufangfa_suzu_proc(string$tempname,string$butt)
{
string $sel[]=`ls -sl -fl`;
string$suzu="";
for ($i=0;$i<size($sel);$i++)
    {
    $suzu+=$sel[$i]+" ";
    }
textFieldGrp -e -tx  $suzu $tempname;
button -e -en 0 $butt;
}
/////////////载入数组///////////////
global proc zxb_zairufangfa_suzu_A_proc(string$tempname,string$butt)
{
string $sel[]=`ls -sl `;
string$suzu="";
for ($i=0;$i<size($sel);$i++)
    {
    $suzu+=$sel[$i]+" ";
    }
textFieldGrp -e -tx  $suzu $tempname;
button -e -en 0 $butt;
}


///////////////载入一堆字符//////////////
global proc string zxb_array_to_stringproc(string$tempname[])
{

string $obj="";
for($i=0;$i<size($tempname);$i++)
    {
    $obj+=(" "+$tempname[$i]);
    }
 return $obj;
}

//////////////////添加属性/////////////////////
global proc zxb_ADD_shuxing_string_proc(string$kongzhiqi,string$shuxing)
{
  int$ex=`objExists ($kongzhiqi+"."+$shuxing)`;    ///判断
  select -r $kongzhiqi;
  if($ex==0){addAttr -ln $shuxing  -dt "string";} 
}


//////////////////添加属性/////////////////////
global proc zxb_ADD_shuxing_double_proc(string$kongzhiqi,string$shuxing)
{
  int$ex=`objExists ($kongzhiqi+"."+$shuxing)`;    ///判断
  select -r $kongzhiqi;
  if($ex==0){addAttr -ln $shuxing -at double   -dv 0 -k 1;} 
}

//////////////////添加属性/////////////////////
global proc zxb_ADD_shuxing_double_A_proc(string$kongzhiqi,string$shuxing)
{
  int$ex=`objExists ($kongzhiqi+"."+$shuxing)`;    ///判断
  select -r $kongzhiqi;
  if($ex==0){addAttr -ln $shuxing -at double  -min 0 -max 10  -dv 0 -k 1;} 
}

//////////////////添加属性/////////////////////
global proc zxb_ADD_shuxing_double_B_proc(string$kongzhiqi,string$shuxing,float$min,float$max)
{
  int$ex=`objExists ($kongzhiqi+"."+$shuxing)`;    ///判断
  select -r $kongzhiqi;
  if($ex==0){addAttr -ln $shuxing -at double  -min $min -max $max  -dv 0 -k 1;} 
}


///////////////////////创建空组
global proc zxb_ADD_kongzu_proc(string$kongzu)
{  
 int$ex=`objExists $kongzu`; ///判断
 if($ex==0){ group -empty -n $kongzu;}
   
}
//////////选中物体创建空组//////////////
global proc zxb_ADD_kongzuA_proc(string$kongzu,string$wuti)
{  
 int$ex=`objExists $kongzu`; ///判断
 if($ex==0)
 { 
 select -r $wuti;
 group  -n $kongzu;
 }
   
}
/////////////////////////////////////////创建节点
global proc zxb_ADD_jiedian_proc(string$jiedian_name,string$jiedia)

{
   int$ex=`objExists $jiedian_name`;    ///判断
   if($ex==0){shadingNode -asUtility  $jiedia -n $jiedian_name;//创建范围节点
   }
   
}


/////////////////////////////////////////创建节点
global proc zxb_ADD_createNode_proc(string$jiedian_name,string$jiedia)

{
   int$ex=`objExists $jiedian_name`;    ///判断
   if($ex==0){createNode   $jiedia -n $jiedian_name;//创建范围节点
   }
   
}
/////////隐藏按钮并载入文字

global proc zxb_butt_tex_proc(string $butt,string $textFieldGrpa)
{

button -e -en 0 $butt;
zxb_zairufangfa_A_proc($textFieldGrpa);
}

//////////反向保存关节名称//////////////
global proc string zxb_baocunguanjie_mingzi_proc(string$mingzi, int$qunlujing)
{
         string $IKS[];
         clear$IKS;
         if($qunlujing==0){$IKS=`listRelatives -c -ad   -type "joint"$mingzi `; }
         if($qunlujing==1){$IKS=`listRelatives -c -ad    -type "joint"-pa $mingzi `; }
         string$all_bn[];
         clear $all_bn;  
         $all_bn[0]=$mingzi; 
        for($j=0;$j<size($IKS);$j++)
           {
               string$temp_bn=$IKS[$j];
               int$temp_a=size($IKS)-$j;
               $all_bn[$temp_a]=$temp_bn;
               
               
           }
           
          string$mingziss="";
         for($j=0;$j<size($all_bn);$j++)
             {
              string$temp=$all_bn[$j]+" ";
              $mingziss+=$temp;
              }
              
              
         return $mingziss;

}







///////////////////复制关节并重新命名////////////////////////////////////////

global proc string zxb_chongxingmingming_bn_mingzi_proc(string$bn,string$qianzui)
  {
  select -r $bn;
  string$mingzi=$bn+$qianzui+"temp";
  string$mingzi_a=$bn+$qianzui;
  duplicate -rr -n $mingzi ;
  string$pa_bn=zxb_baocunguanjie_mingzi_proc($mingzi,1);
  string$pa_bns[]= stringToStringArray($pa_bn, " ");//关节
  string$bn_name="";
  string$bn_namea="";
  for($ii=size($pa_bns)-1;$ii>=0;$ii--)
     {
            string$temp_bn=$pa_bns[$ii];
            string$name=$mingzi_a+$ii;
            select -r $temp_bn;
            rename $temp_bn $name;
            if($ii==0)
               {
                 $bn_namea=$name;
                 }
       }
  string$bn_name=zxb_baocunguanjie_mingzi_proc($bn_namea,0);   
  return  $bn_name;
   
   }
  
  
  
  
  
  //////////////////////////通过曲线返回U参数///////////////////////////////
  global proc float zxb_return_curve_U(float$x,float$y,float$z,string$qvxian)
{
    
float$u=0;
string$shangxiaqvxian_nearestPointOnCurve=$qvxian+"zxb_return_curve_U_nearestPointOnCurve";
string $xingjiedian[]=`listRelatives -s $qvxian`;
string$qvxian_shap=$xingjiedian[0];
zxb_ADD_createNode_proc($shangxiaqvxian_nearestPointOnCurve,"nearestPointOnCurve");
connectAttr -force ($qvxian_shap+".worldSpace[0]")  ($shangxiaqvxian_nearestPointOnCurve+".inputCurve");
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionX") $x;
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionY") $y;
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionZ") $z;
string$parameter=`getAttr ($shangxiaqvxian_nearestPointOnCurve+".parameter")`;
$u=$parameter;
return$u;
delete $shangxiaqvxian_nearestPointOnCurve;
}
  
  
//////////////////通过曲线返回U位置///////////////////////////
global proc float[]  zxb_return_curve_place(float$x,float$y,float$z,string$qvxian)
{
    

float$ee[];
clear $ee;
string$shangxiaqvxian_nearestPointOnCurve=$qvxian+"zxb_return_curve_U_nearestPointOnCurve";
string $xingjiedian[]=`listRelatives -s $qvxian`;
string$qvxian_shap=$xingjiedian[0];
zxb_ADD_createNode_proc($shangxiaqvxian_nearestPointOnCurve,"nearestPointOnCurve");
connectAttr -force ($qvxian_shap+".worldSpace[0]")  ($shangxiaqvxian_nearestPointOnCurve+".inputCurve");
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionX") $x;
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionY") $y;
setAttr ($shangxiaqvxian_nearestPointOnCurve+".inPositionZ") $z;
string$parameter=`getAttr ($shangxiaqvxian_nearestPointOnCurve+".parameter")`;
$u=$parameter;
return$ee;
delete $shangxiaqvxian_nearestPointOnCurve;
}  




//////////////////////计算位置的平均值///////////////////////////
global proc float zxb_qvfengshangzi ()
{
string$tempString[]=`ls -sl -fl`;

float $tys[];
float $tysAverage;
for ($y=0;$y<size($tempString);$y++)
	{
	$pos=`xform -q -ws -t $tempString[$y]`;
	$tys[$y]=$pos[1];
	$tysAverage+=$tys[$y];
	}
$tysAverage=$tysAverage/size($tempString);
return $tysAverage;
}



///////////////////////计算Y轴法线的朝向///////////////////////////

global proc float zxb_normal_pingjunshu(string$mode)
{
string$tempString[]=`ls -sl -fl`;
string$temp_mode=$mode;

float$shu=0;
string$mode_shps[]=`listRelatives -s $temp_mode`; 
for ($y=0;$y<size($tempString);$y++)
	{
	string$mesh_OnMesh="Temp_closestPointOnMesh";
	zxb_ADD_createNode_proc($mesh_OnMesh, "closestPointOnMesh");
	connectAttr -force ($mode_shps[0]+".worldMesh[0]") ($mesh_OnMesh+".inMesh");
	string$temp_cv=$tempString[$y];
	float $cv_pos[]=`xform -q -ws -t $temp_cv`;
	setAttr -type float3 ($mesh_OnMesh+".inPosition") $cv_pos[0] $cv_pos[1] $cv_pos[2];
	float$a=getAttr ($mesh_OnMesh+".result.normal.normalY");
    $shu+=$a;
    delete $mesh_OnMesh;
	}
int$r=size($tempString);
float$pingjun=$shu/$r;
return $pingjun;
}





//////////////////////////创建FK控制器//////////////////////////////////////////////////
global proc  zxb_FK_controller_proc(string$head_bn)
{
string$temp_a_bn[];
 clear$temp_a_bn;
$temp_a_bn[0]=$head_bn;
string $bn[]=$temp_a_bn;
int $bnnum=size($bn);

for($jj=0;$jj<$bnnum;$jj++)
   {
    select -r ($bn[$jj]);
	string $sels[] = `ls -sl`;
	
	int $size=size($sels);	
	/////////////////////////////
	string $baseJoint = $sels[0];
	
	string $endJoint;
	
	string $childs[]=`listRelatives -c -ad $sels[0]`;
	int $num=size($childs);
	$endJoint=$childs[0];
	//////////////////////////////////////	
	string $typs=`nodeType  $baseJoint`;
	string $type=`nodeType  $endJoint`;
	if($typs!="joint")error "需要选择两个关节";
	if($type!="joint")error "需要选择两个关节";

	select -r  $baseJoint;
	
    for($a=($num-1);$a>0;$a--){
    
    select -add ($childs[$a]);
}

string $sel[]=`ls -sl`;

string $tokem[];
int $tonum=`tokenize ($sel[0]) "_" $tokem`;
string $side=$tokem[1];

for($i=0;$i<size($sel);$i++){
  circle -ch 0 -o on -nr 1 0 0 -r 1 -n ($sel[$i]+"Con") ;
  select -r ($sel[$i]+"Con");
  group -n ($sel[$i]+"ConGrp");
  group -n ($sel[$i]+"ConGrpA");
  select -r ($sel[$i]);
  select -add ($sel[$i]+"ConGrpA");
  delete `parentConstraint`;
  
  select -r ($sel[$i]+"Con");
  select -add ($sel[$i]);
  parentConstraint;
  //scaleConstraint; 
 
  setAttr -lock true ($sel[$i]+"Con.v");
  string $shape[]=`listRelatives -s ($sel[$i]+"Con")`;
    setAttr ($shape[0]+".overrideEnabled") 1;
  if($side=="l"){
    setAttr ($shape[0]+".overrideColor") 22;   
  }else if($side=="r"){
    setAttr ($shape[0]+".overrideColor") 13;   
  }else{
        setAttr ($shape[0]+".overrideColor") 6;     
  }  
}

for($i=0;$i<(size($sel)-1);$i++){
    $j=$i+1;
    select -r ($sel[$j]+"ConGrpA");
    select -add ($sel[$i]+"Con");
    parent;
}

int $size=size($sel);
/////////////////////
addAttr -ln "rotx"  -at double -k 1 ($sel[$size-1]+"Con");
addAttr -ln "roty"  -at double -k 1 ($sel[$size-1]+"Con");
addAttr -ln "rotz"  -at double -k 1 ($sel[$size-1]+"Con");
addAttr -ln "showCon"  -at bool -k 1 ($sel[$size-1]+"Con");

for($i=0;$i<size($sel);$i++){
    connectAttr -f ($sel[$size-1]+"Con.rotx") ($sel[$i]+"ConGrp.rotateX");
    connectAttr -f ($sel[$size-1]+"Con.roty") ($sel[$i]+"ConGrp.rotateY");
    connectAttr -f ($sel[$size-1]+"Con.rotz") ($sel[$i]+"ConGrp.rotateZ");    
}

for($i=0;$i<(size($sel)-1);$i++){
    string $shap[]=`listRelatives -s ($sel[$i]+"Con")`;

    connectAttr -f ($sel[$size-1]+"Con.showCon") ($shap[0]+".v");
        }
    }
}




////////////////////////////////////////关节创建曲线/////////////////////////////////////////////////////////////////
global proc  zxb_curve_establish_proc(string$cbns[],string$qvxian)
{
  string$mingzi="curve -d 3 ";
  for($jj=0;$jj<size($cbns);$jj++)
      {
          string$mingzi_bnn=$cbns[$jj];
          float $temp[]=`xform -q -ws -t $mingzi_bnn`;
          $mingzi+="-p "+$temp[0]+" "+$temp[1]+" "+$temp[2]+" ";
      }
   $mingzi+=" -n "+ $qvxian;
   eval($mingzi); 
}
       
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////初始化区域/////////////////////////////////////////////////////////////////////////////////////////








/////创建下巴绑定////
global proc zxb_xiababangding_proc()
{
  zxb_ui_jiazai;  
  string $xiaba_bn=`textFieldGrp -q -tx  UI_jaw_bn`;
  string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;
  
  
  int$ex=`objExists $xiaba_bn`; 
  if($ex==0){ error  "下巴关节没有载入";}
  int$ex=`objExists $head_qvxian`; 
  if($ex==0){ error  "头部控制器没有载入" ;}
  //zxb_ADD_kongzu_proc("head_all_bn_Group");
  zxb_ADD_kongzu_proc("head_all_loc_Group");
  zxb_ADD_kongzu_proc("head_all_curve_Group");
  //zxb_ADD_kongzu_proc("head_all_nurbsSphere_Group");
 zxb_ADD_kongzu_proc("head_all_Cluster_Group");
 //zxb_ADD_kongzu_proc("head_all_hairfollicle");
  //zxb_ADD_kongzu_proc("not_move");
  zxb_ADD_kongzu_proc("jaw_loc_Group");
  zxb_ADD_kongzu_proc("head_curve_Group");
  zxb_ADD_kongzu_proc("head_pupil_curve_Group");
  parent("head_curve_Group")  ("head_all_curve_Group");
 // parent("head_all_nurbsSphere_Group")("Face_Group");
  parent("jaw_loc_Group")("head_all_loc_Group");
 // parent ("head_all_bn_Group")("Face_Group");
 // parent ("not_move")("Face_Group");
  parent ("head_all_loc_Group")("Face_Group");
  parent ("head_all_curve_Group")("Face_Group");
  parent("head_all_Cluster_Group")("Face_Group");
  //parent("head_all_hairfollicle")("Face_Group");
  parent("head_pupil_curve_Group")("head_all_curve_Group");
  parentConstraint$head_qvxian("head_curve_Group");
 setAttr "head_all_Cluster_Group.visibility" 0;
  setAttr -lock true "head_all_Cluster_Group.v";
  
  int$ex=`objExists ($head_qvxian+".jaw")`;    ///判断
  select -r $head_qvxian;
  if($ex==0){addAttr -ln "jaw"  -dt "string";}  
  
  int$ex=`objExists ($head_qvxian+".UI_jaw_bn")`;    ///判断
  select -r $head_qvxian;
  if($ex==0){addAttr -ln "UI_jaw_bn"  -dt "string";}  
  
  int$ex=`objExists ($head_qvxian+".jaw_root_bn")`;    ///判断
  select -r $head_qvxian;
  if($ex==0){addAttr -ln "jaw_root_bn"  -dt "string";}  
  
  int$ex=`objExists ($head_qvxian+".jaw_zhengti_bn")`;    ///判断
  select -r $head_qvxian;
  if($ex==0){addAttr -ln "jaw_zhengti_bn"  -dt "string";}  
  
  string$qvxian_jaw="";  
  string$qvxian_jaw_bn=""; 
  string$qvxian_jaw_root_bn=""; 
  string$qvxian_jaw_zhengti_bn=""; 
  string$jaw_bn=$xiaba_bn;
  select -r $jaw_bn ;
  
  string $jaw=($jaw_bn+"_BN");
  duplicate -rr -n $jaw;
  string$ziwuti[]=`listRelatives -c  -pa $jaw`;
  string $jaw_end=($jaw_bn+"_BN_end");
  rename $ziwuti[0] $jaw_end;
  string$qvxian_jaw_bn=$jaw;
  setAttr -type "string"($head_qvxian+".UI_jaw_bn") $qvxian_jaw_bn;

  string$grp=($jaw+"_jaw_bn_grp");
  int$ex=`objExists $grp`;    ///判断
  $qvxian_jaw+=$grp+" ";
  if($ex==0)
     {
       group  -em  -n $grp;
     }
  parent $jaw $grp;
  string$bn_con=($jaw+"_com");
  string$qvxian_grpA=($bn_con+"_A");
  string$qvxian_grpB=($bn_con+"_B");
  string$qvxian_grpC=($bn_con+"_C");
  $qvxian_jaw+=$qvxian_grpC+" ";
  float$banjing=`getAttr ($jaw_end+".tx")`;
  
 int$ex=`objExists ($head_qvxian+".jaw_controller")`;    ///判断
  select -r $head_qvxian;
  if($ex==0){addAttr -ln "jaw_controller"  -dt "string";}
  setAttr -type "string"($head_qvxian+".jaw_controller") $bn_con;
     
  circle -c 0 0 0 -nr 0 1 0 -sw 360 -r ($banjing*0.3) -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $bn_con ;
 
  select -r ($bn_con+".cv[3]") ;
  select -tgl  ($bn_con+".cv[7]") ;
  select -tgl ($bn_con+".cv[5]") ;
  select -tgl  ($bn_con+".cv[1]") ;
  scale -r -p 0cm 0cm 0cm 0.3 0.3 0.3 ;
  move -r -os -wd 0 0.8 0 ;
  select -r $bn_con;
  rotate -r -os -fo 90 0 0 ;
  FreezeTransformations;
  ResetTransformations;
  DeleteHistory;
  string$ziwuti_sshap[]=`listRelatives -s  $bn_con`;
  setAttr ($ziwuti_sshap[0]+".overrideEnabled") 1; 
  setAttr ($ziwuti_sshap[0]+".overrideColor") 17;
  group -n $qvxian_grpA;
  group -n $qvxian_grpB;
  group -n $qvxian_grpC;
  delete `pointConstraint $jaw_end $qvxian_grpC`;
 setAttr ($qvxian_grpC+".visibility") 0;
  setAttr -lock true ($qvxian_grpC+".v");

  float$tx=`getAttr  ($jaw_end+".tx")`;
  select -r ($bn_con+".cv[0:9999]") ;
  //move -r -os -wd ($tx*0.3) 0 0 ;
  float$bn_pos[]=`xform -q -ws -t $jaw`;
  string$jaw_root=($jaw+"_root");
  select -cl  ;
  joint -p  $bn_pos[0] $bn_pos[1] $bn_pos[2] -n $jaw_root ;
  move -r 0 0 ($tx*-0.5) ;
  parent $jaw_root $grp;
  parent $jaw $jaw_root;
  
  zxb_ADD_kongzu_proc("jaw_all_Group");
  parent ("jaw_all_Group") "Face_Group";
  parent  $qvxian_grpC ("jaw_all_Group");
  
  $qvxian_jaw_root_bn=$jaw_root;
   setAttr -type "string"($head_qvxian+".jaw_root_bn") $qvxian_jaw_root_bn;
 // select -r $jaw_root;
  //SelectHierarchy;
  //joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;

  
  
  string$jaw_locA=($jaw+"_locA");
  string$loc_GRPA=($jaw_locA+"_A");
  string$loc_GRPB=($jaw_locA+"_B");
  
  spaceLocator -p 0 0 0 -n $jaw_locA ;
  group -n $loc_GRPA;
  group -n $loc_GRPB;

  delete `pointConstraint $jaw_bn $loc_GRPB`;
  parent $loc_GRPB $jaw_root;
  parent  $jaw $jaw_locA;
  string$jaw_locB=($jaw+"_locB");
  string$loc_GRPAA=($jaw_locA+"_AA");
  string$loc_GRPBB=($jaw_locA+"_BB");
  $qvxian_jaw+=$loc_GRPBB+" ";
  setAttr -type "string"($head_qvxian+".jaw") $qvxian_jaw;
  spaceLocator -p 0 0 0 -n $jaw_locB ;
  group -n $loc_GRPAA;
  group -n $loc_GRPBB;
  string$FUwuti[]=`listRelatives -p  $jaw_bn`;
  parent  $loc_GRPBB ("jaw_all_Group");
  delete`pointConstraint $jaw_bn $loc_GRPBB`;
  parentConstraint -mo $FUwuti[0] $loc_GRPBB;  
  pointConstraint  $jaw_bn $jaw_locB;
  connectAttr -f ($jaw_bn+".rotate") ($jaw+".rotate");
  connectAttr -f ($jaw_locB+".t") ($jaw_locA+".t");
  setAttr ($grp+".visibility") 0;
  string$BUYIDONGZU="Face_Group";
  int$ex=`objExists $BUYIDONGZU`;    ///判断
  if($ex==0)
     {
       group  -em  -n $BUYIDONGZU;
     }
    parent $grp ("jaw_all_Group"); //下巴关节P给组
  
  
  select -r  $jaw_bn;
  string$zuiba_zhengti=($jaw_bn+"_zhengti");
  duplicate -rr -n $zuiba_zhengti; //复制下巴关节
  
  
    string$zhengti_grp=($jaw_bn+"_zhengti_grp");
  int$ex=`objExists $zhengti_grp`;    ///判断
  if($ex==0)
     {
       group  -em  -n $zhengti_grp;
     }
  string$ziwuti_A[]=`listRelatives -c  -pa $zuiba_zhengti`;
  string $jawzhengti_end=($zuiba_zhengti+"_BN_end");
  rename $ziwuti_A[0] $jawzhengti_end; //重命名下巴末端关节
  move -r 0 ($tx*0.05) 0 ;
  $qvxian_jaw_zhengti_bn=$zuiba_zhengti;
  setAttr -type "string"($head_qvxian+".jaw_zhengti_bn") $qvxian_jaw_zhengti_bn;
 transformLimits -tx -1 1 -etx 1 1 $bn_con;
 transformLimits -ty -1 1 -ety 1 1 $bn_con;
 transformLimits -tz -1 1 -etz 1 1 $bn_con;
 transformLimits -tz 0 0 -etz 1 1 $bn_con;
 transformLimits -ry 0 0 -ery 1 1 $bn_con;
 transformLimits -rx 0 0 -erx 1 1 $bn_con;
 transformLimits -rz -30 30 -erz 1 1 $bn_con;
 delete`pointConstraint  $zuiba_zhengti $zhengti_grp  `;
 parent $zhengti_grp $grp;
 parent $zuiba_zhengti $zhengti_grp;
scaleConstraint -mo   -skip x -skip y -weight 1   $bn_con  $zuiba_zhengti;
 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".ty") ($zuiba_zhengti+".ty");  
 setDrivenKeyframe -itt "linear" -ott "spline" -v -1 -dv -1 -cd ($bn_con+".ty") ($zuiba_zhengti+".ty"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".ty") ($zuiba_zhengti+".ty"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 1 -cd ($bn_con+".ty") ($zuiba_zhengti+".ty"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 0 -cd ($bn_con+".ty") ($zuiba_zhengti+".sx"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 1.1 -dv 1 -cd ($bn_con+".ty") ($zuiba_zhengti+".sx"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".tx") ($zuiba_zhengti+".ry"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v -5 -dv 1 -cd ($bn_con+".tx") ($zuiba_zhengti+".ry"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".tx") ($zuiba_zhengti+".ry"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 5 -dv -1 -cd ($bn_con+".tx") ($zuiba_zhengti+".ry");
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".rz") ($zuiba_zhengti+".rx"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v 10 -dv 30 -cd ($bn_con+".rz") ($zuiba_zhengti+".rx");  
 setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($bn_con+".rz") ($zuiba_zhengti+".rx"); 
 setDrivenKeyframe -itt "linear" -ott "spline" -v -10 -dv -30 -cd ($bn_con+".rz") ($zuiba_zhengti+".rx");  
 //zxb_zairufangfa_D_proc("zuibazhengti_button");
 //zxb_zairufangfa_vsanniu_proc("zuibazhengti_button_delete");
  
  
  ///////////创建混合变形
  string $xiaba_mode=`textFieldGrp -q -tx  UI_head_mode`;
  string $xiaba_head_con=`textFieldGrp -q -tx UI_head_controller `;
  int$ex=`objExists $xiaba_mode`; 
  if($ex==0){ error  "头部模型没有载入";}
  int$ex=`objExists $xiaba_head_con`; 
  if($ex==0){ error  "头部控制器没有载入";}
  string$jaw_root=`getAttr ($xiaba_head_con+".jaw_root_bn")`;
  int$ex=`objExists $jaw_root`; 
  if($ex==0){ error  "下巴根关节不存在 请创建下巴绑定";}
  string$jaw_zhengti=`getAttr ($xiaba_head_con+".jaw_zhengti_bn")`;
  int$ex=`objExists $jaw_zhengti`; 
  if($ex==0){ error  "嘴巴整体关节不存在 请创建下巴绑定";}
  string$jaw_bn=`getAttr ($xiaba_head_con+".UI_jaw_bn")`;
  int$ex=`objExists $jaw_bn`; 
  if($ex==0){ error  "下巴关节不存在 请创建下巴绑定";}
  int$ex=`objExists "zxb_face_bs"`; 
  if($ex==1){ error  "混合变形已经创建 请清除 zxb_face_bs";}
  //zxb_zairufangfa_D_proc("hedebs_button");
  string$mode=$xiaba_mode;
  string$modegrp="head_bs_grop_lay";
  zxb_ADD_shuxing_string_proc($xiaba_head_con,$modegrp);//添加混合变形模型组得属性
  setAttr -type "string"($xiaba_head_con+"."+$modegrp) $modegrp;
  select -cl  ;
  zxb_ADD_kongzu_proc($modegrp);
  string $fuwuti_temp_bs[]=`listRelatives -p $modegrp`; 
  int$ex=`objExists $fuwuti_temp_bs[0]`; ///判断
  if($ex==0){ parent $modegrp "Face_Group" ;}
  //                                 1                 2                 3                 4                   5               6                7
  string$fase_bs_mode_nemes[]={"open_mouth_lay","mouth_whole_lay","repeated_mouth_lay","open_A_mouth_lay","lip_lay","eye_lip_lay","eye_lip_ciji_lay"};//混合变形模型列表
  string$zidonguv="zxb_face_UV_mode_lay";
  select -r $mode;
  duplicate -rr -n $zidonguv;
  hilite  $zidonguv ;
  selectMode -component ;
  select -r ( $zidonguv+".f[0:9999999999999999999999]");
  polyAutoProjection -lm 0 -pb 0 -ibd 1 -cm 0 -l 2 -sc 1 -o 1 -p 6 -ps 0.2 -ws 0 ( $zidonguv+".f[0:9999999999999999999999]");
  select -r  $zidonguv;
  DeleteHistory;
  parent $zidonguv $modegrp;
  select -cl  ;
  select -r  $mode;
  select -add $zidonguv ;
  string$blendShape_s[]=`blendShape`;
  setAttr ($blendShape_s[0]+"."+$xiaba_mode) 1;
  setAttr ($zidonguv+".visibility") 0;
  string$uv_mode="zxb_face_UV_mode";
  zxb_ADD_shuxing_string_proc($xiaba_head_con,$uv_mode);
  setAttr -type "string"($xiaba_head_con+"."+$uv_mode) $zidonguv;
  string$mode_lst="";
  select -r $mode;
  string$bss[]=`blendShape`;
  rename $bss[0] "zxb_face_bs";//创建混合变形
  string $mode_shepe[]=`listRelatives -s $mode`; 
  string $tweak1_s[]=`listConnections -d 0 -s 1  ($mode_shepe[0]+".tweakLocation")`;//列出链接属性  -d输入   -s输出  -p 列出属性
  string $skinCluster_s[]=`listConnections -d 0 -s 1  ($mode_shepe[0]+".inMesh")`;//列出链接属性  -d输入   -s输出  -p 列出属性
  reorderDeformers $tweak1_s[0] "zxb_face_bs" $mode;
  for ($i=0;$i<size($fase_bs_mode_nemes);$i++)
      {
       string$temp_mode=$fase_bs_mode_nemes[$i]; 
       $mode_lst+=$temp_mode+" ";
       select -r $mode;
       duplicate -rr -n $temp_mode;
       string $fuwuti_temp_a[]=`listRelatives -p $temp_mode`; 
       if( $fuwuti_temp_a[0]!=$modegrp){parent$temp_mode $modegrp;}
       
       setAttr ($temp_mode+".visibility") 0;
       string $listOfShapesInNode[] =`listAttr -k -m "zxb_face_bs"`;
       int$idex=0;
       $idex=size($listOfShapesInNode)-2;
       blendShape -e  -t $mode $idex $temp_mode 1 "zxb_face_bs";
       setAttr ("zxb_face_bs."+$temp_mode) 1;

       if($i==0)
         {
          select -r $jaw_root;
          select -add $jaw_bn;
          select -add $temp_mode;
          skinCluster; 
          setAttr ("zxb_face_bs."+$temp_mode) 0;
          setAttr -lock true ("zxb_face_bs."+$temp_mode);
          }
       if($i==1)
         {
          select -r $jaw_root;
          select -add $jaw_zhengti;
          select -add $temp_mode;
          skinCluster; 
          }
       if($i==2)
         {
          select -r $jaw_root;
          select -add $jaw_bn;
          select -add $temp_mode;
          skinCluster; 
          }
       if($i==3)
         {
          select -r $jaw_root;
          select -add $jaw_bn;
          select -add $temp_mode;
          skinCluster; 
          setAttr ("zxb_face_bs."+$temp_mode) 0;
          }
        
      }
  
  zxb_ADD_shuxing_string_proc($xiaba_head_con,"base_bs_mode");//添加保存混合变形模型得名字属性
  setAttr -type "string"($xiaba_head_con+".base_bs_mode") $mode_lst;//保存混合变形模型名
  zxb_ADD_shuxing_string_proc($xiaba_head_con,"base_bs_shuxing");//添加混合变形属性
   string$base_bs_shuxing="";
  $base_bs_shuxing+="zxb_face_bs";
  setAttr -type "string"($xiaba_head_con+".base_bs_shuxing") $base_bs_shuxing;//保存混合变形属性
  string$lailian="";
  $lailian+=$fase_bs_mode_nemes[2]+" "+$fase_bs_mode_nemes[3]+" ";
  zxb_ADD_shuxing_string_proc($xiaba_head_con,"base_bs_lalian");//添加拉链嘴巴模型
  setAttr -type "string" ($xiaba_head_con+".base_bs_lalian") $lailian;//保存拉链嘴巴混合变形模型数据
  //zxb_zairufangfa_vsanniu_proc("headhunhebianxing_button"); 
  
  
  
  
  
  
  //链接混合变形
   string$FKJaw_M_kongzhiqi=`textFieldGrp -q -tx UI_jaw_controller `;
   string$toubu=`textFieldGrp -q -tx UI_head_controller `;
   string$hean_mode=` getAttr ($toubu+".base_bs_lalian")`;
   string $array[]= stringToStringArray($hean_mode, " ");//字符串转化数组
   string$hean_bs=` getAttr ($toubu+".base_bs_shuxing")`;
   string$open_reverse="Face_open_reverse";
   select -r $FKJaw_M_kongzhiqi;
   zxb_ADD_shuxing_double_A_proc($FKJaw_M_kongzhiqi,$open_reverse);
   string$jiedian=($FKJaw_M_kongzhiqi+"_setRange");
   zxb_ADD_jiedian_proc($jiedian,"setRange");
   connectAttr -f ($FKJaw_M_kongzhiqi+"."+$open_reverse) ($jiedian+".valueX");
   setAttr ($jiedian+".oldMaxX") 10;
   setAttr ($jiedian+".maxX") 1;
   string$erverse_jiedian=($FKJaw_M_kongzhiqi+"_erverse");
   zxb_ADD_jiedian_proc($erverse_jiedian,"reverse");
   connectAttr -f  ($jiedian+".outValueX") ($erverse_jiedian+".inputX");
   connectAttr -f ($erverse_jiedian+".outputX") ($hean_bs+"."+$array[1]);
   connectAttr -f ($jiedian+".outValueX") ($hean_bs+"."+$array[0]);
   //button -e -en 0 hede_open_reverse_button;
   
   button -e -en 0 zuibazhengti_button;
  
}  


/////////////删除混合变形/////////
global proc zxb_delete_head_bs_proc()
{
   string$head_con=`textFieldGrp  -q -tx  UI_head_controller`;
   string$head_bs=`getAttr ($head_con+".base_bs_shuxing")`;
   string$head_mode=`getAttr ($head_con+".base_bs_mode")`;
   
   string$array[]= stringToStringArray($head_mode, " ");//字符串转化数组
   select -r $head_bs;
   delete $head_bs;
   select -r $array;
   delete $array;
   zxb_zairufangfa_vsanniu_proc("hedebs_button"); 
   zxb_zairufangfa_vsanniu_on_proc("headhunhebianxing_button");
}
/////////////编辑混合变形/////////
global proc zxb_edit_head_bs_proc()
{}

/////////////添加混合变形/////////
global proc zxb_ADD_head_bs_proc()
{}


///////////////////检查模型是否对称//////////////////////
global proc zxb_zairufangfa_toubu_proc(string$tempname,string$butt)
{
string $sel[]=`ls -sl`;
textFieldGrp -e -tx $sel[0] $tempname;
button -e -en 0 $butt;
int$aa=`checkBox -q  -v hede_vs`;
if($aa==0){zxb_jianchamoxing ("确定");}

}
global proc int zxb_jianchamoxing (string $okMessage)
{
global string $gMainProgressBar;
int $tempInt[];
int $numVtxs,$mirrortVtx,$i;
int $return=1;
float $mag;
float $posA[],$posB[];
string $sel[]=`ls -sl`;
string $m;

if (!size($sel))
	error "没有选择模型";

//check Transform
$tempFloat=`getAttr ($sel[0]+".t")`;
if ($tempFloat[0]!=0) $m+="TranslateX = "+$tempFloat[0]+", should be 0\n";
if ($tempFloat[1]!=0) $m+="TranslateY = "+$tempFloat[1]+", should be 0\n";
if ($tempFloat[2]!=0) $m+="TranslateZ = "+$tempFloat[2]+", should be 0\n";
$tempFloat=`getAttr ($sel[0]+".r")`;
if ($tempFloat[0]!=0) $m+="RotateX = "+$tempFloat[0]+", should be 0\n";
if ($tempFloat[1]!=0) $m+="RotateY = "+$tempFloat[1]+", should be 0\n";
if ($tempFloat[2]!=0) $m+="RotateZ = "+$tempFloat[2]+", should be 0\n";
$tempFloat=`getAttr ($sel[0]+".s")`;
if ($tempFloat[0]!=1) $m+="ScaleX = "+$tempFloat[0]+", should be 1\n";
if ($tempFloat[1]!=1) $m+="ScaleY = "+$tempFloat[1]+", should be 1\n";
if ($tempFloat[2]!=1) $m+="ScaleZ = "+$tempFloat[2]+", should be 1\n";
$tempFloat=`getAttr ($sel[0]+".rp")`;
if ($tempFloat[0]!=0) $m+="RotatePivotX = "+$tempFloat[0]+", should be 0\n";
if ($tempFloat[1]!=0) $m+="RotatePivotY = "+$tempFloat[1]+", should be 0\n";
if ($tempFloat[2]!=0) $m+="RotatePivotZ = "+$tempFloat[2]+", should be 0\n";
$tempFloat=`getAttr ($sel[0]+".sp")`;
if ($tempFloat[0]!=0) $m+="ScalePivotX = "+$tempFloat[0]+", should be 0\n";
if ($tempFloat[1]!=0) $m+="ScalePivotY = "+$tempFloat[1]+", should be 0\n";
if ($tempFloat[2]!=0) $m+="ScalePivotZ = "+$tempFloat[2]+", should be 0\n";

if ($m!="")
	$m=$m+"\上面的旋转值非默认值.\n"
			+"在构建正面朝上时会导致错误\n"
			+"建议使用冻结坐标工具,\n"
			+"在绑定之前.";
if ($m!="")
	{
	$dialog=`confirmDialog -t "确认" -m $m -b $okMessage -b "取消" -db "取消" -ds "取消"`;
	if ($dialog!=$okMessage)
		$return=0;
	return $return;
	}

//Symmetry check
if (`objExists closestSampler`) delete closestSampler;
createNode -n closestSampler closestPointOnMesh;
connectAttr -f ($sel[$i]+".outMesh") closestSampler.inMesh;
$tempInt=`polyEvaluate -v $sel[$i]`;
$numVtxs=$tempInt[0];
select -cl;
progressBar -e -st "检查顶点" -bp -ii 1 -min 0 -max $numVtxs $gMainProgressBar;
for ($i=0;$i<$numVtxs;$i++)
	{
	if (`progressBar -q -ic $gMainProgressBar`)
		{progressBar -e -ep $gMainProgressBar;break;}
	progressBar -e -s 1 $gMainProgressBar;
	$posA=`xform -q -ws -t ($sel[0]+".vtx["+$i+"]")`;
	if ($posA[0]>0.001)
		continue;
	setAttr closestSampler.inPosition ($posA[0]*-1) $posA[1] $posA[2];
	$mirrortVtx=`getAttr closestSampler.closestVertexIndex`;
	$posB=`xform -q -ws -t ($sel[0]+".vtx["+$mirrortVtx+"]")`;
	$mag=`mag <<($posA[0]-($posB[0]*-1)),($posA[1]-$posB[1]),($posA[2]-$posB[2])>>`;
	if ($mag>0.001)
		select -add ($sel[0]+".vtx["+$i+"]") ($sel[0]+".vtx["+$mirrortVtx+"]");
	}
progressBar -e -ep $gMainProgressBar;
delete closestSampler;
refresh;
if (size(`ls -sl`))
	{
	$dialog=`confirmDialog -t "顶点" -m "选定的顶点不对称" -b $okMessage -b "取消" -db "确认" -ds "确认"`;
	if ($dialog!=$okMessage)
		$return=0;
	}
else
	print "//模型是对称的.\n";

return $return;
}





///////////////按钮////////////////////
global proc zxb_chuangjananniu_proc(int$xinghzuang,string $xiaba,int$fangxiang,string$mingzi)
{
    //int$xinghzuang=2;string $xiaba="xiaba";$fangxiang=0;
    
$teststring=`textFieldGrp -q -tx UI_head_mode `;
$gtCN=$teststring;

string $gtCname;
$gtCname=$gtCN+"_";
int $selec=$xinghzuang;
float $minH=-1;
float $maxH=1;
float $minV=-1;
float $maxV=1;
string $name=$xiaba;
int $fnm=`getAttr ($gtCname+"faceFrame.FrameHnum")`;
setAttr ($gtCname+"faceFrame.FrameHnum") ($fnm+1);

if($selec==1){
int $vv=$fangxiang;
//////////////////////////////
curve -d 3 -p -1 1 0 -p 1 1 0 -p 1 1 0 -p 1 1 0 -p 1 -1 0 -p 1 -1 0 -p 1 -1 0 -p -1 -1 0 -p -1 -1 0 
-p -1 -1 0 -p -1 1 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8 -n ($gtCname+$mingzi);

select -r ($gtCname+$mingzi);

duplicate -rr -n ($gtCname+$mingzi+"_temp");
scale 1.1 1.1 1.1;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
pickWalk -d down;

select -add ($gtCname+$mingzi);
parent -s -r;
delete ($gtCname+$mingzi+"_temp");

select -r ($gtCname+$mingzi);
scale 1.2 1.2 1.2;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;

if($vv==1)
{
setAttr ($gtCname+$mingzi+".rz") 45;
select -r ($gtCname+$mingzi+".cv[0:*]");
rotate -r 0 0 -45;
}

circle -ch 0 -o on -r 0.15 -n ($gtCname+$name);
string $b[]=`ls -sl`;

setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");

select -add ($gtCname+$mingzi);
parent;
string $tempN[]=`ls -sl`;
transformLimits -tx $minH $maxH -etx 1 1 ($tempN[0]);
transformLimits -ty $minV $maxV -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);

textCurves -ch 0 -f "Times New Roman|h-13|w400|c0" -t $name;
string $sel[]=`ls -sl`;
rename $sel[0] ($gtCname+$name+"temp");
string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;

for($i=0;$i<size($childs);$i++)
{
  string $c[]=`listRelatives -fullPath -c ($childs[$i])`;
  for($j=0;$j<size($c);$j++)
  {
  select -r ($c[$j]);
  select -add ($gtCname+$name+"temp");
  parent;
  }
delete ($childs[$i]);
}

string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;
select -r $childs[0];
rename $name;
string $currentN[]=`ls -sl`;

for($i=1;$i<size($childs);$i++)
   {
  select -r ($childs[$i]);
  makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
  pickWalk -d down;
  select -add $currentN[0];
  parent -s -r;
  delete ($childs[$i]);
}


select -r $currentN[0];
CenterPivot;
scale 0.75 0.75 0.75;
spaceLocator -p 0 0 0 -n ($name+"temp");
move 0 -1.5 0 ;
select -add $currentN[0];
delete `pointConstraint`;
delete ($name+"temp");
select -r $currentN[0];

group -n ($xiaba+"faceConName");
CenterPivot;
select -add ($gtCname+$mingzi);
parent;
delete ($gtCname+$name+"temp");


select -r ($gtCname+$mingzi);
select -add ($gtCname+"faceFrame") ;
parent;
setAttr ($gtCname+$mingzi+".tx") 0;
setAttr ($gtCname+$mingzi+".ty") 0;
setAttr ($gtCname+$mingzi+".tz") 0;
setAttr ($gtCname+$mingzi+".sx") 1;
setAttr ($gtCname+$mingzi+".sy") 1;
setAttr ($gtCname+$mingzi+".sz") 1;

}
/////////////////////////////////////////////////
if($selec==2){
curve -d 3 -p -1 1 0 -p 1 1 0 -p 1 1 0 -p 1 1 0 -p 1 0 0 -p 1 0 0 -p 1 0 0 -p -1 0 0 -p -1 0 0 -p -1 0 0 -p -1 1 0 
-k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8 -n ($gtCname+$mingzi);

select -r ($gtCname+$mingzi);
CenterPivot;
setAttr ($gtCname+$mingzi+".scaleY") 0.15;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;

duplicate -rr -n ($gtCname+$mingzi+"_temp");
scale 1.1 2 1.1;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
pickWalk -d down;

select -add ($gtCname+$mingzi);
parent -s -r;
delete ($gtCname+$mingzi+"_temp");

circle -ch 0 -o on -r 0.24 -n ($gtCname+$name);
move 0 0.5 0;
makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;

string $b[]=`ls -sl`;


select -r ($b[0]+".cv[1]") ($b[0]+".cv[5]") ;
select -tgl ($b[0]+".cv[3]") ($b[0]+".cv[7]") ;
scale  0.6 0.6 0.6 ;
select -r ($b[0]+".cv[0:7]");
scale 1 1.3 1;

setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
setAttr -lock true ($b[0]+".ty");
select -r $b;
select -add ($gtCname+$mingzi);
parent;


string $tempN[]=`ls -sl`;
transformLimits -tx $minH $maxH -etx 1 1 ($tempN[0]);
transformLimits -ty 0 0 -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);

textCurves -ch 0 -f "Times New Roman|h-13|w400|c0" -t $name;
string $sel[]=`ls -sl`;
rename $sel[0] ($gtCname+$name+"temp");
string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;

for($i=0;$i<size($childs);$i++)
{
string $c[]=`listRelatives -fullPath -c ($childs[$i])`;
for($j=0;$j<size($c);$j++)
{
select -r ($c[$j]);
select -add ($gtCname+$name+"temp");
parent;
}
delete ($childs[$i]);
}

string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;
select -r $childs[0];
rename $name;
string $currentN[]=`ls -sl`;
for($i=1;$i<size($childs);$i++)
{
select -r ($childs[$i]);
makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
pickWalk -d down;
select -add $currentN[0];
parent -s -r;
delete ($childs[$i]);
}


select -r $currentN[0];
CenterPivot;
scale 0.75  0.75 0.75;
spaceLocator -p 0 0 0 -n ($name+"temp");
move 0 -0.05 0 ;
select -add $currentN[0];
delete `pointConstraint`;
delete ($name+"temp");
select -r $currentN[0];;
group -n ($xiaba+"faceConName");
CenterPivot;
select -add ($gtCname+$mingzi);
parent;
delete ($gtCname+$name+"temp");


select -r ($gtCname+$mingzi);
select -add ($gtCname+"faceFrame") ;
parent;
setAttr ($gtCname+$mingzi+".tx") 0;
setAttr ($gtCname+$mingzi+".ty") 0;
setAttr ($gtCname+$mingzi+".tz") 0;
setAttr ($gtCname+$mingzi+".sx") 1;
setAttr ($gtCname+$mingzi+".sy") 1;
setAttr ($gtCname+$mingzi+".sz") 1;
setAttr ($gtCname+$mingzi+".rx") 0;
setAttr ($gtCname+$mingzi+".ry") 0;
setAttr ($gtCname+$mingzi+".rz") 0;
}
///////////////////////////////////////////////////////


if($selec==3){
curve -d 3 -p 0 -1 0 -p 1 -1 0 -p 1 -1 0 -p 1 -1 0 -p 1 1 0 -p 1 1 0 -p 1 1 0 -p 0 1 0 -p 0 1 0 -p 0 1 0 -p 0 -1 0 
-k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8 -n ($gtCname+$mingzi);

select -r ($gtCname+$mingzi);
CenterPivot;

scale 0.15 1 1 ($gtCname+$mingzi);
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;

duplicate -rr -n ($gtCname+$mingzi+"_temp");
scale 2 1.1 1.1;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
pickWalk -d down;

select -add ($gtCname+$mingzi);
parent -s -r;
delete ($gtCname+$mingzi+"_temp");

circle -ch 0 -o on -r 0.25 -n ($gtCname+$name);
move 0.5 0 0;
makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
string $b[]=`ls -sl`;
select -r ($b[0]+".cv[1]") ($b[0]+".cv[5]") ;
select -tgl ($b[0]+".cv[3]") ($b[0]+".cv[7]") ;
scale  0.6 0.6 0.6 ;
select -r ($b[0]+".cv[0:7]");
scale 1.3 1 1;

setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
setAttr -lock true ($b[0]+".tx");

select -r $b;
select -add ($gtCname+$mingzi);
parent;


string $tempN[]=`ls -sl`;
transformLimits -tx 0 0 -etx 1 1 ($tempN[0]);
transformLimits -ty $minV $maxV -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);

textCurves -ch 0 -f "Times New Roman|h-13|w400|c0" -t $name;
string $sel[]=`ls -sl`;
rename $sel[0] ($gtCname+$name+"temp");
string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;

for($i=0;$i<size($childs);$i++){
string $c[]=`listRelatives -fullPath -c ($childs[$i])`;
for($j=0;$j<size($c);$j++){
select -r ($c[$j]);
select -add ($gtCname+$name+"temp");
parent;
}
delete ($childs[$i]);
}

string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;
select -r $childs[0];
rename $name;
string $currentN[]=`ls -sl`;
for($i=1;$i<size($childs);$i++){
select -r ($childs[$i]);
makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
pickWalk -d down;
select -add $currentN[0];
parent -s -r;
delete ($childs[$i]);
}


select -r $currentN[0];
CenterPivot;
scale 0.75 0.75 0.75;
spaceLocator -p 0 0 0 -n ($name+"temp");
move 0.5 -1.5 0 ;
select -add $currentN[0];
delete `pointConstraint`;
delete ($name+"temp");
select -r $currentN[0];;
group -n ($xiaba+"faceConName");
CenterPivot;
select -add ($gtCname+$mingzi);
parent;
delete ($gtCname+$name+"temp");




select -r ($gtCname+$mingzi);
select -add ($gtCname+"faceFrame") ;
parent;
setAttr ($gtCname+$mingzi+".tx") 0;
setAttr ($gtCname+$mingzi+".ty") 0;
setAttr ($gtCname+$mingzi+".tz") 0;
setAttr ($gtCname+$mingzi+".sx") 1;
setAttr ($gtCname+$mingzi+".sy") 1;
setAttr ($gtCname+$mingzi+".sz") 1;
setAttr ($gtCname+$mingzi+".rx") 0;
setAttr ($gtCname+$mingzi+".ry") 0;
setAttr ($gtCname+$mingzi+".rz") 0;
}

//////////////////////////////////////////////


if($selec==4){
curve -d 3 -p -1 1 0 -p 1 1 0 -p 1 1 0 -p 1 1 0 -p 1 -1 0 -p 1 -1 0 -p 1 -1 0 -p -1 -1 0 -p -1 -1 0 
-p -1 -1 0 -p -1 1 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8 -n ($gtCname+$mingzi);

select -r ($gtCname+$mingzi);

duplicate -rr -n ($gtCname+$mingzi+"_temp");
scale 1.1 1.1 1.1;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
pickWalk -d down;

select -add ($gtCname+$mingzi);
parent -s -r;
delete ($gtCname+$mingzi+"_temp");

select -r ($gtCname+$mingzi);
scale 1.2 1.2 1.2;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;


circle -ch 0 -o on -r 0.35 -n ($gtCname+$name);
string $b[]=`ls -sl`;
scale 1 0.75 1 $b[0];

setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
select -r $b;
select -add ($gtCname+$mingzi);
parent;
string $tempN[]=`ls -sl`;
transformLimits -tx -1 1 -etx 1 1 ($tempN[0]);
transformLimits -ty -.5 .5 -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);
///////////////
circle -ch 0 -o on -r 0.35 -n ($gtCname+$name+"Up");
string $b[]=`ls -sl`;
move 0 0.5 0 $b[0];
select -r $b;
makeIdentity -apply true -t 1 -r 1 -s 1 -n 0;


select -r ($b[0]+".cv[5]") ;
move -r 0 0.225 0 ;
select -r ($b[0]+".cv[4:6]") ;
move -r 0 0.225 0 ;


setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
select -r ($b);
select -add ($gtCname+$mingzi);
parent;
string $tempN[]=`ls -sl`;

transformLimits -tx -1 1 -etx 1 1 ($tempN[0]);
transformLimits -ty -.5 .5 -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);

///////////////////////////

circle -ch 0 -o on -r 0.35 -n ($gtCname+$name+"Down");
string $b[]=`ls -sl`;
move 0 -0.5 0 $b[0];
select -r ($b);
makeIdentity -apply true -t 1 -r 1 -s 1 -n 0;

select -r ($b[0]+".cv[1]") ;
move -r 0 -0.225 0 ;
select -r ($b[0]+".cv[0:2]") ;
move -r 0 -0.225 0 ;

setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
select -r ($b);
select -add ($gtCname+$mingzi);
parent;
string $tempN[]=`ls -sl`;

transformLimits -tx -1 1 -etx 1 1 ($tempN[0]);
transformLimits -ty -.5 .5 -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);
//////////////////////////////////////////

textCurves -ch 0 -f "Times New Roman|h-13|w400|c0" -t $name;
string $sel[]=`ls -sl`;
rename $sel[0] ($gtCname+$name+"temp");
string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;

for($i=0;$i<size($childs);$i++){
string $c[]=`listRelatives -fullPath -c ($childs[$i])`;
for($j=0;$j<size($c);$j++){
select -r ($c[$j]);
select -add ($gtCname+$name+"temp");
parent;
}
delete ($childs[$i]);
}

string $childs[]=`listRelatives -fullPath -c  ($gtCname+$name+"temp")`;
select -r $childs[0];
rename $name;
string $currentN[]=`ls -sl`;
for($i=1;$i<size($childs);$i++){
select -r ($childs[$i]);
makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
pickWalk -d down;
select -add $currentN[0];
parent -s -r;
delete ($childs[$i]);
}

select -r $currentN[0];
CenterPivot;
scale 0.75  0.75  0.75 ;
spaceLocator -p 0 0 0 -n ($name+"temp");
move 0 -1.5 0 ;
select -add $currentN[0];
delete `pointConstraint`;
delete ($name+"temp");
select -r $currentN[0];;
group -n ($xiaba+"faceConName");
CenterPivot;
select -add ($gtCname+$mingzi);
parent;
delete ($gtCname+$name+"temp");

select -r ($gtCname+$mingzi);
select -add ($gtCname+"faceFrame") ;
parent;
setAttr ($gtCname+$mingzi+".tx") 0;
setAttr ($gtCname+$mingzi+".ty") 0;
setAttr ($gtCname+$mingzi+".tz") 0;
setAttr ($gtCname+$mingzi+".sx") 1;
setAttr ($gtCname+$mingzi+".sy") 1;
setAttr ($gtCname+$mingzi+".sz") 1;
    }
}


 
 
 
 
 
 
//////////////完成表情控制面板////////////////////////////
global proc zxb_mianbanwancheng_proc(){
$teststring=`textFieldGrp -q -tx UI_head_mode `;

$gtCN=$teststring;

string $gtCname;
$gtCname=$gtCN+"_";
string $shape[]=`listRelatives  -s ($gtCname+"faceFrame")`;

for($j=0;$j<size($shape);$j++){
setAttr ($shape[$j]+".overrideEnabled") 1;
setAttr ($shape[$j]+".overrideColor") 22;
}

string $frameH[]=`listRelatives  -c -type "transform" ($gtCname+"faceFrame")`;
for($i=0;$i<size($frameH);$i++)
{

string $shape[]=`listRelatives  -c -s ($frameH[$i])`;
for($j=0;$j<size($shape);$j++)
 {
setAttr ($shape[$j]+".overrideEnabled") 1;
setAttr ($shape[$j]+".overrideDisplayType") 1;
  }

string $childs[]=`listRelatives -fullPath -c -type "transform" ($frameH[$i])`;
int $size=size($childs);

setAttr ($childs[($size-1)]+".overrideEnabled") 1;
setAttr ($childs[($size-1)]+".overrideDisplayType") 1;

for($j=0;$j<size($childs)-1;$j++)
     {
setAttr ($childs[$j]+".overrideEnabled") 1;
setAttr ($childs[$j]+".overrideColor") 22;
        }
    } 
zxb_zairufangfa_vsanniu_proc("hedemianbankuan_bianji_button");   
zxb_zairufangfa_vsanniu_on_proc("hedemianbankuan_wancheng_button");   

zxb_zairufangfa_vsanniu_on_proc("hedemianbankuan_Add_button");
zxb_zairufangfa_vsanniu_on_proc("hedemianbankuan_Add_delete_button");
      
}

//////////////编辑面板//////////////////
global proc zxb_mianbanbianji_proc(){
$teststring=`textFieldGrp -q -tx UI_head_mode `;
$gtCN=$teststring;

string $gtCname;
$gtCname=$gtCN+"_";

string $frameH[]=`listRelatives -fullPath -c -type "transform"  ($gtCname+"faceFrame")`;
for($i=0;$i<size($frameH);$i++){

string $shape[]=`listRelatives -fullPath -c -s ($frameH[$i])`;
for($j=0;$j<size($shape);$j++){
setAttr ($shape[$j]+".overrideEnabled") 0;
setAttr ($shape[$j]+".overrideDisplayType") 0;
}

string $childs[]=`listRelatives -fullPath -c -type "transform"  ($frameH[$i])`;
int $size=size($childs);

setAttr ($childs[($size-1)]+".overrideEnabled") 0;
setAttr ($childs[($size-1)]+".overrideDisplayType") 0;

    }
    
zxb_zairufangfa_vsanniu_proc("hedemianbankuan_wancheng_button"); 
zxb_zairufangfa_vsanniu_proc("hedemianbankuan_Add_button");
zxb_zairufangfa_vsanniu_proc("hedemianbankuan_Add_delete_button");
zxb_zairufangfa_vsanniu_on_proc("hedemianbankuan_bianji_button");
}


//////////添加控制器面板////////////////////
global proc zxb_mianban_Addmianban_proc()
{
if(`window -ex zxb_ADD_mianbucon`) deleteUI  zxb_ADD_mianbucon;
window -wh 420 200 -t "添加控制器" zxb_ADD_mianbucon;
columnLayout -adjustableColumn 0; 
checkBox -l "默认方框 选中长条" -value 0 zxb_add_changtiao;
textFieldGrp  -cw2 100 130 -l "外控制器名字前缀大写"    W_con_name;
textFieldGrp  -cw2 100 130 -l "内控制器名字前缀小写"    N_con_name;
button -l  "添加控制器"  -c "zxb_mianban_Add_proc";
showWindow  ;
}


global proc zxb_mianban_Add_proc()
{
    int$aa=`checkBox -q -v zxb_add_changtiao`;
    string$teststring=`textFieldGrp -q -tx UI_head_mode `;
    string$con=`textFieldGrp -q -tx  UI_head_controller`;
    string$W_Neme=`textFieldGrp -q -tx W_con_name `;
    string$N_Neme=`textFieldGrp -q -tx N_con_name `;
    $head=$teststring+"_";
    int$bb=1;
    if($aa==0){$bb=1;}
    if($aa==1){$bb=2;}
    zxb_chuangjananniu_proc($bb,$N_Neme,0,$W_Neme);
    
    
    string$add_head_allcon="add_head_allcon";
    zxb_ADD_shuxing_string_proc($con,$add_head_allcon);
    string$conshuzu=`getAttr ($con+".add_head_allcon")`; 
    string$array_B[] = stringToStringArray($conshuzu, " ");//字符串转化数组
    int$ex=`objExists $array_B[0]`;
    string$addmingzi="";
    if($ex==1)
       {
         for ($i=0;$i<size($array_B);$i++)
              {
               string$temp_mingzxi=$array_B[$i];
               $addmingzi+=$temp_mingzxi+" "+$N_Neme+" ";
               //int$a=size($array_B)-1;
               
               }
       }else
             {
              string$n_neme=$N_Neme+" ";
             setAttr -type "string" ($con+".add_head_allcon") $n_neme  ;
    
             }
       
   if($ex==1){ setAttr -type "string" ($con+".add_head_allcon")  $addmingzi ;}
    
    /*string$dede=$head+$N_Neme;
    string$temp=`getAttr ($con+".Head_allcon")`;
    $temp+=$temp+$dede+" ";
    setAttr -type "string" ($con+".Head_allcon") $temp;*/
}



global proc zxb_mianban_Add_delete_proc()
{
    string$bianliang[]=`ls -sl`;
    string$con=`textFieldGrp -q -tx  UI_head_controller`;
    string$temp=`getAttr ($con+".Head_allcon")`;
    string$array[] = stringToStringArray($temp, " ");//字符串转化数组
    int$ex=`objExists $bianliang[0]`; 
    if($ex==0){ error "请选择表情控制框";}

   string $andbn[]=`listRelatives -c -fullPath  -type "transform" $bianliang[0]`;
   string $rrrrr[]=`listRelatives -c  -type "transform" $bianliang[0]`;
   string$mingzi="";
   for($j=0;$j<size($andbn);$j++)
   {
       string $tempss[]=`listRelatives -s   $andbn[$j]`;
       int$ex=`objExists $tempss[0]`;    ///判断
      if($ex==1){$mingzi=$rrrrr[$j];}
   }
   
 

    string$all_name="";
    
    
   for ($y=0;$y<size($array);$y++)
        {
        string$name=$array[$y];
        if($name==$mingzi)
          {
              //$all_name+=$name+" ";
          $all_name=$name;
          }
        }

   //setAttr -type "string" ($con+".Head_allcon") $all_name ;

    int$ex=`objExists $all_name`; 
    if($ex==1){ error "选中的控制器是默认控制器";}else{ delete $bianliang[0];}
  
}




//////////////////////////////////////////
global proc zxb_open_reverse_proc()
{
 
   string$FKJaw_M_kongzhiqi=`textFieldGrp -q -tx UI_jaw_controller `;
    string$toubu=`textFieldGrp -q -tx UI_head_controller `;
   string$hean_mode=` getAttr ($toubu+".base_bs_lalian")`;
   string $array[]= stringToStringArray($hean_mode, " ");//字符串转化数组
   
   string$hean_bs=` getAttr ($toubu+".base_bs_shuxing")`;
     
   string$open_reverse="open_reverse";
   select -r $FKJaw_M_kongzhiqi;
   zxb_ADD_shuxing_double_A_proc($FKJaw_M_kongzhiqi,$open_reverse);
   string$jiedian=($FKJaw_M_kongzhiqi+"_setRange");
   zxb_ADD_jiedian_proc($jiedian,"setRange");
   
   connectAttr -f ($FKJaw_M_kongzhiqi+".open_reverse") ($jiedian+".valueX");
   setAttr ($jiedian+".oldMaxX") 10;
   setAttr ($jiedian+".maxX") 1;
   
   string$erverse_jiedian=($FKJaw_M_kongzhiqi+"_erverse");
   
   zxb_ADD_jiedian_proc($erverse_jiedian,"reverse");
   
   connectAttr -f  ($jiedian+".outValueX") ($erverse_jiedian+".inputX");
   connectAttr -f ($erverse_jiedian+".outputX") ($hean_bs+"."+$array[1]);
   connectAttr -f ($jiedian+".outValueX") ($hean_bs+"."+$array[0]);
   button -e -en 0 hede_open_reverse_button;
   
}



////////////////////////////选择其他模型上的线
global proc string zxb_xuanzebutongmoxing_jiluxuanzhededian(int $panduan, string $mesh_name)
{
    
   //string $mesh_name="head_mesh_zuiba_nianlian";
   string $bianliang[]=`ls -sl -fl`;

 //int $panduan=0;
   string $dian="vtx";
   if($panduan==0)
    {
    $dian="e";
    }else
    {
     $dian="vtx";
     }

   select -cl  ;


  for ($ll=0;$ll<size($bianliang);$ll++)
  {
    string $temp_name[];
    int $chafen=`tokenize $bianliang[$ll] "[" $temp_name`;
    int $chafen=`tokenize $temp_name[1] "]" $temp_name`;
    int $xuhao=$temp_name[0];
    select -add ($mesh_name+"."+$dian+"["+$xuhao+"]");
   // print  $temp_name;
    
   }
   
   string$aaa="";
   string $qq[]=`ls -sl -fl`;
    for ($ll=0;$ll<size($qq);$ll++)
        {
         string$temp=$qq[$ll];
         $aaa+=$temp+" " ;
         }
   return $aaa;
}/////////////////////////////////自动创建拉链嘴巴/////////////////////////////////////////////
global proc zxb_zuibalalian_all_proc() 
{
    string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
    string$lalian_modess=` getAttr ($Controller+".base_bs_lalian ")`;
    string $lalian_modes[]= stringToStringArray($lalian_modess, " ");//反向嘴巴模型
    string$qvxian_insidess=`textFieldGrp -q -tx  UI_mouth_inside_wire`;//
    string $qvxian_inside[]= stringToStringArray($qvxian_insidess, " ");//反向嘴巴模型
    
   string$repeated=$lalian_modes[0];
   textFieldGrp -e -tx  $repeated zxb_zairumode ;//载入反向模型
   string$Face_zipper_Group="Face_zipper_Group";
   zxb_ADD_kongzu_proc($Face_zipper_Group);
   setAttr ($Face_zipper_Group+".visibility") 0;
   setAttr -lock true ($Face_zipper_Group+".v");
    parent $Face_zipper_Group "Face_Group";
   
   select -r $qvxian_inside;
   string$open_qvxian_s=zxb_xuanzebutongmoxing_jiluxuanzhededian(0 , $lalian_modes[0]);
   textFieldGrp -e -tx  $open_qvxian_s UI_mouth_temp_wire ;//曲线
   string$Face_zipper_Group_curve_grp="Face_zipper_Group_curve";
   
   zxb_ADD_kongzu_proc($Face_zipper_Group_curve_grp);
   setAttr ($Face_zipper_Group_curve_grp+".visibility") 0;
   setAttr -lock true ($Face_zipper_Group_curve_grp+".v");
   parent$Face_zipper_Group_curve_grp  "Face_zipper_Group";
   zxb_ADD_shuxing_string_proc($Controller,"lip_open_qvxian");
   zxb_ADD_shuxing_string_proc($Controller,"lip_close_qvxian");
   zxb_ADD_shuxing_string_proc($Controller,"lip_follow_qvxian");


   string$aaaa=`zxb_zuiba_tiqv_lalian_open_proc`;
   string$bbbb=`zxb_zuiba_tiqv_lalian_close_proc`;
   string$cccc=`zxb_zuiba_tiqv_lalian_follow_proc`;
   
  
   
   setAttr -type "string" ($Controller+".lip_open_qvxian") $aaaa;
   setAttr -type "string" ($Controller+".lip_close_qvxian") $bbbb;
   setAttr -type "string" ($Controller+".lip_follow_qvxian") $cccc;
      
    string$temp_op=`textFieldGrp -q -tx  UI_mouth_zipper_wire_open_A`;
    string$temp_close=`textFieldGrp -q -tx  UI_mouth_zipper_wire_close_B`;
    string$temp_op_close=$temp_op+$temp_close;
    textFieldGrp -e -tx  $temp_op_close UI_mouth_zipper_wire_close_open ;//曲线

    
    zxb_dingweiqi_kongzhiqvxian;
    zxb_dingweiqi_gensuiqvxian;
    zxb_global_bolangzui;
    
   
    string$temp_qvxians=$aaaa+$bbbb+$cccc;
    string $all_qvxians[]= stringToStringArray($temp_qvxians, " ");//反向嘴巴模型

    for ($i=0;$i<size($all_qvxians);$i++)
        { 
        string$qvxian=$all_qvxians[$i];
        parent $qvxian $Face_zipper_Group;
        }
    string$lalian_loc_ss=` getAttr ($Controller+".lalianloc")`;
    string $lalian_loc_s[]= stringToStringArray($lalian_loc_ss, " ");//反向嘴巴模型
    parent $lalian_loc_s[0] $Face_zipper_Group_curve_grp;
    setAttr  ($lalian_loc_s[0]+".visibility") 0;
    setAttr -lock true ($lalian_loc_s[0]+".v");
    
     parent $lalian_loc_s[1] $Face_zipper_Group_curve_grp;
    setAttr  ($lalian_loc_s[1]+".visibility") 0;
    setAttr -lock true ($lalian_loc_s[1]+".v");
    
    string $temp_aa[]= stringToStringArray($aaaa, " ");//反向嘴巴模型
    string $temp_bb[]= stringToStringArray($bbbb, " ");//反向嘴巴模型
    string $temp_cc[]= stringToStringArray($cccc, " ");//反向嘴巴模型
     for ($i=0;$i<size($temp_aa);$i++)
          {
              string$temp_qvxian_a= $temp_aa[$i];
              string$temp_qvxian_b= $temp_bb[$i];
              string$temp_qvxian_c= $temp_cc[$i];
              parent  $temp_qvxian_a $Face_zipper_Group_curve_grp;
              parent  $temp_qvxian_b $Face_zipper_Group_curve_grp;
              parent  $temp_qvxian_c $Face_zipper_Group_curve_grp;
           }
 
button -e -en 0 hedebs_button;
}





///////////////////////////提取上下曲线方法////////////////////////////////////////////////////
global proc string zxb_zuiba_tiqvqvxianfangfa_proc(int$a,string$mingzi,string$qianzui,string$xian_A)
{
//int$a=1;
//string$mingzi="open";
//string$xian_Ass[]= stringToStringArray($xian_A, " ");//字符串转化数组
string$xian=$xian_A;
//string$modess=`textFieldGrp -q -tx  zxb_zairumode`;
//string$Aqvxianss=`textFieldGrp -q -tx zxb_qvxianmingzi `;
 // string$Aqvxians[];
 // clear $Aqvxians;
 // int $nemt=`tokenize $Aqvxianss" " $Aqvxians`;//分离字符串存到变量
  string$Axianxian=$qianzui;


string$qvxianss[]= stringToStringArray($xian, " ");//字符串转化数组
string $bianliang[]=$qvxianss;//提取曲线名字


string$temp_qvxian[];
clear $temp_qvxian;
int $nemt=`tokenize $bianliang[0]"."  $temp_qvxian`;//分离字符串存到变量
string$moxing=$temp_qvxian[0];

select -r $bianliang;
ConvertSelectionToVertices;
string $dingdian[]=`ls -sl -fl`;


      string$R_cv="";
      string$L_cv="";
     string$vtxs[]=$dingdian;
     float$dd=-100000000000000;
     float$xx=1000000000000000;
     string$dian_L="";
     string$dian_R="";
     for ($i=0;$i<size($vtxs);$i++)
          {
           string$vtx=$vtxs[$i];
           float$bn_pos[]=`xform -q -ws -t $vtx`;
           if($bn_pos[0]>$dd)
             {
             $dd=$bn_pos[0];
             $dian_L=$vtx;
             }
             if($bn_pos[0]<$xx)
             {
             $xx=$bn_pos[0];
             $dian_R=$vtx;
             }
             
           }
           
            $L_cv=$dian_L;   
     $R_cv=$dian_R;
 float $R_POS[]=`xform -q -ws -t $R_cv`; 
 string$qvxian_mingzi=$Axianxian+"_temp_curve";
  select -r $qvxianss;
  polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $qvxian_mingzi;
 DeleteHistory;
 float$pamte=zxb_return_curve_U($R_POS[0],$R_POS[1],$R_POS[2],$qvxian_mingzi);
 select -r ($qvxian_mingzi+".u["+$pamte+"]") ;
float $tempp_POS[]=`xform -q -ws -t $dingdian[0]`; 
int$jisuan=size($dingdian)-1;
float $tempp_POS_A[]=`xform -q -ws -t $dingdian[$jisuan]`; 
float $R_POaS=$R_POS[0]+$R_POS[1]+$R_POS[2];
float $R_PObS=$tempp_POS[0]+$tempp_POS[1]+$tempp_POS[2];
if($R_POaS!=$R_PObS)
  {
    moveNurbsCurveSeam;
   }
 select -r ($qvxian_mingzi+".cv[0:999999999]");
 
 string $qvxian_A[]=`ls -sl -fl`;
 
 
string$dianLL="";
 //string$temp_cv=$dingdian[$i];
float $cv_pos[]=`xform -q -ws -t $L_cv`;
float$maga=1000000000000;
     
for($iii=0;$iii<size($qvxian_A);$iii++)
   { 
     string$mag_cv=$qvxian_A[$iii];
     float $mag_po[]=`xform -q -ws -t $mag_cv`;
     float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
     if($weizhi<$maga){$maga=$weizhi;$dianLL=$mag_cv;}
     } 
    
//print $dianLL;
  string$ccv[];
  clear $ccv;
  int $nemt=`tokenize $dianLL"[" $ccv`;//分离字符串存到变量
   int $nemt=`tokenize $ccv[1]"]" $ccv`;//分离字符串存到变量
  string$shu=$ccv[0];
 
 
 int$qvxiancv_size=size($qvxian_A);
int$temp_a=$shu;

float$exa=0;
float$exb=0;


if($a==0)
{
select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exb=`zxb_qvfengshangzi`;

select -r ($qvxian_mingzi+".cv[0:999999999]");
select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exa=`zxb_qvfengshangzi`;
}
if($a==1)
 {
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exa=zxb_normal_pingjunshu($moxing);
  
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exb=`zxb_normal_pingjunshu($moxing)`;
  }


string$up_qvxiancvs[];
clear$up_qvxiancvs;
string$dw_qvxiancvs[];
clear$dw_qvxiancvs;



if($exb>$exa)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
 $dw_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  }
if($exa>$exb)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $dw_qvxiancvs=`ls -sl -fl`;
   }

   
 //select -r $dingdian ;
//string $xiangliang[]=`ls -sl -fl`;
string$UP_zuijing="";
string$DW_zuijing="";


for($o=0;$o<2;$o++)
{
    string$temp_suzu[];
    clear$temp_suzu;
   if($o==0){$temp_suzu=$up_qvxiancvs;}
   if($o==1){$temp_suzu=$dw_qvxiancvs;}
   for($i=0;$i<size($temp_suzu);$i++)
    {
     string$temp_cv=$temp_suzu[$i];
     float $cv_pos[]=`xform -q -ws -t $temp_cv`;
     float$mag=1000000000000;
     string$dian="";
     for($ii=0;$ii<size($dingdian);$ii++)
        { 
         string$mag_cv=$dingdian[$ii];
         float $mag_po[]=`xform -q -ws -t $mag_cv`;
         float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
         if($weizhi<$mag){$mag=$weizhi;$dian=$mag_cv+" ";}
         } 
     if($o==0){$UP_zuijing+=$dian;}
     if($o==1){$DW_zuijing+=$dian;}  
     }
    
 }   
       string$up_zuijingdw[]= stringToStringArray($UP_zuijing, " ");//字符串转化数组
       string$dw_zuijingdw[]= stringToStringArray($DW_zuijing, " ");//字符串转化数组 
       
string$head_qvxian=$Axianxian+"_"+$mingzi+"_UP";//open  

//select -r $up_zuijingdw;
//select -r $dw_zuijingdw; 
select -r $up_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian;

string$head_qvxian_b=$Axianxian+"_"+$mingzi+"_DW";//open
select -r $dw_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian_b;


string$temp_mingzi="";
$temp_mingzi+=$head_qvxian+" "+$head_qvxian_b+" ";
delete $qvxian_mingzi;



string$dian_LRA=$head_qvxian+".cv[0]";
float $pos_A[]=`xform -q -ws -t$dian_LRA`;
string$dian_LRB=$head_qvxian_b+".cv[0]";
float $pos_B[]=`xform -q -ws -t $dian_LRB`;

if($pos_A[0]!=$pos_B[0]){reverseCurve -ch 1 -rpo 1 $head_qvxian;}


 return $temp_mingzi;
}



//////////////定位器控制器曲线/////////////////////

global proc  zxb_dingweiqi_kongzhiqvxian()
{
//string $bianliang[]=`ls -sl`;//选中曲线D  没有历史记录的曲线
 string $bianliang_sss=`textFieldGrp -q -tx  UI_mouth_zipper_wire_follow_D`;
string $bianliang[]= stringToStringArray($bianliang_sss, " ");//字符串转化数组
string $qianzui=`textFieldGrp -q -tx UI_mouth_zipper_prefix `;


string$curve_temp="zxb_"+$qianzui+"_curve_follow__grp";

zxb_ADD_kongzu_proc($curve_temp);
parent $curve_temp "Face_zipper_Group";
for($i=0;$i<size($bianliang);$i++) 
{
    string $qvxian_A=$bianliang[$i];
    select -r ($qvxian_A+".cv[0:999999999999]");
    string  $cvs[]=`ls -sl -fl`;
    
    int $panduan=`objExists ($qvxian_A+"_locGrp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian_A+"_locGrp");
        }
     select -cl  ;
     group -empty -n ($qvxian_A+"_locGrp");
     setAttr ($qvxian_A+"_locGrp.visibility") 0;
     setAttr -lock true ($qvxian_A+"_locGrp"+".v");
     
     parent($qvxian_A+"_locGrp") $curve_temp ;
     int $panduanA=`objExists ($qvxian_A+"_gengsui_"+"nearestPointOnCurve")`;//查询这个物体是否纯在
     if($panduanA==1){ delete ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");}
     createNode nearestPointOnCurve -n  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");//创建曲线最近点节点
     string $qvxian_shp[]=`listRelatives -s $qvxian_A`;
     connectAttr -force ($qvxian_shp[0]+".worldSpace[0]")  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve.inputCurve");
       
    for($j=0;$j<size($cvs);$j++) 
    {
        string  $cvdian_bianliang=$cvs[$j];
       spaceLocator -p 0 0 0 -n($qvxian_A+"_loc_A_"+$j);
       spaceLocator -p 0 0 0 -n($qvxian_A+"_loc_B_"+$j);
       parent ($qvxian_A+"_loc_B_"+$j)  ($qvxian_A+"_loc_A_"+$j);
       
       select -r ($qvxian_A+"_loc_B_"+$j);
       group -n  ($qvxian_A+"_locgrp_"+$j);
       group -n  ($qvxian_A+"_locgrp_A"+$j);
       group -n  ($qvxian_A+"_locgrp_B"+$j);
       //parent  ($qvxian_A+"_locgrp_B"+$j) ($qvxian_A+"_loc_A_"+$j);
       parent  ($qvxian_A+"_loc_A_"+$j) ($qvxian_A+"_locGrp");
       float $poslist[]= `xform -q -ws -t  $cvdian_bianliang`;
       setAttr -type float3 ($qvxian_A+"_gengsui_"+"nearestPointOnCurve"+".inPosition") $poslist[0] $poslist[1] $poslist[2];
       float $poslist_A[]=`getAttr ($qvxian_A+"_gengsui_"+"nearestPointOnCurve"+".position")`;
      xform -ws -t    $poslist_A[0] $poslist_A[1] $poslist_A[2] ($qvxian_A+"_loc_A_"+$j);//定位器1的位置
       xform -ws -t  $poslist[0] $poslist[1] $poslist[2]($qvxian_A+"_loc_B_"+$j) ;//定位器1的位置
       string $loc_shp[]=`listRelatives -s ($qvxian_A+"_loc_B_"+$j)`;
       connectAttr -f ($loc_shp[0]+".worldPosition[0]") ($qvxian_shp[0]+".controlPoints["+$j+"]");
     }
     
     delete  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");
}

 button -e -en 0 UI_mouth_zipper_follow_DD_button;//
}

////////////////////////////曲线控制器定位器//////////////////////////////////////////

global proc  zxb_dingweiqi_gensuiqvxian()
{
//string $bianliang[]=`ls -sl`;//选中另外4条曲线
string $bianliang_sss=`textFieldGrp -q -tx  UI_mouth_zipper_wire_close_open`;
string $bianliang[]= stringToStringArray($bianliang_sss, " ");//字符串转化数组
string $qianzui=`textFieldGrp -q -tx UI_mouth_zipper_prefix `;

string$qvxianzu="zxb_"+$qianzui+"_curve_open_close_grp";

zxb_ADD_kongzu_proc($qvxianzu);
parent $qvxianzu "Face_zipper_Group";
 int $panduan_A=`objExists ("temp_qvxian_nearestPointOnCurve")`;//查询这个物体是否纯在
 if($panduan_A==1){delete ("temp_qvxian_nearestPointOnCurve"); }
createNode nearestPointOnCurve -n  ("temp_qvxian_nearestPointOnCurve");//创建曲线最近点节点

for($i=0;$i<size($bianliang);$i++) 
{
    string $qvxian=$bianliang[$i]; 
     string $qvxian_shp[]=`listRelatives -s $qvxian`;
     connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ("temp_qvxian_nearestPointOnCurve.inputCurve") ;
    
 
    
     int $panduan=`objExists ($qvxian+"_B_Grp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian+"_B_Grp");
        }
    
     select -cl  ;
     group -empty -n ($qvxian+"_B_Grp");
     setAttr ($qvxian+"_B_Grp.visibility") 0;
     setAttr -lock true ($qvxian+"_B_Grp"+".v");
     parent ($qvxian+"_B_Grp") $qvxianzu; 
     
    int $panduan=`objExists ($qvxian+"_A_Grp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian+"_A_Grp");
        }
     select -cl  ;
     group -empty -n ($qvxian+"_A_Grp");
     setAttr ($qvxian+"_A_Grp.visibility") 0;
     setAttr -lock true ($qvxian+"_A_Grp"+".v");
    parent ($qvxian+"_A_Grp") $qvxianzu; 
   select -r ($qvxian+".cv[0:99999999999]");
    string $cvs[]=`ls -sl -fl`;
    
  global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("创建定位器...") -bp -ii 1 -min 0 -max `size($cvs)` $gMainProgressBar;
    for($j=0;$j<size($cvs);$j++) 
    {
         if(`progressBar -q -ic $gMainProgressBar`)
         break;
         progressBar -e -s 1 $gMainProgressBar;
         string $cv_dian=$cvs[$j];
        spaceLocator -p 0 0 0 -n ($qvxian+"_loc_A_"+$j);
        spaceLocator -p 0 0 0 -n ($qvxian+"_loc_B_"+$j);
        parent ($qvxian+"_loc_B_"+$j) ($qvxian+"_B_Grp");
        parent ($qvxian+"_loc_A_"+$j)  ($qvxian+"_A_Grp");
        float $pos_a[]=`xform -q -ws -t $cvs[$j]`;
        setAttr  -type float3 ("temp_qvxian_nearestPointOnCurve.inPosition")  $pos_a[0] $pos_a[1] $pos_a[2];
         addAttr -ln ("canshu")  -at double   -dv 0 -k  1 ($qvxian+"_loc_A_"+$j);//添加属性
        float $canshu=`getAttr "temp_qvxian_nearestPointOnCurve.parameter"`;
        setAttr  ($qvxian+"_loc_A_"+$j+".canshu") $canshu;
        setAttr -lock true ($qvxian+"_loc_A_"+$j+".canshu");
        
         int $panduan_A=`objExists ($qvxian+"_pointOnCurveInfo_loc_"+$j)`;//查询这个物体是否纯在
         if($panduan_A==1){delete ($qvxian+"_pointOnCurveInfo_loc_"+$j); }
        createNode "pointOnCurveInfo" -n ($qvxian+"_pointOnCurveInfo_loc_"+$j);//创建曲线信息节点
        connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".inputCurve");
        connectAttr -force ($qvxian+"_loc_A_"+$j+".canshu") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".parameter");
        connectAttr -force ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position") ($qvxian+"_loc_A_"+$j+".t");
        
        float $pos_c[]=`getAttr ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position")`;
         setAttr -type float3 ($qvxian+"_loc_B_"+$j+".t") $pos_c[0] $pos_c[1] $pos_c[2];
     }
     progressBar -e -ep $gMainProgressBar;
    
}
delete ("temp_qvxian_nearestPointOnCurve");


button -e -en 0 UI_mouth_zipper_open_AABB_button;
}






///////////////////////创建拉链效果/////////////////////////
global proc zxb_global_bolangzui(){

//string $bianliang[]=`ls -sl`;//选中默认曲线

string $openA_sss=`textFieldGrp -q -tx  UI_mouth_zipper_wire_open_A`;
string $openAs[]= stringToStringArray($openA_sss, " ");//字符串转化数组

string $close_sss=`textFieldGrp -q -tx  UI_mouth_zipper_wire_close_B`;
string $close_Bs[]= stringToStringArray($close_sss, " ");//字符串转化数组

 string $follow_sss=`textFieldGrp -q -tx  UI_mouth_zipper_wire_follow_D`;
string$follow_Ds[]= stringToStringArray($follow_sss, " ");//字符串转化数组

 string $qianzui_sss=`textFieldGrp -q -tx  UI_mouth_zipper_prefix`;
 string$qianzui_a[];
  clear $qianzui_a;
  int $nemt=`tokenize $qianzui_sss" " $qianzui_a`;//分离字符串存到变量
  string$qianzui=$qianzui_a[0];

string $bianliang[]=$close_Bs;
 int $fanxiang_a=`checkBox -q  -value fanxuan`;
 int $panduan_a=`objExists ($bianliang[0]+"_curveInfo")`;
 if($panduan_a==1){delete ($bianliang[0]+"_curveInfo");}
shadingNode -asUtility curveInfo -n ($bianliang[0]+"_curveInfo");

string $qvxian_shp[]=`listRelatives -c ($bianliang[0])`;
connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ($bianliang[0]+"_curveInfo.inputCurve");

 int $panduan=`objExists ($bianliang[0]+".changdu")`;
if($panduan==0){addAttr -ln "changdu"  -at double  -dv 0 -k 1($bianliang[0]);}
setAttr -lock 0  ($bianliang[0]+".changdu");
connectAttr -force  ($bianliang[0]+"_curveInfo.arcLength") ($bianliang[0]+".changdu");
setAttr -lock 1  ($bianliang[0]+".changdu");


select -r  ($bianliang[0]+".cv[0:9999999999]") ;
string $qvxian_dian[]=`ls -sl -fl`;
int $qvxian_size=size($qvxian_dian);
float $pos_A[]=`xform -q -ws -t ($bianliang[0]+".cv[0]")`;
float $pos_B[]=`xform -q -ws -t ($bianliang[0]+".cv["+($qvxian_size-1)+"]")`;
float $pos_l_panduan[]=$pos_A;
float $pos_r_panduan[]=$pos_B;
if ( $pos_r_panduan[0]>$pos_l_panduan[0])
{
     $pos_l_panduan=$pos_B;
     $pos_r_panduan=$pos_A;
}

string$zuiba_loc_L=($bianliang[0]+"LL_ZUIBA_LOC");
string$zuiba_loc_R=($bianliang[0]+"RR_ZUIBA_LOC");
string$all_lalian_loc=$zuiba_loc_L+" "+ $zuiba_loc_R+" ";
string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
zxb_ADD_shuxing_string_proc($Controller,"lalianloc");
setAttr -type "string" ($Controller+".lalianloc") $all_lalian_loc;
spaceLocator -p 0 0 0 -n $zuiba_loc_L;
spaceLocator -p 0 0 0 -n $zuiba_loc_R;
xform  -ws -t  $pos_l_panduan[0]  $pos_l_panduan[1]  $pos_l_panduan[2] $zuiba_loc_L;
xform  -ws -t  $pos_r_panduan[0]  $pos_r_panduan[1]  $pos_r_panduan[2] $zuiba_loc_R;


 int $panduan_b=`objExists ($zuiba_loc_L+".shuaijian")`;
 float $changdu=`getAttr ($bianliang[0]+".changdu")`;
 float $changduzhi= $changdu/5.0;
if($panduan_b==0)
{
addAttr -ln "shuaijian"  -at double  -dv $changduzhi -k 1 ($zuiba_loc_L);
setAttr -keyable false -channelBox true ($zuiba_loc_L+".shuaijian");
}

move -r  ($changduzhi*1.25) 0 0 ($zuiba_loc_L) ;
move -r  ($changduzhi*-1.25) 0 0 ($zuiba_loc_R) ;
//print `size($qvxian_dian)`;
for($j=0;$j<size($bianliang);$j++)
{
 

for($i=0;$i<size($qvxian_dian);$i++)
 {
     
     string $qvxian_B=$close_Bs[$j];
     string$qvxian_A= $openAs[$j];
     string$qvxian_D=$follow_Ds[$j];
     
     string$qvxian_loc=($qvxian_B+"_loc_A_"+$i);
     string$qvxian_locA=($qvxian_A+"_loc_A_"+$i);
     string$qvxian_locD=($qvxian_D+"_loc_A_"+$i);
    
         select -r $qvxian_loc ;
         select -add $qvxian_locA ;
         select -add $qvxian_locD;
     string $dianyuesu_bianliang[]=`pointConstraint`;
     
     
      int $panduan_C=`objExists ($qvxian_B+"_plusMinusAverage_L_"+$i)`;
      if($panduan_C==1){delete ($qvxian_B+"_plusMinusAverage_L_"+$i); }
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_L_"+$i);//创建加减节点
     connectAttr -force  ($zuiba_loc_L+".tx") ($qvxian_B+"_plusMinusAverage_L_"+$i+".input1D[0]");
     connectAttr -force  ($qvxian_locA+".tx") ($qvxian_B+"_plusMinusAverage_L_"+$i+".input1D[1]");
     setAttr ($qvxian_B+"_plusMinusAverage_L_"+$i+".operation") 2;
      
      int $panduan_F=`objExists ($qvxian_B+"setRange_A_"+$i)`;
      if($panduan_F==1){delete ($qvxian_B+"setRange_A_"+$i); }
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_A_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_A_"+$i+".maxX") 1;
     connectAttr -f ($zuiba_loc_L+".shuaijian")($qvxian_B+"setRange_A_"+$i+".oldMaxX");
     connectAttr -f ($qvxian_B+"_plusMinusAverage_L_"+$i+".output1D") ($qvxian_B+"setRange_A_"+$i+".valueX");
     
      
     int $panduan_D=`objExists ($qvxian_B+"_plusMinusAverage_R_"+$i)`;
     if($panduan_D==1){delete ($qvxian_B+"_plusMinusAverage_R_"+$i); }
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_R_"+$i);//创建加减节点
     connectAttr -force  ($zuiba_loc_R+".tx") ($qvxian_B+"_plusMinusAverage_R_"+$i+".input1D[1]");//中间减→→右边 右边数值是负数
     connectAttr -force  ($qvxian_locA+".tx") ($qvxian_B+"_plusMinusAverage_R_"+$i+".input1D[0]");
     setAttr ($qvxian_B+"_plusMinusAverage_R_"+$i+".operation") 2;
     
      int $panduan_F=`objExists ($qvxian_B+"setRange_B_"+$i)`;
      if($panduan_F==1){delete ($qvxian_B+"setRange_B_"+$i); }
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_B_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_B_"+$i+".maxX") 1;
     connectAttr -f ($zuiba_loc_L+".shuaijian")($qvxian_B+"setRange_B_"+$i+".oldMaxX");
     connectAttr -f ($qvxian_B+"_plusMinusAverage_R_"+$i+".output1D") ($qvxian_B+"setRange_B_"+$i+".valueX");
     
     
     int $panduan_E=`objExists ($qvxian_B+"_plusMinusAverage_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"_plusMinusAverage_M_"+$i);}
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_M_"+$i);//创建加减节点
     setAttr ($qvxian_B+"_plusMinusAverage_M_"+$i+".operation") 2;
     setAttr ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[0]") 2;
     connectAttr -f ($qvxian_B+"setRange_A_"+$i+".outValueX")  ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[1]");
     connectAttr -f ($qvxian_B+"setRange_B_"+$i+".outValueX")  ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[2]");



     int $panduan_E=`objExists ($qvxian_B+"setRange_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"setRange_M_"+$i);}
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_M_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_M_"+$i+".maxX") 1;
     setAttr ($qvxian_B+"setRange_M_"+$i+".oldMaxX") 1;
     connectAttr -f ($qvxian_B+"_plusMinusAverage_M_"+$i+".output1D") ($qvxian_B+"setRange_M_"+$i+".valueX");
     
     
      int $panduan_E=`objExists ($qvxian_B+"reverse_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"reverse_M_"+$i);}
     shadingNode -asUtility reverse -n($qvxian_B+"reverse_M_"+$i); //创建反向节点
     connectAttr -f ($qvxian_B+"setRange_M_"+$i+".outValueX") ($qvxian_B+"reverse_M_"+$i+".inputX");
     if($fanxiang_a==1)
        {
         connectAttr -f  ($qvxian_B+"setRange_M_"+$i+".outValueX") ($dianyuesu_bianliang[0]+"."+$qvxian_loc+"W0")  ;
          connectAttr -f  ($qvxian_B+"reverse_M_"+$i+".outputX") ($dianyuesu_bianliang[0]+"."+$qvxian_locA+"W1") ;
         }
        else{
          connectAttr -f  ($qvxian_B+"reverse_M_"+$i+".outputX") ($dianyuesu_bianliang[0]+"."+$qvxian_loc+"W0")  ;
          connectAttr -f   ($qvxian_B+"setRange_M_"+$i+".outValueX")($dianyuesu_bianliang[0]+"."+$qvxian_locA+"W1") ;
           }
        
 }
 
}
 
 
  button -e -en 0  UI_mouth_zipper_Create_button;
}
 
///////////////////////////生成包裹

global proc zxb_lalianbaoguo_poc()
 {
  string $lalian_modces=`textFieldGrp -q -tx  zxb_zairumodeA`;
  string $qvxianDs=`textFieldGrp -q -tx Dqvxian  `;
  string $zhangzuiqvxians=`textFieldGrp -q -tx zhangzuiqvxian  `;
  
  string$qvxianDss[]=stringToStringArray($qvxianDs, " ");
   string$zhangzuiqvxianss[]=stringToStringArray($zhangzuiqvxians, " ");
  string$mod[];
  clear $mod;
  int $nemt=`tokenize  $lalian_modces " " $mod`;//分离字符串存到变量
  string$lalian_modce=$mod[0];
  
for ($i=0;$i<size($qvxianDss);$i++)
    {
    string$qvxian=$qvxianDss[$i];
    string$qvxian_A=$zhangzuiqvxianss[$i];
    string$baoguoa[]=`wire -gw false -en 1.000000 -ce 0.000000 -li 0.000000 -w $qvxian $lalian_modce`;
    setAttr ($baoguoa[0]+".rotation") 0.2;
    setAttr ($baoguoa[0]+".dropoffDistance[0]") 10;
    select -r  $qvxian_A;
    select -add  $qvxian_A ($qvxian+"BaseWire");
    string$bs[]=`blendShape`;
    
    setAttr ($bs[0]+"."+$qvxian_A) 1;
    
    }


}





////////////////////////骨骼跟随曲线


global proc xiao_gugegengsuiqvxian_proc_columnLayout() 
{
if(`window -ex zxb_chibangWin_columnLayout`) deleteUI zxb_chibangWin_columnLayout; 

window -t "翅膀" zxb_chibangWin_columnLayout; 
columnLayout -adj 1 -w 300 gtBSColumlayout;

 
 text -l " 关节跟随曲线 " -h 25;
 text -l "  " -h 25;
 rowColumnLayout -nc 2 -cw 1 440 -cw 2 340  ;

textFieldGrp  -cw2 100 300 -l "曲线" -tx "曲线" -ed 0  qvxian;
button -l "载入" -c ("zxb_zairufangfa_A_proc(\""+"qvxian"+"\")") ;


setParent ..; 

text -l "  " -h 25;
button -l "创建" -c "zxb_gugegengsuiqvxian_a_proc" ;
showWindow zxb_chibangWin_columnLayout; 
}
 


global proc zxb_gugegengsuiqvxian_a_proc()
{
      string $qvxianss=`textFieldGrp -q -tx  qvxian `;
      string$qvxian_s[]= stringToStringArray($qvxianss, " ");//关节
      
     string $bianliang[]=$qvxian_s;//

 int $panduan_A=`objExists ("temp_qvxian_nearestPointOnCurve")`;//查询这个物体是否纯在
 if($panduan_A==1){delete ("temp_qvxian_nearestPointOnCurve"); }
createNode nearestPointOnCurve -n  ("temp_qvxian_nearestPointOnCurve");//创建曲线最近点节点

for($i=0;$i<size($bianliang);$i++) 
{
    string $qvxian=$bianliang[$i]; 
     string $qvxian_shp[]=`listRelatives -s $qvxian`;
     connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ("temp_qvxian_nearestPointOnCurve.inputCurve") ;
    
     string$qvxian_grp=($qvxian+"_bn_Grp");
    
     int $panduan=`objExists $qvxian_grp`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete $qvxian_grp;
        }
     select -cl  ;
     group -empty -n $qvxian_grp;
     setAttr ($qvxian_grp+".visibility") 0;
    // setAttr -lock true ($qvxian_grp+".v");
     
  

   select -r ($qvxian+".cv[0:99999999999]");
    string $cvs[]=`ls -sl -fl`;
    
  global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("创建骨骼...") -bp -ii 1 -min 0 -max `size($cvs)` $gMainProgressBar;
    for($j=0;$j<size($cvs);$j++) 
    {
         if(`progressBar -q -ic $gMainProgressBar`)
         break;
         progressBar -e -s 1 $gMainProgressBar;
         string $cv_dian=$cvs[$j];
         string$bn=($qvxian+"_bn_"+$j);
         select -cl  ;
         joint -p 0 0 0 -n $bn;
       
        parent $bn  $qvxian_grp;
        float $pos_a[]=`xform -q -ws -t $cvs[$j]`;
        setAttr  -type float3 ("temp_qvxian_nearestPointOnCurve.inPosition")  $pos_a[0] $pos_a[1] $pos_a[2];
         addAttr -ln ("canshu")  -at double   -dv 0 -k  1 $bn;//添加属性
        float $canshu=`getAttr "temp_qvxian_nearestPointOnCurve.parameter"`;
        setAttr  ($bn+".canshu") $canshu;
        setAttr -lock true ($bn+".canshu");
        
         int $panduan_A=`objExists ($qvxian+"_pointOnCurveInfo_loc_"+$j)`;//查询这个物体是否纯在
         if($panduan_A==1){delete ($qvxian+"_pointOnCurveInfo_loc_"+$j); }
        createNode "pointOnCurveInfo" -n ($qvxian+"_pointOnCurveInfo_loc_"+$j);//创建曲线信息节点
        connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".inputCurve");
        connectAttr -force ($bn+".canshu") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".parameter");
        connectAttr -force ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position") ($bn+".t");
        
        float $pos_c[]=`getAttr ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position")`;
        // setAttr -type float3 ($qvxian+"_loc_B_"+$j+".t") $pos_c[0] $pos_c[1] $pos_c[2];
     }
     progressBar -e -ep $gMainProgressBar;
    
}
delete ("temp_qvxian_nearestPointOnCurve");
      
      

}







global proc string zxb_zuiba_tiqv_lalian_open_proc()
{
    
    string$xian_AA=`textFieldGrp -q -tx  UI_mouth_temp_wire`;
    string$mode_xuanran=`textFieldGrp -q -tx UI_head_mode `;
    string $open_s_qvxian_a[]= stringToStringArray($xian_AA, " ");//提取的曲线名字
    string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
    string$lalian_modess=` getAttr ($Controller+".base_bs_mode ")`;
    string $lalian_modes[]= stringToStringArray($lalian_modess, " ");//反向嘴巴模型
    string$lailain_temp=zxb_mode_huanxian($open_s_qvxian_a,$lalian_modes[0]);
     string $open_s_qvxian[]= stringToStringArray($lailain_temp, " ");//提取的曲线名字
    string$Aqvxianss=`textFieldGrp -q -tx UI_mouth_zipper_prefix `;
    string$Aqvxians[];
    clear $Aqvxians;
    int $nemt=`tokenize $Aqvxianss" " $Aqvxians`;//分离字符串存到变量
    string$qianzui=$Aqvxians[0];
    
    string $qvxianA=zxb_zuiba_tiqvqvxianfangfa_proc(1,"open",$qianzui,$lailain_temp);
    
    textFieldGrp -e -tx $qvxianA UI_mouth_zipper_wire_open_A ;
    button -e -en 0 UI_mouth_zipper_wire_open_A_button ;
    button -e -en 0 lalian_button_qvxianA ;
    return $qvxianA;
   
}
global proc string zxb_zuiba_tiqv_lalian_close_proc()
{
    string$Aqvxianss=`textFieldGrp -q -tx UI_mouth_zipper_prefix `;//曲线前缀
    string$Aqvxians[];
    clear $Aqvxians;
    int $nemt=`tokenize $Aqvxianss" " $Aqvxians`;
    string$qianzui=$Aqvxians[0];
    
    string$xian_AA=`textFieldGrp -q -tx  UI_mouth_temp_wire`;
    string $open_s_qvxian[]= stringToStringArray($xian_AA, " ");//提取的曲线名字
    string$close_s_mode=`textFieldGrp -q -tx  zxb_zairumode`;//反向嘴巴模型
    select -r $open_s_qvxian;
    string$close_s_qvxian=zxb_xuanzebutongmoxing_jiluxuanzhededian(0 ,$close_s_mode);
    string $close_B=zxb_zuiba_tiqvqvxianfangfa_proc(1,"close",$qianzui,$close_s_qvxian);
    textFieldGrp -e -tx $close_B UI_mouth_zipper_wire_close_B ;
    button -e -en 0 UI_mouth_zipper_wire_close_B_button;
    button -e -en 0 lalian_button_qvxian ;
    return $close_B;
}


global proc string zxb_zuiba_tiqv_lalian_follow_proc()

{  
    string$xian_AA=`textFieldGrp -q -tx  UI_mouth_temp_wire`;
    string $open_s_qvxian[]= stringToStringArray($xian_AA, " ");//提取的曲线名字
    string$Aqvxianss=`textFieldGrp -q -tx UI_mouth_zipper_prefix `;
    string$Aqvxians[];
    clear $Aqvxians;
    int $nemt=`tokenize $Aqvxianss" " $Aqvxians`;//分离字符串存到变量
    string$qianzui=$Aqvxians[0];
    
   
    string $follow_A=zxb_zuiba_tiqvqvxianfangfa_proc(1,"follow",$qianzui,$xian_AA);//生成张嘴嘴巴曲线
    string $follow_s[]= stringToStringArray($follow_A, " ");//提取的曲线名字
    select -r $follow_s;
    DeleteHistory;
    textFieldGrp -e -tx $follow_A UI_mouth_zipper_wire_follow_D ;
    button -e -en 0 UI_mouth_zipper_wire_follow_D_button ;
    button -e -en 0 lalian_button_qvxianD ;
    
    return $follow_A;
}




/////////////////设置拉链驱动/////////////////////
global proc zxb_zd_sheziqvdong_poc()
{
  string $qvxians=`textFieldGrp -q -tx  zxb_zairukongzhiqi`;
  string$qvxianss[];
  clear $qvxianss;
  int $nemt=`tokenize  $qvxians " " $qvxianss`;//分离字符串存到变量
  string$qvxian=$qvxianss[0];
  
  string $locss=`textFieldGrp -q -tx zxb_dingweiqi  `;

  string$locs[]=stringToStringArray($locss, " ");
  
  for ($i=0;$i<size($locs);$i++)
  {
   
   string$loc=$locs[$i];
   int$a=0;
   string$rrll="";
      
   if($i==0){$a=1;$rrll="L";}else{$a=0;$rrll="R";}
   string$loc_b=$locs[$a];
   
   int $ex=`objExists ($qvxian+".lalian_L")`;//查询这个物体是否纯在
   if($ex==0){addAttr -ln "lalian_L"  -at double  -min 0 -max 10 -dv 0 -k  1 $qvxian;}//添加属性  
   
    $ex=`objExists ($qvxian+".lalian_R")`;//查询这个物体是否纯在
    if($ex==0){addAttr -ln "lalian_R"  -at double  -min 0 -max 10 -dv 0 -k  1 $qvxian;}//添加属性  
    
    float$loc_pos=`getAttr ($loc+".tx")`;
    float$loc_b_pos=`getAttr ($loc_b+".tx")`;
   setDrivenKeyframe -itt "linear" -ott "spline" -v $loc_pos -dv 0 -cd ($qvxian+".lalian_"+$rrll) ($loc+".tx");  
   setDrivenKeyframe -itt "linear" -ott "spline" -v $loc_b_pos -dv 10 -cd ($qvxian+".lalian_"+$rrll) ($loc+".tx");  
  }
}

/////////////////////////////////设置嘴巴波浪///////////////////////////
global proc zxb_bolangzui()
{

string $bianliang[]=`ls -sl `;//选中曲线D  

for($i=0;$i<size($bianliang);$i++)
{
   string $qvxian_D=$bianliang[$i];
   select -r $qvxian_D;
  duplicate -rr -n ($qvxian_D+"_bolang");
    string $grpchids[]=`listRelatives -c ($qvxian_D+"_locGrp")`;
    
    int $panduan=`objExists ($qvxian_D+"_bolanggrp") `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp");
        setAttr ($qvxian_D+"_bolanggrp.visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp.v");
       parent   ($qvxian_D+"_bolanggrp") "Face_zipper_Group";
     }
     
     string$boliang=($bianliang[0]+"_bolang_all");
     
    int $panduan=`objExists $boliang `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n $boliang ;
       setAttr ($boliang+".visibility") 0;
       setAttr -lock true -keyable false -channelBox false ($boliang+".v");
     
        parent   $boliang "Face_zipper_Group";
       
     }
    
    
     
     /////////////////////////复制曲线D的定位器   属性控制拉链嘴的组//////////////////////////////
   string $objloc_d[];//定义定位器的所有物体  复制出来的定位器的名字
   clear $objloc_d;
   for($j=0;$j<size($grpchids);$j++)
   {
     string $qvxian_D_locA= $grpchids[$j];
     string $loc_chids[]=`listRelatives -c  -type "transform" $qvxian_D_locA`;
     string $obj="";

     for($ii=0;$ii<size($loc_chids);$ii++)
       {
       int $panduan=`objExists ($loc_chids[$ii]+".offsetZ")`;
       if ($panduan==0){$obj=$loc_chids[$ii];}
       }
     select -r $obj ;
     duplicate -rr -n ($obj+"_bolang");
     parent ($obj+"_bolang") ($qvxian_D+"_bolanggrp");
     string $zu_zi[]=`listRelatives -c -ad  -type  "transform" -fullPath ($obj+"_bolang")`;
     string $zu_zi_A[]=`listRelatives -c -ad  -type  "transform" ($obj+"_bolang")`;
     string $bolangloc="";

     for($iii=0;$iii<size($zu_zi);$iii++)////重命名
      {
          string $ziwuti=$zu_zi[$iii];
          //select -r $ziwuti;
          rename  $ziwuti ($zu_zi_A[$iii]+"_bolang");
          string$loc_shap[]=`listRelatives -s ($zu_zi_A[$iii]+"_bolang")`;
          if($loc_shap[0]==""&&$iii==0){ delete($zu_zi_A[$iii]+"_bolang");}
          if($loc_shap[0]!="")
            {
             string$tepe_B=`nodeType $loc_shap[0]`;
            if($tepe_B=="locator"){$bolangloc=($zu_zi_A[$iii]+"_bolang");}
             }

         
         
        
    
       }
      string $loc_zu[]=`listRelatives -c  -type  "transform"  $obj`;
      string $lalian_loczu=$loc_zu[0];

     connectAttr -f ($bolangloc+".t") ($lalian_loczu+".t");
     select -r $bolangloc;

     $objloc_d[$j] = $bolangloc;//把定位器的名称保存到变量里   复制出来的定位器的名字
   }
  // print $objloc_d;
  
  
  
  ///////////////////创建曲线///////////////////
   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $kaishi_pos_B[]=`xform -q -ws -t  ($qvxian_D+".cv[+"+size($grpchids)+"]")`;
    int $panduan=`objExists ($qvxian_D+"_bolang")`;
    if($panduan==1){ delete ($qvxian_D+"_bolang");}
    
  curve -d 1 -p $kaishi_pos_A[0] $kaishi_pos_A[1] $kaishi_pos_A[2] -p $kaishi_pos_B[0] $kaishi_pos_B[1] $kaishi_pos_B[2] -n($qvxian_D+"_bolang"); //创建曲线
  setAttr ($qvxian_D+"_bolang.visibility") 0;
  setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang.v");
  rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s 2 -d 3 -tol 0.01 ($qvxian_D+"_bolang");//重建曲线
  /////////////创建曲线信息节点///////////////////////////
     int $panduan=`objExists ($qvxian_D+"qvxianzuijingdianjiedian")`;
     if($panduan==1){ delete ($qvxian_D+"qvxianzuijingdianjiedian");}
   createNode nearestPointOnCurve -n ($qvxian_D+"qvxianzuijingdianjiedian");//创建曲线最近点节点
   string $qvxian_D_shp[]=`listRelatives -s $qvxian_D`;
   connectAttr -force ($qvxian_D_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点

    
    /////////////////判断是否翻转曲线起始点/////////////////
    
    float $dian_temp_kaishi[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[0]")`;
    float $dian_temp_jiesu[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[4]")`;
    float $dian_temp_kaishi_A[]=`xform -q -ws -t ($qvxian_D+".cv[0]")`;
    float$dis=mag(<<$dian_temp_kaishi[0],$dian_temp_kaishi[1],$dian_temp_kaishi[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);
    float$dis_a=mag(<<$dian_temp_jiesu[0],$dian_temp_jiesu[1],$dian_temp_jiesu[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);

    if($dis>$dis_a){reverseCurve -ch 0 -rpo 1 ($qvxian_D+"_bolang");}
    parent ($qvxian_D+"_bolang") $boliang;
    
    //////////////////创建蔟//////////////
    int $cv_size=5;
    for($a=0;$a<$cv_size;$a++)//创建蔟
     {
      select -r ($qvxian_D+"_bolang.cv["+$a+"]"); 
       
     CreateCluster ;
     rename ($qvxian_D+"_bolang_cu_"+$a);
     spaceLocator -p 0 0 0 -n ($qvxian_D+"_bolang_cu_loc_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_D_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_C_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_B_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_A_"+$a);
     setAttr ($qvxian_D+"_bolang_cu_grp_A_"+$a+".visibility") 0;
     setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang_cu_grp_A_"+$a+".v");
     delete`pointConstraint  ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_grp_A_"+$a)`;
     parent ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_loc_"+$a);
     parent ($qvxian_D+"_bolang_cu_grp_A_"+$a) $boliang;
      }
     
     ///////////////////////蔟控制复制出来定位器//////////////////////////////
     
     
      int $panduan_A=`objExists ($qvxian_D+"_bolanggrp"+"_A")`;
      if ($panduan_A==0)
      { select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp"+"_A");
        setAttr ($qvxian_D+"_bolanggrp"+"_A"+".visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp"+"_A"+".v");
       }
    string $qvxian_D_boliang_shp[]=`listRelatives -s ($qvxian_D+"_bolang")`;
   connectAttr -force ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点
   for($aa=0;$aa<size($objloc_d);$aa++)
   {
        string $loc_d=$objloc_d[$aa];
        float $pos[]=`xform -q -ws -t $loc_d`;
       setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $pos[0] $pos[1] $pos[2];
      float $weozh=`getAttr  ($qvxian_D+"qvxianzuijingdianjiedian.parameter")`;
      
      int $panduan_l=`objExists ($loc_d+"_pointOnCurveInfo_"+$aa)`;
      if($panduan_l==1){delete ($loc_d+"_pointOnCurveInfo_"+$aa); }
     createNode "pointOnCurveInfo" -n ($loc_d+"_pointOnCurveInfo_"+$aa);//创建曲线最近点节点
     connectAttr -force  ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($loc_d+"_pointOnCurveInfo_"+$aa+".inputCurve");
     setAttr ($loc_d+"_pointOnCurveInfo_"+$aa+".parameter") $weozh;
     
     spaceLocator -p 0 0 0 -n ( $loc_d+"_A_loc_"+$a);
     connectAttr -force ($loc_d+"_pointOnCurveInfo_"+$aa+".position") ( $loc_d+"_A_loc_"+$a+".t");
     parent ( $loc_d+"_A_loc_"+$a) ($qvxian_D+"_bolanggrp"+"_A");
     pointConstraint -mo ( $loc_d+"_A_loc_"+$a)   $loc_d;
   }
  
   delete  ($qvxian_D+"qvxianzuijingdianjiedian");
   parent ($qvxian_D+"_bolanggrp"+"_A") $boliang;
   
   ///////////////////创建控制器////////////////////////
   
   string $qvxianname=($qvxian_D+"UP_bolangqvxian");
   if($i==1){$qvxianname=($qvxian_D+"DN_bolangqvxian");}
   string$head_Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
   zxb_ADD_shuxing_string_proc($head_Controller,"boliang_controller");
    string$all_boliang_controller_temp=`getAttr ($head_Controller+".boliang_controller")`;
   string$all_Controller=$qvxianname+" ";
   if($all_boliang_controller_temp=="")
     { 
     setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
    
    }
   else
   {
       
   $all_Controller=$all_boliang_controller_temp+" "+$all_Controller;
   setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
   }
   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $qvxian_MM_pos[]=`xform -q -ws -t  ($qvxian_D+"_bolang.cv[2]")`;
   float $rsd= `abs($kaishi_pos_A[0]*0.2)`;
  circle -c 0 0 0 -nr 0 1 0 -sw 360 -r $rsd -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $qvxianname; 
  group -n ($qvxianname+"_grp_B");
  group -n ($qvxianname+"_grp_A");
  select -r  ($qvxianname+".cv[0]") ($qvxianname+".cv[2]") ($qvxianname+".cv[4]") ($qvxianname+".cv[6]") ;
  scale -r -p 0cm 0cm 0cm 0.417937 0.417937 0.417937 ;
  if($i==0)
  {  
  move -r -os -wd 0 ($rsd*0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*0.5) ($rsd*1.5) ;
  }else
  {
  move -r -os -wd 0 ($rsd*-0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*-0.5) ($rsd*1.5) ;
  }
 
  xform  -ws -t $qvxian_MM_pos[0] $qvxian_MM_pos[1] $qvxian_MM_pos[2]($qvxianname+"_grp_A");
  
  string $shape[]=`listRelatives -s $qvxianname`;
    setAttr ($shape[0]+".overrideEnabled") 1;
    setAttr ($shape[0]+".overrideColor") 16;
  //parent   ($qvxianname+"_grp_A") $boliang;
    
    
    ////////////////////表达式//////////////////////////
   
    float $rsd= ($kaishi_pos_A[0]*0.35);
    float$aaaa= `abs ($rsd)`;
     float $temp=$aaaa;
    addAttr -ln "upty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "dnty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "pianyi"  -at double  -dv 0 -k 1 $qvxianname;
    addAttr -ln "upsl"  -at double  -dv $temp -k 1 $qvxianname;
    addAttr -ln "dntsl"  -at double  -dv ($temp*-1) -k 1 $qvxianname;
    setAttr -keyable false -channelBox true ($qvxianname+".upsl");
    setAttr -keyable false -channelBox true ($qvxianname+".dntsl");
    
    

    string $grp_C1=($qvxian_D+"_bolang_cu_grp_C_1");
    string $grp_C2=($qvxian_D+"_bolang_cu_grp_C_2");
    string $grp_C3=($qvxian_D+"_bolang_cu_grp_C_3");
    
    string $grp_B1=($qvxian_D+"_bolang_cu_grp_B_1");
    string $grp_B2=($qvxian_D+"_bolang_cu_grp_B_2");
    string $grp_B3=($qvxian_D+"_bolang_cu_grp_B_3");
   //select -r $grp_C3;
   // print $grp_C3;
    float $temp_[]=`xform -q -ws -t  $grp_C2`;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B3+".scalePivot") ($grp_B3+".rotatePivot") ;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B1+".scalePivot") ($grp_B1+".rotatePivot") ;
    string $exp="";
    $exp+=($grp_C1+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6+"+$qvxianname+".tx));\n");
    $exp+=($grp_C3+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6-"+$qvxianname+".tx));\n");
    $exp+=($grp_C2+".ty=("+$grp_C1+".ty+"+$grp_C3+".ty);\n");
    $exp+=($grp_C1+".tz="+$grp_C3+".tz=("+$qvxianname+".tz*0.5);\n");
    $exp+=($grp_B2+".tz=("+$grp_B1+".tz+"+$grp_B3+".tz);\n");
    $exp+=($grp_B1+".sx="+$grp_B3+".sx=("+$qvxianname+".sx);\n");
    $exp+=($grp_C1+".tx="+$grp_C2+".tx="+$grp_C3+".tx="+$qvxianname+".pianyi*0.1;\n");
    $exp+=($grp_B3+".rx="+$grp_B1+".rx="+$qvxianname+".rx;\n");
    $exp+=($grp_B3+".ry="+$grp_B1+".ry="+$qvxianname+".ry;\n");
    $exp+=($grp_B3+".rz="+$grp_B1+".rz="+$qvxianname+".rz;\n");
    //print $exp;
    
int$panduan_biaodashi=`objExists ($qvxian_D+"_biaodashi")`;
if($panduan_biaodashi==1){delete ($qvxian_D+"_biaodashi") ;}
expression -s $exp  -o ($qvxian_D+"_biaodashi") -ae 1 -uc all ;

}
}


///////////////////////////////嘴唇反转骨骼创建/////////////////////////////////////////////



global proc zxb_extract_Curves_lipbs_a() 
{
 string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;
 string$names=`getAttr ($head_qvxian+".lip_Curves")`;
 string$Array_s[]= stringToStringArray($names, " ");//字符串转化数组
 string$Curves_Ws[];
 clear $Curves_Ws;//清除数组
 $Curves_Ws[0]=$Array_s[0]; $Curves_Ws[1]=$Array_s[1];
 string$Curves_Ns[];
 clear $Curves_Ns;//清除数组
 $Curves_Ns[0]=$Array_s[2]; $Curves_Ns[1]=$Array_s[3];
 string$Curves_ins[];
 clear$Curves_ins;//清除数组
 $Curves_ins[0]=$Array_s[4]; $Curves_ins[1]=$Array_s[5];
 string$Curves_outers[];
 clear$Curves_outers;//清除数组
 $Curves_outers[0]=$Array_s[6];$Curves_outers[1]=$Array_s[7];
 print $Curves_Ws;


 for($u=0;$u<size($Curves_Ws);$u++)
   {
   string$all_bn_temp="";
   string$Curve_W=$Curves_Ws[$u];
   string$Curve_N=$Curves_Ns[$u];
   string$Curves_in=$Curves_ins[$u];
   string$namen_temp_aa="chuckle_UP";
   if($u==1){$namen_temp_aa="chuckle_DW";}
   zxb_ADD_shuxing_string_proc($head_qvxian,$namen_temp_aa);
   string $Curves_outer=$Curves_outers[$u];
   select -r   $Curves_in;
   select -add $Curve_W;
   string $bs_in[]=`blendShape -frontOfChain `;
   $bs_W=$bs_in[0];
   select -r $Curves_outer ;
   select -add $Curve_N ;
   string $bs_outer[]=`blendShape -frontOfChain `;
   $bs_N=$bs_outer[0];
   select -r $Curve_W ;
   string $Curves_N_root=$Curve_N+"_root";
   duplicate -rr -n$Curves_N_root; 
   select -r $Curve_W ;
   select -add  $Curve_N;
   select -add  $Curves_N_root;
   string $bs_root[]=`blendShape -frontOfChain `;
   $bs_G=$bs_root[0];
   int $ex=`objExists  "lip_Curve"`;//查询这个物体是否纯在
   
   
   if($ex==0)
     {
      zxb_ADD_shuxing_string_proc($head_qvxian,"lip_xuanzhun_con");
      circle -c 0 0 0 -nr 0 1 0 -sw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n "lip_Curve";
       setAttr -type "string"($head_qvxian+".lip_xuanzhun_con")  "lip_Curve";  
      group  -n "lip_Curve_grp_A";
      group  -n "lip_Curve_grp_B";
      group  -n "lip_Curve_grp_C";
      float$bbobx_Max[]=`getAttr ($Curve_W+".boundingBoxMax")`;////绑定box节点   
      setAttr "lip_Curve_grp_C.translateX" $bbobx_Max[0];
      setAttr "lip_Curve_grp_C.translateY" $bbobx_Max[1];
      setAttr "lip_Curve_grp_C.translateZ" $bbobx_Max[2];
      parent "lip_Curve_grp_C" "lip_curve_Group";
     }

    string$up_dw="";
    if($u==0)
       {   
        $up_dw="UP_";
        }
    if($u==1)
      {
      $up_dw="DW_";
      }

   string$shuxing_in=$up_dw+$Curves_in;
   string$shuxing_outer=$up_dw+$Curves_outer;
   string$shuxing_hensui=$up_dw+"gensui_M" ;
   addAttr -ln $shuxing_in -at double  -min 0 -max 1 -dv 0 -k 1"lip_Curve";
   addAttr -ln  $shuxing_outer  -at double  -min 0 -max 1 -dv 0 -k 1 "lip_Curve";
   addAttr -ln $shuxing_hensui  -at double  -min 0 -max 1 -dv 1 -k 1  "lip_Curve";
   connectAttr -f  ("lip_Curve."+$shuxing_in) ($bs_W+"."+ $Curves_in) ;
   connectAttr -f  ("lip_Curve."+$shuxing_outer) ($bs_N+"."+ $Curves_outer) ;
   connectAttr -f  ("lip_Curve."+$shuxing_hensui ) ($bs_G+"."+$Curve_W) ;
   string$fanxiangjiedian=($Curve_W+"_reverse");
   int $panduan=`objExists $fanxiangjiedian`;//查询这个物体是否纯在
   if($panduan==1){delete $fanxiangjiedian;}
   shadingNode -asUtility reverse -n $fanxiangjiedian ; //创建返向节点
   connectAttr -f   ("lip_Curve."+$shuxing_hensui ) ($fanxiangjiedian+".inputX") ;
   connectAttr -f    ($fanxiangjiedian+".output.outputX") ($bs_G+"."+$Curve_N) ;
   select -r $Curves_N_root;
   CenterPivot;

    ///////////////////创建关节  并控制关节的位移///////////////////////////////////
   select -r ($Curves_N_root+".cv[0:999999999999]");
   string$cvs[]=`ls -sl -fl`;
   int$duanshu=size($cvs);
   string$bn_root=($Curves_N_root+"_root");
   int$ex=`objExists $bn_root`;
   if($ex==0)
     {
    select -cl  ;
    joint -n $bn_root;
    //delete`pointConstraint  $qvxian $bn_root`;
    setAttr ($bn_root+".drawStyle") 2;
    setAttr -l true { ($bn_root+".ds") };
    /*string $qvxian_fu[]=`listRelatives -p  $Curves_N_root`; 
    
    string $qvxian_grp=$qvxian_fu[0];
    int $ex=`objExists $qvxian_grp`;
    if($ex==1){parent $bn_root $qvxian_grp;}*/
     parent $bn_root ("lip_joints_Group")  ;
    }

  select -r $Curves_N_root;
  string$qvxian_A=($Curves_N_root+"_zhouxiang");
  duplicate -rr -n $qvxian_A;
  //parent $qvxian_A("lip_curve_Group") ;
  select -r $qvxian_A;
  rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s $duanshu -d 3 -tol 0.01  $qvxian_A;
  select -cl  ;
  string$qvxianjiedian_xingxi=($Curves_N_root+"_nearestPointOnCurve");
  int$panduan=`objExists $qvxianjiedian_xingxi`;
  if($panduan==1){delete $qvxianjiedian_xingxi;}
  createNode nearestPointOnCurve -n $qvxianjiedian_xingxi;//
  string $qvxian_Shape[]=`listRelatives -s  $Curves_N_root`; 
  string$qvxianShape=$qvxian_Shape[0];
  connectAttr -f   ($qvxianShape+".worldSpace[0]")  ($qvxianjiedian_xingxi+".inputCurve");
  string$all_bns="";
  for($i=0;$i<size($cvs);$i++) 
     {
    int$qvyu=$i%3;
    string $cv_dian=$cvs[$i];
    string$qvxian_bn=($Curves_N_root+"_bn_"+$i);
    $all_bns+=$qvxian_bn+" ";
    string$qvxianjiedian=($qvxian_bn+"_pointOnCurveInfo_"+$i);
    float $cv_pos_A[]=` xform -q -ws -t    $cv_dian`;
    select -r $bn_root;
    joint -p$cv_pos_A[0] $cv_pos_A[1] $cv_pos_A[2] -n $qvxian_bn;
    $all_bn_temp+=$qvxian_bn+" ";
    int$panduan=`objExists $qvxianjiedian`;
    if($panduan==1){delete $qvxianjiedian;}
    createNode pointOnCurveInfo -n $qvxianjiedian;//创建曲线信息节点
    setAttr -type float3 ($qvxianjiedian_xingxi+".inPosition") $cv_pos_A[0] $cv_pos_A[1] $cv_pos_A[2];
    float $param=`getAttr ($qvxianjiedian_xingxi+".parameter")`;
    setAttr  ($qvxianjiedian+".parameter") $param;
    connectAttr -f   ($qvxianShape+".worldSpace[0]")  ($qvxianjiedian+".inputCurve");
    connectAttr -f    ($qvxianjiedian+".position") ($qvxian_bn+".t");//连接位置
    select -r $qvxian_A;
    select -add $qvxian_bn;
    delete `tangentConstraint -weight 1 -aimVector 1 0 0 -upVector 0 1 0 -worldUpType "scene"`;
    select -r $qvxian_bn;
    channelBoxCommand -freezeRotate;
    if($qvyu==0)
     {
       setAttr ($qvxian_bn+".radius") 0.2;
     }else{setAttr ($qvxian_bn+".radius") 0.1;}

  }
  setAttr -type "string" ($head_qvxian+"."+$namen_temp_aa) $all_bn_temp ;  
  delete $qvxianjiedian_xingxi;
   string$all_bnss[]= stringToStringArray( $all_bns," ");//字符串转化数组
  for($uu=0;$uu<size($all_bnss);$uu++) 
      {
        int$qvyu=$uu%3;
        string$bn=$all_bnss[$uu];
       select -add $bn;
       if($qvyu==0&&$uu>0)
          {
           int$kaishi=$uu-3;
           string$aaaa[]=`ls -sl`;
           zxb_fanzhuanzui_xniuqv_proc($aaaa);
           select -cl  ;
           select -add $bn;
          }
       }
 }   
}

 
 
 
global proc string zxb_extract_Curves_proc_extract_WANQV() 
{
       string $xiaba_bn_W=`textFieldGrp -q -tx  UI_mouth_outer_wire `;
       string $xiaba_bn_N=`textFieldGrp -q -tx   UI_mouth_oral_wire`;
       string$Curves_W=zxb_extract_Curves_proc(0,"Curves_W","place",$xiaba_bn_W);
       string$Curves_Ws[]= stringToStringArray($Curves_W, " ");//字符串转化数组
       string$Curves_N=zxb_extract_Curves_proc(0,"Curves_N","place",$xiaba_bn_N);
       string$Curves_Ns[]= stringToStringArray($Curves_N, " ");//字符串转化数组
       
       select -r ($Curves_Ws[0]+".cv[0:99999]") ;
       string$qvxians_A[]=`ls -sl -fl`;
              
       select -r ($Curves_Ns[0]+".cv[0:99999]") ;
       string$qvxians_B[]=`ls -sl -fl`;
       
       
       int $ex_a=size($qvxians_A);
       int $ex_b=size($qvxians_B);
       if($ex_b!=$ex_a)
         {
          select -r $Curves_Ns[0];
          rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s $ex_a -d 1 -tol 0.001 $Curves_Ns[0];
          select -r $Curves_Ns[1];
          DeleteHistory;
          }
          
       select -r ($Curves_Ws[1]+".cv[0:99999]") ;
       string$qvxians_C[]=`ls -sl -fl`;
              
       select -r ($Curves_Ns[1]+".cv[0:99999]") ;
       string$qvxians_D[]=`ls -sl -fl`;
       
       
       int $ex_C=size($qvxians_C);
       int $ex_D=size($qvxians_C);  
        if($ex_D!=$ex_C)
         {
          select -r $Curves_Ns[1];
          rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s $ex_C -d 1 -tol 0.001 $Curves_Ns[1];
          select -r $Curves_Ns[1];
          DeleteHistory;
          }
                
        select -r $Curves_Ws;
        DeleteHistory;
        select -r $Curves_Ns;
        DeleteHistory;


float $cv_pos_kaishi_a[]=` xform -q -ws -t   $qvxians_A[0]`;
float $cv_pos_kaishi_b[]=` xform -q -ws -t   $qvxians_B[0]`;
if($cv_pos_kaishi_a[0]<0)
  {
   select -r $Curves_Ws[0];
   reverseCurve -ch 0 -rpo 1 $Curves_Ws[0];
   select -r $Curves_Ws[1];
   reverseCurve -ch 0 -rpo 1 $Curves_Ws[1];
  }

 if($cv_pos_kaishi_b[0]<0)
  {
   select -r $Curves_Ns[0];
   reverseCurve -ch 0 -rpo 1 $Curves_Ns[0];
   select -r $Curves_Ns[1];
   reverseCurve -ch 0 -rpo 1 $Curves_Ns[1];
  } 
  
  
string$in_in="";
string$out_out="";
string$in_out="";
zxb_ADD_kongzu_proc("lip_curve_Group");
zxb_ADD_kongzu_proc("lip_joints_Group");
zxb_ADD_kongzu_proc("lip_overturn_Group");
parent  "lip_overturn_Group"  "Face_Group";
parent("lip_joints_Group")("lip_overturn_Group");
parent("lip_curve_Group")("lip_overturn_Group") ;
for($u=0;$u<size($Curves_Ws);$u++)
 {
string$Curve_W=$Curves_Ws[$u];
string$Curve_N=$Curves_Ns[$u];
  
select -r $Curve_W; 
string $Curves_in=$Curve_W+"_in";
duplicate -rr -n $Curves_in; 
select -r $Curve_N; 
string $Curves_outer=$Curve_N+"_outer";
duplicate -rr -n $Curves_outer; 
$in_out+=$Curves_in+" ";
$out_out+=$Curves_outer+" ";

  parent  $Curve_W ("lip_curve_Group");
  parent  $Curve_N("lip_curve_Group");
   parent   $Curves_in("lip_curve_Group");
   parent   $Curves_outer("lip_curve_Group");
  }

 $in_out+= $in_in+$out_out;
 string$fanhui=$Curves_Ws[0]+" "+$Curves_Ws[1]+" "+$Curves_Ns[0]+" "+$Curves_Ns[1]+" "+$in_out;
 return $fanhui;



  }
global proc string zxb_extract_Curves_proc(int$a,string$mingzi,string$qianzui,string$xian_A)//int 区分线段的平均值或者法线朝向 $mingzi名字 $qianzui前缀 $xian_A 线段名称
{

string$xian=$xian_A;
string$Axianxian=$qianzui;
string$mingzi=$mingzi;
string$qvxianss[]= stringToStringArray($xian, " ");//字符串转化数组
string $bianliang[]=$qvxianss;//提取曲线名字
string$temp_qvxian[];
clear $temp_qvxian;
int $nemt=`tokenize $bianliang[0]"."  $temp_qvxian`;//分离字符串存到变量
string$moxing=$temp_qvxian[0];
select -r $bianliang;
ConvertSelectionToVertices;
string $dingdian[]=`ls -sl -fl`;


      string$R_cv="";
      string$L_cv="";
     string$vtxs[]=$dingdian;
     float$dd=-100000000000000;
     float$xx=1000000000000000;
     string$dian_L="";
     string$dian_R="";
     for ($i=0;$i<size($vtxs);$i++)
          {
           string$vtx=$vtxs[$i];
           float$bn_pos[]=`xform -q -ws -t $vtx`;
           if($bn_pos[0]>$dd)
             {
             $dd=$bn_pos[0];
             $dian_L=$vtx;
             }
             if($bn_pos[0]<$xx)
             {
             $xx=$bn_pos[0];
             $dian_R=$vtx;
             }
             
           }
           
           
     $L_cv=$dian_L;   
     $R_cv=$dian_R;
 float $R_POS[]=`xform -q -ws -t $R_cv`; 
 string$qvxian_mingzi=$Axianxian+"_temp_curve";
  select -r $qvxianss;
  polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $qvxian_mingzi;
 DeleteHistory;
 float$pamte=zxb_return_curve_U($R_POS[0],$R_POS[1],$R_POS[2],$qvxian_mingzi);
 select -r ($qvxian_mingzi+".u["+$pamte+"]") ;
float $tempp_POS[]=`xform -q -ws -t $dingdian[0]`; 
int$jisuan=size($dingdian)-1;
float $tempp_POS_A[]=`xform -q -ws -t $dingdian[$jisuan]`; 
float $R_POaS=$R_POS[0]+$R_POS[1]+$R_POS[2];
float $R_PObS=$tempp_POS[0]+$tempp_POS[1]+$tempp_POS[2];
if($R_POaS!=$R_PObS)
  {
    moveNurbsCurveSeam;
   }
 

 select -r ($qvxian_mingzi+".cv[0:999999999]");
 
 string $qvxian_A[]=`ls -sl -fl`;
 
 
string$dianLL="";
float $cv_pos[]=`xform -q -ws -t $L_cv`;
float$maga=1000000000000;
     
for($iii=0;$iii<size($qvxian_A);$iii++)
   { 
     string$mag_cv=$qvxian_A[$iii];
     float $mag_po[]=`xform -q -ws -t $mag_cv`;
     float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
     if($weizhi<$maga){$maga=$weizhi;$dianLL=$mag_cv;}
     } 
    
//print $dianLL;
  string$ccv[];
  clear $ccv;
  int $nemt=`tokenize $dianLL"[" $ccv`;//分离字符串存到变量
   int $nemt=`tokenize $ccv[1]"]" $ccv`;//分离字符串存到变量
  string$shu=$ccv[0];
 
 
 int$qvxiancv_size=size($qvxian_A);
int$temp_a=$shu;

float$exa=0;
float$exb=0;


if($a==0)
{
select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exb=`zxb_qvfengshangzi`;

select -r ($qvxian_mingzi+".cv[0:999999999]");
select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exa=`zxb_qvfengshangzi`;
}
if($a==1)
 {
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exa=zxb_normal_pingjunshu($moxing);
  
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exb=`zxb_normal_pingjunshu($moxing)`;
  }


string$up_qvxiancvs[];
clear$up_qvxiancvs;
string$dw_qvxiancvs[];
clear$dw_qvxiancvs;



if($exb>$exa)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
 $dw_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  }
if($exa>$exb)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $dw_qvxiancvs=`ls -sl -fl`;
   }
string$UP_zuijing="";
string$DW_zuijing="";


for($o=0;$o<2;$o++)
{
    string$temp_suzu[];
    clear$temp_suzu;
   if($o==0){$temp_suzu=$up_qvxiancvs;}
   if($o==1){$temp_suzu=$dw_qvxiancvs;}
   for($i=0;$i<size($temp_suzu);$i++)
    {
     string$temp_cv=$temp_suzu[$i];
     float $cv_pos[]=`xform -q -ws -t $temp_cv`;
     float$mag=1000000000000;
     string$dian="";
     for($ii=0;$ii<size($dingdian);$ii++)
        { 
         string$mag_cv=$dingdian[$ii];
         float $mag_po[]=`xform -q -ws -t $mag_cv`;
         float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
         if($weizhi<$mag){$mag=$weizhi;$dian=$mag_cv+" ";}
         } 
     if($o==0){$UP_zuijing+=$dian;}
     if($o==1){$DW_zuijing+=$dian;}  
     }
    
 }   
string$up_zuijingdw[]= stringToStringArray($UP_zuijing, " ");//字符串转化数组
string$dw_zuijingdw[]= stringToStringArray($DW_zuijing, " ");//字符串转化数组       
string$head_qvxian=$Axianxian+"_"+$mingzi+"_UP";//open  
select -r $up_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian;

string$head_qvxian_b=$Axianxian+"_"+$mingzi+"_DW";//open
select -r $dw_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian_b;


string$temp_mingzi="";
$temp_mingzi+=$head_qvxian+" "+$head_qvxian_b+" ";
delete $qvxian_mingzi;



string$dian_LRA=$head_qvxian+".cv[0]";
float $pos_A[]=`xform -q -ws -t$dian_LRA`;
string$dian_LRB=$head_qvxian_b+".cv[0]";
float $pos_B[]=`xform -q -ws -t $dian_LRB`;

if($pos_A[0]!=$pos_B[0]){reverseCurve -ch 1 -rpo 1 $head_qvxian;}


 return $temp_mingzi;
}





global proc zxb_fanzhuanzui_xniuqv_proc(string $bns_name[])
{
////////////按顺序选中要控制与要被控制的关节 //////////////////////////
string $bns[]=$bns_name;
int$bnsize=size($bns);
string$bn_R= $bns[0];
string$bn_L= $bns[($bnsize-1)];
float$aa=1.0/($bnsize-1);



int$panduansb=1;


for($i=1;$i<($bnsize-1);$i++) 
{
    string$bn=$bns[$i];
    string$chengchu=($bn+"_multiplyDivide_"+$i+"_rx");
    string$chengchu_A=($bn+"_multiplyDivide_A"+$i+"_rx");
    string$chengchu_B=($bn+"_multiplyDivide_B"+$i+"_rx");

    string$fanxiang=($bn+"_reverse"+$i+"_rx");
    string$jianjian=($bn+"_plusMinusAverage"+$i+"_rx");
    
    
    float$ab=1-$aa*$i;
    float$sb=smoothstep (0,1,$ab);
     float$bb=$ab;
     if($panduansb==1)
     {
      $bb=$sb;
      }
     int$ex=`objExists ($bn+".rooweigth")`;
    if($ex==0)
    {
          addAttr -ln "rooweigth"  -at double  -min 0 -max 1 -dv $bb -k 1 $bn;
          setAttr -keyable false -channelBox true ($bn+".rooweigth");
    }
    
    
    
    
    int$ex=`objExists ($bn+".rooallx")`;
    if($ex==0)
    {
          addAttr -ln "rooallx"  -at double  -min 0 -max 2 -dv 1 -k 1 $bn;
          setAttr -keyable false -channelBox true ($bn+".rooallx");
    }
   
    int$ex=`objExists ($bn+".rooally")`;
    if($ex==0)
    {
          addAttr -ln "rooally"  -at double  -min 0 -max 2 -dv 1 -k 1 $bn;
          setAttr -keyable false -channelBox true ($bn+".rooally");
    }
    
     int$ex=`objExists ($bn+".rooallz")`;
    if($ex==0)
    {
          addAttr -ln "rooallz"  -at double  -min 0 -max 2 -dv 1 -k 1 $bn;
          setAttr -keyable false -channelBox true ($bn+".rooallz");
    }
    
    
    
    
   
    
    
  int$ex=`objExists $chengchu`;
  if($ex==1){delete  $chengchu;}
  shadingNode -asUtility multiplyDivide -n $chengchu;
  connectAttr -f ($bn_R+".r") ($chengchu+".input1");
  connectAttr -f ($bn+".rooweigth") ($chengchu+".input2X");
  connectAttr -f ($bn+".rooweigth") ($chengchu+".input2Y");
  connectAttr -f ($bn+".rooweigth") ($chengchu+".input2Z");

  
  
  int$ex=`objExists $chengchu_A`;
  if($ex==1){delete  $chengchu_A;}
  shadingNode -asUtility multiplyDivide -n $chengchu_A;
  connectAttr -f ($bn_L+".r") ($chengchu_A+".input1");

  
  int$ex=`objExists $fanxiang`;
  if($ex==1){delete  $fanxiang;}
  shadingNode -asUtility reverse -n $fanxiang; //创建返向节点
  
  connectAttr -f ($bn+".rooweigth") ($fanxiang+".inputX");
  connectAttr -f ($bn+".rooweigth") ($fanxiang+".inputY");
  connectAttr -f ($bn+".rooweigth") ($fanxiang+".inputZ");

  connectAttr -f ($fanxiang+".output") ($chengchu_A+".input2");
  
   
  int$ex=`objExists $jianjian`;
  if($ex==1){delete  $jianjian;}
 shadingNode -asUtility plusMinusAverage -n $jianjian;//创建加减节
  connectAttr -f ($chengchu+".output") ($jianjian+".input3D[0]");
 connectAttr -f ($chengchu_A+".output") ($jianjian+".input3D[1]");

  int$ex=`objExists $chengchu_B`;
  if($ex==1){delete  $chengchu_B;}
  shadingNode -asUtility multiplyDivide -n $chengchu_B;
  
connectAttr -f ($jianjian+".output3D") ($chengchu_B+".input1");
connectAttr -f ($bn+".rooallx") ($chengchu_B+".input2X");
connectAttr -f ($bn+".rooally") ($chengchu_B+".input2Y");
connectAttr -f ($bn+".rooallz") ($chengchu_B+".input2Z");

connectAttr -f  ($chengchu_B+".output") ($bn+".r")  ;


}
}













//////////////////////////////////////////////////////////////嘴巴次级骨骼创建///////////////////////////////////////////////////////////////////////////
global proc string zxb_zuibajici_joint_proc(int$chongjian,string$qianzui)
{

  /*string $qvxianssa=`textFieldGrp -q -tx zxb_zairuqvxian `;*/
 string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;
float $temp[]=`getAttr ($head_qvxian+".boundingBoxSize")`;//头的BOX
float $con_size=$temp[2]/70.0;//半径
string $xiaba_bn=`textFieldGrp -q -tx  UI_mouth_outer_wire  `;
string$name_lip=zxb_extract_Curves_proc(0,"lip","place",$xiaba_bn);//提取曲线
string$qvxiansaa[]=stringToStringArray($name_lip, " ");
select -r $qvxiansaa;
DeleteHistory;
string$nurbsSphere=$qianzui+"_nurbsSphere_Group";
string$Cluster=$qianzui+"_Cluster_Group";
string$hairfollicle=$qianzui+"_hairfollicle_Group";
string$joints=$qianzui+"_joint_Group";
string$temp_on_neme=$qianzui+"_temp_ciji_GRP";
string$Cluster_neme="";
string$temp_all_lip_secondary=$qianzui+"_secondary";
string$all_bn_grp_temp=$qianzui+"_root_grp";
zxb_ADD_kongzu_proc($temp_all_lip_secondary);
parent  $temp_all_lip_secondary "Face_Group"; 

zxb_ADD_kongzu_proc($nurbsSphere);
zxb_ADD_kongzu_proc($Cluster);
zxb_ADD_kongzu_proc($hairfollicle);
zxb_ADD_kongzu_proc($joints);

setAttr ($joints+".visibility") 0;
setAttr -lock true ($joints+".v");

int $ex=`objExists "Face_Group"`;//查询这个物体是否纯在
if($ex==1)
  {
   parent ($joints) $temp_all_lip_secondary;
   parent $nurbsSphere $temp_all_lip_secondary;
   parent ($hairfollicle) $temp_all_lip_secondary;
   parent ($Cluster) $temp_all_lip_secondary;
  }else
      {
       zxb_ADD_kongzu_proc($temp_on_neme);
       parent ($joints) $temp_on_neme;
       parent $nurbsSphere $temp_on_neme;
       parent ($hairfollicle) $temp_on_neme;
       parent ($Cluster) $temp_on_neme;
       }

string $bianliang[]=$qvxiansaa;//选中嘴巴曲线
int$sssd=$chongjian;
//int$sssd=1;
/*string $qvxianssb=`textFieldGrp -q -tx zxb_zairuqvxianA `;
string$qvxiansbb[]=stringToStringArray($qvxianssb, " ");*/
if($sssd==1)
 { 
   select -r $qvxiansaa[0];
   duplicate -rr -n ($qvxiansaa[0]+"temp");
   select -r $qvxiansaa[1];
   duplicate -rr -n ($qvxiansaa[1]+"temp");
 }
string $kongzhi_qvxianA=($qvxiansaa[0]+"temp");
string $kongzhi_qvxianB=($qvxiansaa[1]+"temp");
string $qvxian_kong[];
clear$qvxian_kong;
if($sssd==1)
 {
   select -cl  ;
   int $panduan=`objExists $kongzhi_qvxianA`;//查询这个物体是否纯在
   if($panduan==1){select -add $kongzhi_qvxianA;}
   int $panduan=`objExists $kongzhi_qvxianB`;//查询这个物体是否纯在
   if($panduan==1){select -add $kongzhi_qvxianB;}
   $qvxian_kong=`ls -sl`;//选中嘴巴曲线   
  }
int $size_qvxian=size ($qvxian_kong);
//print $bianliang;
string $temp_shuzzu[];
clear $temp_shuzzu;
int $cv_size;

for($i=0;$i<size($bianliang);$i++) 
{
     string $qvxian=$bianliang[$i];
     string $qvxian_AAA="";
     if($sssd==1){$qvxian_AAA=$qvxian_kong[$i];}   
     float $temp_pos_A[]=`xform -q -ws -t ($qvxian+".cv[0]")`;
     select -cl  ;
     
     string$temp_up_or_dw="UP";
     if($i>0){$temp_up_or_dw="DW";}
     string$shuxing_temp=$qianzui+"_all_joint_"+$temp_up_or_dw;
     zxb_ADD_shuxing_string_proc( $head_qvxian,$shuxing_temp);
     string$temp_bn_temp="";
     
    ///////////////////////创建跟骨骼///////////////////////////
    string$zuiba_bn_root=($bianliang[0]+"zuiba_bn_root");
    int $panduan=`objExists $zuiba_bn_root`;
    if($panduan==0)
      {
        joint -p 0 $temp_pos_A[1] $temp_pos_A[2] -n $zuiba_bn_root ;
        setAttr ($zuiba_bn_root+".drawStyle") 2;
        group -n $all_bn_grp_temp;
        setAttr -l true { ($zuiba_bn_root+".ds") };
        parent $all_bn_grp_temp $joints ;
       }
    /////////////////创建子关节///////////////////////////////////////
    select -r ($qvxian+".cv[0:9999999999999]") ;
    string $qvxian_cv[]=`ls -sl -fl`;//选中点
    string $bn=($qvxian+"_UPbn_");
    if($i==1){$bn=($qvxian+"_DWbn_");}
    string $qvmian_plane=($qvxian+"_UP_plane_");
    if($i==1){$qvmian_plane=($qvxian+"_DW_plane_");} 
    string $qvmian_clust=($qvxian+"_UP_clust_");
    if($i==1){$qvmian_clust=($qvxian+"_DW_clust_");} 
    string $qvmian_con=($qvxian+"_UP_con_");
    if($i==1){$qvmian_con=($qvxian+"_DW_con_");} 
     string $qvmian_qvxian=($qvxian+"_UP_qvxian_");
    if($i==1){$qvmian_qvxian=($qvxian+"_DW_qvxian_");} 
     string $xing_bn[];
     clear $xing_bn;
     int$xuanhuan=0;
     int$xuanhuan_size=size($qvxian_cv);
     if($i==1){$xuanhuan=1;$xuanhuan_size=$xuanhuan_size-1;}
     int$bn_int=0;
     
    for($ii=$xuanhuan;$ii<$xuanhuan_size;$ii++) 
      {
      string $CVdian=$qvxian_cv[$ii];
      string $qvxian_bn=($qvxian+$bn+$ii);
      float $temp_pos_B[]=`xform -q -ws -t $CVdian`;
      select -r  $zuiba_bn_root;
      joint -p $temp_pos_B[0] $temp_pos_B[1] $temp_pos_B[2]-n  $qvxian_bn ;
      setAttr ($qvxian_bn+".radius") $con_size;
      $xing_bn[$bn_int]=$qvxian_bn;
      $bn_int=$bn_int+1;
      $temp_bn_temp+=$qvxian_bn+" ";
      }
      setAttr -type "string" ( $head_qvxian+"."+$shuxing_temp) $temp_bn_temp; 
      // print  $xing_bn;
     //////////////////////////////////////////////创建曲线 //////////////////////////////////////////////////////
  
   if($sssd==0)
     {
      string $qvxian_D = $qvxian;
      float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
      float $kaishi_pos_B[]=`xform -q -ws -t  ($qvxian_D+".cv[+"+(size($qvxian_cv)-1)+"]")`;
      int $panduan=`objExists $qvmian_qvxian`;
      if($panduan==1){ delete $qvmian_qvxian;}
      curve -d 1 -p $kaishi_pos_A[0] $kaishi_pos_A[1] $kaishi_pos_A[2] -p $kaishi_pos_B[0] $kaishi_pos_B[1] $kaishi_pos_B[2] -n $qvmian_qvxian; //创建曲线
     rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s 4 -d 3 -tol 0.01 $qvmian_qvxian;//重建曲线
     //////////////////坐标中心点的位置保证在0的位置////////////////
    float $temp_pos_A[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[3]")`;
     xform -ws -t 0  $temp_pos_A[1]  $temp_pos_A[2] ($qvmian_qvxian+".cv[3]");//中间点Z轴保证为0 
    /////////////创建曲线信息节点///////////////////////////
     int $panduan=`objExists ($qvxian_D+"qvxianzuijingdianjiedian")`;
     if($panduan==1){ delete ($qvxian_D+"qvxianzuijingdianjiedian");}
     createNode nearestPointOnCurve -n ($qvxian_D+"qvxianzuijingdianjiedian");//创建曲线最近点节点
     string $qvxian_D_shp[]=`listRelatives -s $qvxian_D`;
     connectAttr -force ($qvxian_D_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点
    ////////////点3的位置/////////////////////
    for($iii=0;$iii<10;$iii++)//点3的位置
       {
        float $temp_pos_D[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[3]")`;
        setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $temp_pos_D[0] $temp_pos_D[1] $temp_pos_D[2];
        float $qvxian_pos[]=`getAttr ($qvxian_D+"qvxianzuijingdianjiedian.position")`;
        xform -ws -t 0 $qvxian_pos[1] $qvxian_pos[2] ($qvmian_qvxian+".cv[3]");
       }
     ///////////点2的位置///////////
    float $temp_pos_B[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[0]")`;
    float $qvxian_MM_pos[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[3]")`;
    xform -ws -t (($temp_pos_B[0]+$qvxian_MM_pos[0])/2) (($temp_pos_B[1]+$qvxian_MM_pos[1])/2)  (($temp_pos_B[2]+$qvxian_MM_pos[2])/2) ($qvmian_qvxian+".cv[2]");
    float $temp_pos_D[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[2]")`;
    setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $temp_pos_D[0] $temp_pos_D[1] $temp_pos_D[2];
    float $qvxian_pos[]=`getAttr ($qvxian_D+"qvxianzuijingdianjiedian.position")`;
    xform -ws -t $qvxian_pos[0] $qvxian_pos[1] $qvxian_pos[2] ($qvmian_qvxian+".cv[2]");//点1的位置
    spaceLocator -p 0 0 0 -n ("temp_A");
    spaceLocator -p 0 0 0 -n ("temp_B");
    spaceLocator -p 0 0 0 -n ("temp_C");
    //float $temp_pos_B[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[0]")`;
    float $qvxian_MM_pos[]=`xform -q -ws -t  ($qvmian_qvxian+".cv[2]")`;
    xform -ws -t ($temp_pos_B[0]) ($temp_pos_B[1])  ($temp_pos_B[2]) ("temp_A");
    xform -ws -t $qvxian_MM_pos[0] $qvxian_MM_pos[1] $qvxian_MM_pos[2]  ("temp_B");
    string $yuesu_TEMP[]=`parentConstraint  ("temp_A") ("temp_B") ("temp_C")`;
    setAttr ($yuesu_TEMP[0]+".temp_AW0") 0.666;
    setAttr ($yuesu_TEMP[0]+".temp_BW1") 0.333;
    float $temp_pos_D[]=`xform -q -ws -t  ("temp_C")`;
    setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $temp_pos_D[0] $temp_pos_D[1] $temp_pos_D[2];
    float $qvxian_pos[]=`getAttr ($qvxian_D+"qvxianzuijingdianjiedian.position")`;
    xform -ws -t $qvxian_pos[0] $qvxian_pos[1] $qvxian_pos[2] ($qvmian_qvxian+".cv[1]");//点1的位置
    delete ("temp_A") ("temp_B")("temp_C");
    ///////////点4的位置//////////////
    float $temp_posG[]=`xform -q -ws -t ($qvmian_qvxian+".cv[2]")`;
    xform  -ws -t ($temp_posG[0]*-1) $temp_posG[1] $temp_posG[2]  ($qvmian_qvxian+".cv[4]");//对称的位置  点3的位置
    ///////////点5的位置//////////////
    float $temp_posG[]=`xform -q -ws -t ($qvmian_qvxian+".cv[1]")`;
    xform  -ws -t ($temp_posG[0]*-1) $temp_posG[1] $temp_posG[2]  ($qvmian_qvxian+".cv[5]");//对称的位置  点3的位置
    /////////////////判断是否翻转曲线起始点/////////////////
    //string $qvxian_D = $qvxian;
    float $dian_temp_kaishi[]=`xform -q -ws -t ($qvmian_qvxian+".cv[0]")`;
    float $dian_temp_jiesu[]=`xform -q -ws -t ($qvmian_qvxian+".cv[6]")`;
    if($dian_temp_jiesu[0]>$dian_temp_kaishi[0])
      {  
       reverseCurve -ch 0 -rpo 1 ($qvmian_qvxian);
      }
   delete ($qvxian_D+"qvxianzuijingdianjiedian");
    
   }else 
          { 
           select -r $qvxian_AAA;
           rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 3 -tol 0.001 $qvxian_AAA;
           select -r $qvxian_AAA;
           DeleteHistory;
           rename $qvxian_AAA  ($qvmian_qvxian);
           }
 
   ///////////////////////////////////////////////////////////
   float $dian_temp_kaishi[];
   float$dian_temp_jiesu[];
   clear $dian_temp_kaishi  $dian_temp_jiesu;
   if( $size_qvxian!=2)
   { 
   select -r ($qvmian_qvxian+".cv[0:9999999999999]");
    string $qvxian_cv_eee[]=`ls -sl -fl`;//选中点
    float$size=size($qvxian_cv_eee);
    $dian_temp_kaishi=`xform -q -ws -t ($qvmian_qvxian+".cv[0]")`;
   $dian_temp_jiesu=`xform -q -ws -t ($qvmian_qvxian+".cv["+$size+"]")`;
   }
   else 
      { 
       select -r($qvmian_qvxian+".cv[0:9999999999999]"); 
       string $qvxian_cv_eee[]=`ls -sl -fl`;//选中点
       float$size=size($qvxian_cv_eee);
       $dian_temp_kaishi=`xform -q -ws -t ($qvmian_qvxian+".cv[0]")`;
       $dian_temp_jiesu=`xform -q -ws -t ($qvmian_qvxian+".cv["+$size+"]")`;
       if($dian_temp_jiesu[0]>$dian_temp_kaishi[0])
         { 
          reverseCurve -ch 0 -rpo 1 ($qvmian_qvxian);
          }
       select -r($qvmian_qvxian+".cv[0:9999999999999]"); 
     }
     
     ///////////////////////////////////放样曲面//////////////////////////////////////////////////////////////
    string $qvxian_cv_A[]=`ls -sl -fl`;//选中点
    $cv_size=size($qvxian_cv_A);
   $changdu=abs($dian_temp_kaishi[0]-$dian_temp_jiesu[0]);
   offsetCurve  -ch off -rn false -cb 2 -st true -cl true -cr 0 -d ($changdu*-0.01) -tol 0.01 -sd 5 -ugn false  ($qvmian_qvxian) ;
   rename ($qvmian_qvxian+"_A");
   offsetCurve  -ch off -rn false -cb 2 -st true -cl true -cr 0 -d ($changdu*0.01) -tol 0.01 -sd 5 -ugn false  ($qvmian_qvxian) ;
   rename ($qvmian_qvxian+"_B");
   loft -ch 0 -u 1 -c 0 -ar 1 -d 3 -ss 1 -rn 0 -po 0 -rsn true  -n $qvmian_plane ($qvmian_qvxian+"_A")  ($qvmian_qvxian+"_B") ;
   delete  ($qvmian_qvxian+"_A") ($qvmian_qvxian+"_B") ($qvmian_qvxian);
   setAttr ($qvmian_plane+".visibility") 0;
   setAttr -lock true  ($qvmian_plane+".v");
 //////////////////////////创建毛囊附着/////////////////////////////
   int $panduan=`objExists ($qvmian_plane+"_closestPointOnSurface_temp")`;//查询这个物体是否纯在
   if($panduan==1){ delete($qvmian_plane+"_closestPointOnSurface_temp");}
   createNode "closestPointOnSurface" -n ($qvmian_plane+"_closestPointOnSurface_temp") ;
   string $sheps[]=`listRelatives -s $qvmian_plane`;
   connectAttr -force ($sheps[0]+".worldSpace[0]")  ($qvmian_plane+"_closestPointOnSurface_temp.inputSurface");
   parent$qvmian_plane("lip_nurbsSphere_Group");
   string $plane_Shape= $sheps[0];
   for($iii=0;$iii<size($xing_bn);$iii++) 
   {
       string $zuiba_bn=$xing_bn[$iii];
       string $bn_maonang_shep=($zuiba_bn+"_maonang_Shape");
       spaceLocator -p 0 0 0 -n ($zuiba_bn+"_loc");
       delete`parentConstraint  $zuiba_bn ($zuiba_bn+"_loc") `;
       setAttr ($zuiba_bn+"_loc.visibility") 0;
       setAttr -lock true ($zuiba_bn+"_loc.v");
       float $pos[]=`xform -q -ws -t $zuiba_bn `;
       setAttr -type float3 ($qvmian_plane+"_closestPointOnSurface_temp.inPosition") $pos[0] $pos[1]$pos[2];
       float $U=`getAttr ($qvmian_plane+"_closestPointOnSurface_temp.parameterU")`;
       float $V=`getAttr ($qvmian_plane+"_closestPointOnSurface_temp.parameterV")`;
       createNode "follicle" -n $bn_maonang_shep;//
       string $maonang[]=`listRelatives -p  $bn_maonang_shep`; //列出子物体 -c 列出子物体 -p  关节父物体-ad 所有子物体 - fullPath 全路径 -s 列出型节点
        string $bn_maonang=$maonang[0];
        parent  $bn_maonang ("lip_hairfollicle_Group");
        setAttr ($bn_maonang+".visibility") 0;
        setAttr -lock true ($bn_maonang+".v");
        connectAttr -force ($plane_Shape+".local") ($bn_maonang_shep+".inputSurface");
        connectAttr -force ($plane_Shape+".worldMatrix[0]") ($bn_maonang_shep+".inputWorldMatrix");
        connectAttr -f ($bn_maonang_shep+".outRotate") ($bn_maonang+".rotate");
        connectAttr -f ($bn_maonang_shep+".outTranslate") ($bn_maonang+".translate");
        setAttr ($bn_maonang_shep+".parameterU") $U;
        setAttr ($bn_maonang_shep+".parameterV") $V;
       parent ($zuiba_bn+"_loc")$bn_maonang;
       parentConstraint ($zuiba_bn+"_loc") $zuiba_bn;//父子约束
   }
   for($iii=1;$iii<($cv_size-1);$iii++) 
      {
        string $qvmian_dian=($qvmian_plane+".cv["+$iii+"][0:3]");
        select -r  $qvmian_dian ;
        CreateCluster;
        string $cu=($qvmian_plane+"_Handle_"+$iii);
        rename $cu;
        parent  $cu ("lip_Cluster_Group");
        $Cluster_neme+=$cu+" ";
        setAttr ($cu+".visibility") 0;
        setAttr -lock true ($cu+".v");
     }
   
   $temp_shuzzu[$i]=$qvmian_plane;
}
select -cl  ;
for($j=0;$j<size($temp_shuzzu);$j++) 
   {
   string $qvmian=$temp_shuzzu[$j];
   select -add ($qvmian+".cv[0][0:3]");
    }
CreateCluster;
string $cu_mingzi=($bianliang[0]+"__UP_plane_Handle_0");
rename $cu_mingzi;
parent  $cu_mingzi ("lip_Cluster_Group");
$Cluster_neme+=$cu_mingzi+" ";
setAttr ($cu_mingzi+".visibility") 0;
setAttr -lock true ($cu_mingzi+".v");
select -cl  ;
for($j=0;$j<size($temp_shuzzu);$j++) 
   {
   string $qvmian=$temp_shuzzu[$j];
   select -add ($qvmian+".cv["+($cv_size-1)+"][0:3]");
   }
CreateCluster;

string $cu_mingzi=($bianliang[1]+"_DW_plane__Handle_0");
rename $cu_mingzi;
parent  $cu_mingzi ("lip_Cluster_Group");
setAttr ($cu_mingzi+".visibility") 0;
setAttr -lock true ($cu_mingzi+".v");
$Cluster_neme+=$cu_mingzi+" ";

delete$qvxiansaa[0]$qvxiansaa[1] ;
return $Cluster_neme;
}

////////////////////////////////////////////////////////////////////
global proc string zxb_extract_Curves_proc(int$a,string$mingzi,string$qianzui,string$xian_A)//int 区分线段的平均值或者法线朝向 $mingzi名字 $qianzui前缀 $xian_A 线段名称
{

string$xian=$xian_A;
//string $xian=`textFieldGrp -q -tx  zxb_ganjie `;
string$Axianxian=$qianzui;
string$mingzi=$mingzi;
string$qvxianss[]= stringToStringArray($xian, " ");//字符串转化数组
string $bianliang[]=$qvxianss;//提取曲线名字
string$temp_qvxian[];
clear $temp_qvxian;
int $nemt=`tokenize $bianliang[0]"."  $temp_qvxian`;//分离字符串存到变量
string$moxing=$temp_qvxian[0];
select -r $bianliang;
ConvertSelectionToVertices;
string $dingdian[]=`ls -sl -fl`;


      string$R_cv="";
      string$L_cv="";
     string$vtxs[]=$dingdian;
     float$dd=-100000000000000;
     float$xx=1000000000000000;
     string$dian_L="";
     string$dian_R="";
     for ($i=0;$i<size($vtxs);$i++)
          {
           string$vtx=$vtxs[$i];
           float$bn_pos[]=`xform -q -ws -t $vtx`;
           if($bn_pos[0]>$dd)
             {
             $dd=$bn_pos[0];
             $dian_L=$vtx;
             }
             if($bn_pos[0]<$xx)
             {
             $xx=$bn_pos[0];
             $dian_R=$vtx;
             }
             
           }
           
           
     $L_cv=$dian_L;   
     $R_cv=$dian_R;
 float $R_POS[]=`xform -q -ws -t $R_cv`; 
 string$qvxian_mingzi=$Axianxian+"_temp_curve";
  select -r $qvxianss;
  polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $qvxian_mingzi;
 DeleteHistory;
 float$pamte=zxb_return_curve_U($R_POS[0],$R_POS[1],$R_POS[2],$qvxian_mingzi);
 select -r ($qvxian_mingzi+".u["+$pamte+"]") ;
float $tempp_POS[]=`xform -q -ws -t $dingdian[0]`; 
int$jisuan=size($dingdian)-1;
float $tempp_POS_A[]=`xform -q -ws -t $dingdian[$jisuan]`; 
float $R_POaS=$R_POS[0]+$R_POS[1]+$R_POS[2];
float $R_PObS=$tempp_POS[0]+$tempp_POS[1]+$tempp_POS[2];
if($R_POaS!=$R_PObS)
  {
    moveNurbsCurveSeam;
   }
 

 select -r ($qvxian_mingzi+".cv[0:999999999]");
 
 string $qvxian_A[]=`ls -sl -fl`;
 
 
string$dianLL="";
float $cv_pos[]=`xform -q -ws -t $L_cv`;
float$maga=1000000000000;
     
for($iii=0;$iii<size($qvxian_A);$iii++)
   { 
     string$mag_cv=$qvxian_A[$iii];
     float $mag_po[]=`xform -q -ws -t $mag_cv`;
     float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
     if($weizhi<$maga){$maga=$weizhi;$dianLL=$mag_cv;}
     } 
    
//print $dianLL;
  string$ccv[];
  clear $ccv;
  int $nemt=`tokenize $dianLL"[" $ccv`;//分离字符串存到变量
   int $nemt=`tokenize $ccv[1]"]" $ccv`;//分离字符串存到变量
  string$shu=$ccv[0];
 
 
 int$qvxiancv_size=size($qvxian_A);
int$temp_a=$shu;

float$exa=0;
float$exb=0;


if($a==0)
{
select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exb=`zxb_qvfengshangzi`;

select -r ($qvxian_mingzi+".cv[0:999999999]");
select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
$exa=`zxb_qvfengshangzi`;
}
if($a==1)
 {
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exa=zxb_normal_pingjunshu($moxing);
  
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $exb=`zxb_normal_pingjunshu($moxing)`;
  }


string$up_qvxiancvs[];
clear$up_qvxiancvs;
string$dw_qvxiancvs[];
clear$dw_qvxiancvs;



if($exb>$exa)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
 $dw_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  }
if($exa>$exb)
  {
  select -r ($qvxian_mingzi+".cv[0:999999999]");
  select -d  ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $up_qvxiancvs =`ls -sl -fl`;
  select -r ($qvxian_mingzi+".cv[0:"+$temp_a+"]");
  $dw_qvxiancvs=`ls -sl -fl`;
   }
string$UP_zuijing="";
string$DW_zuijing="";


for($o=0;$o<2;$o++)
{
    string$temp_suzu[];
    clear$temp_suzu;
   if($o==0){$temp_suzu=$up_qvxiancvs;}
   if($o==1){$temp_suzu=$dw_qvxiancvs;}
   for($i=0;$i<size($temp_suzu);$i++)
    {
     string$temp_cv=$temp_suzu[$i];
     float $cv_pos[]=`xform -q -ws -t $temp_cv`;
     float$mag=1000000000000;
     string$dian="";
     for($ii=0;$ii<size($dingdian);$ii++)
        { 
         string$mag_cv=$dingdian[$ii];
         float $mag_po[]=`xform -q -ws -t $mag_cv`;
         float $weizhi=mag(<<$cv_pos[0],$cv_pos[1],$cv_pos[2]>>-<< $mag_po[0] ,$mag_po[1] ,$mag_po[2]>>);////////计算距离
         if($weizhi<$mag){$mag=$weizhi;$dian=$mag_cv+" ";}
         } 
     if($o==0){$UP_zuijing+=$dian;}
     if($o==1){$DW_zuijing+=$dian;}  
     }
    
 }   
string$up_zuijingdw[]= stringToStringArray($UP_zuijing, " ");//字符串转化数组
string$dw_zuijingdw[]= stringToStringArray($DW_zuijing, " ");//字符串转化数组       
string$head_qvxian=$Axianxian+"_"+$mingzi+"_UP";//open  
select -r $up_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian;

string$head_qvxian_b=$Axianxian+"_"+$mingzi+"_DW";//open
select -r $dw_zuijingdw;
select -add $R_cv;
select -add $L_cv;
ConvertSelectionToContainedEdges;
polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $head_qvxian_b;


string$temp_mingzi="";
$temp_mingzi+=$head_qvxian+" "+$head_qvxian_b+" ";
delete $qvxian_mingzi;



string$dian_LRA=$head_qvxian+".cv[0]";
float $pos_A[]=`xform -q -ws -t$dian_LRA`;
string$dian_LRB=$head_qvxian_b+".cv[0]";
float $pos_B[]=`xform -q -ws -t $dian_LRB`;

if($pos_A[0]!=$pos_B[0]){reverseCurve -ch 1 -rpo 1 $head_qvxian;}


 return $temp_mingzi;
}




global proc zxb_child_object_proc(string$mode_ss,string$head_bn_ss,string$all_bn_ss,int$root_ss,int$duicheng_ss,int$fanxiang_ss,int$maonang_ss)
{//////////////已知项//////////////////模型//////////////旋转物体////////所有次级骨骼或者簇///控制旋转/////////对称///////////////反向 ////////毛囊

int$xuanzhuan=$root_ss;
int$duicheng= $duicheng_ss;
int$dingweiqi_fanxiang= $fanxiang_ss;
int$maonang_fuzhao=$maonang_ss;
string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;

string $toubu_boj=$mode_ss;//模型
string $fangxiang_bn =$head_bn_ss;//骨骼

string $cijibn_sss=$all_bn_ss;//次级骨骼
string$cijibn_ss[]=stringToStringArray($cijibn_sss, " ");
zxb_ADD_kongzu_proc("head_follow_loc_Group");
zxb_ADD_kongzu_proc("head_follow_curve_Group");

 string $temp_fu_A[];
 string $temp_fu_B[];
 clear $temp_fu_A;
 clear $temp_fu_B;
 $temp_fu_A=`listRelatives -p ($cijibn_ss[0])`; 
 int  $ex=`objExists ( $temp_fu_A[0])`;
 if($ex==1){ $temp_fu_B=`listRelatives -p ($temp_fu_A[0])`; }
 //print $temp_fu_B[0];
// string $temp_fu_C[]=`listRelatives -p ( $temp_fu_B[0])`;
// string $temp_fu_D[]=`listRelatives -p ( $temp_fu_C[0])`;
$ex=`objExists ("Face_Group")`;
if($ex==1)
  {
    string $temp_fu[]=`listRelatives -p ("head_follow_loc_Group")`; 
    $ex_a=`objExists $temp_fu[0]`; 
    if($ex_a==0)
       {
         parent ("head_follow_loc_Group")$temp_fu_B[0];
         parent ("head_follow_curve_Group")$temp_fu_B[0];
        }
   
   }else
       {zxb_ADD_kongzu_proc("lip_temp_ciji_GRP");
         parent ("head_follow_loc_Group")("lip_temp_ciji_GRP");
         parent ("head_follow_curve_Group")("lip_temp_ciji_GRP");
        }

string $bianliang[]=$cijibn_ss;//选中簇
string $head_bn=$fangxiang_bn;//头部骨骼
string$mensh=$toubu_boj;//模型
int$maonang=$maonang_fuzhao;
//int $ex;//判断
int $ex_A=$xuanzhuan;//判断是否控制簇的旋转
int $ex_B=$duicheng;//判断是否控制器左右对称的位移
int $x_C=$dingweiqi_fanxiang;//判断定位器是否反向控制器旋转
int$vis=`getAttr ($mensh+".v") `;

select -r $mensh;
channelBoxCommand -unlock ;
CBunlockAttr ($mensh+".v");
setAttr  ($mensh+".visibility") 1;
select -cl  ;
string $mash_zi_A[]=`listRelatives -s $mensh `; 
string $mash_shape_A=$mash_zi_A[0];
//////////////////////////////////////////
string $root_grp=($mensh+"_grp");//总组
string $qvxian_grp=($mensh+"_qvxian_grp");//总组

string $head_qvxian_shepe_temp[]=`listRelatives -s $head_qvxian `; 
float $temp[]=`getAttr ($head_qvxian_shepe_temp[0]+".boundingBoxSize")`;//头的BOX
float $con_size=$temp[2]*0.01;//半径

$ex=`objExists $root_grp`;
if($ex==0){group -empty -n $root_grp ;parent $root_grp ("head_follow_curve_Group");}//创建组

  $ex=`objExists $qvxian_grp`;
if($ex==0)
   {
       group -empty -n $qvxian_grp ;
       setAttr ($qvxian_grp+".visibility") 0;
       setAttr -lock true ($qvxian_grp+".v"); 
       parent $qvxian_grp ("head_follow_curve_Group");
     }//创建组

string$controller_cu_temp_all="";
string$shuxing_controller=$temp_fu_B[0]+"controller";

 zxb_ADD_shuxing_string_proc($head_qvxian,$shuxing_controller);
 
for ($y=0;$y<size($bianliang);$y++)
{ //////////////////////////需要的变量/////////////////////////////////////
   string $cu=$bianliang[$y];//簇
  
   string $cu_loc_temp=($cu+"_loc");
   string $cu_loc_grp=($cu+"_loc_grp");
   string $cu_loc_grp_B=($cu+"_loc_grp_B");
   string $cu_loc_grp_A=($cu+"_loc_grp_A");
   string $cu_con=($cu+"_con");
   
   string $cu_con_Grp_A=($cu+"_con_grp_A");
   string $cu_con_Grp_B=($cu+"_con_grp_B");
   string $cu_con_Grp_C=($cu+"_con_grp_C");
   string $cu_con_Grp_D=($cu+"_con_grp_D");
   string $cu_con_Grp_E=($cu+"_con_grp_E");
   string $cu_con_Grp_F=($cu+"_con_grp_F");
   string $cu_con_Grp_G=($cu+"_con_grp_G");
   
   
   
   string $cu_con_Grp_ROT=($cu+"_con_grp_ROT");
   string $cu_con_Grp_REV=($cu+"_con_grp_REV");
   string $cu_con_Grp=($cu+"_con_grp");
   
   
    string$loc_rot=("head_ciji_loc_rot");
   string$loc_rot_grp=($loc_rot+"_grp");
    string$loc_follow=($loc_rot+"_follow");
    string$loc_follow_grp=($loc_rot+"_follow_grp");
   
   ///////////////创建控制簇的定位器  位置 缩放//////////////////////////////////
   spaceLocator -p 0 0 0 -n  $cu_loc_temp;
   group -n $cu_loc_grp;
   group -n $cu_loc_grp_B;
   group -n $cu_loc_grp_A;
   
  setAttr ($cu_loc_temp+".visibility") 0;
  setAttr -lock true  ($cu_loc_temp+".v");
   
  ////////////控制整体旋转 缩放 位移 的定位器//////////////// 
   
    $ex=`objExists $loc_rot`;
   if($ex==0)
   {
    spaceLocator -p 0 0 0 -n  $loc_rot;
    group -n $loc_rot_grp;
    parent $loc_rot_grp $root_grp;
    setAttr ($loc_rot_grp+".visibility") 0;
    setAttr -lock true ($loc_rot_grp+".v");
    
    
    spaceLocator -p 0 0 0 -n  $loc_follow;
      int$temp_panduan=`objExists $loc_follow_grp`;
      if($temp_panduan==1){delete $loc_follow_grp;}
    group -n $loc_follow_grp;
    delete`pointConstraint $head_bn $loc_follow_grp`;
    parent $loc_follow_grp ("head_follow_loc_Group");
    //parent $loc_follow_grp $head_bn;
    parentConstraint $head_bn $loc_follow_grp ;
    scaleConstraint -mo $head_bn $loc_follow_grp;
    setAttr ($loc_follow_grp+".visibility") 0;
    setAttr -lock true ($loc_follow_grp+".v");
    parentConstraint $loc_follow $loc_rot;
     scaleConstraint $loc_follow $loc_rot;
     }
   /////////////////////创建控制器///////////////////////////////
   $controller_cu_temp_all+=$cu_con+" ";
   zxb_chuangjianqiuxingkongzhiqi($cu_con,$con_size);
   group -n $cu_con_Grp_A;
   group -n $cu_con_Grp_B;
   group -n $cu_con_Grp_C;
   group -n $cu_con_Grp_D;
   group -n $cu_con_Grp_E;
   group -n $cu_con_Grp_F;
   group -n $cu_con_Grp_G;
   group -n $cu_con_Grp_REV;
   group -n  $cu_con_Grp_ROT;
   group -n $cu_con_Grp;
   delete`parentConstraint $cu $cu_con_Grp`;
  
   parent $cu_con_Grp $root_grp;
   
   
   
   ///////////////////////被头部约束的定位旋转 缩放连接到控制器////////////////////////////////
    connectAttr -force ($loc_rot+".r") ($cu_con_Grp+".r");
    connectAttr -force ($loc_rot+".s") ($cu_con_Grp+".s");
     delete`parentConstraint $cu_con $cu_loc_grp_A`;
    float $pos_temp[]=`xform -q -ws -t $cu_loc_temp`;
    if($ex_B==1)
    {
      if($pos_temp[0]<-0.001)
      {
       setAttr ($cu_con_Grp_ROT+".scaleZ") -1;
       setAttr ($cu_loc_grp_B+".scaleZ") -1;
      }   
    } 
   
   /////////////////控制器的3个组连接簇的最上层组///////////////////////
   addAttr -ln "zhouxiangX"  -at double  -dv 0 -k 1  $cu_con;
   addAttr -ln "zhouxiangY"  -at double  -dv 0 -k 1  $cu_con;
   addAttr -ln "zhouxiangZ"  -at double  -dv 0 -k 1  $cu_con;
   setAttr -keyable false -channelBox true ($cu_con+".zhouxiangZ");
   setAttr -keyable false -channelBox true ($cu_con+".zhouxiangX");
   setAttr -keyable false -channelBox true ($cu_con+".zhouxiangY");
   connectAttr -force ($cu_con+".zhouxiangX")  ($cu_con_Grp_ROT+".rx");
   connectAttr -force ($cu_con+".zhouxiangY")  ($cu_con_Grp_ROT+".ry");
   connectAttr -force ($cu_con+".zhouxiangZ")  ($cu_con_Grp_ROT+".rz");

  if($x_C==1)
      {
          
          float$xuanzhuan_temp[]=`xform -q -ws -t $cu_loc_grp_B`;
          if($xuanzhuan_temp[0]<0)
             {
              string$xuanzhuan_multiplyDivide=($cu+"xuanzhuan_multiplyDivide_"+$y);
              int$exaa=`objExists $xuanzhuan_multiplyDivide`;
              if($exaa==1){delete $xuanzhuan_multiplyDivide;}
              shadingNode -asUtility multiplyDivide -n $xuanzhuan_multiplyDivide;//创建乘除节点 
              setAttr  -type float3 ($xuanzhuan_multiplyDivide+".input2") -1 -1 -1 ;
              connectAttr -force ($cu_con+".zhouxiangX") ($xuanzhuan_multiplyDivide+".input1X");
              connectAttr -force ($cu_con+".zhouxiangY") ($xuanzhuan_multiplyDivide+".input1Y");
              connectAttr -force ($cu_con+".zhouxiangZ") ($xuanzhuan_multiplyDivide+".input1Z");
              
              connectAttr -force  ($xuanzhuan_multiplyDivide+".outputX") ($cu_loc_grp_B+".rx");
              connectAttr -force  ($xuanzhuan_multiplyDivide+".outputY") ($cu_loc_grp_B+".ry");
              connectAttr -force  ($xuanzhuan_multiplyDivide+".outputZ")($cu_loc_grp_B+".rz");
            }else
                 {   connectAttr -force ($cu_con+".zhouxiangX")  ($cu_loc_grp_B+".rx");
                     connectAttr -force ($cu_con+".zhouxiangY")  ($cu_loc_grp_B+".ry");
                     connectAttr -force ($cu_con+".zhouxiangZ")  ($cu_loc_grp_B+".rz");
                 }

  
      }
        else{
              connectAttr -force ($cu_con+".zhouxiangX")  ($cu_loc_grp_B+".rx");
              connectAttr -force ($cu_con+".zhouxiangY")  ($cu_loc_grp_B+".ry");
              connectAttr -force ($cu_con+".zhouxiangZ")  ($cu_loc_grp_B+".rz");
               }
   
   ///////////////////////控制器的3个组 控制控制簇簇的定位器////////////////////////////////////
   
  
  
   
   string $jiajianjiedian_A=($cu+"plusMinusAverage_A"+$y);
   string $jiajianjiedian_B=($cu+"plusMinusAverage_B"+$y);
   string $jiajianjiedian_C=($cu+"plusMinusAverage_C"+$y);
    string $jiajianjiedian_D=($cu+"plusMinusAverage_D"+$y);
   string $jiajianjiedian_E=($cu+"plusMinusAverage_E"+$y);
   string $jiajianjiedian_F=($cu+"plusMinusAverage_F"+$y);
     string $jiajianjiedian_G=($cu+"plusMinusAverage_G"+$y);
     
    addAttr -ln "zhaodao_trs"  -at bool  -dv 0 -k 1  $cu_con;
    setAttr -keyable false -channelBox true ($cu_con+".zhaodao_trs");
    
    addAttr -ln "zhaodao_rot"  -at bool  -dv 0 -k 1  $cu_con;
    setAttr -keyable false -channelBox true ($cu_con+".zhaodao_rot");
    
    addAttr -ln "zhaodao_scl"  -at bool  -dv 0 -k 1  $cu_con;
    setAttr -keyable false -channelBox true ($cu_con+".zhaodao_scl");
    
  
   int $panduan_temp=`objExists $jiajianjiedian_A`;
   if($panduan_temp==1){delete $jiajianjiedian_A;}
   shadingNode -asUtility plusMinusAverage -n $jiajianjiedian_A;//创建加减节点
   
   int $panduan_temp=`objExists $jiajianjiedian_B`;
   if($panduan_temp==1){delete $jiajianjiedian_B;}
   shadingNode -asUtility plusMinusAverage -n $jiajianjiedian_B;//创建加减节点
   
   int $panduan_temp=`objExists $jiajianjiedian_C`;
   if($panduan_temp==1){delete $jiajianjiedian_C;}
   shadingNode -asUtility plusMinusAverage -n $jiajianjiedian_C;//创建加减节点
   
   
      

   
     addAttr -ln "zhaodao_trs"  -at bool  -dv 0  $jiajianjiedian_A;
     addAttr -ln "zhaodao_rot"  -at bool  -dv 0 $jiajianjiedian_B;
     addAttr -ln "zhaodao_scl"  -at bool  -dv 0  $jiajianjiedian_C;
    
     connectAttr -force ($cu_con+".zhaodao_trs") ($jiajianjiedian_A+".zhaodao_trs")  ;
     connectAttr -force ($cu_con+".zhaodao_rot") ($jiajianjiedian_B+".zhaodao_rot")  ;
     connectAttr -force ($cu_con+".zhaodao_scl") ($jiajianjiedian_C+".zhaodao_scl")  ;
   
   select -r $cu_con $cu_con_Grp_A  $cu_con_Grp_B  $cu_con_Grp_C $cu_con_Grp_D $cu_con_Grp_E  $cu_con_Grp_F $cu_con_Grp_G;
   string $bianliang_tempA[]=`ls -sl`;//
   
   for($i=0;$i<size($bianliang_tempA);$i++) 
   {
   string$temp_=$bianliang_tempA[$i];
   connectAttr -force ($temp_+".t")  ($jiajianjiedian_A+".input3D["+$i+"]");
   connectAttr -force ($temp_+".r")  ($jiajianjiedian_B+".input3D["+$i+"]");
   
   if($i==0)
     {
         connectAttr -force ($temp_+".s")  ($jiajianjiedian_C+".input3D["+$i+"]");  
   
      }else
      {
         int $panduan_temp=`objExists ($temp_+"_temp")`;
        if($panduan_temp==1){delete ($temp_+"_temp");}
        shadingNode -asUtility plusMinusAverage -n ($temp_+"_temp");//创建加减节点
        connectAttr -force ($temp_+".s")  ($temp_+"_temp.input3D[0]");  
        setAttr -type float3 ($temp_+"_temp.input3D[1]") 1 1 1;
        setAttr ($temp_+"_temp.operation") 2;
        connectAttr -force ($temp_+"_temp.output3D") ($jiajianjiedian_C+".input3D["+$i+"]");
      }

   }
   
   connectAttr -force  ($jiajianjiedian_C+".output3D") ($cu_loc_temp+".s");
   connectAttr -force  ($jiajianjiedian_B+".output3D") ($cu_loc_temp+".r");
   connectAttr -force  ($jiajianjiedian_A+".output3D") ($cu_loc_temp+".t");
   
   
   ///////////////////////曲线跟随脸/////////////////////////////////
   if($maonang==0)///////////////////////如果是曲线制控制器的组/////////////////////////////
     {
      string $qvxian_wangge=($cu+"curveFromMeshEdge_pos"+$y); 


      string $wangge_zuijingdian=($cu+"closestPointOnMesh"+$y);
      string $qvxian_A=($cu+"_qvxian_"+$y);
   
      string $mash_zi[]=`listRelatives -s $mensh `; 
      string $mash_shape=$mash_zi[0];
   
      int $panduan_temp=`objExists $qvxian_wangge`;
      if($panduan_temp==1){delete $qvxian_wangge;}
      createNode "curveFromMeshEdge" -n $qvxian_wangge;
   
      connectAttr -force ($mash_shape+".worldMesh[0]") ($qvxian_wangge+".inputMesh");
      curve -d 1 -p 0 0 0 -p 1 0 0 -k 0 -k 1 -n($qvxian_A);//创建曲线
      parent $qvxian_A $qvxian_grp;
     
      string $qvxian_shape[]=`listRelatives -s $qvxian_A `; 
      string $qvxian_A_shape=$qvxian_shape[0];
      connectAttr ($qvxian_wangge+".outputCurve") ($qvxian_A+".create");//网格连接到曲线



      int $panduan_temp=`objExists $wangge_zuijingdian`;
      if($panduan_temp==1){delete $wangge_zuijingdian;}

      createNode "closestPointOnMesh" -n $wangge_zuijingdian;//创建模型最近点节点
      connectAttr -force ($mash_shape+".worldMesh[0]") ($wangge_zuijingdian+".inMesh");
  
     float $temp_pos_BB[]=`xform -q -ws -t $cu_con_Grp`;
     setAttr -type float3 ($wangge_zuijingdian+".inPosition") $temp_pos_BB[0] $temp_pos_BB[1] $temp_pos_BB[2];
     int $inddex=`getAttr ($wangge_zuijingdian+".closestVertexIndex")`;
     string $dian_neme=($mensh+".vtx["+$inddex+"]");
     select -r  $dian_neme;
     ConvertSelectionToEdges;
     string $bianliang_B[]=`ls -sl -fl`;//
     string $temp_xian_a[];
     int $temp_shuzi=`tokenize  $bianliang_B[0]  "[" $temp_xian_a`;
     $temp_shuzi=`tokenize  $temp_xian_a[1]  "]" $temp_xian_a`;
     int $edge=$temp_xian_a[0];//提取到模型的边索引
     //setAttr ($qvxian_wangge+".edgeIndex[0]")  $edge;
 
     //select -r $cu_con;   
     addAttr -ln "edgeindex"  -at long  -dv $edge -k 1  $cu_con;//边索引报存到变量
     addAttr -ln "parameter"  -at double  -dv 0.5 -k 1  $cu_con;
     setAttr -keyable false -channelBox true ($cu_con+".edgeindex");
     setAttr -keyable false -channelBox true ($cu_con+".parameter");
     connectAttr -force ($cu_con+".edgeindex")  ($qvxian_wangge+".edgeIndex[0]") ;//曲线跟随网格
     
     //print  $dian_neme;
   //print  $temp_xian_a[0];
   
    int $panduan_temp=`objExists ($cu_con+"_pointOnCurveInfo_grppos")`;
    if($panduan_temp==1){delete ($cu_con+"_pointOnCurveInfo_grppos");}
    createNode "pointOnCurveInfo" -n ($cu_con+"_pointOnCurveInfo_grppos");//创建曲线最近点节点
    connectAttr -force ( $qvxian_A_shape+".worldSpace[0]") ($cu_con+"_pointOnCurveInfo_grppos.inputCurve");
    connectAttr -f  ($cu_con+"_pointOnCurveInfo_grppos.position") ($cu_con_Grp+".translate");//控制控制器的最上层的组
    
    setAttr ($cu_con+"_pointOnCurveInfo_grppos.turnOnPercentage") 1;
    connectAttr -force ($cu_con+".parameter")  ($cu_con+"_pointOnCurveInfo_grppos.parameter");//控制器的属性控制器曲线的parameter
      delete $wangge_zuijingdian;
  }
  else///////////////////////如果是毛囊控制控制器的组/////////////////////////////
      {//////////////////////创建毛囊连接到模型/////////////////////////
          string$maonang_name=($cu+$y+"_maonangShape");
         createNode "follicle" -n $maonang_name;//创建毛囊
         select -r $maonang_name;
         connectAttr -f ($mash_shape_A+".outMesh") ($maonang_name+".inputMesh");
         connectAttr -f ($mash_shape_A+".worldMatrix[0]") ($maonang_name+".inputWorldMatrix");
         string $mangnang_T[]=`listRelatives -p $maonang_name`; 
         string$mangnang_weiyi=$mangnang_T[0];
         connectAttr -f ($maonang_name+".outTranslate") ($mangnang_weiyi+".translate");
         connectAttr -f ($maonang_name+".outRotate") ($mangnang_weiyi+".rotate");
       
       /////////////////////////////////////
        string $wangge_zuijingdian=($cu+"closestPointOnMesh"+$y);
        int $panduan_temp=`objExists $wangge_zuijingdian`;
        if($panduan_temp==1){delete $wangge_zuijingdian;}

        createNode "closestPointOnMesh" -n $wangge_zuijingdian;//创建模型最近点节点
        connectAttr -force ($mash_shape_A+".worldMesh[0]") ($wangge_zuijingdian+".inMesh");
        
         
        spaceLocator -p 0 0 0 -n ($maonang_name+"_temp_loc");
        group -n ($maonang_name+"_temp_loc_A");
        delete`pointConstraint  $cu_con_Grp ($maonang_name+"_temp_loc_A")`;
        delete`normalConstraint $mensh ($maonang_name+"_temp_loc_A")`;
        delete`geometryConstraint $mensh ($maonang_name+"_temp_loc_A")`;
        setAttr ($maonang_name+"_temp_loc.translateX") 0.01;

        float$pos_temp_weizhi[]=`xform -ws -q -t  ($maonang_name+"_temp_loc")`;
        setAttr -type float3 ($wangge_zuijingdian+".inPosition") $pos_temp_weizhi[0] $pos_temp_weizhi[1] $pos_temp_weizhi[2];
        float$U=`getAttr ($wangge_zuijingdian+".parameterU")`;
        float$V=`getAttr ($wangge_zuijingdian+".parameterV")`;
        delete ($maonang_name+"_temp_loc_A");
        setAttr($maonang_name+".parameterV") $V;
        setAttr($maonang_name+".parameterU") $U;//给毛囊的uv赋值
        
        
        string$maonangzu=($mensh+"_maonang_grp");
        $ex=`objExists $maonangzu`;
        if($ex==0)
          {
              group -empty -n $maonangzu ;
              setAttr ($maonangzu+".visibility") 0;
              setAttr -lock true ($maonangzu+".v");
          }//创建组
       
        parent $mangnang_weiyi $maonangzu;
        connectAttr -f  ($mangnang_weiyi+".t")  ($cu_con_Grp+".translate") ;//控制控制器的最上层的组
          delete $wangge_zuijingdian;
       }


   int $panduan_temp=`objExists ($cu+"_temp_fanxiangA")`;
   if($panduan_temp==1){delete ($cu+"_temp_fanxiangA");}
    shadingNode -asUtility plusMinusAverage -n ($cu+"_temp_fanxiangA");//创建加减节点
    int $panduan_temp=`objExists ($cu+"_temp_fanxiangmultiplyDivideA")`;
    if($panduan_temp==1){delete ($cu+"_temp_fanxiangmultiplyDivideA");}
    shadingNode -asUtility multiplyDivide -n ($cu+"_temp_fanxiangmultiplyDivideA");//创建乘除节点
    setAttr -type float3($cu+"_temp_fanxiangmultiplyDivideA.input2") -1 -1 -1;
    connectAttr -force ($cu+"_temp_fanxiangA.output3D") ($cu+"_temp_fanxiangmultiplyDivideA.input1");
    connectAttr -force  ($cu+"_temp_fanxiangmultiplyDivideA.output") ($cu_con_Grp_REV+".t");

   for($i=0;$i<size($bianliang_tempA);$i++) 
   {
     connectAttr -force   ($bianliang_tempA[$i]+".t") ($cu+"_temp_fanxiangA.input3D["+$i+"]");
    }

   //string $cu_t[]=`listRelatives -p  $cu`; 
   $ex=`objExists ("head_follow_loc_Group")`;//查询这个物体是否纯在
   if($ex==1){parent $cu_loc_grp_A ("head_follow_loc_Group");}
   //parent $cu  $cu_loc_temp;
   pointConstraint  $cu_loc_temp $cu ;
   scaleConstraint -mo  $cu_loc_temp $cu ;
   if($ex_A==1){ orientConstraint -mo  $cu_loc_temp $cu ;}


 }
 
 setAttr -type "string" ($head_qvxian+"."+$shuxing_controller)  $controller_cu_temp_all ;
 setAttr ($mensh+".v") $vis ;
}



 

global proc zxb_chuangjianqiuxingkongzhiqi(string  $cu_con,float $con_size)
{

 ///////////////////////////////创建控制器//////////////////////////////////
   circle -c 0 0 0 -nr 0 1 0 -sw 360 -r $con_size -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n$cu_con ; 
    string $qvxian_shape[]=`listRelatives -s  ($cu_con )`; 
    setAttr ($qvxian_shape[0]+".overrideEnabled") 1;
    setAttr ($qvxian_shape[0]+".overrideColor")22;
   duplicate -rr -n ($cu_con+"temp");
   duplicate -rr -n ($cu_con+"temp_A");
   select -r($cu_con+"temp_A");
   rotate -r -os -fo 0 0 90 ;
   FreezeTransformations;
    select -r($cu_con+"temp");
   rotate -r -os -fo 90 0 90 ;
   FreezeTransformations;
   string $qvxian_shape[]=`listRelatives -s  ($cu_con+"temp")`; 
   setAttr ($qvxian_shape[0]+".overrideEnabled") 1;
   setAttr ($qvxian_shape[0]+".overrideColor")22;
   select -r $qvxian_shape[0];
   select -add $cu_con;
   parent -r -s ;
   delete ($cu_con+"temp");
   string $qvxian_shape[]=`listRelatives -s  ($cu_con+"temp_A")`; 
   setAttr ($qvxian_shape[0]+".overrideEnabled") 1;
   setAttr ($qvxian_shape[0]+".overrideColor")22;
   select -r $qvxian_shape[0];
   select -add $cu_con;
   parent -r -s ;
   delete ($cu_con+"temp_A");
   select -r $cu_con;
   
   }
   
   
   
global proc zxb_secondary_controller()
{
  string $head_controller=`textFieldGrp -q -tx UI_head_controller `;
  string$bn_ss=`getAttr ($head_controller+".lip_Cluster")`;
  string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
  string $head_joinr=`textFieldGrp -q -tx UI_head_bn `;
  zxb_child_object_proc($head_mode,$head_joinr,$bn_ss,0,1,0,0); 
 

}

/////////创建眼眼皮IK控制器

global proc zxb_eye_lip_con_controller()
{
  string $head_controller=`textFieldGrp -q -tx UI_head_controller `;
  string$bn_ss=`getAttr ($head_controller+".eye_lip_ik")`;
  string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
  string $head_joinr=`textFieldGrp -q -tx UI_head_bn `;
  zxb_child_object_proc($head_mode,$head_joinr,$bn_ss,0,1,0,0); 
string$cu_A_ss[]=stringToStringArray($bn_ss, " ");//

  for ($i=0;$i<size($cu_A_ss);$i++)
      {
      string$con_temp=$cu_A_ss[$i];
      string$con_temp_a=$cu_A_ss[$i]+"_con";
      string $shepe[]=`listRelatives -s $con_temp_a`; 
      for ($ii=0;$ii<size($shepe);$ii++)
           {
            string$shepe_temp=$shepe[$ii];
            setAttr ($shepe_temp+".overrideEnabled") 1;
            setAttr($shepe_temp+".overrideColor") 12;
            select -r  ($shepe_temp+".cv[0:9999999999999999]") ;
            scale -r    2 2 2  ;
           }
      }

}





/////////////////////////////////面部簇创建簇//////////////////////////////////////////////
global proc zxb_face_to_Cluster_proc(){
string$mianban_UI[]={"UI_nose","UI_noseguard","UI_basis_nasi","UI_nose_R","UI_cheek","UI_cheekbone_R","UI_jwa_point"};
string$mianban_UI_name[]={"noseCluster","noseguardCluster","basisCluster","nose_rl_Cluster","cheekCluster","cheekboneCluster","jwaCluster"};
string$dian="";
int$fan=`checkBox -q -v duicheng`;
for($i=0;$i<size($mianban_UI);$i++)
{
    string$ui_string=$mianban_UI[$i];
    string $xiaba_temp=`textFieldGrp -q -tx  $ui_string `;
    $dian+=$xiaba_temp+" ";
 }
//string $xiaba_bn=`textFieldGrp -q -tx  zxb_ganjie `;
string$bns[]= stringToStringArray($dian, " ");//关节
string $dingdian_s[]=$bns;//选中顶点创建簇
int$jingxiang=$fan;
float$threshoud=0.01;
string$cu_mode_s[];
clear$cu_mode_s;
int $nemt=`tokenize $dingdian_s[0] "." $cu_mode_s`;//分离字符串存到变量
string$cu_mode=$cu_mode_s[0];
string$zu_root=("face_cu_grp");
string$shep_zi[]=`listRelatives -s $cu_mode`;
string$shep=$shep_zi[0];
int$ex_panduan=`objExists $zu_root`;
if($ex_panduan==0){group -empty -n $zu_root; }

int$ex=`objExists ("head_all_Cluster_Group")`;
if($ex==1){parent ("face_cu_grp") ("head_all_Cluster_Group");}
string$closestPointOnMesh=$cu_mode+"_closestPointOnMesh_temp";
int$panduan=`objExists$closestPointOnMesh`;
if($panduan==1){delete $closestPointOnMesh;} 
createNode "closestPointOnMesh" -n $closestPointOnMesh; //模型信息节点	
connectAttr -force ($shep+".worldMesh[0]") ($closestPointOnMesh+".inMesh");
int$fanxiang=$fan;
string$mingzi="";
for ($i=0;$i<size($dingdian_s);$i++)
    {
        string$dingdian=$dingdian_s[$i];
        string$name_temp=$mianban_UI_name[$i];
        string$sikn_cu=($cu_mode+"_cluster_Handle"+$i);
        select -r  $dingdian;
        newCluster " -envelope 1  " ;
         string$temp_s[]=`ls -sl`;//选中顶点创建簇
        rename $temp_s[0] $name_temp;
         parent $name_temp $zu_root;
        /*string $loc=($temp_s[0]+"_temp_loc");
        spaceLocator -p 0 0 0 -n $loc ;
        delete`pointConstraint $temp_s[0] $loc`;*/
        $mingzi+=$name_temp+" ";
        if($jingxiang==1)
           {
             float$pos_temp[]=`xform -q -ws -t $dingdian`;
             if($pos_temp[0]>$threshoud||$pos_temp[0]<($threshoud*-1))
                {
                    setAttr -type float3 ($closestPointOnMesh+".inPosition") ($pos_temp[0]*-1) $pos_temp[1] $pos_temp[2];
                    int$index=`getAttr ($closestPointOnMesh+".closestVertexIndex")`;
                     select -r ($cu_mode+".vtx["+$index+"]");
                     newCluster " -envelope 1 " ;
                        string$temp_s_a[]=`ls -sl`;//选中顶点创建簇
                        rename $temp_s_a[0] ($name_temp+"sid");
                         $mingzi+= ($name_temp+"sid")+" ";
                        parent  ($name_temp+"sid") $zu_root;
                        
                     
                 }
            }
       
    }
    
  

delete $closestPointOnMesh;
select -r $zu_root;
string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;
zxb_ADD_shuxing_string_proc($head_qvxian,"face_Cluster_name");
setAttr -type "string"($head_qvxian+".face_Cluster_name") $mingzi;
/////////////////////////////////////创建面部控制器///////////////////////////
 string $head_controller=`textFieldGrp -q -tx UI_head_controller `;
  string$bn_ss=`getAttr ($head_controller+".face_Cluster_name")`;
  string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
  string $head_joinr=`textFieldGrp -q -tx UI_head_bn `;
  zxb_child_object_proc($head_mode,$head_joinr,$bn_ss,0,1,0,0); 
  
button -e -en 0 headhunhebianxing_add_button;

}


///////////////////////////////////////创建瞳孔控制器/////////////////////////////////////////////////////
global proc zxb_pupil_bs_mode_extract_proc()
{
    
string $dian_aa=`textFieldGrp -q -tx UI_pupil_middle `;
string $dian_bb=`textFieldGrp -q -tx UI_pupil_up `;
string$temp_string=$dian_aa+" "+$dian_bb;
string $ves[]= stringToStringArray($temp_string, " ");//字符串转化数组
//string $ves[]=`ls -sl -fl`;//顶点  中间  上面
string$temp[];
 clear$temp;
int$shuliang=`tokenize $ves[0] "." $temp`;
string$mode=$temp[0];
float$pos_teme[]=`xform -q -ws -t $ves[0]`;
float$pos_teme_a[]=`xform -q -ws -t $ves[1]`;
if($pos_teme[1]>$pos_teme_a[1])
  {
   $pos_teme=`xform -q -ws -t$ves[1]`;
   $pos_teme_a= `xform -q -ws -t $ves[0]`;
  }
string$loc_A=($mode+"_loca");
string$loc_B=($mode+"_locb");
spaceLocator -p 0 0 0 -n $loc_A;
spaceLocator -p 0 0 0 -n $loc_B;
setAttr -type float3($loc_A+".translate") $pos_teme[0] $pos_teme[1] $pos_teme[2];
setAttr -type float3($loc_B+".translate") $pos_teme_a[0] $pos_teme_a[1] $pos_teme_a[2];

//创建眼球模型跟曲面
string$qiu=($mode+"_qiu");
string$qiunurb=($mode+"_nurb");
polySphere -r 1 -sx 20 -sy 20 -ax 0 0 1 -cuv 2 -ch 1 -n ($mode+"_qiu");
sphere -p 0 0 0 -ax 0 1 0 -ssw 0 -esw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 8 -nsp 4 -ch 0 -n $qiunurb;
string$qvmian_shapes[]=`listRelatives -s $qiunurb`;
string$qvmian_shape=$qvmian_shapes[0];
select -cl  ;
select -r $mode;
newCluster " -envelope 1";
string$cua[]=`ls -sl`;
delete` pointConstraint $cua[0]  ($mode+"_qiu")`;
select -r $loc_A;
select -add $qiu;
aimConstraint -offset 0 0 0 -weight 1 -aimVector 0 0 1 -upVector 0 1 0 -worldUpType "object" -worldUpObject $loc_B;
delete $loc_B $loc_A $cua[0] ;

//创建的模型尽量靠近原始模型
float$boxs[]=`getAttr ($mode+".boundingBoxSize")`;
float$beishu=0.5;
setAttr ($qiu+".s") ($boxs[0]*$beishu) ($boxs[1]*$beishu) ($boxs[2]*$beishu);
delete` pointConstraint $qiu $qiunurb`;
delete` scaleConstraint $qiu $qiunurb`;
string$modejiedian=($mode+"yanqiu_closestPointOnMesh");
string$shaps[]=`listRelatives -s $mode`;
string$shap=$shaps[0];
int$ex=`objExists $modejiedian`;
if($ex==1){delete $modejiedian; }
createNode "closestPointOnMesh" -n $modejiedian; //多边型最近点节点
select -r ($qiu+".vtx[0:999999999]");
connectAttr -force ($shap+".worldMesh[0]")  ($modejiedian+".inMesh");
string $qiu_ves[]=`ls -sl -fl`;//顶点
for($i=0;$i<size($qiu_ves);$i++)
   {
       string$dian=$qiu_ves[$i];
       float$pos_temps[]=`xform -q -ws -t  $dian`;
       setAttr -type float3 ($modejiedian+".inPosition") $pos_temps[0] $pos_temps[1] $pos_temps[2] ;
       float $xingpos[]=`getAttr ($modejiedian+".position")`;
       xform -ws -t $xingpos[0] $xingpos[1] $xingpos[2] $dian;
       
   }




textFieldGrp -e -tx  $qiu UI_eye_create_mesh;
textFieldGrp -e -tx $qiunurb UI_eye_create_Surfaces;
textFieldGrp -e -tx $mode  UI_eye_mode_mesh;

}


//////////////////////////////////////////瞳孔绑定//////////////////////////////////////////////////////////////
global proc zxb_tongkongsuofang_shengcbangd_proc()
{
string$qiu=`textFieldGrp -q -tx  UI_eye_create_mesh`;//生成模型
string$yushess=`textFieldGrp -q -tx  UI_eye_name_preinstall_BS`;//混合变形预设
string$qiunurb=`textFieldGrp -q -tx UI_eye_create_Surfaces`;//生成曲面
string$mode=`textFieldGrp -q -tx UI_eye_mode_mesh`;//当前模型
string$eye_mode_A=`textFieldGrp -q -tx   UI_eyr_mode_L`;
string$eye_mode_B=`textFieldGrp -q -tx   UI_eyr_mode_R`;
int$weiyi= `checkBox -q -value duicheng `;
string $grp=($mode+"_yanqiu_grp");
string$qiu_R=($qiu+"_R");
string$qiunurb_R=($qiunurb+"_R");
string$grp_a=($grp+"_R");
string$kongzhiqi_nn="";
string$kongzhiqi_qq="";
int$left=$weiyi;
string$all_modess[];
clear $all_modess;
$all_modess[0]=$eye_mode_A;
$all_modess[1]=$eye_mode_B;
for($m=0;$m<size($all_modess);$m++)
   {
    string$ming_temp=$all_modess[$m];
    string$MOde[]= stringToStringArray($ming_temp, " ");//模型名字
    string$yushes[]= stringToStringArray($yushess, " ");//混合变形预设
    int$ex=`objExists $MOde[0]`;
    if($ex>0)
      {
      int$ex=`objExists $grp`;
      if($ex==0)
        {
         select -r $qiu;
         select -add $qiunurb;
         doGroup 0 1 1 ;
         rename $grp;
         //复制右眼模型曲面
         select -r $grp;
         duplicate -rr -n $grp_a;
         string$zieutis[]=`listRelatives -c -fullPath  $grp_a`; 
         rename $zieutis[0] $qiu_R;
         rename $zieutis[1] $qiunurb_R;
         setAttr ($grp_a+".scaleX") -1;
         
         setAttr ($grp_a+".visibility") 0;
         setAttr -lock true ($grp_a+".v");
          setAttr ($grp+".visibility") 0;
         setAttr -lock true ($grp+".v");
        } 
    }
    
    int$ex=`objExists $MOde[0]`;
    if($ex>0)
    {

    string$qvmian_shapes_R[]=`listRelatives -s $qiunurb_R`;
    string$qvmian_shape_R=$qvmian_shapes_R[0];
    string$qvmian_shapes[]=`listRelatives -s $qiunurb`;
    string$qvmian_shape=$qvmian_shapes[0];
    string$qvmian_xingjiedian="";
    string$qiu_aaa="";
    string$R_L="L";
    if($m==1)
      {
      $R_L="R";
      $qvmian_xingjiedian=$qvmian_shape_R;
      $qiu_aaa=$qiu_R;
      select -r $qiu_R;
      }
    else
        {
        $R_L="L";
        $qvmian_xingjiedian=$qvmian_shape;
        $qiu_aaa=$qiu;
        select -r $qiu;
        }
   string$qiu_A=($qiu+"_qvxian_meish"+$R_L);
   string$qvxian=($qiu_A+"_tongkongC_"+$R_L);
   
   duplicate -rr -n $qiu_A ; 
   doMenuComponentSelectionExt($qiu_A, "edge", 1);
   select -add   ($qiu_A+".e[0:19]") ($qiu_A+".e[20:39]") ($qiu_A+".e[40:59]") ($qiu_A+".e[60:79]") ($qiu_A+".e[80:99]") ($qiu_A+".e[100:119]")  ($qiu_A+".e [120:139]") ($qiu_A+".e[140:159]") ($qiu_A+".e[360:379]")($qiu_A+".e[160:179]");
   ConvertSelectionToFaces;
   delete;
   select -add   ($qiu_A+".e[160:179]") ;
   polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $qvxian;
   
   DeleteHistory;
   CenterPivot;
   string$qvxiang_grp=($qvxian+"_grp");
   group -n $qvxiang_grp;
   
   //创建曲线2
   string$qvxian_A_bngrp=($qiu_A+"_qvxian_grp"+$R_L);
   int$ex=`objExists $qvxian_A_bngrp`;
   if($ex==0){ group -empty -n $qvxian_A_bngrp ; }
   polySelect -er 322 $qiu_A;
   string $qiu_A_xian[]=`ls -sl -fl`;//线段
   string$eyeqvxian_s[];
   clear$eyeqvxian_s;
   for($i=0;$i<size($qiu_A_xian);$i++)
      {string$string_temp[];
       string$qvxian_B=($qiu_A+"_huanxing"+$i);
       clear $string_temp;
       string$bian=$qiu_A_xian[$i];
       int$temp_A=`tokenize  $bian "[" $string_temp`;
       $temp_A=`tokenize  $string_temp[1] "]" $string_temp`;
       int$index=$string_temp[0];
       polySelect -edgeLoop $index $qiu_A;
       polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $qvxian_B;
       DeleteHistory;
       parent $qvxian_B $qvxian_A_bngrp;
       $eyeqvxian_s[$i]=$qvxian_B; 
     }
    
    
   //判断曲线正反
   for($i=0;$i<size($eyeqvxian_s);$i++)
      {
      string$qvxian_cv=$eyeqvxian_s[$i];
      select -r ($qvxian_cv+".cv[0:9999999]");
      string $temp_cv[]=`ls -sl -fl`;//顶点
      float$pos_cv_a[]=`xform -q -ws -t $temp_cv[0]`;
      int$qq=(size($temp_cv)-1);
      float$pos_cv_b[]=`xform -q -ws -t ($temp_cv[$qq])`;
      if($pos_cv_a[2]<$pos_cv_b[2])
        {
         reverseCurve -ch 0 -rpo 1 $qvxian_cv;
        }
      }
   
   
   
   //创建关节
   string$qiu_A_bngrp=($qiu_A+"_tongkong_bn_grp"+$R_L);
   int$ex=`objExists $qiu_A_bngrp`;
   if($ex==0){ group -empty -n $qiu_A_bngrp; }
   for($i=0;$i<size($eyeqvxian_s);$i++)
      {
      string$qvxian_cv=$eyeqvxian_s[$i];
      select -r ($qvxian_cv+".cv[0:9999999]");
      string $temp_cv[]=`ls -sl -fl`;//顶点
      int$size=size($temp_cv);
      int$ex=`objExists($qvxian_cv+".zhaodaoBN")`; 
      if($ex==1){deleteAttr ($qvxian_cv+".zhaodaoBN");}
      addAttr -ln "zhaodaoBN"  -dt "string"  $qvxian_cv;
      //setAttr -type "string" ($qvxian_cv+".zhaodaoBN") "";
      for($ii=0;$ii<$size;$ii++)
         { 
          string$bnmane=($qiu_A+"_tongkong_BN_"+$i+$R_L+$ii);
          string$cv=$temp_cv[$ii];
          float$cvpos_temp[]=`xform -q -ws -t  $cv`;
          select -cl  ;
          joint -p $cvpos_temp[0] $cvpos_temp[1] $cvpos_temp[2]-n $bnmane;
          setAttr ($bnmane+".radius") 0.1;
          parent $bnmane $qiu_A_bngrp;
          int$ex=`objExists ($bnmane+".zhaodaoBN")`; 
          if($ex==0){addAttr -ln "zhaodaoBN"  -at bool  $bnmane;}
          string$getbnname=`getAttr($qvxian_cv+".zhaodaoBN")`;
          string$xingming=($getbnname+$bnmane+" ");
          setAttr -type "string" ($qvxian_cv+".zhaodaoBN") $xingming;
         }   
      }
      ////关节跟随曲面并衰减控制
   string$qiu_A_loc_rp=($qiu_A+"_tongkong_loc_grp"+$R_L);
   int$ex=`objExists $qiu_A_loc_rp`;
   if($ex==0){ group -empty -n $qiu_A_loc_rp ; }
   string$qiu_shaps[]=`listRelatives -s   $qiu_aaa`;
   string$qiu_shap=$qiu_shaps[0];
   string$kloc[];
   clear$kloc;
   string$kbn[];
   clear$kbn;
   for($i=0;$i<size($eyeqvxian_s);$i++)
      {
      string$qvxian_B=$eyeqvxian_s[$i];
      string$strings=`getAttr ($qvxian_B+".zhaodaoBN")`;
      string$bns[]=stringToStringArray($strings, " ");
      string$qvxianshaps[]=`listRelatives -s $qvxian_B`;
      string $qvxianshap=$qvxianshaps[0];
      string $qvxianxixi=($qvxian_B+"_eye_yanqiu_curveInfo");
      int$ex=`objExists  $qvxianxixi`;
      if($ex==1){delete   $qvxianxixi;}
      shadingNode -asUtility curveInfo -n  $qvxianxixi; //曲线信息
      connectAttr -force ($qvxianshap+".worldSpace[0]") ($qvxianxixi+".inputCurve");
      float$dis=`getAttr ($qvxianxixi+".arcLength")`;
      float$cdiss=0;
      for($j=0;$j<size($bns);$j++)
         {
         string$bn=$bns[$j];
         string$bn_loc=($bn+"loc"+$j);
         string$bn_loc_grpa=($bn+"loc_A"+$j);
         spaceLocator -p 0 0 0 -n $bn_loc;
         group -n $bn_loc_grpa;
         parent $bn_loc_grpa $qiu_A_loc_rp;
         delete ` pointConstraint  $bn $bn_loc_grpa`;
         string $qvmianjiedian=($bn+"_eye_yanqiu_closestPointOnSurface");
         int$ex=`objExists $qvmianjiedian`;
         if($ex==1){delete  $qvmianjiedian;}
         createNode "closestPointOnSurface" -n $qvmianjiedian ;//曲面信息节点	
         string$locshaps[]=`listRelatives -s $bn_loc`;
         string$locshap=$locshaps[0];
         connectAttr -force ($qvmian_xingjiedian+".worldSpace[0]") ($qvmianjiedian+".inputSurface");
         connectAttr -force ($locshap+".worldPosition[0]") ($qvmianjiedian+".inPosition");
         connectAttr -force  ($qvmianjiedian+".position") ($bn+".t") ;//定位器控制骨骼
         if($j==0)
           {
           $kloc[$i]=$bn_loc;
           $kbn[$i]=$bn;
            }
         if($j>0)
           {
           int$jj=$j-1;
           string$bbn=$bns[$jj];
           float$weizhi[]=`xform -q -ws -t $bbn`;
           float$weizhi_a[]=`xform -q -ws -t $bn`;
           
           float$ccdis=mag(<<$weizhi[0],$weizhi[1],$weizhi[2]>>-<<$weizhi_a[0],$weizhi_a[1],$weizhi_a[2]>>);
           $cdiss+=$ccdis;
           float$changdu=(1-($cdiss/$dis)); 
           string $chenmgcujiedian_A=($bn_loc+"_eye_yanqiu_multiplyDivide_A");
           int$ex=`objExists $chenmgcujiedian_A`;
           if($ex==1){delete  $chenmgcujiedian_A;}
           shadingNode -asUtility multiplyDivide -n $chenmgcujiedian_A;//创建乘除节点
           connectAttr -force ($bns[0]+"loc"+"0"+".t") ($chenmgcujiedian_A+".input1");
           int$ex=`objExists ($bn+".gensui")`;
           if($ex==0){addAttr -ln "gensui"  -at double  -dv $changdu -k 1 $bn;}
           setAttr -keyable false -channelBox true ($bn+".gensui");
           connectAttr -force ($bn+".gensui") ($chenmgcujiedian_A+".input2X");
           connectAttr -force ($bn+".gensui") ($chenmgcujiedian_A+".input2Y");
           connectAttr -force ($bn+".gensui") ($chenmgcujiedian_A+".input2Z");
           connectAttr -force  ($chenmgcujiedian_A+".output") ($bn_loc+".t");
           } 
         }
       }
   //第一排定位器跟随曲线
   string$qvxian_A=($qvxian+"_A");
   $kongzhiqi_qq+=$qvxian_A+" ";
   select -r $qvxian;
   duplicate -rr -n $qvxian_A;
   parent $qvxian $qvxian_A_bngrp;
   float$boxs_a[]=`getAttr ($qvxian_A+".boundingBoxSize")`;
   select -r  ($qvxian_A+".cv[0:99999999999]");
   move -r 0 0 ($boxs_a[0]*0.5);
   //setAttr ($qvxiang_grp+".tz") ;
   string$qvxianshap_Bs[]=`listRelatives -s $qvxian`;
   string$qvxianshap_B=$qvxianshap_Bs[0];
   for($i=0;$i<size($kloc);$i++)
     {
     string$loc_temp= $kloc[$i];
     string $qvxianjiedian_A=($loc_temp+"_eye_yanqiu_qvxian_nearestPointOnCurve_A");
     string $qvxianjiedian_AA=($loc_temp+"_eye_yanqiu_qvxian_pointOnCurveInfo_A");
     int$ex=`objExists $qvxianjiedian_A`;
     if($ex==1){delete  $qvxianjiedian_A;}
     int$ex=`objExists $qvxianjiedian_AA`;
     if($ex==1){delete  $qvxianjiedian_AA;}
     createNode nearestPointOnCurve -n $qvxianjiedian_A ;
     createNode "pointOnCurveInfo" -n $qvxianjiedian_AA;//创建曲线信息节点
     connectAttr -force ($qvxianshap_B+".worldSpace[0]") ($qvxianjiedian_A+".inputCurve");
     connectAttr -force ($qvxianshap_B+".worldSpace[0]") ($qvxianjiedian_AA+".inputCurve");
     float$weizhi_temp[]=`xform -q -ws -t $loc_temp`;
     setAttr -type float3($qvxianjiedian_A+".inPosition")$weizhi_temp[0] $weizhi_temp[1] $weizhi_temp[2];
     float$canshu=`getAttr ($qvxianjiedian_A+".parameter")`;
     setAttr ($qvxianjiedian_AA+".parameter")$canshu;
     string$loc_A=($loc_temp+"_C");
     spaceLocator -p 0 0 0 -n $loc_A;
     connectAttr -force ($qvxianjiedian_AA+".position") ($loc_A+".t");
     parent $loc_A $qiu_A_loc_rp;
     parentConstraint  $loc_A $loc_temp;
    }
   //创建控制曲线的蒙皮关节  并添加融合节点
   string$qvxianshap_Cs[]=`listRelatives -s $qvxian_A`;
   setAttr ($qvxianshap_Cs[0]+".overrideEnabled") 1;
   setAttr($qvxianshap_Cs[0]+".overrideColor") 15;
   //delete`orientConstraint $qiu_aaa $qvxiang_grp `;
   string$root_bn=($qiu+"_root"+$R_L);
   select -cl  ;
   joint -p 0 0 0 -n $root_bn ;
   delete`pointConstraint $qvxian_A $root_bn`;//点约束 
   parent $root_bn $qvxian_A ;
   string$attrs[]=$yushes;
   select -r  $qvxian;
   string$bs_AA[]=`blendShape`;
   string$bstongkong=("tongkongbs_"+$qvxian);
   rename $bs_AA[0] $bstongkong;
   for($i=0;$i<size($attrs);$i++)
      {
      string$name=($qvxian+$attrs[$i]+"_"+$i);
      string$shuxing=$attrs[$i];
      select -r  $qvxian;
      duplicate -rr -n $name;
      blendShape -e  -t $qvxian $i $name 1 $bstongkong;
      select -r $qvxian_A;
      string$shuaxing_a=($qvxian_A+"."+$shuxing);
      int$ex=`objExists $shuaxing_a`;
      if($ex==0){ addAttr -ln $shuxing  -at double  -min 0 -max 1  -dv 0 -k 1 $qvxian_A;}
      setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd ($qvxian_A+"."+$shuxing)  ($bstongkong+"."+$name);
      setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 1 -cd ($qvxian_A+"."+$shuxing)  ($bstongkong+"."+$name);
     }
   //关节控制曲线    
   if($m==0){select -r $qiunurb;}else{select -r $qiunurb_R;}     
   select -add $root_bn;
   normalConstraint -weight 1 -aimVector 1 0 0 -upVector 0 1 0 -worldUpType "scene";
   select -r $root_bn;
   select -add $qvxian;
   newSkinCluster "-toSelectedBones -mi 1 -omi true -dr 6 -rui 0";  



   //创建眼球中间的关节   
   string$M_pos_cv= ($qiu_aaa+".vtx[381]") ;
   float$M_pos_temp[]=`xform -q -ws -t $M_pos_cv`;
   string$m_root_bn=($qiu_aaa+"_M_root"+$R_L);
   select -cl  ;
   joint -p $M_pos_temp[0] $M_pos_temp[1] $M_pos_temp[2] -n $m_root_bn ;
   parent  $m_root_bn $qiu_A_bngrp;
   string$bn=$m_root_bn;
   string$bn_loc=($bn+"loc_root");
   string$bn_loc_B=($bn+"loc_root_b");
   string$bn_loc_grpa=($bn+"loc_A_root");
   string$bn_loc_grpb=($bn+"loc_B_root");
   spaceLocator -p 0 0 0 -n $bn_loc;
   group -n $bn_loc_grpa;
   parent $bn_loc_grpa $qiu_A_loc_rp;
   delete ` pointConstraint  $bn $bn_loc_grpa`;          
   spaceLocator -p 0 0 0 -n $bn_loc_B;
   group -n $bn_loc_grpb;
   parent $bn_loc_grpb $qiu_A_bngrp;          
   //中间关机在曲面上滑动             
   string $qvmianjiedian=($bn+"_eye_yanqiu_closestPointOnSurface_root");
   int$ex=`objExists $qvmianjiedian`;
   if($ex==1){delete  $qvmianjiedian;}
   createNode "closestPointOnSurface" -n $qvmianjiedian ;//曲面信息节点	
   string$locshaps[]=`listRelatives -s $bn_loc`;
   string$locshap=$locshaps[0];
   string$locshapBs[]=`listRelatives -s $bn_loc_B`;
   string$locshapB=$locshapBs[0];
   connectAttr -force ($qvmian_xingjiedian+".worldSpace[0]") ($qvmianjiedian+".inputSurface");
   connectAttr -force ($locshap+".worldPosition[0]") ($qvmianjiedian+".inPosition");
   connectAttr -force  ($qvmianjiedian+".position") ($bn_loc_B+".t") ;//定位器控制骨骼    
   pointConstraint -mo $qvxian_A $bn_loc;
   scaleConstraint  -mo $qvxian_A $bn_loc_B;
   setAttr ($locshapB+".v") 0;
   setAttr ($locshap+".v") 0;
   setAttr -l 1($locshapB+".v") 0;
   setAttr -l 1 ($locshap+".v") 0;
   //法线约束关节   中间关节是发现约束的定位器            
   string$all_bn[]=`listRelatives -c -ad -type "joint" $qiu_A_bngrp`;     
   select -r $all_bn;
   select -d $m_root_bn;//排除中间关节
   select -add $bn_loc_B;
   string$faxianyuseu_bn[]=`ls -sl `;
   for($i=0;$i<size($faxianyuseu_bn);$i++)
      {
      if($m==0){select -r $qiunurb;}else{select -r $qiunurb_R;}
      select -add $faxianyuseu_bn[$i];
      normalConstraint -weight 1 -aimVector 1 0 0 -upVector 0 1 0 -worldUpType "scene";//法线约束
      }
   parent $bn $bn_loc_B;//中间关节跟随定位器
   //给球的模型蒙皮
   select -r $all_bn;
   select -add $qiu_aaa;            
   newSkinCluster "-toSelectedBones -mi 1 -omi 0 -dr 6 -rui 0"; 
   select -r $kbn  ;
   select -add $bn ;
   string$qaun_bn[]=`ls -sl -type "joint"`;
   select -r ($qiu_aaa+".e[360:379]") ;
   ConvertSelectionToVertices;
   string$qiu_cvs[]=`ls -sl -fl`;
   int$pinghua=2;
   string $skinCluster2=`findRelatedSkinCluster $qiu_aaa` ;//访问蒙皮节点
   float$quznhzong=`skinPercent -tv  $bn 0.75 $skinCluster2  $qiu_cvs`;


   //给内眼球制作控制器
   string$qvxian_B=($qvxian_A+"B");
   $kongzhiqi_nn+=$qvxian_B+" ";
   select -r $qvxian_A ;
   duplicate -rr -n $qvxian_B;
   string$teme_zi_obj[]=`listRelatives -c -type "joint" -fullPath $qvxian_B`;
   delete $teme_zi_obj;
   select -r ($qvxian_B+".cv[0:9999999]");
   newCluster " -envelope 1";
   string$cus[]=`ls -sl`;
   setAttr -type float3 ($cus[0]+".scale") 0.7 0.7 0.7;
   select -r  $qvxian_B;
   DeleteHistory;
   for($i=0;$i<size($attrs);$i++)
      {
      string$shuxing=$attrs[$i];
      catch (`deleteAttr -attribute $shuxing  $qvxian_B`);
      }
   parent $qvxian_B $qvxian_A;
   scaleConstraint $qvxian_B $bn;//缩放约束
   string$mode_a_grp="";
   if($m==0)
     {
      $mode_a_grp=$grp ;
     }
   else
     {
      $mode_a_grp=$grp_a;
     } 
   select -r $MOde;
   string$temp_eyemode[]=`ls -sl`;
   for($i=0;$i<size($temp_eyemode);$i++)
      {
      string$temp_eye_mode=$temp_eyemode[$i];
      string$eye_mode_AA=($temp_eye_mode+"_A");
      
      select -r $temp_eye_mode;
      duplicate -rr -n $eye_mode_AA;
      parent  $eye_mode_AA $grp;
      select -r $eye_mode_AA ;
      select -add $temp_eye_mode ;
      string$eye_hunhebianxing[]=`blendShape -frontOfChain`;
      rename $eye_hunhebianxing[0] ($temp_eye_mode+"_eye_qiu_bs");
      setAttr ($temp_eye_mode+"_eye_qiu_bs"+"."+$eye_mode_AA) 1;
      select -r $all_bn;
      select -add $eye_mode_AA;
      newSkinCluster "-toSelectedBones -mi 1 -omi 0 -dr 6 -rui 0"; 
      select -r $qiu_aaa;
      select -add $eye_mode_AA;
      copySkinWeights  -noMirror -surfaceAssociation closestPoint -influenceAssociation closestJoint;
     }

   //整理层级
   $root_L_grp=($grp+"root_grp"+$R_L);  
   string$zu_zong=("head_pupil_curve_Group");
   zxb_ADD_kongzu_proc("head_pupil_curve_Group");
  // print $root_L_grp;
  
   select -r  $qvxiang_grp $mode_a_grp  $qvxian_A_bngrp $qiu_A_bngrp $qiu_A_loc_rp;
   group-n  $root_L_grp;
   parent $root_L_grp ("head_pupil_curve_Group") ;
   select -r    $qvxian_A_bngrp $qiu_A_bngrp $qiu_A_loc_rp;
   string$temp_gpr[]=`ls -sl`;
   for($i=0;$i<size($temp_gpr);$i++)
      {
       string$grp_q=$temp_gpr[$i];
       setAttr ($grp_q+".visibility") 0;
       setAttr -lock true ($grp_q+".v");
       }

      

  }
    }
textFieldGrp -e -tx $kongzhiqi_nn kongzhiqi_ab;   
textFieldGrp -e -tx $kongzhiqi_qq kongzhiqi_a;  
// print   ($kongzhiqi_nn+"\n"+$kongzhiqi_qq);
}





////////////////////////////////////////瞳孔转混合变形//////////////////////////////////////////////



global proc zxb_tongkong_BSProc()
{

string$eye_mode_A=`textFieldGrp -q -tx   UI_eyr_mode_L`;//L模型
string$eye_mode_B=`textFieldGrp -q -tx   UI_eyr_mode_R`;//R模型
string$kongzhiqisss=`textFieldGrp -q -tx   kongzhiqi`;////添加属性的控制器
string$shuxingkongzhiqisss=`textFieldGrp -q -tx  kongzhiqi_ab `;//内瞳孔
string$kongzhiqi_ABSS[]= stringToStringArray($shuxingkongzhiqisss, " ");//控制器A

string$shuzhi_A=`textFieldGrp -q -tx  fangda `;//数值
string$shuzhi_B=`textFieldGrp -q -tx  suoxiao `;//数值
string$shuzhi_C=`textFieldGrp -q -tx   suoxiaox `;//数值
string$shuzhi_D=`textFieldGrp -q -tx  fangdax `;//数值
string$shuzhi_E=`textFieldGrp -q -tx  suoxiaoy `;//数值
string$shuzhi_F=`textFieldGrp -q -tx  fangday `;//数值

string$shushu=stringArrayToString({ $shuzhi_A, $shuzhi_B,$shuzhi_C,$shuzhi_D,$shuzhi_E,$shuzhi_F }, ", ");
string$shushuSSS[]= stringToStringArray($shushu, ", ");//

string$kongzhiqi_ASS=`textFieldGrp -q -tx   kongzhiqi_a`;//外瞳孔
string$yueshe_BSAsss=`textFieldGrp -q -tx  yueshe_BS_A`;//
string$kongzhiqi_AS[]= stringToStringArray($kongzhiqi_ASS, " ");//控制器A

string$yueshe_BSsss=`textFieldGrp -q -tx   UI_eye_name_preinstall_BS`;
string$yushes[]= stringToStringArray($yueshe_BSsss, " ");//曲线BS数组
string$yushes_A[]= stringToStringArray($yueshe_BSAsss, " ");//曲线BS数组
int$duicheng= `checkBox -q -value duicheng `;


string$kongzhiqiss[]=stringToStringArray($kongzhiqisss, " ");//添加属性的控制器

string$kongzhiqi_L="";
string$kongzhiqi_R="";
for($i=0;$i<size($kongzhiqiss);$i++) 
{
    string$temp_kongzzhiqi=$kongzhiqiss[$i];
    spaceLocator -p 0 0 0 -n "temp_loc";
    delete `parentConstraint  $temp_kongzzhiqi "temp_loc"`;
    float$temp_pos[]=`xform -q -ws -t "temp_loc"`;
    delete "temp_loc" ;
    if($temp_pos[0]>0.000001){$kongzhiqi_L=$temp_kongzzhiqi;}
    if($temp_pos[0]<-0.000001){$kongzhiqi_R=$temp_kongzzhiqi;}
    if($temp_pos[0]==0){error "控制器在世界坐标零的位置";}
}
string$kongzhi="";
string$kk_kongzhiqi[];
clear$kk_kongzhiqi;
$kk_kongzhiqi[0]=$kongzhiqi_L;
$kk_kongzhiqi[1]=$kongzhiqi_R;
//if($duicheng==0){$kongzhi=$kongzhiqi_L;}else{$kongzhi=$kongzhiqi_R;}



string$kongzhiqi_AL="";
string$kongzhiqi_AR="";
for($i=0;$i<size($kongzhiqi_AS);$i++) //外瞳孔控制器
{
    string$temp_kongzzhiqi=$kongzhiqi_AS[$i];
    spaceLocator -p 0 0 0 -n "temp_loc";
    delete `parentConstraint  $temp_kongzzhiqi "temp_loc"`;
    float$temp_pos[]=`xform -q -ws  -t ("temp_loc")`;
    delete "temp_loc";
    if($temp_pos[0]>0.000001){$kongzhiqi_AL=$temp_kongzzhiqi;}
    if($temp_pos[0]<-0.000001){$kongzhiqi_AR=$temp_kongzzhiqi;}
    if($temp_pos[0]==0){error "控制器在世界坐标零的位置";}
}
string$kongzhiA="";
string$kk_kongzhiA[];
clear$kk_kongzhiA;
$kk_kongzhiA[0]=$kongzhiqi_AL;
$kk_kongzhiA[1]=$kongzhiqi_AR;
//if($duicheng==0){$kongzhiA=$kongzhiqi_AL;}else{$kongzhiA=$kongzhiqi_AR;}



string$kongzhiqi_ABL="";
string$kongzhiqi_ABR="";
for($i=0;$i<size($kongzhiqi_ABSS);$i++) //内瞳孔控制器
{
    string$temp_kongzzhiqi=$kongzhiqi_ABSS[$i];
    spaceLocator -p 0 0 0 -n "temp_loc";
    delete `parentConstraint  $temp_kongzzhiqi "temp_loc"`;
    float$temp_pos[]=`xform -q -wd  -t "temp_loc"`;
    delete "temp_loc";
    if($temp_pos[0]>0.000001){$kongzhiqi_ABL=$temp_kongzzhiqi;}
    if($temp_pos[0]<-0.000001){$kongzhiqi_ABR=$temp_kongzzhiqi;}
    if($temp_pos[0]==0){error "控制器在世界坐标零的位置";}
}
string$kongzhiAB="";
string$kk_kongzhiAABB[];
clear$kk_kongzhiAABB;
$kk_kongzhiAABB[0]=$kongzhiqi_ABL;
$kk_kongzhiAABB[1]=$kongzhiqi_ABR;
//if($duicheng==0){$kongzhiAB=$kongzhiqi_ABL;}else{$kongzhiAB=$kongzhiqi_ABR;}

string$mode_SS[];//模型
clear $mode_SS;
$mode_SS[0]=$eye_mode_A+" ";
$mode_SS[1]=$eye_mode_B+" ";
string$mode_S[];//模型


//if($duicheng==0){$mode_S=$MOdeL;}else{$mode_S=$MOdeR;}

for($xi=0;$xi<size($mode_SS);$xi++) 
{
    string$mesh_temp=$mode_SS[$xi];
    string$Mo_temp_mode[]= stringToStringArray($mesh_temp, " ");//字符串转化数组
    $kongzhiAB=$kk_kongzhiAABB[$xi];
    $kongzhiA=$kk_kongzhiA[$xi];
    $kongzhi=$kk_kongzhiqi[$xi];
    clear $mode_S;
    $mode_S=$Mo_temp_mode;
    int $ex=`objExists $Mo_temp_mode[0]`;
    if($ex==1)
      {

for($i=0;$i<size($yushes);$i++) 
   {
        string$mingzi=$yushes[$i];
        int $ex=`objExists ($kongzhi+"."+$mingzi)`;
        if($ex==0)
           {
               select -r $kongzhi;
          
            addAttr -ln $mingzi  -at double  -min 0 -max 1 -dv 0 -k 1;
           }
   }
   


string$grp_root=$kongzhiA+"_bs_grp_root";
string$zu_zong=("head_pupil_curve_Group");
zxb_ADD_kongzu_proc("head_pupil_curve_Group");

int$ex=`objExists$grp_root`;    ///判断
if($ex==0){ group -em -n $grp_root ;setAttr  ($grp_root+".visibility") 0;setAttr -lock true ($grp_root+".v"); parent $grp_root ("head_pupil_curve_Group");}
for($i=0;$i<size($mode_S);$i++) 
   {
    string$temp_mode=$mode_S[$i];
    string$grp=$temp_mode+"_bs_grp";
    int$ex=`objExists $grp`;    ///判断
    if($ex==0){ group -em -n $grp; };
    parent $grp  $grp_root;
    string$bs="";
    string $mode_shape[]=`listRelatives -s $temp_mode `; 
    string $mode_shap=$mode_shape[0];
    string $temp_shuxing[]=`listConnections -d 0 -s 1 ( $mode_shap+".inMesh")`;//列出链接属性  -d输入   -s输出  -p 列出属性
    string$type=`nodeType $temp_shuxing[0]`;
    if($type=="skinCluster")
      {
      string $temp_shuxing_A[]=`listConnections -d 0 -s 1 ( $temp_shuxing[0]+".input[0].inputGeometry")`;//列出链接属性  -d输入   -s输出  -p 列出属性
      $bs=$temp_shuxing_A[0];
      }
    if($type=="blendShape"){$bs=$temp_shuxing[0];}
    for($j=0;$j<size($yushes);$j++) 
        { 
        string$temp_shuxinga=$yushes[$j];
        string$bs_mode=$temp_mode+$temp_shuxinga;
        setAttr ($kongzhiA+"."+$temp_shuxinga) 1;
        select -r   $temp_mode;
        duplicate -rr -n  $bs_mode;
        parent  $bs_mode $grp;
        setAttr ($kongzhiA+"."+$temp_shuxinga) 0;
        string $listOfShapesInNode[] =`listAttr -k -m $bs`;
        string$bsss[];
        clear$bsss;
        for($jj=0;$jj<size($listOfShapesInNode);$jj++)
            {
            string$mmmm=$listOfShapesInNode[$jj];
            int$ex=`objExists $mmmm`; 
            if($ex==1)
                {  
                int$size=size($bsss);
                $bsss[$size]=$mmmm;
                 } 
            
            }
        int$idex=size($bsss);
        select -r   $bs_mode;
        select -add $temp_mode;
        blendShape -e  -t $temp_mode $idex $bs_mode 1 $bs;
        setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd  ($kongzhi+"."+$temp_shuxinga)  ($bs+"."+$bs_mode);  
        setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 1 -cd   ($kongzhi+"."+$temp_shuxinga)  ($bs+"."+$bs_mode);  
         } 
       for($w=0;$w<size($yushes_A);$w++)
          {
          float$temp_zhi=$shushuSSS[$w];
          string$temp_ming=$yushes_A[$w];
          string$bs_mode=$temp_mode+$temp_ming;
          int $ex=`objExists ($kongzhi+"."+$temp_ming)`;
          if($ex==0)
           {
            select -r $kongzhi;
            addAttr -ln $temp_ming -at double  -min 0 -max 1 -dv 0 -k 1;
           }

          if($w==0){setAttr -type float3 ($kongzhiA+".scale") $temp_zhi $temp_zhi $temp_zhi;}
          if($w==1){setAttr -type float3 ($kongzhiA+".scale") $temp_zhi $temp_zhi $temp_zhi;}
          if($w==2){setAttr ($kongzhiA+".scaleX") $temp_zhi;}
          if($w==3){setAttr ($kongzhiA+".scaleX") $temp_zhi;}
          if($w==4){setAttr ($kongzhiA+".scaleY") $temp_zhi;}
          if($w==5){setAttr ($kongzhiA+".scaleY") $temp_zhi;}
          select -r   $temp_mode;
          duplicate -rr -n  $bs_mode;
          parent  $bs_mode $grp;
          string $listOfShapesInNode[] =`listAttr -k -m $bs`;
          string$bsss[];
          clear$bsss;
          for($jj=0;$jj<size($listOfShapesInNode);$jj++)
            {
             string$mmmm=$listOfShapesInNode[$jj];
             int$ex=`objExists $mmmm`; 
             if($ex==1)
               {   
                int$size=size($bsss);
                $bsss[$size]=$mmmm;
                } 
            
            }
          int$idex=size($bsss);
          select -r   $bs_mode;
          select -add $temp_mode;
          blendShape -e  -t $temp_mode $idex $bs_mode 1 $bs;
          setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd  ($kongzhi+"."+$temp_ming)  ($bs+"."+$bs_mode);  
          setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 1 -cd   ($kongzhi+"."+$temp_ming)  ($bs+"."+$bs_mode); 
          setAttr -type float3 ($kongzhiA+".scale") 1 1 1;     
          }  
       for($w=0;$w<size($yushes_A);$w++)
          {
          float$temp_zhi=$shushuSSS[$w];
          string$temp_ming=$yushes_A[$w]+"_nie";
          string$bs_mode=$temp_mode+$temp_ming;
          int $ex=`objExists ($kongzhi+"."+$temp_ming)`;
          if($ex==0)
           {
               select -r $kongzhi;
           
            addAttr -ln $temp_ming -at double  -min 0 -max 1 -dv 0 -k 1;
           }

          if($w==0){setAttr -type float3 ($kongzhiAB+".scale") $temp_zhi $temp_zhi $temp_zhi;}
          if($w==1){setAttr -type float3 ($kongzhiAB+".scale") $temp_zhi $temp_zhi $temp_zhi;}
          if($w==2){setAttr ($kongzhiAB+".scaleX") $temp_zhi;}
          if($w==3){setAttr ($kongzhiAB+".scaleX") $temp_zhi;}
          if($w==4){setAttr ($kongzhiAB+".scaleY") $temp_zhi;}
          if($w==5){setAttr ($kongzhiAB+".scaleY") $temp_zhi;}
          select -r   $temp_mode;
          duplicate -rr -n  $bs_mode;
          parent  $bs_mode $grp;
          string $listOfShapesInNode[] =`listAttr -k -m $bs`;
          string$bsss[];
          clear$bsss;
          for($jj=0;$jj<size($listOfShapesInNode);$jj++)
            {
            string$mmmm=$listOfShapesInNode[$jj];
             int$ex=`objExists $mmmm`; 
             if($ex==1)
                {
                int$size=size($bsss);
                $bsss[$size]=$mmmm;
                 } 
            
            }
          int$idex=size($bsss);
          select -r   $bs_mode;
          select -add $temp_mode;
          blendShape -e  -t $temp_mode $idex $bs_mode 1 $bs;
          setDrivenKeyframe -itt "linear" -ott "spline" -v 0 -dv 0 -cd  ($kongzhi+"."+$temp_ming)  ($bs+"."+$bs_mode);  
          setDrivenKeyframe -itt "linear" -ott "spline" -v 1 -dv 1 -cd   ($kongzhi+"."+$temp_ming)  ($bs+"."+$bs_mode); 
          setAttr -type float3 ($kongzhiAB+".scale") 1 1 1;     
        }
         
    }



}
/////



       }
}









////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////眼皮自动创建次级/////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
global proc zxb_yanjing_yanpi_qvxian_fangfa_proc()

{
    
    string$all_temp_eye_bn="";
    //string$ui_name_s[]={"UI_eye_middle_wire"};
    string$ui_name_A[]={"UI_eye_R_mode","UI_eye_L_mode"};
    string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//查询眼眶线的变量   
    string$eye_bs_name_s=`getAttr ($UI_head_controller+".base_bs_mode")`;
    string $eye_bs_name_ss[]= stringToStringArray($eye_bs_name_s, " ");//字符串转化数组
     string$eye_bs_name=$eye_bs_name_ss[4];
    string$EYE_com_SS=`getAttr ($UI_head_controller+".eye_con")`;
    string $EYE_com_S[]= stringToStringArray($EYE_com_SS, " ");//字符串转化数组
    string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
    zxb_ADD_shuxing_string_proc($UI_head_controller,"eye_qvmian");
    string$qvmian_temp="";
    string$qvmxian_DDD_temp="";
    int$ex_duichengtemp=`checkBox -q -value duicheng`;
    
     for ($e=0;$e<size($ui_name_A);$e++)
     {
         string$ui_mingzi="UI_eye_middle_wire";
         string $ui_name_mode=$ui_name_A[$e];
         string$eye_con_A=$EYE_com_S[$e];
         string$fuzhao_qvmian="";
         string$DD_QVXIAN="";
         string$grp_lr_temp="";
         string$zhangkai_qvxian_A="";
         string$gensui_qvxian_D="";
         string$bihe_qvxian="";
         string$temp_rl_bianliang="";
         if($e==0){$temp_rl_bianliang="R";}
         if($e==1){$temp_rl_bianliang="L";}
         string$all_rl_qvxian_MM="";
         string$shuxing_baocun="eye_close"+$temp_rl_bianliang;
         zxb_ADD_shuxing_string_proc($UI_head_controller,$shuxing_baocun);


         string $mnian_temp=`textFieldGrp -q -tx  $ui_mingzi`;//查询眼眶线的变量
         string $mnians_temp[]= stringToStringArray($mnian_temp, " ");//字符串转化数组
         if($ex_duichengtemp==1&&$e==1)
            {
            
            select -r $mnians_temp;
            symmetricModelling -e -symmetry true; if (true) SymmetrizeSelection; 
            string$temp_ext_a[]=`ls -sl -fl`;
            for ($qq=0;$qq<size($temp_ext_a);$qq++)
                {
                 string$temp_ext_b=$temp_ext_a[$qq];
                 float$dian_pos_A_as[]=`xform -q -ws -t $temp_ext_b`;
                 if($dian_pos_A_as[0]<0){ select -d $temp_ext_b;}
                 
                
                }
             $mnians_temp=`ls -sl -fl`;
            }
         
         string $mnians[]=$mnians_temp;
         string$mnianss="";
         for ($zz=0;$zz<size($mnians);$zz++)
             {
              string$xianduan=$mnians[$zz];
              string$temp_clear[];
              clear $temp_clear;//清除数组
              int $nemt=`tokenize $xianduan "." $temp_clear`;//分离字符串存到变量
              $mnianss+=$eye_bs_name+"."+$temp_clear[1]+" ";
              }
         string $head_qvxian=`textFieldGrp -q -tx  UI_head_controller`;//查询眼眶线的变量
         string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
         string $head_joinr=`textFieldGrp -q -tx UI_head_bn `;
         float$bbobx_max[]=`getAttr ($head_qvxian+".boundingBoxMax")`;
         float$pianyi=$bbobx_max[0]/130;
         int$ex=`objExists $mnians[0]`;    ///判断
         if($ex==1)
         {
          string$qvxian="eye_wire";
          string$rrll="";
          int$duicheng_bn=`checkBox -q  -value   duicheng`;
          spaceLocator -p 0 0 0 -n "temp_loc_pos";
          select -r $mnians;
          string$temp_Cluster[]=`newCluster " -envelope 1"`;
          delete`pointConstraint $temp_Cluster[1] "temp_loc_pos" `;
          float$temp_loc_pos= `getAttr "temp_loc_pos.translateX"`;
          if($temp_loc_pos>0.0000000001){$rrll="L";}
          if($temp_loc_pos<-0.0000000001){$rrll="R";}
          delete "temp_loc_pos" $temp_Cluster[1];
          zxb_extract_Curves_proc(1,$rrll,$qvxian,$mnianss);//int 区分线段的平均值或者法线朝向 $mingzi名字 $qianzui前缀 $xian_A 线段名称
          string$eye_cu_grp="eye_grp_cu_"+$rrll;
          zxb_ADD_kongzu_proc($eye_cu_grp);
          setAttr ($eye_cu_grp+".visibility") 0;
          setAttr -lock true ($eye_cu_grp+".v");
          string$eye_cu_shuxing="eye_cu_mingzi_"+$rrll;
          zxb_ADD_shuxing_string_proc($head_qvxian,$eye_cu_shuxing);
          string$dw_A=$qvxian+"_"+$rrll+"_DW";
          string$up_A=$qvxian+"_"+$rrll+"_UP";
          select -r $up_A  $dw_A;
          string$qvxians[]=`ls -sl  `;
          float$dian_pos_A[];
          float$dian_pos_B[];
          for ($aa=0;$aa<size($qvxians);$aa++) 
              {
              string$qv_temp=$qvxians[$aa];
             select -r ($qv_temp+".cv[0:999999999]") ;
             string$temp_dian[]=`ls -sl  -fl`;
             if($aa==0){$dian_pos_A=`xform -q -ws -t $temp_dian[0]`;}
             if($aa==1){$dian_pos_B=`xform -q -ws -t $temp_dian[0]`;}  
              }   
         if($dian_pos_A[0]!=$dian_pos_B[0])
             {
             if($duicheng_bn==1){reverseCurve -ch 1 -rpo 1 $up_A;}
             if($duicheng_bn==0){reverseCurve -ch 1 -rpo 1 $dw_A;}
             }
             
        string$grp=$qvxians[0]+"grp";
        string$grp_curve=$qvxians[0]+"_grp_curve";
        int$ex=`objExists $grp`;    ///判断
        $grp_lr_temp=$grp;
        if($ex==0){group -empty -n $grp ; group -empty -n $grp_curve ; parent $grp_curve  $grp;  setAttr ($grp_curve+".visibility") 0;  setAttr -lock true ($grp_curve+".v"); }
        int$ex=`objExists ("Eye_all_grp")`;
          if($ex==1){parent $eye_cu_grp  "Eye_all_grp"; parent $grp "Eye_all_grp";}
        string$qvmians[];
        clear$qvmians; 
        string$HH_qvxian="";  
        string$HH_qvmian="";
        string$xian_d_ss="";
        string$xian_cc_ss="";
        for ($aa=0;$aa<size($qvxians);$aa++) 
            {
            string$temp_qvxian=$qvxians[$aa];
            $bihe_qvxian+=$temp_qvxian+" ";
            string$qvxian_D=$temp_qvxian+"_D";
            $gensui_qvxian_D+=$qvxian_D+" ";
            $xian_d_ss+=$qvxian_D+" ";
            
            string$qvxian_A=$temp_qvxian+"_A";
            $zhangkai_qvxian_A+=$qvxian_A+" ";
            string$qvxian_CC=$temp_qvxian+"_CC";
            $xian_cc_ss+=$qvxian_CC+" ";
            string$qvxian_HH=$temp_qvxian+"_HH";
            $HH_qvxian+=$qvxian_HH+" ";
            string$qvxian_DD=$temp_qvxian+"_DD";
            $DD_QVXIAN+=$qvxian_DD+" ";
            $qvmxian_DDD_temp+=$qvxian_DD+" ";
            string$qvxian_FF=$temp_qvxian+"_FF";
            string$qvxian_qvmian=$temp_qvxian+"_qvmian";
            $HH_qvmian+=$qvxian_qvmian+" ";
            string$qvxian_pianyi_A=$temp_qvxian+"_pianyi_A";
            string$qvxian_pianyi_B=$temp_qvxian+"_pianyi_B";
            select -r $temp_qvxian;
            duplicate -rr -n $qvxian_D;
           select -r $temp_qvxian;
           duplicate -rr -n  $qvxian_A;
           select -r $temp_qvxian;
           duplicate -rr -n  $qvxian_CC;
           select -r $temp_qvxian;
          duplicate -rr -n  $qvxian_HH;
          select -r $temp_qvxian;
          duplicate -rr -n  $qvxian_DD;
          select -r   $temp_qvxian;
          duplicate -rr  -n $qvxian_FF;
          select -r $qvxian_CC ;
          select -add $qvxian_HH ;
          select -add $qvxian_DD ;
          string$bss[]=`blendShape -automatic -tc 0`;
          setAttr ($bss[0]+"."+$qvxian_CC) 1;
          setAttr ($bss[0]+"."+$qvxian_HH) 1;
          select -r  $qvxian_FF;
          rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s 4 -d 3 -tol 0.01 $qvxian_FF;
          offsetCurve  -ch on -rn false -cb 2 -st true -cl true -cr 0 -d ($pianyi*-1) -tol 0.01 -sd 5 -ugn false   -n $qvxian_pianyi_A  $qvxian_FF;
          offsetCurve  -ch on -rn false -cb 2 -st true -cl true -cr 0 -d $pianyi -tol 0.01 -sd 5 -ugn false  -n $qvxian_pianyi_B  $qvxian_FF ;
          loft -ch 1 -u 1 -c 0 -ar 1 -d 3 -ss 1 -rn 0 -po 0 -rsn true  -n $qvxian_qvmian $qvxian_pianyi_A $qvxian_pianyi_B;
          int$size=size($qvmians);
          $qvmians[$size]=$qvxian_qvmian;
          delete $qvxian_pianyi_A $qvxian_pianyi_B $qvxian_FF;
          parent  $temp_qvxian $grp_curve;
          parent $qvxian_D  $grp_curve; 
          parent $qvxian_A $grp_curve;
          parent $qvxian_CC  $grp_curve;
          parent $qvxian_HH $grp_curve;
          parent $qvxian_DD $grp_curve;
          parent $qvxian_qvmian $grp_curve;
          rename $temp_qvxian ($qvxian_A+"A");
          rename $qvxian_A $temp_qvxian;
          rename ($qvxian_A+"A") $qvxian_A; 
          
          $all_rl_qvxian_MM+=$temp_qvxian+" ";
          zxb_eye_qvmiankongzhiqqvxian_proc($qvxian_HH,$qvxian_qvmian);
         string$mode_qvmian=`zxb_tongkong_qvmian_mode_extract_proc($ui_name_mode)`;//创建曲面球

         string $nurbsSphere_a[]= stringToStringArray($mode_qvmian, " ");//字符串转化数组
         string$nurbsSphere=$nurbsSphere_a[0];
         $fuzhao_qvmian=$nurbsSphere;
         int$ex=`objExists $nurbsSphere`;
         if($ex==1){zxb_qvxian_gensui_yanqiu_fangfa_proc($qvxian_D,$qvxian_CC,$mode_qvmian);}else{error  "眼球曲面模型不存在";}
         } 
         setAttr -type "string" ($UI_head_controller+"."+$shuxing_baocun)  $all_rl_qvxian_MM;
         string$temp_name_cu="";
         for ($aa=0;$aa<size($qvmians);$aa++) 
             {
             string$temp=$qvmians[$aa];
            select -r ($temp+".cv[0:999999999999][0:99999999]");
            string$cvs[]=`ls -sl -fl `;
            int$size=size($cvs);
            string$qw=$cvs[$size-1];
            string$ee[];
            clear$ee;
            int $nemt=`tokenize $qw "[" $ee`;//分离字符串存到变量
            int $nemt=`tokenize $ee[1] "]" $ee`;//分离字符串存到变量
            int$id=$ee[0] ;
            for ($m=1;$m<($id);$m++) 
             {  
             select -r ($temp+".cv["+$m+"][0:3]") ;
             string$temp_cu_s[]=` newCluster " -envelope 1"` ;
             $temp_name_cu+=$temp_cu_s[1]+" ";
             parent $temp_cu_s[1]$eye_cu_grp;
             }
         
           }
         
         select -r ($qvmians[0]+".cv[0][0:3]");
         select -add ($qvmians[1]+".cv[0][0:3]"); 
         string$temp_cu_ss[] =`newCluster " -envelope 1" `;
         $temp_name_cu+=$temp_cu_ss[1]+" ";
         parent $temp_cu_ss[1]$eye_cu_grp;
         select -r ($qvmians[0]+".cv[6][0:3]");
        select -add ($qvmians[1]+".cv[6][0:3]"); 
        string$temp_cu_sss[]=`newCluster " -envelope 1"` ;
        $temp_name_cu+=$temp_cu_sss[1]+" ";
        parent $temp_cu_sss[1]$eye_cu_grp;
        setAttr -type "string" ($head_qvxian+"."+$eye_cu_shuxing) $temp_name_cu;
        string$qianzui="R";
        if($e==1){$qianzui="L";}
        string$all_op_cs=$zhangkai_qvxian_A+$bihe_qvxian;
         int$ex=`objExists $mnians[0]`;    ///判断
         if($ex==1)
           {
            $qvmian_temp+=$fuzhao_qvmian+" ";
            zxb_child_object_proc($head_mode,$head_joinr,$temp_name_cu,0,1,0,0); //创建控制器
            string$bn_return=zxb_yanjing_yanpichuangjian_guanjie_proc($DD_QVXIAN,$eye_con_A,$fuzhao_qvmian,$e);
            $all_temp_eye_bn=$bn_return;
            zxb_dingweiqi_kongzhiqvxian_eye($gensui_qvxian_D,$qianzui);
            zxb_dingweiqi_gensuiqvxian_A($all_op_cs,$qianzui);
            zxb_global_lalian_a($zhangkai_qvxian_A,$bihe_qvxian,$gensui_qvxian_D,$qianzui);
            zxb_bolangzui_a($gensui_qvxian_D);
            zxb_ADD_shuxing_string_proc($UI_head_controller,"eye_bn_"+$qianzui);
            setAttr -type "string" ($UI_head_controller+".eye_bn_"+$qianzui) $all_temp_eye_bn;
            }
         
        int$ex=`objExists  $grp_lr_temp`;
        if($ex==1){ parent $fuzhao_qvmian  $grp_lr_temp;}
        string$UP_EYE_all_BN_pengzhuang_L="";
        string$DW_EYE_all_BN_pengzhuang_L="";
        string$UP_EYE_all_BN_pengzhuang_R="";
        string$DW_EYE_all_BN_pengzhuang_R="";
        /*string$string_eye_guge_temp[]={"UP_EYE_all_BN_pengzhuang_L","DW_EYE_all_BN_pengzhuang_L","UP_EYE_all_BN_pengzhuang_R","DW_EYE_all_BN_pengzhuang_R";}
        for ($q=0;$q<size($string_eye_guge_temp);$q++)
            {
             string$shuxing_temp_a=($UI_head_controller+"."+$string_eye_guge_temp;
             string$ex_a=`objExists  $grp_lr_temp`;
             }*/
        string $EYE_qvmian_dd_temp[]= stringToStringArray($DD_QVXIAN, " ");//字符串转化数组
        select -r$EYE_qvmian_dd_temp[0];
       float$ex_floata=`zxb_qvfengshangzi`;
        select -r $EYE_qvmian_dd_temp[1];
       float$ex_floatb=`zxb_qvfengshangzi`;
       string$up_qvxian="";
       string$dw_qvxian="";
       string$eye_kongzhi_L=$EYE_com_S[1];
       string$eye_kongzhi_R=$EYE_com_S[0];
       if($ex_floata>$ex_floatb){$up_qvxian=$EYE_qvmian_dd_temp[0];$dw_qvxian=$EYE_qvmian_dd_temp[1];}else{$up_qvxian=$EYE_qvmian_dd_temp[1];$dw_qvxian=$EYE_qvmian_dd_temp[0];}
       spaceLocator -p 0 0 0 -n "TEMP_LOC";
       delete `pointConstraint  $fuzhao_qvmian  "TEMP_LOC"`;
       float$pos_dia[]=`xform -q -ws -t  "TEMP_LOC"`;
       delete "TEMP_LOC";
       if($pos_dia[0]>0)
         {
         $UP_EYE_all_BN_pengzhuang_L=`getAttr ($UI_head_controller+".UP_EYE_all_BN_pengzhuang_L")`;
         $DW_EYE_all_BN_pengzhuang_L=`getAttr ($UI_head_controller+".DW_EYE_all_BN_pengzhuang_L")`;
         zxb_yanpi_pengzhuang_chengxu_proc($dw_qvxian,$eye_kongzhi_L,$DW_EYE_all_BN_pengzhuang_L,$fuzhao_qvmian);
         zxb_yanpi_pengzhuang_chengxu_proc($up_qvxian,$eye_kongzhi_L,$UP_EYE_all_BN_pengzhuang_L,$fuzhao_qvmian);
         }else
             {
                 
             $UP_EYE_all_BN_pengzhuang_R=`getAttr ($UI_head_controller+".UP_EYE_all_BN_pengzhuang_R")`;
             $DW_EYE_all_BN_pengzhuang_R=`getAttr ($UI_head_controller+".DW_EYE_all_BN_pengzhuang_R")`; 
              zxb_yanpi_pengzhuang_chengxu_proc($dw_qvxian,$eye_kongzhi_R,$DW_EYE_all_BN_pengzhuang_R,$fuzhao_qvmian);
              zxb_yanpi_pengzhuang_chengxu_proc($up_qvxian,$eye_kongzhi_R,$UP_EYE_all_BN_pengzhuang_R,$fuzhao_qvmian); 
             }
      
         
      }


    
    }
    


zxb_eye_lip_quanzhong_jisuan;///计算次级权重
zxb_eye_close_qvxian_fangfa;//波浪曲线闭合自动计算
button -e -en 0 hedemianbankuan_delete_button;
}



//////////////////////曲面控制器曲线///////////////
global proc zxb_eye_qvmiankongzhiqqvxian_proc(string$xian,string$mian)
{
string $qvxian_Hs=$xian;
string$eeeee[];
clear $eeeee;
int $nemt=`tokenize $qvxian_Hs " " $eeeee`;//分离字符串存到变量
string $qvxian_H=$eeeee[0];

string $qvmian_Hs=$mian;
string$AAAAAA[];
clear $AAAAAA;
int $nemt=`tokenize  $qvmian_Hs " " $AAAAAA`;//分离字符串存到变量
string  $qvmian_H=$AAAAAA[0];
select -r  $qvxian_H $qvmian_H;
string $bianliang[]=`ls -sl`;//选择曲线 //手动控制曲线 加选曲面

////////////判断曲面还是曲线//////////////////
int$size=size($bianliang);
if($size!=2){error "请选中一个曲线和一个曲面两个物体";}
string$qvxian_temp="";
string$qvmian_temp="";
string$shape_a[]=`listRelatives -s $bianliang[0]`; 
string$shape_b[]=`listRelatives -s $bianliang[1]`; 
int$ex_a=`objExists $shape_a[0]`;
if($ex_a==0){error "选中的第一个物体没有型节点";}
int$ex_b=`objExists $shape_b[0]`;
if($ex_b==0){error "选中的第二个物体没有型节点";}
string$type_a=`nodeType $shape_a[0]`;

if($type_a=="nurbsCurve")
  {
    $qvxian_temp=$bianliang[0];
    $qvmian_temp=$bianliang[1];
  }else
       {
        $qvxian_temp=$bianliang[1];
        $qvmian_temp=$bianliang[0];
       }

  
      
/////////////////////////////创建曲面信息节点/////////////////////////////////////////////////////
string$qvmian_closestPointOnSurface=($qvmian_temp+"_closestPointOnSurface_yanpi");
string$qvmian_shape[]=`listRelatives -s $qvmian_temp`; 
string$qvmianshape=$qvmian_shape[0];
int$panduan_B=`objExists $qvmian_closestPointOnSurface`;
if($panduan_B==1){delete $qvmian_closestPointOnSurface;}
shadingNode -asUtility closestPointOnSurface  -n $qvmian_closestPointOnSurface;
connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_closestPointOnSurface+".inputSurface");

/////////////选中曲线////////////////////////
select -r ($qvxian_temp+".cv[0:999999999]");
string $cvs[]=`ls -sl -fl`;
 
for ($i=0;$i<size($cvs);$i++)
{
    
    
    ////////////////////曲面最近点节点 赋值最近点节点////////////////////////////
   string$cv=$cvs[$i];
   string$qvmian_pointOnSurfaceInfo=($qvmian_temp+"_pointOnSurfaceInfo_yanpi"+$i);
   int$panduan_A=`objExists $qvmian_pointOnSurfaceInfo`;
   if($panduan_A==1){delete $qvmian_pointOnSurfaceInfo;}
   shadingNode -asUtility pointOnSurfaceInfo  -n $qvmian_pointOnSurfaceInfo;
   float$pos_dia[]=`xform -q -ws -t $cv`;
   setAttr -type float3 ($qvmian_closestPointOnSurface+".inPosition") $pos_dia[0] $pos_dia[1] $pos_dia[2];
   float$U=`getAttr ($qvmian_closestPointOnSurface+".parameterU")`;
   float$V=`getAttr ($qvmian_closestPointOnSurface+".parameterV")`;
   setAttr ($qvmian_pointOnSurfaceInfo+".parameterU") $U;//获得U值
   setAttr ($qvmian_pointOnSurfaceInfo+".parameterV") $V;//获得V值
   connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_pointOnSurfaceInfo+".inputSurface");//连接曲面
   
   ///////////////////////////创建定位器连接到曲线上（定位器被曲面控制 定位器控制曲线）//////////////////////////////////////////////////
   string$zu_A=($qvmian_temp+"_eye_grp_loc");
   string$eye_loc=($qvxian_temp+"_eye_loc_"+$i);
   string$eye_loc_grp_a=($eye_loc+"_GRP_A");
   string$eye_loc_grp_b=($eye_loc+"_GRP_B");

   int$panduan_A=`objExists $zu_A`;
   if($panduan_A==0)
      {
          select -cl  ;
         group -empty -n  $zu_A;
         setAttr ($zu_A+".visibility") 0;
         setAttr -lock true ($zu_A+".v");   
         string$qvmian_zu[]=`listRelatives -p $qvmian_temp`; 
         int$panduan_A=`objExists $qvmian_zu[0]`;
         if($panduan_A==1){ parent $zu_A $qvmian_zu[0];}
        
      }
      
      spaceLocator -p 0 0 0 -n $eye_loc;
      group -n $eye_loc_grp_a;
      group -n $eye_loc_grp_b;
      parent $eye_loc_grp_b $zu_A;
      connectAttr -f ($qvmian_pointOnSurfaceInfo+".position") ($eye_loc_grp_b+".t");//连接定位器  这个位置是曲面的位置  与曲线顶点的位置有偏移
      ///////////////////矫正偏移  保证定位器一点在曲线点上/////////////////////
      xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_a;
      string$loc_sheps[]=`listRelatives -s $eye_loc`; 
      string$loc_shep=$loc_sheps[0];
      connectAttr -f ($loc_shep+".worldPosition[0]")  ($qvxian_temp+".controlPoints["+$i+"]");//定位器控制曲线
      
      
   } 
   
   delete $qvmian_closestPointOnSurface;
}




////////////////////曲线跟随曲面////////////////////////////////

global proc zxb_qvxian_gensui_qvxian_fangfa_proc()
{
  
string $qvxian_jichus=`textFieldGrp -q -tx  zxb_zairuqvxian_jichu`;
string$eeeee[];
clear $eeeee;
int $nemt=`tokenize $qvxian_jichus " " $eeeee`;//分离字符串存到变量
string $qvxian_jichu=$eeeee[0];

string $qvxian_cs=`textFieldGrp -q -tx  zxb_zairuqvxian_c`;
string$AAAAAA[];
clear $AAAAAA;
int $nemt=`tokenize  $qvxian_cs " " $AAAAAA`;//分离字符串存到变量
string  $qvxian_c=$AAAAAA[0];


string $qvmian_qiu_as=`textFieldGrp -q -tx  zxb_qvmianqiu_c`;
string$ttttt[];
clear $ttttt;
int $nemt=`tokenize  $qvmian_qiu_as " " $ttttt`;//分离字符串存到变量
string   $qvmian_qiu_a=$ttttt[0];

select -r  $qvxian_jichu $qvmian_qiu_a;
  
string $bianliang[]=`ls -sl`;// 跟随眼皮的曲线  加选眼球的曲面  制作曲线附着曲面 （曲线跟随没有删除历史的曲线并附着在眼球曲面上）

////////////判断曲面还是曲线//////////////////
int$size=size($bianliang);
if($size!=2){error "请选中一个曲线和一个曲面两个物体";}
string$qvxian_temp="";
string$qvmian_temp="";

string$shape_a[]=`listRelatives -s $bianliang[0]`; 
string$shape_b[]=`listRelatives -s $bianliang[1]`; 
int$ex_a=`objExists $shape_a[0]`;
if($ex_a==0){error "选中的第一个物体没有型节点";}
int$ex_b=`objExists $shape_b[0]`;
if($ex_b==0){error "选中的第二个物体没有型节点";}
string$type_a=`nodeType $shape_a[0]`;

if($type_a=="nurbsCurve")
  {
    $qvxian_temp=$bianliang[0];
    $qvmian_temp=$bianliang[1];
  }else
       {
        $qvxian_temp=$bianliang[1];
        $qvmian_temp=$bianliang[0];
       }

  


string$gensuiqvxian=$qvxian_c;
select -r ($qvxian_temp+".cv[0:99999999999]");
string $cvs[]=`ls -sl -fl`;
int$CVshu=size($cvs);
string$qvxian_shape[]=`listRelatives -s $qvxian_temp`; 
string$qvmian_shapes[]=`listRelatives -s $qvmian_temp`; 
string$qvxianshape=$qvxian_shape[0];
string$qvmianshape=$qvmian_shapes[0];

string$qvxian_nearestPointOnCurve=($gensuiqvxian+"_nearestPointOnCurve_yanpi");
int$panduan_B=`objExists$qvxian_nearestPointOnCurve`;
if($panduan_B==1){delete $qvxian_nearestPointOnCurve;}
shadingNode -asUtility nearestPointOnCurve  -n $qvxian_nearestPointOnCurve;
connectAttr -force ($qvxianshape+".worldSpace[0]") ($qvxian_nearestPointOnCurve+".inputCurve");
for ($i=0;$i<$CVshu;$i++)
    {
       string$cv_name_A=($qvxian_temp+".cv["+$i+"]");
       string$cv_name_B=($gensuiqvxian+".cv["+$i+"]");
       float$pos_A[]=`xform -q -ws -t $cv_name_A`;
       
       setAttr -type float3 ($qvxian_nearestPointOnCurve+".inPosition") $pos_A[0] $pos_A[1] $pos_A[2];
       float$param=`getAttr ($qvxian_nearestPointOnCurve+".parameter")`;
       
        string$qvxianpointOnCurveInfo=($qvxian_temp+"_pointOnCurveInfo_gensui_loc_"+$i);
        int$ex=`objExists $qvxianpointOnCurveInfo`;
        if($ex==1){delete $qvxianpointOnCurveInfo;}
        shadingNode -asUtility pointOnCurveInfo  -n $qvxianpointOnCurveInfo;
        connectAttr -force ($qvxianshape+".worldSpace[0]") ($qvxianpointOnCurveInfo+".inputCurve");
        setAttr  ($qvxianpointOnCurveInfo+".parameter")  $param;//通过曲线获得一个位置
     
     
        ////////////////////创建曲面球的曲面信息节点//////////////////////////////////
        string$qvmianclosestPointOnSurface=($gensuiqvxian+"_closestPointOnSurface_"+$i);
         int$ex=`objExists $qvmianclosestPointOnSurface`;
        if($ex==1){delete $qvmianclosestPointOnSurface;}
        shadingNode -asUtility closestPointOnSurface  -n $qvmianclosestPointOnSurface;
        connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmianclosestPointOnSurface+".inputSurface");
        connectAttr -force ($qvxianpointOnCurveInfo+".position") ($qvmianclosestPointOnSurface+".inPosition");

       /* float$pos_weizhi[]=`getAttr   ($qvxianpointOnCurveInfo+".position")`;
        setAttr -type float3 ($qvmianclosestPointOnSurface+".inPosition") $pos_weizhi[0] $pos_weizhi[1] $pos_weizhi[2];//赋值给曲面最近点节点（曲线信息节点的值）  
        
        */
        ////////////创建定位器//////////////////////
        string$loc=($gensuiqvxian+"_eye_yanpi_gensui_loc"+$i);
        string$loc_grp_a=($loc+"_grp_A");
        string$loc_grp_b=($loc+"_grp_B");
        spaceLocator -p 0 0 0 -n $loc;
        group -n $loc_grp_a;
        group -n $loc_grp_b;
        string$root_zu=($gensuiqvxian+"_eye_yanpi_gensui_root_grp");
        int$ex=`objExists $root_zu`;
        if( $ex==0)
          {
           
           select -cl  ;
           group -empty -n  $root_zu;
           setAttr ($root_zu+".visibility") 0;
           setAttr -lock true ($root_zu+".v"); 
           }
        parent $loc_grp_b $root_zu;
        
        
        connectAttr -force  ($qvmianclosestPointOnSurface+".position") ($loc_grp_b+".t");//定位器的组跟随曲面
        xform -ws -t $pos_A[0] $pos_A[1] $pos_A[2] $loc_grp_a;//定位器偏移
        
        string$loc_shapes[]=`listRelatives -s $loc `; 
        string$loc_shape=$loc_shapes[0];
        connectAttr -force ($loc_shape+".worldPosition[0]") ($gensuiqvxian+".controlPoints["+$i+"]");//定位器控制器曲线


    }

delete $qvxian_nearestPointOnCurve; 
}




///////////////////////////////////////生成曲面模型/////////////////////////////////////////////////////
global proc string  zxb_tongkong_qvmian_mode_extract_proc(string$UI_eye_L_mode)
{
    
string $dian_aa=`textFieldGrp -q -tx $UI_eye_L_mode `;

string$AAAAAA[];
clear $AAAAAA;
int $nemt=`tokenize  $dian_aa " " $AAAAAA`;//分离字符串存到变量


string$moxing_ss[];
clear $moxing_ss;
$moxing_ss[0]=$AAAAAA[0];

string$mode_qvmian_sss="";
for($jjj=0;$jjj<size($moxing_ss);$jjj++)
    {
    string$aaa=$moxing_ss[$jjj];
    string$mode=$aaa;
    int$ex_a=`objExists $mode`;
    if($ex_a==1)
      {
  //创建眼球模型跟曲面
string$qiu=($mode+"_qiu_eye");
string$qiunurb=($mode+"_nur_eye");
$mode_qvmian_sss+=$qiunurb+" ";
int$ex=`objExists $qiunurb`;
if($ex==0)
{

polySphere -r 1 -sx 20 -sy 20 -ax 0 0 1 -cuv 2 -ch 1 -n $qiu;
sphere -p 0 0 0 -ax 0 1 0 -ssw 0 -esw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 50 -nsp 50 -ch 0 -n $qiunurb;
setAttr ($qiunurb+".visibility") 0;
setAttr -lock true ($qiunurb+".v");
string$qvmian_shapes[]=`listRelatives -s $qiunurb`;
string$qvmian_shape=$qvmian_shapes[0];
select -cl  ;
select -r ($mode+".vtx[0:99999999999999]");
newCluster " -envelope 1";
string$cua[]=`ls -sl`;
delete` pointConstraint $cua[0] $qiu`;

delete  $cua[0] ;

//创建的模型尽量靠近原始模型
string$mode_temp_cop=$mode+"_temp";
select -r  $mode;
duplicate -rr -n $mode_temp_cop ;
select -r  $mode_temp_cop;
CenterPivot;
float$boxs[]=`getAttr ($mode_temp_cop+".boundingBoxSize")`;
delete  $mode_temp_cop;
float$beishu=0.5;
setAttr -type float3 ($qiu+".s") ($boxs[0]*$beishu) ($boxs[1]*$beishu) ($boxs[2]*$beishu);
delete` pointConstraint $qiu $qiunurb`;
delete` scaleConstraint $qiu $qiunurb`;
string$modejiedian=($mode+"yanqiu_closestPointOnMesh");
string$shaps[]=`listRelatives -s $mode`;
string$shap=$shaps[0];
int$ex=`objExists $modejiedian`;
if($ex==1){delete $modejiedian; }
createNode "closestPointOnMesh" -n $modejiedian; //多边型最近点节点
select -r ($qiu+".vtx[0:999999999]");
connectAttr -force ($shap+".worldMesh[0]")  ($modejiedian+".inMesh");
string $qiu_ves[]=`ls -sl -fl`;//顶点
for($i=0;$i<size($qiu_ves);$i++)
   {
       string$dian=$qiu_ves[$i];
       float$pos_temps[]=`xform -q -ws -t  $dian`;
       setAttr -type float3 ($modejiedian+".inPosition") $pos_temps[0] $pos_temps[1] $pos_temps[2] ;
       float $xingpos[]=`getAttr ($modejiedian+".position")`;
       xform -ws -t $xingpos[0] $xingpos[1] $xingpos[2] $dian;
       
   }

select -r ( $qiunurb+".cv[0:999999999]");
string $qiu_vesa[]=`ls -sl -fl`;//顶点
for($i=0;$i<size($qiu_vesa);$i++)
   {
       string$dian=$qiu_vesa[$i];
       float$pos_temps[]=`xform -q -ws -t  $dian`;
       setAttr -type float3 ($modejiedian+".inPosition") $pos_temps[0] $pos_temps[1] $pos_temps[2] ;
       float $xingpos[]=`getAttr ($modejiedian+".position")`;
       xform -ws -t $xingpos[0] $xingpos[1] $xingpos[2] $dian;
       
   }
delete $qiu;
        }
      }

     
     }


return $mode_qvmian_sss;
}



global proc zxb_qvxian_gensui_yanqiu_fangfa_proc(string$jichu,string$jichu_C,string$jichu_qvmian)
{
  

string $qvxian_jichu=$jichu;
string  $qvxian_c=$jichu_C;
string   $qvmian_qiu_a=$jichu_qvmian;

select -r  $qvxian_jichu $qvmian_qiu_a;
  
string $bianliang[]=`ls -sl`;// 跟随眼皮的曲线  加选眼球的曲面  制作曲线附着曲面 （曲线跟随没有删除历史的曲线并附着在眼球曲面上）

////////////判断曲面还是曲线//////////////////
int$size=size($bianliang);
if($size!=2){error "请选中一个曲线和一个曲面两个物体";}
string$qvxian_temp="";
string$qvmian_temp="";

string$shape_a[]=`listRelatives -s $bianliang[0]`; 
string$shape_b[]=`listRelatives -s $bianliang[1]`; 
int$ex_a=`objExists $shape_a[0]`;
if($ex_a==0){error "选中的第一个物体没有型节点";}
int$ex_b=`objExists $shape_b[0]`;
if($ex_b==0){error "选中的第二个物体没有型节点";}
string$type_a=`nodeType $shape_a[0]`;

if($type_a=="nurbsCurve")
  {
    $qvxian_temp=$bianliang[0];
    $qvmian_temp=$bianliang[1];
  }else
       {
        $qvxian_temp=$bianliang[1];
        $qvmian_temp=$bianliang[0];
       }

  


string$gensuiqvxian=$qvxian_c;
select -r ($qvxian_temp+".cv[0:99999999999]");
string $cvs[]=`ls -sl -fl`;
int$CVshu=size($cvs);
string$qvxian_shape[]=`listRelatives -s $qvxian_temp`; 
string$qvmian_shapes[]=`listRelatives -s $qvmian_temp`; 
string$qvxianshape=$qvxian_shape[0];
string$qvmianshape=$qvmian_shapes[0];

string$qvxian_nearestPointOnCurve=($gensuiqvxian+"_nearestPointOnCurve_yanpi");
int$panduan_B=`objExists$qvxian_nearestPointOnCurve`;
if($panduan_B==1){delete $qvxian_nearestPointOnCurve;}
shadingNode -asUtility nearestPointOnCurve  -n $qvxian_nearestPointOnCurve;
connectAttr -force ($qvxianshape+".worldSpace[0]") ($qvxian_nearestPointOnCurve+".inputCurve");
for ($i=0;$i<$CVshu;$i++)
    {
       string$cv_name_A=($qvxian_temp+".cv["+$i+"]");
       string$cv_name_B=($gensuiqvxian+".cv["+$i+"]");
       float$pos_A[]=`xform -q -ws -t $cv_name_A`;
       
       setAttr -type float3 ($qvxian_nearestPointOnCurve+".inPosition") $pos_A[0] $pos_A[1] $pos_A[2];
       float$param=`getAttr ($qvxian_nearestPointOnCurve+".parameter")`;
       
        string$qvxianpointOnCurveInfo=($qvxian_temp+"_pointOnCurveInfo_gensui_loc_"+$i);
        int$ex=`objExists $qvxianpointOnCurveInfo`;
        if($ex==1){delete $qvxianpointOnCurveInfo;}
        shadingNode -asUtility pointOnCurveInfo  -n $qvxianpointOnCurveInfo;
        connectAttr -force ($qvxianshape+".worldSpace[0]") ($qvxianpointOnCurveInfo+".inputCurve");
        setAttr  ($qvxianpointOnCurveInfo+".parameter")  $param;//通过曲线获得一个位置
     
     
        ////////////////////创建曲面球的曲面信息节点//////////////////////////////////
        string$qvmianclosestPointOnSurface=($gensuiqvxian+"_closestPointOnSurface_"+$i);
         int$ex=`objExists $qvmianclosestPointOnSurface`;
        if($ex==1){delete $qvmianclosestPointOnSurface;}
        shadingNode -asUtility closestPointOnSurface  -n $qvmianclosestPointOnSurface;
        connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmianclosestPointOnSurface+".inputSurface");
        connectAttr -force ($qvxianpointOnCurveInfo+".position") ($qvmianclosestPointOnSurface+".inPosition");

       /* float$pos_weizhi[]=`getAttr   ($qvxianpointOnCurveInfo+".position")`;
        setAttr -type float3 ($qvmianclosestPointOnSurface+".inPosition") $pos_weizhi[0] $pos_weizhi[1] $pos_weizhi[2];//赋值给曲面最近点节点（曲线信息节点的值）  
        
        */
        ////////////创建定位器//////////////////////
        string$loc=($gensuiqvxian+"_eye_yanpi_gensui_loc"+$i);
        string$loc_grp_a=($loc+"_grp_A");
        string$loc_grp_b=($loc+"_grp_B");
        spaceLocator -p 0 0 0 -n $loc;
        group -n $loc_grp_a;
        group -n $loc_grp_b;
        string$root_zu=($gensuiqvxian+"_eye_yanpi_gensui_root_grp");
        int$ex=`objExists $root_zu`;
        if( $ex==0)
          {
           
           select -cl  ;
           group -empty -n  $root_zu;
           setAttr ($root_zu+".visibility") 0;
           setAttr -lock true ($root_zu+".v"); 
           string$qvxian_fuwuti_s[]=`listRelatives -p $jichu_C`; 
           int$ex=`objExists $qvxian_fuwuti_s[0]`;
           if($ex==1){ parent $root_zu $qvxian_fuwuti_s[0]; }
           }
        parent $loc_grp_b $root_zu;
        
        
        connectAttr -force  ($qvmianclosestPointOnSurface+".position") ($loc_grp_b+".t");//定位器的组跟随曲面
        xform -ws -t $pos_A[0] $pos_A[1] $pos_A[2] $loc_grp_a;//定位器偏移
        
        string$loc_shapes[]=`listRelatives -s $loc `; 
        string$loc_shape=$loc_shapes[0];
        connectAttr -force ($loc_shape+".worldPosition[0]") ($gensuiqvxian+".controlPoints["+$i+"]");//定位器控制器曲线


    }

delete $qvxian_nearestPointOnCurve; 
}





global proc string zxb_yanjing_yanpichuangjian_guanjie_proc(string$qvxian_dds,string$yanjingkongzhiqi,string$qvmianqiu,int$qq_lr) ///////////////////////////////////////创建关节
{
    
string$return_string="";    
string $qvxian_Dss=$qvxian_dds;
string $qvxian_Ds[]= stringToStringArray($qvxian_Dss," ");//字符串转化数组
string $head_com=`textFieldGrp -q -tx UI_head_controller `;
string $kongzhiqiss=$yanjingkongzhiqi;
string$AAAAAA[];
clear $AAAAAA;
int $nemt=`tokenize  $kongzhiqiss " " $AAAAAA`;//分离字符串存到变量
string  $kongzhiqi=$AAAAAA[0];
string $qvmian_qiu_as=$qvmianqiu;
string$ttttt[];
clear $ttttt;
int $nemt=`tokenize  $qvmian_qiu_as " " $ttttt`;//分离字符串存到变量
string   $qvmian_qiu_a=$ttttt[0];
string $qvxians[]=$qvxian_Ds;//选中曲线  D
string$yanqiu_con=$kongzhiqi;//眼球控制器名字
string$qiuti=$qvmian_qiu_a;
int$L_R=$qq_lr;
string$upqvxian="";
string$dwqvxian="";
string$obj_nanme="";
string$qvmianshapes[]=`listRelatives -s $qiuti`; 
string$qvmianshape=$qvmianshapes[0];
//////添加属性连接连接范围节点及反向节点
int$ex=`objExists ($yanqiu_con+".gensui")`;
if($ex==0){addAttr -ln "gensui"  -at double  -min 0 -max 10 -dv 10 -k 1 $yanqiu_con ;}
string$fanweijiedian=($yanqiu_con+"_eye_yanpi_kongzhiqi_setRange");
int$ex=`objExists $fanweijiedian`;
if($ex==1){delete $fanweijiedian;}
shadingNode -asUtility setRange -n $fanweijiedian;
string$fanxiangjiedian=($yanqiu_con+"_eye_yanpi_kongzhiqi_reverse");
int$ex=`objExists $fanxiangjiedian`;
if($ex==1){delete $fanxiangjiedian;}
shadingNode -asUtility reverse -n $fanxiangjiedian;
setAttr ($fanweijiedian+".oldMaxX") 10;
setAttr ($fanweijiedian+".maxX") 1;
connectAttr -f ($yanqiu_con+".gensui") ($fanweijiedian+".valueX");
connectAttr -f ($fanweijiedian+".outValueX") ($fanxiangjiedian+".inputX");
string$fanweijijiedianshuchu_A=($fanweijiedian+".outValueX");
string$fanxiangjiedianshuchu_B=($fanxiangjiedian+".outputX");

/////////////////////////判断程序那条曲线是上下///////////////////////
float$ty=-10000000000000;
for ($i=0;$i<size($qvxians);$i++)
{
   string$qvxian=$qvxians[$i];
    string$shapes[]=`listRelatives -s $qvxian`; 
    string$shape=$shapes[0];
    string$type=`nodeType $shape`;
    select -r ($qvxian+".cv[0:999999999999]");
    string $cv_s[]=`ls -sl -fl`;
    for ($j=0;$j<size($cv_s);$j++)
        {
         float$pos_cv[]=`xform -q -ws -t $cv_s[$j]`;
         if($pos_cv[1]>$ty)
            {
            $ty=$pos_cv[1];
            $obj_nanme=$qvxian;
            }
         }
    
}
$upqvxian=$obj_nanme;
select -r $qvxians;
select -d $upqvxian;
string $qvxians_dws[]=`ls -sl`;
$dwqvxian=$qvxians_dws[0];
select -r  $upqvxian;
select -add  $dwqvxian;
string $qvxians_s[]=`ls -sl`;
string$eye_bn[];
string$DW_UP="";
string$DW_UP_LR="";
for ($ii=0;$ii<size($qvxians_s);$ii++)
{
    clear $eye_bn;
    string$qvxian=$qvxians_s[$ii];
    string$fuwuti_a[]=`listRelatives -p $qvxian`;
    string$fuwuti[]=`listRelatives -p $fuwuti_a[0]`;
    int$panduan=`objExists$fuwuti[0]`;
    select -r ($qvxian+".cv[0:9999999999999]");
    string $qvxians_cvs[]=`ls -sl -fl`;
    if($ii==0){$DW_UP="UP";}
    if($ii==1){$DW_UP="DW";}
    float $RL_LIST[]= `xform -q -ws -t $qvxians_cvs[0]`;
    if($RL_LIST[0]>0){$DW_UP_LR="L";}
    if($RL_LIST[0]<0){$DW_UP_LR="R";}
    string$eyey_bn_shuxing=$DW_UP+"_EYE_all_BN"+$DW_UP_LR;
    string$eyey_bn_shuxing_pengzhuang=$DW_UP+"_EYE_all_BN_pengzhuang_"+$DW_UP_LR;
    zxb_ADD_shuxing_string_proc($head_com,$eyey_bn_shuxing);
     zxb_ADD_shuxing_string_proc($head_com,$eyey_bn_shuxing_pengzhuang);
    string$temp_eyey_bn_shuxing="";
    string$temp_eyey_bn_shuxing_pengzhuang="";
    //////////区分上眼皮与下眼皮
    int$jiesu=size($qvxians_cvs);
    int$kaishi=0;
    if($ii==1)
      {
          $jiesu=$jiesu-1;
          $kaishi=1;
      }
      
      string$qianzui="L";
      if($L_R==0){$qianzui="R";}
      string$BN_name=("eye_yanpi_"+$qvxian+$qianzui);
      string$loc_grp=($BN_name+"_grp");
      int$ex=`objExists $loc_grp`;
      if($ex==0)
         {
         select -cl  ;
         group -empty -n  $loc_grp; //创建定位器空组
         setAttr ($loc_grp+".visibility") 0;
         setAttr -lock true ($loc_grp+".v");
         if($panduan==1){parent $loc_grp $fuwuti[0];}
         }
     
     string$qvxian_zuijingdianjiedian=($qvxian+"_eye_yanpi_nearestPointOnCurve");//曲线最近点节点（定位器跟随时需要）
     int$ex=`objExists $qvxian_zuijingdianjiedian`;
     if($ex==1){delete $qvxian_zuijingdianjiedian;}
     createNode "nearestPointOnCurve" -n $qvxian_zuijingdianjiedian;
    string$qvxian_shaps[]=`listRelatives -s $qvxian`;
    string$qvxianshap=$qvxian_shaps[0];
    connectAttr -force ($qvxianshap+".worldSpace[0]")  ($qvxian_zuijingdianjiedian+".inputCurve");
   for ($iii=$kaishi;$iii<$jiesu;$iii++)
       {
        string$bn_name=($BN_name+"_"+$iii);
        string$bn_loc=($bn_name+"_loc");
        string$bn_loc_A=($bn_name+"_loc_fuzhao_");
        string$bn_loc_B=($bn_name+"_loc_gensui_qvxian");

        string$bn_loc_A_grp_A=($bn_name+"_loc_fuzhao_grp_A");
        string$bn_loc_A_grp_B=($bn_name+"_loc_fuzhao_grp_B");


        string$cv=$qvxians_cvs[$iii];
        float$pos_temp[]=`xform -q -ws -t  $cv`;
        select -cl  ;
        joint -p $pos_temp[0] $pos_temp[1] $pos_temp[2] -n $bn_name;//创建关节
        $return_string+=$bn_name+" ";
        $temp_eyey_bn_shuxing+=$bn_name+" ";
        if($ii==0)
          {
          if($iii>=1){$temp_eyey_bn_shuxing_pengzhuang+=$bn_name+" ";}
          }
        if($ii==1)
          {
          $temp_eyey_bn_shuxing_pengzhuang+=$bn_name+" ";
          }
        $eye_bn[$iii]=$bn_name;
        spaceLocator -p 0 0 0 -n $bn_loc;//创建定位器
        parent $bn_loc $loc_grp;
        delete`pointConstraint $bn_name $bn_loc`;
        pointConstraint $bn_loc  $bn_name ;//定位器约束关节
        select -r $qiuti;
        select -add $bn_name;
        ////////////////眼球曲面约束骨骼/////////////////////
        normalConstraint -weight 1 -aimVector 1 0 0 -upVector 0 1 0 -worldUpType "vector" -worldUpVector 0 1 0;
        spaceLocator -p 0 0 0 -n $bn_loc_A;//创建定位器  跟随曲面
        group -n $bn_loc_A_grp_A;
        group -n $bn_loc_A_grp_B;
        parent  $bn_loc_A_grp_B  $loc_grp;
        spaceLocator -p 0 0 0 -n $bn_loc_B;//创建定位器  跟随曲线
        parent  $bn_loc_B $loc_grp;
        setAttr -type float3 ($qvxian_zuijingdianjiedian+".inPosition") $pos_temp[0] $pos_temp[1] $pos_temp[2] ;
        float$param=`getAttr ($qvxian_zuijingdianjiedian+".parameter")`;
       string$loc_juiedian=($qvxian+"_eye_yanpi_loc_pointOnCurveInfo"+$iii);//曲线信息节点
       int$ex=`objExists $loc_juiedian`;
       if($ex==1){delete $loc_juiedian;}
       createNode "pointOnCurveInfo" -n $loc_juiedian;
       connectAttr -force ($qvxianshap+".worldSpace[0]")  ($loc_juiedian+".inputCurve");
       setAttr ($loc_juiedian+".parameter") $param;
       connectAttr -force ($loc_juiedian+".position") ($bn_loc_B+".t");//定位器跟随曲线
       string$qvmianzuijiandian=($qvxian+"eye_yanpi_pos_closestPointOnSurface_"+$iii);
       int$ex=`objExists $qvmianzuijiandian`;
       if($ex==1){delete $qvmianzuijiandian;}
       createNode "closestPointOnSurface" -n $qvmianzuijiandian;
       connectAttr -force  ($qvmianshape+".worldSpace[0]") ($qvmianzuijiandian+".inputSurface");
       connectAttr -force  ($bn_loc_B+".t")  ($qvmianzuijiandian+".inPosition");
       connectAttr -force    ($qvmianzuijiandian+".position") ($bn_loc_A_grp_B+".t");//定位器组跟随曲面
       delete`pointConstraint $bn_loc_B $bn_loc_A_grp_A`;
       select -r $bn_loc_A;
       select -add $bn_loc_B;
       select -add $bn_loc;
       string$dian_yuesu[]=`pointConstraint`;
       connectAttr -force $fanweijijiedianshuchu_A  ($dian_yuesu[0]+"."+$bn_loc_A+"W0");
       connectAttr -force $fanxiangjiedianshuchu_B  ( $dian_yuesu[0]+"."+$bn_loc_B+"W1");
        }  
      string$bn_root=($qvxian+"eye_root_"+$qianzui);
      int$ex=`objExists $bn_root`;
      if($ex==0)
         {
             select -cl  ;
             joint -p 0 0 0-n $bn_root;//创建跟关节
             setAttr ($bn_root+".drawStyle") 2;
             setAttr ($bn_root+".visibility") 0;
             setAttr -lock true  ($bn_root+".v");
             for ($m=0;$m<size($eye_bn);$m++)
                 {
                     string$aa=$eye_bn[$m];
                     if($aa!="")
                       {
                         select -add $eye_bn[$m];
                        }
                  }
            // select -r $eye_bn;
             select -add $bn_root;
             delete`pointConstraint`;
             if($panduan==1){ parent $bn_root $fuwuti[0];}
          }
          
       select -cl  ;
       for ($m=0;$m<size($eye_bn);$m++)
       {
           string$aa=$eye_bn[$m];
           if($aa!="")
           {
            select -add $eye_bn[$m];
            }
       }
       select -add $bn_root;
       parent;
       delete $qvxian_zuijingdianjiedian;
       setAttr -type "string" ($head_com+"."+$eyey_bn_shuxing) $temp_eyey_bn_shuxing;
       setAttr -type "string" ($head_com+"."+$eyey_bn_shuxing_pengzhuang) $temp_eyey_bn_shuxing_pengzhuang;
      
}



return $return_string;
}


//////////////定位器控制器曲线/////////////////////

global proc  zxb_dingweiqi_kongzhiqvxian_eye(string$ddd_qvxian,string$qvxian_qianzui)
{
//string $bianliang[]=`ls -sl`;//选中曲线D  没有历史记录的曲线
 string $bianliang_sss=$ddd_qvxian;
string $bianliang[]= stringToStringArray($bianliang_sss, " ");//字符串转化数组
string $qianzui=$qvxian_qianzui;


string$curve_temp="zxb_"+$qianzui+"_curve_follow__grp";

zxb_ADD_kongzu_proc($curve_temp);
parent $curve_temp "Eye_all_grp";
for($i=0;$i<size($bianliang);$i++) 
{
    string $qvxian_A=$bianliang[$i];
    select -r ($qvxian_A+".cv[0:999999999999]");
    string  $cvs[]=`ls -sl -fl`;
    
    int $panduan=`objExists ($qvxian_A+"_locGrp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian_A+"_locGrp");
        }
     select -cl  ;
     group -empty -n ($qvxian_A+"_locGrp");
     setAttr ($qvxian_A+"_locGrp.visibility") 0;
     setAttr -lock true ($qvxian_A+"_locGrp"+".v");
     
     parent($qvxian_A+"_locGrp") $curve_temp ;
     int $panduanA=`objExists ($qvxian_A+"_gengsui_"+"nearestPointOnCurve")`;//查询这个物体是否纯在
     if($panduanA==1){ delete ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");}
     createNode nearestPointOnCurve -n  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");//创建曲线最近点节点
     string $qvxian_shp[]=`listRelatives -s $qvxian_A`;
     connectAttr -force ($qvxian_shp[0]+".worldSpace[0]")  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve.inputCurve");
       
    for($j=0;$j<size($cvs);$j++) 
    {
        string  $cvdian_bianliang=$cvs[$j];
       spaceLocator -p 0 0 0 -n($qvxian_A+"_loc_A_"+$j);
       spaceLocator -p 0 0 0 -n($qvxian_A+"_loc_B_"+$j);
       parent ($qvxian_A+"_loc_B_"+$j)  ($qvxian_A+"_loc_A_"+$j);
       
       select -r ($qvxian_A+"_loc_B_"+$j);
       group -n  ($qvxian_A+"_locgrp_"+$j);
       group -n  ($qvxian_A+"_locgrp_A"+$j);
       group -n  ($qvxian_A+"_locgrp_B"+$j);
       //parent  ($qvxian_A+"_locgrp_B"+$j) ($qvxian_A+"_loc_A_"+$j);
       parent  ($qvxian_A+"_loc_A_"+$j) ($qvxian_A+"_locGrp");
       float $poslist[]= `xform -q -ws -t  $cvdian_bianliang`;
       setAttr -type float3 ($qvxian_A+"_gengsui_"+"nearestPointOnCurve"+".inPosition") $poslist[0] $poslist[1] $poslist[2];
       float $poslist_A[]=`getAttr ($qvxian_A+"_gengsui_"+"nearestPointOnCurve"+".position")`;
      xform -ws -t    $poslist_A[0] $poslist_A[1] $poslist_A[2] ($qvxian_A+"_loc_A_"+$j);//定位器1的位置
       xform -ws -t  $poslist[0] $poslist[1] $poslist[2]($qvxian_A+"_loc_B_"+$j) ;//定位器1的位置
       string $loc_shp[]=`listRelatives -s ($qvxian_A+"_loc_B_"+$j)`;
       connectAttr -f ($loc_shp[0]+".worldPosition[0]") ($qvxian_shp[0]+".controlPoints["+$j+"]");
     }
     
     delete  ($qvxian_A+"_gengsui_"+"nearestPointOnCurve");
}


}



////////////////////////////曲线控制器定位器//////////////////////////////////////////

global proc  zxb_dingweiqi_gensuiqvxian_A(string$qvxian,string$qianzui)
{
//string $bianliang[]=`ls -sl`;//选中另外4条曲线
string $bianliang_sss=$qvxian;
string $bianliang[]= stringToStringArray($bianliang_sss, " ");//字符串转化数组
string $qianzui=$qianzui;

string$qvxianzu="zxb_"+$qianzui+"_curve_open_close_grp";

zxb_ADD_kongzu_proc($qvxianzu);
parent $qvxianzu "Eye_all_grp";
 int $panduan_A=`objExists ("temp_qvxian_nearestPointOnCurve")`;//查询这个物体是否纯在
 if($panduan_A==1){delete ("temp_qvxian_nearestPointOnCurve"); }
createNode nearestPointOnCurve -n  ("temp_qvxian_nearestPointOnCurve");//创建曲线最近点节点

for($i=0;$i<size($bianliang);$i++) 
{
    string $qvxian=$bianliang[$i]; 
     string $qvxian_shp[]=`listRelatives -s $qvxian`;
     connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ("temp_qvxian_nearestPointOnCurve.inputCurve") ;
    
 
    
     int $panduan=`objExists ($qvxian+"_B_Grp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian+"_B_Grp");
        }
    
     select -cl  ;
     group -empty -n ($qvxian+"_B_Grp");
     setAttr ($qvxian+"_B_Grp.visibility") 0;
     setAttr -lock true ($qvxian+"_B_Grp"+".v");
     parent ($qvxian+"_B_Grp") $qvxianzu; 
     
    int $panduan=`objExists ($qvxian+"_A_Grp")`;//查询这个物体是否纯在
    if($panduan==1)
        {
         delete ($qvxian+"_A_Grp");
        }
     select -cl  ;
     group -empty -n ($qvxian+"_A_Grp");
     setAttr ($qvxian+"_A_Grp.visibility") 0;
     setAttr -lock true ($qvxian+"_A_Grp"+".v");
    parent ($qvxian+"_A_Grp") $qvxianzu; 
   select -r ($qvxian+".cv[0:99999999999]");
    string $cvs[]=`ls -sl -fl`;
    
  global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("创建定位器...") -bp -ii 1 -min 0 -max `size($cvs)` $gMainProgressBar;
    for($j=0;$j<size($cvs);$j++) 
    {
         if(`progressBar -q -ic $gMainProgressBar`)
         break;
         progressBar -e -s 1 $gMainProgressBar;
         string $cv_dian=$cvs[$j];
        spaceLocator -p 0 0 0 -n ($qvxian+"_loc_A_"+$j);
        spaceLocator -p 0 0 0 -n ($qvxian+"_loc_B_"+$j);
        parent ($qvxian+"_loc_B_"+$j) ($qvxian+"_B_Grp");
        parent ($qvxian+"_loc_A_"+$j)  ($qvxian+"_A_Grp");
        float $pos_a[]=`xform -q -ws -t $cvs[$j]`;
        setAttr  -type float3 ("temp_qvxian_nearestPointOnCurve.inPosition")  $pos_a[0] $pos_a[1] $pos_a[2];
         addAttr -ln ("canshu")  -at double   -dv 0 -k  1 ($qvxian+"_loc_A_"+$j);//添加属性
        float $canshu=`getAttr "temp_qvxian_nearestPointOnCurve.parameter"`;
        setAttr  ($qvxian+"_loc_A_"+$j+".canshu") $canshu;
        setAttr -lock true ($qvxian+"_loc_A_"+$j+".canshu");
        
         int $panduan_A=`objExists ($qvxian+"_pointOnCurveInfo_loc_"+$j)`;//查询这个物体是否纯在
         if($panduan_A==1){delete ($qvxian+"_pointOnCurveInfo_loc_"+$j); }
        createNode "pointOnCurveInfo" -n ($qvxian+"_pointOnCurveInfo_loc_"+$j);//创建曲线信息节点
        connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".inputCurve");
        connectAttr -force ($qvxian+"_loc_A_"+$j+".canshu") ($qvxian+"_pointOnCurveInfo_loc_"+$j+".parameter");
        connectAttr -force ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position") ($qvxian+"_loc_A_"+$j+".t");
        
        float $pos_c[]=`getAttr ($qvxian+"_pointOnCurveInfo_loc_"+$j+".position")`;
         setAttr -type float3 ($qvxian+"_loc_B_"+$j+".t") $pos_c[0] $pos_c[1] $pos_c[2];
     }
     progressBar -e -ep $gMainProgressBar;
    
}
delete ("temp_qvxian_nearestPointOnCurve");



}



///////////////////////创建拉链效果/////////////////////////
global proc zxb_global_lalian_a(string$open_A,string$close_B,string$follow_D,string$qianzui){

//string $bianliang[]=`ls -sl`;//选中默认曲线

string $openA_sss=$open_A;
string $openAs[]= stringToStringArray($openA_sss, " ");//字符串转化数组

string $close_sss=$close_B;
string $close_Bs[]= stringToStringArray($close_sss, " ");//字符串转化数组

 string $follow_sss=$follow_D;
string$follow_Ds[]= stringToStringArray($follow_sss, " ");//字符串转化数组

 string $qianzui_sss=$qianzui;
 string$qianzui_a[];
  clear $qianzui_a;
  int $nemt=`tokenize $qianzui_sss" " $qianzui_a`;//分离字符串存到变量
  string$qianzui=$qianzui_a[0];

string $bianliang[]=$close_Bs;
 int $fanxiang_a=`checkBox -q  -value fanxuan`;
 int $panduan_a=`objExists ($bianliang[0]+"_curveInfo")`;
 if($panduan_a==1){delete ($bianliang[0]+"_curveInfo");}
shadingNode -asUtility curveInfo -n ($bianliang[0]+"_curveInfo");

string $qvxian_shp[]=`listRelatives -c ($bianliang[0])`;
connectAttr -force ($qvxian_shp[0]+".worldSpace[0]") ($bianliang[0]+"_curveInfo.inputCurve");

 int $panduan=`objExists ($bianliang[0]+".changdu")`;
if($panduan==0){addAttr -ln "changdu"  -at double  -dv 0 -k 1($bianliang[0]);}
setAttr -lock 0  ($bianliang[0]+".changdu");
connectAttr -force  ($bianliang[0]+"_curveInfo.arcLength") ($bianliang[0]+".changdu");
setAttr -lock 1  ($bianliang[0]+".changdu");


select -r  ($bianliang[0]+".cv[0:9999999999]") ;
string $qvxian_dian[]=`ls -sl -fl`;
int $qvxian_size=size($qvxian_dian);
float $pos_A[]=`xform -q -ws -t ($bianliang[0]+".cv[0]")`;
float $pos_B[]=`xform -q -ws -t ($bianliang[0]+".cv["+($qvxian_size-1)+"]")`;
float $pos_l_panduan[]=$pos_A;
float $pos_r_panduan[]=$pos_B;
if ( $pos_r_panduan[0]>$pos_l_panduan[0])
{
     $pos_l_panduan=$pos_B;
     $pos_r_panduan=$pos_A;
}

string$zuiba_loc_L=($bianliang[0]+"LL_ZUIBA_LOC");
string$zuiba_loc_R=($bianliang[0]+"RR_ZUIBA_LOC");

string$temp_RR_LL="";


string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
spaceLocator -p 0 0 0 -n $zuiba_loc_L;
spaceLocator -p 0 0 0 -n $zuiba_loc_R;
string$qvxianfu_temp[]=`listRelatives -p $openAs[0] `;
parent $zuiba_loc_L $qvxianfu_temp[0];
parent $zuiba_loc_R $qvxianfu_temp[0];
xform  -ws -t  $pos_l_panduan[0]  $pos_l_panduan[1]  $pos_l_panduan[2] $zuiba_loc_L;
xform  -ws -t  $pos_r_panduan[0]  $pos_r_panduan[1]  $pos_r_panduan[2] $zuiba_loc_R;


 int $panduan_b=`objExists ($zuiba_loc_L+".shuaijian")`;
 float $changdu=`getAttr ($bianliang[0]+".changdu")`;
 float $changduzhi= $changdu/5.0;
if($panduan_b==0)
{
addAttr -ln "shuaijian"  -at double  -dv $changduzhi -k 1 ($zuiba_loc_L);
setAttr -keyable false -channelBox true ($zuiba_loc_L+".shuaijian");
}

move -r  ($changduzhi*1.25) 0 0 ($zuiba_loc_L) ;
move -r  ($changduzhi*-1.25) 0 0 ($zuiba_loc_R) ;

string$eye_loc_all_temp=$zuiba_loc_R+" "+$zuiba_loc_L;
float $pos_A_temp[]=`xform -q -ws -t $zuiba_loc_R`;
if($pos_A_temp[0]>0){$temp_RR_LL="L";}else{$temp_RR_LL="R";}
string$qvxian_name="eye_lalianloc_"+$temp_RR_LL;

zxb_ADD_shuxing_string_proc($Controller,$qvxian_name);
setAttr -type "string" ($Controller+"."+$qvxian_name) $eye_loc_all_temp ;
for($j=0;$j<size($bianliang);$j++)
{
for($i=0;$i<size($qvxian_dian);$i++)
 {
     
     string $qvxian_B=$close_Bs[$j];
     string$qvxian_A= $openAs[$j];
     string$qvxian_D=$follow_Ds[$j];
     
     string$qvxian_loc=($qvxian_B+"_loc_A_"+$i);
     string$qvxian_locA=($qvxian_A+"_loc_A_"+$i);
     string$qvxian_locD=($qvxian_D+"_loc_A_"+$i);
    
         select -r $qvxian_loc ;
         select -add $qvxian_locA ;
         select -add $qvxian_locD;
     string $dianyuesu_bianliang[]=`pointConstraint`;
     
     
      int $panduan_C=`objExists ($qvxian_B+"_plusMinusAverage_L_"+$i)`;
      if($panduan_C==1){delete ($qvxian_B+"_plusMinusAverage_L_"+$i); }
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_L_"+$i);//创建加减节点
     connectAttr -force  ($zuiba_loc_L+".tx") ($qvxian_B+"_plusMinusAverage_L_"+$i+".input1D[0]");
     connectAttr -force  ($qvxian_locA+".tx") ($qvxian_B+"_plusMinusAverage_L_"+$i+".input1D[1]");
     setAttr ($qvxian_B+"_plusMinusAverage_L_"+$i+".operation") 2;
      
      int $panduan_F=`objExists ($qvxian_B+"setRange_A_"+$i)`;
      if($panduan_F==1){delete ($qvxian_B+"setRange_A_"+$i); }
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_A_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_A_"+$i+".maxX") 1;
     connectAttr -f ($zuiba_loc_L+".shuaijian")($qvxian_B+"setRange_A_"+$i+".oldMaxX");
     connectAttr -f ($qvxian_B+"_plusMinusAverage_L_"+$i+".output1D") ($qvxian_B+"setRange_A_"+$i+".valueX");
     
      
     int $panduan_D=`objExists ($qvxian_B+"_plusMinusAverage_R_"+$i)`;
     if($panduan_D==1){delete ($qvxian_B+"_plusMinusAverage_R_"+$i); }
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_R_"+$i);//创建加减节点
     connectAttr -force  ($zuiba_loc_R+".tx") ($qvxian_B+"_plusMinusAverage_R_"+$i+".input1D[1]");//中间减→→右边 右边数值是负数
     connectAttr -force  ($qvxian_locA+".tx") ($qvxian_B+"_plusMinusAverage_R_"+$i+".input1D[0]");
     setAttr ($qvxian_B+"_plusMinusAverage_R_"+$i+".operation") 2;
     
      int $panduan_F=`objExists ($qvxian_B+"setRange_B_"+$i)`;
      if($panduan_F==1){delete ($qvxian_B+"setRange_B_"+$i); }
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_B_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_B_"+$i+".maxX") 1;
     connectAttr -f ($zuiba_loc_L+".shuaijian")($qvxian_B+"setRange_B_"+$i+".oldMaxX");
     connectAttr -f ($qvxian_B+"_plusMinusAverage_R_"+$i+".output1D") ($qvxian_B+"setRange_B_"+$i+".valueX");
     
     
     int $panduan_E=`objExists ($qvxian_B+"_plusMinusAverage_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"_plusMinusAverage_M_"+$i);}
     shadingNode -asUtility plusMinusAverage -n ($qvxian_B+"_plusMinusAverage_M_"+$i);//创建加减节点
     setAttr ($qvxian_B+"_plusMinusAverage_M_"+$i+".operation") 2;
     setAttr ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[0]") 2;
     connectAttr -f ($qvxian_B+"setRange_A_"+$i+".outValueX")  ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[1]");
     connectAttr -f ($qvxian_B+"setRange_B_"+$i+".outValueX")  ($qvxian_B+"_plusMinusAverage_M_"+$i+".input1D[2]");



     int $panduan_E=`objExists ($qvxian_B+"setRange_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"setRange_M_"+$i);}
     shadingNode -asUtility  setRange -n ($qvxian_B+"setRange_M_"+$i);//创建范围节点
     setAttr ($qvxian_B+"setRange_M_"+$i+".maxX") 1;
     setAttr ($qvxian_B+"setRange_M_"+$i+".oldMaxX") 1;
     connectAttr -f ($qvxian_B+"_plusMinusAverage_M_"+$i+".output1D") ($qvxian_B+"setRange_M_"+$i+".valueX");
     
     
      int $panduan_E=`objExists ($qvxian_B+"reverse_M_"+$i)`;
     if( $panduan_E==1){delete ($qvxian_B+"reverse_M_"+$i);}
     shadingNode -asUtility reverse -n($qvxian_B+"reverse_M_"+$i); //创建反向节点
     connectAttr -f ($qvxian_B+"setRange_M_"+$i+".outValueX") ($qvxian_B+"reverse_M_"+$i+".inputX");
     if($fanxiang_a==1)
        {
         connectAttr -f  ($qvxian_B+"setRange_M_"+$i+".outValueX") ($dianyuesu_bianliang[0]+"."+$qvxian_loc+"W0")  ;
          connectAttr -f  ($qvxian_B+"reverse_M_"+$i+".outputX") ($dianyuesu_bianliang[0]+"."+$qvxian_locA+"W1") ;
         }
        else{
          connectAttr -f  ($qvxian_B+"reverse_M_"+$i+".outputX") ($dianyuesu_bianliang[0]+"."+$qvxian_loc+"W0")  ;
          connectAttr -f   ($qvxian_B+"setRange_M_"+$i+".outValueX")($dianyuesu_bianliang[0]+"."+$qvxian_locA+"W1") ;
           }
        
 }
 
}
 
 
 
}
 


/////////////////////////////////设置嘴巴波浪///////////////////////////
global proc zxb_bolangzui_a(string$qvxian_sss)
{

string $qvxian_temp_D[]= stringToStringArray($qvxian_sss, " ");//字符串转化数组
string $bianliang[]= $qvxian_temp_D;//选中曲线D  



for($i=0;$i<size($bianliang);$i++)
{
   string $qvxian_D=$bianliang[$i];
   select -r $qvxian_D;
  duplicate -rr -n ($qvxian_D+"_bolang");
    string $grpchids[]=`listRelatives -c ($qvxian_D+"_locGrp")`;
    
    int $panduan=`objExists ($qvxian_D+"_bolanggrp") `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp");
        setAttr ($qvxian_D+"_bolanggrp.visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp.v");
        parent   ($qvxian_D+"_bolanggrp") "Eye_all_grp" ;
        
     }
     
     string$boliang=($bianliang[0]+"_bolang_all");
     
    int $panduan=`objExists $boliang `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n $boliang ;
       setAttr ($boliang+".visibility") 0;
       setAttr -lock true -keyable false -channelBox false ($boliang+".v");
       string$fuwuti_yemp[]=` listRelatives -p $qvxian_D`;
        setAttr -lock true -keyable false -channelBox false ($boliang+".v");
        parent   $boliang "Face_zipper_Group";
     
     }
     
     
     /////////////////////////复制曲线D的定位器   属性控制拉链嘴的组//////////////////////////////
   string $objloc_d[];//定义定位器的所有物体  复制出来的定位器的名字
   clear $objloc_d;
   for($j=0;$j<size($grpchids);$j++)
   {
     string $qvxian_D_locA= $grpchids[$j];
     string $loc_chids[]=`listRelatives -c  -type "transform" $qvxian_D_locA`;
     string $obj="";

     for($ii=0;$ii<size($loc_chids);$ii++)
       {
       int $panduan=`objExists ($loc_chids[$ii]+".offsetZ")`;
       if ($panduan==0){$obj=$loc_chids[$ii];}
       }
     select -r $obj ;
     duplicate -rr -n ($obj+"_bolang");
     parent ($obj+"_bolang") ($qvxian_D+"_bolanggrp");
     string $zu_zi[]=`listRelatives -c -ad  -type  "transform" -fullPath ($obj+"_bolang")`;
     string $zu_zi_A[]=`listRelatives -c -ad  -type  "transform" ($obj+"_bolang")`;
     string $bolangloc="";

     for($iii=0;$iii<size($zu_zi);$iii++)////重命名
      {
          string $ziwuti=$zu_zi[$iii];
          //select -r $ziwuti;
          rename  $ziwuti ($zu_zi_A[$iii]+"_bolang");
          string$loc_shap[]=`listRelatives -s ($zu_zi_A[$iii]+"_bolang")`;
          if($loc_shap[0]==""&&$iii==0){ delete($zu_zi_A[$iii]+"_bolang");}
          if($loc_shap[0]!="")
            {
             string$tepe_B=`nodeType $loc_shap[0]`;
            if($tepe_B=="locator"){$bolangloc=($zu_zi_A[$iii]+"_bolang");}
             }

         
         
        
    
       }
      string $loc_zu[]=`listRelatives -c  -type  "transform"  $obj`;
      string $lalian_loczu=$loc_zu[0];

     connectAttr -f ($bolangloc+".t") ($lalian_loczu+".t");
     select -r $bolangloc;

     $objloc_d[$j] = $bolangloc;//把定位器的名称保存到变量里   复制出来的定位器的名字
   }
  ///////////////////创建曲线///////////////////
   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $kaishi_pos_B[]=`xform -q -ws -t  ($qvxian_D+".cv[+"+size($grpchids)+"]")`;
    int $panduan=`objExists ($qvxian_D+"_bolang")`;
    if($panduan==1){ delete ($qvxian_D+"_bolang");}
    
  curve -d 1 -p $kaishi_pos_A[0] $kaishi_pos_A[1] $kaishi_pos_A[2] -p $kaishi_pos_B[0] $kaishi_pos_B[1] $kaishi_pos_B[2] -n($qvxian_D+"_bolang"); //创建曲线
  setAttr ($qvxian_D+"_bolang.visibility") 0;
  setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang.v");
  rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s 2 -d 3 -tol 0.01 ($qvxian_D+"_bolang");//重建曲线
  /////////////创建曲线信息节点///////////////////////////
     int $panduan=`objExists ($qvxian_D+"qvxianzuijingdianjiedian")`;
     if($panduan==1){ delete ($qvxian_D+"qvxianzuijingdianjiedian");}
   createNode nearestPointOnCurve -n ($qvxian_D+"qvxianzuijingdianjiedian");//创建曲线最近点节点
   string $qvxian_D_shp[]=`listRelatives -s $qvxian_D`;
   connectAttr -force ($qvxian_D_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点

    
    /////////////////判断是否翻转曲线起始点/////////////////
    
    float $dian_temp_kaishi[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[0]")`;
    float $dian_temp_jiesu[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[4]")`;
    float $dian_temp_kaishi_A[]=`xform -q -ws -t ($qvxian_D+".cv[0]")`;
    float$dis=mag(<<$dian_temp_kaishi[0],$dian_temp_kaishi[1],$dian_temp_kaishi[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);
    float$dis_a=mag(<<$dian_temp_jiesu[0],$dian_temp_jiesu[1],$dian_temp_jiesu[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);

    if($dis>$dis_a){reverseCurve -ch 0 -rpo 1 ($qvxian_D+"_bolang");}
    parent ($qvxian_D+"_bolang") $boliang;
    
    //////////////////创建蔟//////////////
    int $cv_size=5;
    for($a=0;$a<$cv_size;$a++)//创建蔟
     {
      select -r ($qvxian_D+"_bolang.cv["+$a+"]"); 
       
     CreateCluster ;
     rename ($qvxian_D+"_bolang_cu_"+$a);
     spaceLocator -p 0 0 0 -n ($qvxian_D+"_bolang_cu_loc_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_D_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_C_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_B_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_A_"+$a);
     setAttr ($qvxian_D+"_bolang_cu_grp_A_"+$a+".visibility") 0;
     setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang_cu_grp_A_"+$a+".v");
     delete`pointConstraint  ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_grp_A_"+$a)`;
     parent ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_loc_"+$a);
     parent ($qvxian_D+"_bolang_cu_grp_A_"+$a) $boliang;
      }
     
     ///////////////////////蔟控制复制出来定位器//////////////////////////////
     
     
      int $panduan_A=`objExists ($qvxian_D+"_bolanggrp"+"_A")`;
      if ($panduan_A==0)
      { select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp"+"_A");
        setAttr ($qvxian_D+"_bolanggrp"+"_A"+".visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp"+"_A"+".v");
         string$fuwuti_yemp[]=` listRelatives -p $qvxian_D`;
        parent ($qvxian_D+"_bolanggrp"+"_A")  $fuwuti_yemp[0];
       }
    string $qvxian_D_boliang_shp[]=`listRelatives -s ($qvxian_D+"_bolang")`;
   connectAttr -force ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点
   for($aa=0;$aa<size($objloc_d);$aa++)
   {
        string $loc_d=$objloc_d[$aa];
        float $pos[]=`xform -q -ws -t $loc_d`;
       setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $pos[0] $pos[1] $pos[2];
      float $weozh=`getAttr  ($qvxian_D+"qvxianzuijingdianjiedian.parameter")`;
      
      int $panduan_l=`objExists ($loc_d+"_pointOnCurveInfo_"+$aa)`;
      if($panduan_l==1){delete ($loc_d+"_pointOnCurveInfo_"+$aa); }
     createNode "pointOnCurveInfo" -n ($loc_d+"_pointOnCurveInfo_"+$aa);//创建曲线最近点节点
     connectAttr -force  ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($loc_d+"_pointOnCurveInfo_"+$aa+".inputCurve");
     setAttr ($loc_d+"_pointOnCurveInfo_"+$aa+".parameter") $weozh;
     
     spaceLocator -p 0 0 0 -n ( $loc_d+"_A_loc_"+$a);
     connectAttr -force ($loc_d+"_pointOnCurveInfo_"+$aa+".position") ( $loc_d+"_A_loc_"+$a+".t");
     parent ( $loc_d+"_A_loc_"+$a) ($qvxian_D+"_bolanggrp"+"_A");
     pointConstraint -mo ( $loc_d+"_A_loc_"+$a)   $loc_d;
   }
  
   delete  ($qvxian_D+"qvxianzuijingdianjiedian");
   parent ($qvxian_D+"_bolanggrp"+"_A") $boliang;
   
   ///////////////////创建控制器////////////////////////
   
   string $qvxianname=($qvxian_D+"UP_bolangqvxian");
   if($i==1){$qvxianname=($qvxian_D+"DN_bolangqvxian");}
       string$head_Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
   zxb_ADD_shuxing_string_proc($head_Controller,"boliang_controller");
    string$all_boliang_controller_temp=`getAttr ($head_Controller+".boliang_controller")`;
   string$all_Controller=$qvxianname+" ";
   if($all_boliang_controller_temp=="")
     { 
     setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
    
    }
   else
   {
       
   $all_Controller=$all_boliang_controller_temp+" "+$all_Controller;
   setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
   }
  
   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $qvxian_MM_pos[]=`xform -q -ws -t  ($qvxian_D+"_bolang.cv[2]")`;
   float $rsd= `abs($kaishi_pos_A[0]*0.2)`;
  circle -c 0 0 0 -nr 0 1 0 -sw 360 -r $rsd -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $qvxianname; 
  group -n ($qvxianname+"_grp_B");
  group -n ($qvxianname+"_grp_A");
  string$fuwuti_yemp[]=` listRelatives -p $qvxian_D`;
  parent ($qvxianname+"_grp_A") $fuwuti_yemp[0] ;
  select -r  ($qvxianname+".cv[0]") ($qvxianname+".cv[2]") ($qvxianname+".cv[4]") ($qvxianname+".cv[6]") ;
  scale -r -p 0cm 0cm 0cm 0.417937 0.417937 0.417937 ;
  if($i==0)
  {  
  move -r -os -wd 0 ($rsd*0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*0.5) ($rsd*1.5) ;
  }else
  {
  move -r -os -wd 0 ($rsd*-0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*-0.5) ($rsd*1.5) ;
  }
 
  xform  -ws -t $qvxian_MM_pos[0] $qvxian_MM_pos[1] $qvxian_MM_pos[2]($qvxianname+"_grp_A");
  
  string $shape[]=`listRelatives -s $qvxianname`;
    setAttr ($shape[0]+".overrideEnabled") 1;
    setAttr ($shape[0]+".overrideColor") 16;
  //parent   ($qvxianname+"_grp_A") $boliang;
    
    
    ////////////////////表达式//////////////////////////
   
    float $rsd= ($kaishi_pos_A[0]*0.35);
    float$aaaa= `abs ($rsd)`;
     float $temp=$aaaa;
    addAttr -ln "upty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "dnty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "pianyi"  -at double  -dv 0 -k 1 $qvxianname;
    addAttr -ln "upsl"  -at double  -dv $temp -k 1 $qvxianname;
    addAttr -ln "dntsl"  -at double  -dv ($temp*-1) -k 1 $qvxianname;
    setAttr -keyable false -channelBox true ($qvxianname+".upsl");
    setAttr -keyable false -channelBox true ($qvxianname+".dntsl");
    string $grp_C1=($qvxian_D+"_bolang_cu_grp_C_1");
    string $grp_C2=($qvxian_D+"_bolang_cu_grp_C_2");
    string $grp_C3=($qvxian_D+"_bolang_cu_grp_C_3");
    string $grp_B1=($qvxian_D+"_bolang_cu_grp_B_1");
    string $grp_B2=($qvxian_D+"_bolang_cu_grp_B_2");
    string $grp_B3=($qvxian_D+"_bolang_cu_grp_B_3");
    float $temp_[]=`xform -q -ws -t  $grp_C2`;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B3+".scalePivot") ($grp_B3+".rotatePivot") ;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B1+".scalePivot") ($grp_B1+".rotatePivot") ;
    string $exp="";
    $exp+=($grp_C1+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6+"+$qvxianname+".tx));\n");
    $exp+=($grp_C3+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6-"+$qvxianname+".tx));\n");
    $exp+=($grp_C2+".ty=("+$grp_C1+".ty+"+$grp_C3+".ty);\n");
    $exp+=($grp_C1+".tz="+$grp_C3+".tz=("+$qvxianname+".tz*0.5);\n");
    $exp+=($grp_B2+".tz=("+$grp_B1+".tz+"+$grp_B3+".tz);\n");
    $exp+=($grp_B1+".sx="+$grp_B3+".sx=("+$qvxianname+".sx);\n");
    $exp+=($grp_C1+".tx="+$grp_C2+".tx="+$grp_C3+".tx="+$qvxianname+".pianyi*0.1;\n");
    $exp+=($grp_B3+".rx="+$grp_B1+".rx="+$qvxianname+".rx;\n");
    $exp+=($grp_B3+".ry="+$grp_B1+".ry="+$qvxianname+".ry;\n");
    $exp+=($grp_B3+".rz="+$grp_B1+".rz="+$qvxianname+".rz;\n");
int$panduan_biaodashi=`objExists ($qvxian_D+"_biaodashi")`;
if($panduan_biaodashi==1){delete ($qvxian_D+"_biaodashi") ;}
expression -s $exp  -o ($qvxian_D+"_biaodashi") -ae 1 -uc all ;

}
}




//////////////////////////////////眼皮碰撞/////////////////////////////////////////

global proc zxb_yanpi_pengzhuang_chengxu_proc(string$dd_qvxian_temp,string$eye_kongzhiqi_temp,string$all_bn_joints_temp,string$qvmianqiu_temp)
    {
/////////////////上蒙皮关节 对应下蒙皮带融合变形的曲线/////////////////////////////////////
      string$all_qvxian_string=$dd_qvxian_temp;//DD混合变形曲线
      string $qvxians[]=stringToStringArray($all_qvxian_string," ");
      string$qvxian=$qvxians[0];//带融合变形的曲线
      string$all_kongzhiqi_string=$eye_kongzhiqi_temp;//眼睛控制器  上曲线对应下骨骼
      string $kongzhiqis[]=stringToStringArray($all_kongzhiqi_string," ");
      string$kongzhqi=$kongzhiqis[0];//控制器名字
      string$all_gugebn_string=$all_bn_joints_temp;//所有骨骼
      string $gugebns[]=stringToStringArray($all_gugebn_string," ");//所有骨骼名字
      string$all_qvmian_string=$qvmianqiu_temp;//曲面球
      string $qvmians[]=stringToStringArray($all_qvmian_string," ");//曲面
      string$qvmian=$qvmians[0];
      
      string$fanweijiedian[]= `listConnections -d 1 -s 0 ($kongzhqi+".gensui")`;
      string$fanwei=$fanweijiedian[0];//找到到范围节点
     // select -r$fanxiang;
      string$fanxiangjiedian[]= `listConnections -d 1 -s 0 ($fanwei+".outValueX")`;
      string$fanxiang="";
      for($j=0;$j<size($fanxiangjiedian);$j++)
         {
             string$type=`nodeType $fanxiangjiedian[$j]`;
             if($type=="reverse"){$fanxiang=$fanxiangjiedian[$j];}
         }//找到反向节点
         
      string$fanweishuchu=($fanwei+".outValueX");
      string$fangxiangshuchu=($fanxiang+".outputX");
      
      
      string$qvxianxingxi=($qvxian+"_yanpi_pengzhuang_curveInfo");
      int$ex=`objExists $qvxianxingxi`;
      if($ex==1){delete $qvxianxingxi ;}
     shadingNode -asUtility curveInfo -n $qvxianxingxi; //创建曲线信息节点
     
     string$qvxian_shap[]=`listRelatives -s $qvxian`;
      string$qvxian_fuwuti_s[]=`listRelatives -p $qvxian`;
     string$qvxianshep=$qvxian_shap[0];
     connectAttr -force ($qvxianshep+".worldSpace[0]")  ($qvxianxingxi+".inputCurve");
     float$qvxianchangdu=`getAttr ($qvxianxingxi+".arcLength")`;//获得曲线长度
      
     
      
       for($i=0;$i<size($gugebns);$i++)
           {
              string$bn=$gugebns[$i];
              string$inpute_A[]=`listConnections -d 0 -s 1 ($bn+".tx")`;
              string$yuesu=$inpute_A[0];//找到约束
              string$locs[]=`listConnections -d 0 -s 1 ($yuesu+".target[0].targetTranslate")`;
              string$loc=$locs[0];//找到定位器
              delete$yuesu;//删除点约束约束
              string$bn_A=($bn+"fuzhi_AB");
              select -r $bn;
              duplicate -rr -n $bn_A;//复制关节
              string$bn_zi[]=`listRelatives -c -fullPath  $bn_A`;
              delete $bn_zi[0];//删除没有用的约束节点 
              setAttr ($bn_A+".visibility") 0;//隐藏复制出来的关节
              pointConstraint -mo $loc $bn_A;//定位器点约束复制出来的关节

           }
      
       for($i=0;$i<size($gugebns);$i++)
       {
         string$cbn=$gugebns[$i];
         string$Abn=($gugebns[$i]+"fuzhi_AB");//
         string$qvxian_A=($cbn+"_xiangjiao_"+$i);
         curve -d 1 -p 0 0 0 -p 0 ($qvxianchangdu*10) 0 -k 0 -k 1  -n $qvxian_A;
         select -r $qvxian_A;
         CenterPivot;//居中曲线坐标
         setAttr ($qvxian_A+".visibility") 0;//创建曲线
      
         delete`pointConstraint  $Abn $qvxian_A`;//曲线约束到关节
         parent $qvxian_A $Abn;//曲线P给关节
         string$qvxian_shap_c[]=`listRelatives -s $qvxian_A`;
         string$qvxian_shapc=$qvxian_shap_c[0];//刚创建的曲线型节点
         
         string$xiangjiao=($cbn+"_pengzhuang_curveIntersect"+$i);//创建曲线相交点节点
         int$ex=`objExists $xiangjiao`;
         if($ex==1){delete $xiangjiao ;}
         createNode "curveIntersect" -n $xiangjiao;//创建曲线相交节点
         connectAttr -force ($qvxianshep+".worldSpace[0]") ($xiangjiao+".inputCurve1");//链接曲线1
         connectAttr -force ($qvxian_shapc+".worldSpace[0]") ($xiangjiao+".inputCurve2");//链接曲线2
         setAttr ($xiangjiao+".useDirection") 1;
         setAttr -type float3 ($xiangjiao+".direction") 0 0 1;///设置
         
         string$loc=($cbn+"_pengzhuang_loc_gensui_"+$i);
         spaceLocator -p 0 0 0 -n $loc; //创建定位器  跟随曲线
         
         string$qvxianxingxi=($cbn+"_eye_pengzhuang_pointOnCurveInfo"+$i);
         int$ex=`objExists $qvxianxingxi`;
         if($ex==1){delete $qvxianxingxi ;}
         createNode "pointOnCurveInfo" -n $qvxianxingxi; //创建曲线信息节点
         connectAttr -force ($qvxianshep+".worldSpace[0]") ($qvxianxingxi+".inputCurve");//链接眼皮的曲线
         connectAttr -force  ($qvxianxingxi+".position") ($loc+".t");//控制定位器
         connectAttr -f ($xiangjiao+".parameter1[0]") ($qvxianxingxi+".parameter");

         string$loc_qvmian=($cbn+"_pengzhuang_loc_gensuiqvmian_"+$i);
         spaceLocator -p 0 0 0 -n $loc_qvmian; //创建第二个定位器  跟随曲面
         
         string$qvmian_shaps[]=`listRelatives -s $qvmian`;
         string$qvmian_shap=$qvmian_shaps[0];
         
         string$qvmianposjiedian=($cbn+"_pengzhuang_closestPointOnSurface_"+$i);
         int$ex=`objExists $qvmianposjiedian`;
         if($ex==1){delete $qvmianposjiedian ;}
         shadingNode -asUtility closestPointOnSurface -n $qvmianposjiedian;
         connectAttr -f  ($qvmian_shap+".worldSpace[0]") ($qvmianposjiedian+".inputSurface");
         connectAttr -f  ($loc+".t") ($qvmianposjiedian+".inPosition");//第一个定位器的位置信息输入到曲面上
         connectAttr -f  ($qvmianposjiedian+".position") ($loc_qvmian+".t") ;//第二个定位器跟随曲面
       

         string$loc_qiehuan=($cbn+"_pengzhuang_loc_gensuiqiehuan_"+$i);
         spaceLocator -p 0 0 0 -n $loc_qiehuan; //创建第三个定位器  切换定位器
         string$dianyuesu[]=`pointConstraint  $loc $loc_qvmian $loc_qiehuan`;
         connectAttr -f  $fanweishuchu ($dianyuesu[0]+"."+$loc+"W0") ;//第二个定位器跟随曲面
         connectAttr -f   $fangxiangshuchu  ($dianyuesu[0]+"."+$loc_qvmian+"W1") ;//第二个定位器跟随曲面
      
         string$loc_rootgrp=($qvxian+"eye_pengzhuang_grp_loc");
         int$ex=`objExists $loc_rootgrp`;
         if($ex==0)
            {
                select -cl ;
                group -empty -n $loc_rootgrp;
                setAttr ($loc_rootgrp+".visibility") 0;
                setAttr -lock true ($loc_rootgrp+".v"); //创建总组
                parent $loc_rootgrp $qvxian_fuwuti_s[0];
             }
         parent $loc $loc_qvmian $loc_qiehuan $loc_rootgrp;//定位器方到总组里面
         
         
         
       
         string$loc_juzhong=($cbn+"_pengzhuang_loc_juzhong_"+$i);
         string$loc_grp_a=($loc_juzhong+"_grp_A");
         spaceLocator -p 0 0 0 -n $loc_juzhong; //创建第四个个定位器  居中定位器
         group -n $loc_grp_a;
         
         string$yuesu_B[]=`pointConstraint $Abn $loc_qiehuan $loc_grp_a`;//复制出来的关节+切换定位器 约束第4个定位器
         
         
         setAttr ($yuesu_B[0]+"."+$loc_qiehuan+"W1") 0.5;
         setAttr ($yuesu_B[0]+"."+$Abn+"W0") 0.5;
         parent $loc_grp_a $loc_rootgrp ;
         
         string$yuesu_C[]=`pointConstraint $Abn $loc_juzhong $cbn`;//第四个定位器 跟AB关节点约束最终的关节
         
         
         
         string$loc_jshijie=($cbn+"_pengzhuang_loc_shijie_"+$i);//创建第5个定位器
         spaceLocator -p 0 0 0 -n $loc_jshijie;
         parent $loc_jshijie $loc_rootgrp;
         pointConstraint $Abn $loc_jshijie;
         
         string$upposloc=$loc_jshijie;
         string$dwposloc=$loc_qiehuan;
         
         float$ty_a= `getAttr ($loc_jshijie+".ty")`;
         float$ty_b= `getAttr ($loc_qiehuan+".ty")`;
         
         if($ty_a<$ty_b)
            {
             $upposloc=$loc_qiehuan;
             $dwposloc=$loc_jshijie;
             }
       // select -r $dwposloc;
        string$jianjian_A=($cbn+"_pengzhuang_plusMinusAverage"+$i);
       int$ex=`objExists $jianjian_A`;
       if($ex==1){delete $jianjian_A;}
       
      shadingNode -asUtility plusMinusAverage -n $jianjian_A;//创建加减节点
      connectAttr -f ($upposloc+".ty") ($jianjian_A+".input1D[0]");
      connectAttr -f ( $dwposloc+".ty") ($jianjian_A+".input1D[1]");
      setAttr ($jianjian_A+".operation") 2;
      addAttr -ln "zhi"  -at double  -dv 0 -k 1 $loc_juzhong;
      connectAttr -f ($jianjian_A+".output1D")  ($loc_juzhong+".zhi");
   
      string$tiaojianjiedian=($cbn+"_pengzhuang_condition"+$i);
       int$ex=`objExists $tiaojianjiedian`;
       if($ex==1){delete $tiaojianjiedian;}
      shadingNode -asUtility condition -n $tiaojianjiedian;//创建条件节点
      connectAttr -f ($jianjian_A+".output1D") ($tiaojianjiedian+".firstTerm");
      setAttr ($tiaojianjiedian+".operation") 2;
      setAttr ($tiaojianjiedian+".colorIfTrueR") 1;
      setAttr ($tiaojianjiedian+".colorIfFalseR") 0;
      
      
       string$fanxiangjiedian_a=($cbn+"_pengzhuang_reverse"+$i);//创建反向节点
       int$ex=`objExists $fanxiangjiedian_a`;
       if($ex==1){delete $fanxiangjiedian_a;}
       shadingNode -asUtility reverse -n $fanxiangjiedian_a;
       connectAttr -f ($tiaojianjiedian+".outColorR") ($fanxiangjiedian_a+".inputX");//条件节点连接到反向节点
       connectAttr -f   ($tiaojianjiedian+".outColorR") ($yuesu_C[0]+"."+$Abn+"W0");
       connectAttr -f   ($fanxiangjiedian_a+".outputX") ($yuesu_C[0]+"."+$loc_juzhong+"W1");
       
       string$upgensui=($kongzhqi+".upgensui");
       int$ex=`objExists $upgensui`;
       if($ex==0)
         {
           addAttr -ln "upgensui"  -at double  -dv 0 -k 1 $kongzhqi;
           setAttr -keyable false -channelBox true ($kongzhqi+".upgensui");

          }
          
       string$dwgensui=($kongzhqi+".dwgensui");
       int$ex=`objExists $dwgensui`;
       if($ex==0)
         {
           addAttr -ln "dwgensui"  -at double  -dv 0 -k 1 $kongzhqi;
           setAttr -keyable false -channelBox true ($kongzhqi+".dwgensui");

          }
      /* int$revDV=1;
       if($upposloc==$loc_jshijie){$revDV=-1;}*/
       
       string$upgensui=($kongzhqi+".upRev");
       int$ex=`objExists $upgensui`;
       if($ex==0)
         {
           addAttr -ln "upRev"  -at double -min -1 -max 1  -dv -1 -k 1 $kongzhqi;
           setAttr -keyable false -channelBox true ($kongzhqi+".upRev");

          }
          
        string$dwgensui=($kongzhqi+".dwRev");
       int$ex=`objExists $dwgensui`;
       if($ex==0)
         {
           addAttr -ln "dwRev"  -at double -min -1 -max 1  -dv 1 -k 1 $kongzhqi;
           setAttr -keyable false -channelBox true ($kongzhqi+".dwRev");

          }
          
       string$bngensui=($cbn+".bnRev");
       int$ex=`objExists $bngensui`;
       if($ex==0)
         {
           addAttr -ln "bnRev"  -at double   -dv 0 -k 1 $cbn;
           setAttr -keyable false -channelBox true ( $cbn+".bnRev");
          }
       
       
       string$jiuanjian_jiedian_A=($cbn+"_pengzhuang_plusMinusAverage_A_zonghe_"+$i);
       int$ex=`objExists $jiuanjian_jiedian_A`;
       if($ex==1){delete $jiuanjian_jiedian_A;}
       shadingNode -asUtility plusMinusAverage -n $jiuanjian_jiedian_A;//创建加减节点
       if($upposloc==$loc_jshijie)
          {
          connectAttr -f ($kongzhqi+".upgensui") ($jiuanjian_jiedian_A+".input1D[0]");
          }else
               { 
               connectAttr -f ($kongzhqi+".dwgensui") ($jiuanjian_jiedian_A+".input1D[0]");
               }
               
       connectAttr -f ( $cbn+".bnRev") ($jiuanjian_jiedian_A+".input1D[1]");
       
        string$chengchu_A=($cbn+"_pengzhuang_multiplyDivide_pianyi_"+$i);
       int$ex=`objExists $chengchu_A`;
       if($ex==1){delete $chengchu_A;}
       shadingNode -asUtility multiplyDivide -n $chengchu_A;//创建乘除节点    
       connectAttr -f ($jiuanjian_jiedian_A+".output1D") ($chengchu_A+".input1X");
       if($upposloc==$loc_jshijie)
         {
         connectAttr -f ($kongzhqi+".upRev") ($chengchu_A+".input2X");

         }else
             {
                connectAttr -f ($kongzhqi+".dwRev") ($chengchu_A+".input2X"); 
              }
          
          
       connectAttr -f  ($chengchu_A+".outputX") ($loc_juzhong+".ty") ;
       
       
       string$jiajian_jiedian_B=($cbn+"_pengzhuang_plusMinusAverage_B_jiandiao_"+$i);
       int$ex=`objExists $jiajian_jiedian_B`;
       if($ex==1){delete $jiajian_jiedian_B;}
       shadingNode -asUtility plusMinusAverage -n $jiajian_jiedian_B;//创建加减节点
       
       string$chengchu_B=($cbn+"_pengzhuang_multiplyDivide_shuangbei_"+$i);
       int$ex=`objExists $chengchu_B`;
       if($ex==1){delete $chengchu_B;}
       shadingNode -asUtility multiplyDivide -n $chengchu_B;//创建乘除节点    
       
       connectAttr -f   ($jianjian_A+".output1D") ( $jiajian_jiedian_B+".input1D[0]");
       connectAttr -f  ($chengchu_A+".outputX")($chengchu_B+".input1X");
       setAttr ($chengchu_B+".input2X") 2;

       connectAttr -f  ($chengchu_B+".outputX")( $jiajian_jiedian_B+".input1D[1]");
       setAttr ($jiajian_jiedian_B+".operation") 2;
       connectAttr -f ($jiajian_jiedian_B+".output1D") ($tiaojianjiedian+".firstTerm");
       
       
 
       } 
       
  }    
    

////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////眼皮自动创建次级结束////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////






///////////////////////////////////////////////睫毛次级自动附着///////////////////////////////////////////////////////////////

global proc zxb_fuzhao_mode_proc()
{
 string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//
 string $UI_eye_L_lashss=`textFieldGrp -q -tx  UI_eye_all_lash`;//查询被附着的对象
 string$aill_bnss= `getAttr ($UI_head_controller+".eye_bn")`;
 string$aill_bns[]=stringToStringArray($aill_bnss," ");//关节名称
 string $UI_eye_L_lashs[]=stringToStringArray( $UI_eye_L_lashss," ");//被附着的对象模型

 string$eye_modes=`getAttr ($UI_head_controller+".base_bs_mode")`;
 string$eye_modess[]=stringToStringArray($eye_modes," ");//眼睛模型
 string$eye_mode=$eye_modess[5];
 for($i=0;$i<size($UI_eye_L_lashs);$i++)
    {
    string$temp_mode=$UI_eye_L_lashs[$i];
    select -r  $aill_bns;
    select -add  $temp_mode;
    newSkinCluster "-toSelectedBones -mi 1 -omi true -dr 6 -rui true"; 
    select -r  $temp_mode;
    select -add $eye_mode;
    CopySkinWeights;
    }
}

///////////////////////////////////睫毛碰撞///////////////////////////////////////////////////

global proc zxb_jiemao_ciji_kongzhiqi()
{
string$all_root_bn=`textFieldGrp -q -tx UI_jiemao_root_bn `;
 string $all_root_bns[]=stringToStringArray($all_root_bn," ");//被附着的对象模型
string $root_bns[]=$all_root_bns;//选择跟关节创建控制器
string$bns[]=`listRelatives -c  $root_bns[0]`;
float$banjin=0.05;
string$cbn_gra_root_grp=($root_bns[0]+"_GRP_root");
 int$ex=`objExists $cbn_gra_root_grp`;
if($ex==0){group -empty -n $cbn_gra_root_grp; }
 string $xiaba_head_con=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
 string$UV_mode=`getAttr  ($xiaba_head_con+".zxb_face_UV_mode")`;


string$grp_temp="";
for($i=0;$i<size($bns);$i++)
   {
       string$cbn=$bns[$i];
       string$bnss[]=`listRelatives -c  $cbn`;
       //float$tx=`getAttr ($bnss[0]+".tx")`;
       float$tx=$banjin;
       string$cbn_con=($cbn+"_kongzhi");
       string$cbn_gra_A=($cbn+"_GRP_A");
       string$cbn_gra_B=($cbn+"_GRP_B");
       string$cbn_gra_C=($cbn+"_GRP_C");
       $grp_temp+=$cbn_gra_C+" ";
       circle -c 0 0 0 -nr 1 0 0 -sw 360 -r $tx -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $cbn_con ;
       group -n $cbn_gra_A;
       group -n $cbn_gra_B;
       group -n $cbn_gra_C;
       select -r ($cbn_con+".cv[0:99999]");
       move -r -os -wd  $tx 0  0 ;
      
       parent $cbn_gra_C $cbn_gra_root_grp;
       delete`parentConstraint  $cbn $cbn_gra_C`;
       connectAttr -force  ($cbn_con+".r") ($cbn+".r");
       string $qvxianshap[]=`listRelatives -s  $cbn_con`;
       setAttr ($qvxianshap[0]+".overrideEnabled") 1;
       setAttr($qvxianshap[0]+".overrideColor") 18;
   }
   
string $all_zu_temp[]=stringToStringArray($grp_temp," ");


zxb_maonang_Follicle(1,$all_zu_temp,$UV_mode);//int 判断是否保持原位置  ,被控制物体，  模型或者曲面



}



//////////////////////////////////毛囊附着模型/////////////////////////////////////////////////////
global proc zxb_maonang_Follicle(int$weizhi,string$obj_all[],string$fuzhao_mode)//int 判断是否保持原位置  ,被控制物体，  模型或者曲面
{
int $stat=$weizhi;  
string $plane=$fuzhao_mode;
int $ex=`objExists $plane`;
if($ex==0)error "请载入附着模型";
string $sel[]=$obj_all;

string $bigManM= $plane;
string $shape[]=`listRelatives -s $bigManM`;

string $type=`objectType  $shape[0]`;
if($type!="mesh"&&$type!="nurbsSurface")error "需要多边形或者曲面作为固定的面";

int $exsit=`objExists ($bigManM+"follicleGrp")`;

if($exsit==0){
group -em -n ($bigManM+"follicleGrp");
}

for($i=0;$i<size($sel);$i++){
spaceLocator -p 0 0 0 -n ($sel[$i]+"Loc");

group -n ($sel[$i]+"LocGrp");

select -r ($sel[$i]);
select -add ($sel[$i]+"LocGrp");
delete `parentConstraint`;
select -r ($sel[$i]+"Loc");
select -add ($sel[$i]);
parentConstraint -mo;
string $shap[]=`listRelatives -s ($sel[$i]+"Loc")`;
setAttr ($shap[0]+".localScaleZ") 0.01;
setAttr ($shap[0]+".localScaleX") 0.01;
setAttr ($shap[0]+".localScaleY") 0.01;

float $pos[]=`xform -q -a -ws -t ($sel[$i]+"Loc")`;
string $type=`objectType  $shape[0]`;

////////////////////////
if($type=="mesh"){
createNode closestPointOnMesh -n ($sel[$i]+"cpom"+$i);
connectAttr -f ($bigManM+".outMesh") ($sel[$i]+"cpom"+$i+".inMesh");

setAttr ($sel[$i]+"cpom"+$i+".inPositionX") $pos[0] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionY") $pos[1] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionZ") $pos[2] ;
float $u=`getAttr ($sel[$i]+"cpom"+$i+".parameterU")`;
float $v=`getAttr ($sel[$i]+"cpom"+$i+".parameterV")`;

createNode follicle -n ($sel[$i]+"follicleShape"+$i);
select -r ($sel[$i]+"follicleShape"+$i);
pickWalk -d up;
rename ($sel[$i]+"follicle"+$i);
connectAttr -f ($bigManM+".outMesh") ($sel[$i]+"follicleShape"+$i+".inputMesh");
connectAttr -f ($bigManM+".worldMatrix[0]") ($sel[$i]+"follicleShape"+$i+".inputWorldMatrix");

connectAttr -f ($sel[$i]+"follicleShape"+$i+".outTranslate") ($sel[$i] +"follicle"+$i+".translate");
connectAttr -f ($sel[$i]+"follicleShape"+$i+".outRotate") ($sel[$i]+"follicle"+$i+".rotate");

setAttr  ($sel[$i]+"follicleShape"+$i+".parameterU") $u;
setAttr  ($sel[$i]+"follicleShape"+$i+".parameterV") $v;

select -r ($sel[$i]+"follicle"+$i);
select -add ($bigManM+"follicleGrp");
parent;
select -r ($sel[$i]+"cpom"+$i);
delete;
}
else
{
createNode closestPointOnSurface -n ($sel[$i]+"cpom"+$i);
string $shape[]=`listRelatives -s $bigManM`;
connectAttr -f ($shape[0]+".worldSpace") ($sel[$i]+"cpom"+$i+".inputSurface");

setAttr ($sel[$i]+"cpom"+$i+".inPositionX") $pos[0] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionY") $pos[1] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionZ") $pos[2] ;
float $u=`getAttr ($sel[$i]+"cpom"+$i+".parameterU")`;
float $v=`getAttr ($sel[$i]+"cpom"+$i+".parameterV")`;

createNode follicle -n ($sel[$i]+"follicleShape"+$i);
select -r ($sel[$i]+"follicleShape"+$i);
pickWalk -d up;
rename ($sel[$i]+"follicle"+$i);
connectAttr -f ($shape[0]+".local") ($sel[$i]+"follicleShape"+$i+".inputSurface");
connectAttr -f ($shape[0]+".worldMatrix[0]") ($sel[$i]+"follicleShape"+$i+".inputWorldMatrix");

connectAttr -f ($sel[$i]+"follicleShape"+$i+".outTranslate") ($sel[$i] +"follicle"+$i+".translate");
connectAttr -f ($sel[$i]+"follicleShape"+$i+".outRotate") ($sel[$i]+"follicle"+$i+".rotate");

setAttr  ($sel[$i]+"follicleShape"+$i+".parameterU") $u;
setAttr  ($sel[$i]+"follicleShape"+$i+".parameterV") $v;

select -r ($sel[$i]+"follicle"+$i);
select -add ($bigManM+"follicleGrp");
parent;
select -r ($sel[$i]+"cpom"+$i);
delete;

}
if($stat==0){
select -r ($sel[$i]+"follicle"+$i);
select -add ($sel[$i]+"LocGrp");
delete `pointConstraint`;

select -r ($sel[$i]+"LocGrp");
select -add ($sel[$i]+"follicle"+$i);
parent;
        }else{
    string $constraint[]=`listConnections -s 1 -d 0 ($sel[$i]+".tx")`;
    delete ($constraint[0]);
    select -r ($sel[$i]+"follicle"+$i);
    select -add ($sel[$i]+"LocGrp");
    delete `parentConstraint`;

    select -r ($sel[$i]+"LocGrp");
    select -add ($sel[$i]+"follicle"+$i);
    parent;
    float $pos[]=`getAttr ($sel[$i]+"follicle"+$i+".translate")`;
    move $pos[0] $pos[1] $pos[2]  ($sel[$i]+".scalePivot")  ($sel[$i]+".rotatePivot") ;
    select -r ($sel[$i]+"Loc");
    select -add ($sel[$i]);
    parentConstraint -mo;
        }
    }
}




//////////////////////////////////毛囊附着模型/////////////////////////////////////////////////////
global proc string zxb_maonang_Follicle_grp(int$weizhi,string$obj_all[],string$fuzhao_mode)//int 判断是否保持原位置  ,被控制物体，  模型或者曲面
{
int $stat=$weizhi;  
string $plane=$fuzhao_mode;
int $ex=`objExists $plane`;
if($ex==0)error "请载入附着模型";
string $sel[]=$obj_all;

string $bigManM= $plane;
string $shape[]=`listRelatives -s $bigManM`;

string $type=`objectType  $shape[0]`;
if($type!="mesh"&&$type!="nurbsSurface")error "需要多边形或者曲面作为固定的面";

int $exsit=`objExists ($bigManM+"follicleGrp")`;
string$temp_aa=($bigManM+"follicleGrp");
if($exsit==0){
group -em -n ($bigManM+"follicleGrp");
}

for($i=0;$i<size($sel);$i++){
spaceLocator -p 0 0 0 -n ($sel[$i]+"Loc");

group -n ($sel[$i]+"LocGrp");

select -r ($sel[$i]);
select -add ($sel[$i]+"LocGrp");
delete `parentConstraint`;
select -r ($sel[$i]+"Loc");
select -add ($sel[$i]);
parentConstraint -mo;
string $shap[]=`listRelatives -s ($sel[$i]+"Loc")`;
setAttr ($shap[0]+".localScaleZ") 0.01;
setAttr ($shap[0]+".localScaleX") 0.01;
setAttr ($shap[0]+".localScaleY") 0.01;

float $pos[]=`xform -q -a -ws -t ($sel[$i]+"Loc")`;
string $type=`objectType  $shape[0]`;

////////////////////////
if($type=="mesh"){
createNode closestPointOnMesh -n ($sel[$i]+"cpom"+$i);
connectAttr -f ($bigManM+".outMesh") ($sel[$i]+"cpom"+$i+".inMesh");

setAttr ($sel[$i]+"cpom"+$i+".inPositionX") $pos[0] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionY") $pos[1] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionZ") $pos[2] ;
float $u=`getAttr ($sel[$i]+"cpom"+$i+".parameterU")`;
float $v=`getAttr ($sel[$i]+"cpom"+$i+".parameterV")`;

createNode follicle -n ($sel[$i]+"follicleShape"+$i);
select -r ($sel[$i]+"follicleShape"+$i);
pickWalk -d up;
rename ($sel[$i]+"follicle"+$i);
connectAttr -f ($bigManM+".outMesh") ($sel[$i]+"follicleShape"+$i+".inputMesh");
connectAttr -f ($bigManM+".worldMatrix[0]") ($sel[$i]+"follicleShape"+$i+".inputWorldMatrix");

connectAttr -f ($sel[$i]+"follicleShape"+$i+".outTranslate") ($sel[$i] +"follicle"+$i+".translate");
connectAttr -f ($sel[$i]+"follicleShape"+$i+".outRotate") ($sel[$i]+"follicle"+$i+".rotate");

setAttr  ($sel[$i]+"follicleShape"+$i+".parameterU") $u;
setAttr  ($sel[$i]+"follicleShape"+$i+".parameterV") $v;

select -r ($sel[$i]+"follicle"+$i);
select -add ($bigManM+"follicleGrp");
parent;
select -r ($sel[$i]+"cpom"+$i);
delete;
}
else
{
createNode closestPointOnSurface -n ($sel[$i]+"cpom"+$i);
string $shape[]=`listRelatives -s $bigManM`;
connectAttr -f ($shape[0]+".worldSpace") ($sel[$i]+"cpom"+$i+".inputSurface");

setAttr ($sel[$i]+"cpom"+$i+".inPositionX") $pos[0] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionY") $pos[1] ;
setAttr ($sel[$i]+"cpom"+$i+".inPositionZ") $pos[2] ;
float $u=`getAttr ($sel[$i]+"cpom"+$i+".parameterU")`;
float $v=`getAttr ($sel[$i]+"cpom"+$i+".parameterV")`;

createNode follicle -n ($sel[$i]+"follicleShape"+$i);
select -r ($sel[$i]+"follicleShape"+$i);
pickWalk -d up;
rename ($sel[$i]+"follicle"+$i);
connectAttr -f ($shape[0]+".local") ($sel[$i]+"follicleShape"+$i+".inputSurface");
connectAttr -f ($shape[0]+".worldMatrix[0]") ($sel[$i]+"follicleShape"+$i+".inputWorldMatrix");

connectAttr -f ($sel[$i]+"follicleShape"+$i+".outTranslate") ($sel[$i] +"follicle"+$i+".translate");
connectAttr -f ($sel[$i]+"follicleShape"+$i+".outRotate") ($sel[$i]+"follicle"+$i+".rotate");

setAttr  ($sel[$i]+"follicleShape"+$i+".parameterU") $u;
setAttr  ($sel[$i]+"follicleShape"+$i+".parameterV") $v;

select -r ($sel[$i]+"follicle"+$i);
select -add ($bigManM+"follicleGrp");
parent;
select -r ($sel[$i]+"cpom"+$i);
delete;

}
if($stat==0){
select -r ($sel[$i]+"follicle"+$i);
select -add ($sel[$i]+"LocGrp");
delete `pointConstraint`;

select -r ($sel[$i]+"LocGrp");
select -add ($sel[$i]+"follicle"+$i);
parent;
        }else{
    string $constraint[]=`listConnections -s 1 -d 0 ($sel[$i]+".tx")`;
    delete ($constraint[0]);
    select -r ($sel[$i]+"follicle"+$i);
    select -add ($sel[$i]+"LocGrp");
    delete `parentConstraint`;

    select -r ($sel[$i]+"LocGrp");
    select -add ($sel[$i]+"follicle"+$i);
    parent;
    float $pos[]=`getAttr ($sel[$i]+"follicle"+$i+".translate")`;
    move $pos[0] $pos[1] $pos[2]  ($sel[$i]+".scalePivot")  ($sel[$i]+".rotatePivot") ;
    select -r ($sel[$i]+"Loc");
    select -add ($sel[$i]);
    parentConstraint -mo;
        }

    }
return $temp_aa;
}



/////////////////////////////////曲线跟随模型或者曲面//////////////////////////////////////////////////////////////
global proc zxb_mesh_nurbsSurface_to_obj_proc()
{
string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//
string$uv_mode=`getAttr ($UI_head_controller+".zxb_face_UV_mode")`;
string $UI_head_mode=$uv_mode;//
string $UI_head_bn=`textFieldGrp -q -tx  UI_head_bn`;//
string$headbn=$UI_head_bn;//载入头部关节 缩放毛囊需要用到

zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian");

string$pengzhuang_qvxian_ss[]={"UI_jiemao_pengzhuang_qvxian_up_L","UI_jiemao_pengzhuang_qvxian_dw_L","UI_jiemao_pengzhuang_qvxian_up_R","UI_jiemao_pengzhuang_qvxian_dw_R"};
string$qvxian_head_temp="";
string $temp_all_tex="";
for ($i=0;$i<size($pengzhuang_qvxian_ss);$i++)
    {
     string$UI_name=$pengzhuang_qvxian_ss[$i];
     string $temp_ui_tex=`textFieldGrp -q -tx $UI_name`;//
     $temp_all_tex+=$temp_ui_tex;
     }
string$qvxian_grp_s[]=stringToStringArray($temp_all_tex, " ");
for($iii=0;$iii<size($qvxian_grp_s);$iii++)
   {
    string$temp_qvxian=$qvxian_grp_s[$iii];
    int$ex=`objExists $temp_qvxian`;//判断曲线是否存在

    if($ex==1)//如果存在就执行内容
      {

       
     
      select -r $temp_qvxian;
      select -add $UI_head_mode;
      string $bianliang[]=`ls -sl`;//选择曲线  加选曲面
      
      ////////////判断曲面还是曲线//////////////////
      int$size=size($bianliang);
      if($size!=2){error "请选中一个曲线和一个曲面两个物体";}
      string$qvxian_temp="";
      string$qvmian_temp="";
      string$shape_a[]=`listRelatives -s $bianliang[0]`; 
      string$shape_b[]=`listRelatives -s $bianliang[1]`; 
      
      int$ex_a=`objExists $shape_a[0]`;
      if($ex_a==0){error "选中的第一个物体没有型节点";}
      int$ex_b=`objExists $shape_b[0]`;
      if($ex_b==0){error "选中的第二个物体没有型节点";}
      string$type_a=`nodeType $shape_a[0]`;
      if($type_a=="nurbsCurve")
        {
        $qvxian_temp=$bianliang[0];
        $qvmian_temp=$bianliang[1];
        }
     else
       {
        $qvxian_temp=$bianliang[1];
        $qvmian_temp=$bianliang[0];
       }

     select -r  $qvxian_temp;
     string$shape_b[]=`listRelatives -s $qvmian_temp`; 
     string$shape_mode=$shape_b[0];
     string$type_b=`nodeType $shape_b[0]`;
    if($type_b=="nurbsSurface")///
      {
       /////////////////////////////创建曲面信息节点/////////////////////////////////////////////////////
      string$qvmian_closestPointOnSurface=($qvxian_temp+"_closestPointOnSurface_yanpi");
      string$qvmian_shape[]=`listRelatives -s $qvmian_temp`; 
      string$qvmianshape=$qvmian_shape[0];
      int$panduan_B=`objExists $qvmian_closestPointOnSurface`;
      if($panduan_B==1){delete $qvmian_closestPointOnSurface;}
      shadingNode -asUtility closestPointOnSurface  -n $qvmian_closestPointOnSurface;
      connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_closestPointOnSurface+".inputSurface");

      /////////////选中曲线////////////////////////
      select -r ($qvxian_temp+".cv[0:999999999]");
      string $cvs[]=`ls -sl -fl`;
      for ($i=0;$i<size($cvs);$i++)
          {
           ////////////////////曲面最近点节点 赋值最近点节点////////////////////////////
           string$cv=$cvs[$i];
           string$qvmian_pointOnSurfaceInfo=($qvxian_temp+"_pointOnSurfaceInfo_yanpi"+$i);
           int$panduan_A=`objExists $qvmian_pointOnSurfaceInfo`;
           if($panduan_A==1){delete $qvmian_pointOnSurfaceInfo;}
           shadingNode -asUtility pointOnSurfaceInfo  -n $qvmian_pointOnSurfaceInfo;     
           float$pos_dia[]=`xform -q -ws -t $cv`;
           setAttr -type float3 ($qvmian_closestPointOnSurface+".inPosition") $pos_dia[0] $pos_dia[1] $pos_dia[2];
           float$U=`getAttr ($qvmian_closestPointOnSurface+".parameterU")`;
           float$V=`getAttr ($qvmian_closestPointOnSurface+".parameterV")`;
           setAttr ($qvmian_pointOnSurfaceInfo+".parameterU") $U;//获得U值
           setAttr ($qvmian_pointOnSurfaceInfo+".parameterV") $V;//获得V值
           connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_pointOnSurfaceInfo+".inputSurface");//连接曲面
   
           ///////////////////////////创建定位器连接到曲线上（定位器被曲面控制 定位器控制曲线）//////////////////////////////////////////////////
           string$zu_A=($qvxian_temp+"_eye_grp_loc");
           string$eye_loc=($qvxian_temp+"_eye_loc_"+$i);
           string$eye_loc_grp_a=($eye_loc+"_GRP_A");
           string$eye_loc_grp_b=($eye_loc+"_GRP_B");
           string$all_eye_jiemao_grp="all_eye_jiemao_grp";
           zxb_ADD_kongzu_proc($all_eye_jiemao_grp);
           string$mode_ex_grp[]=`listRelatives -p $all_eye_jiemao_grp`; 
           if($mode_ex_grp[0]!="Face_Group"){parent $all_eye_jiemao_grp "Face_Group";}
           string$ex_grps[]=`listRelatives -p $temp_qvxian`; 
           if($ex_grps[0]!=$all_eye_jiemao_grp){parent $temp_qvxian $all_eye_jiemao_grp;}
           int$panduan_A=`objExists $zu_A`;
           if($panduan_A==0)
             {
              select -cl  ;
              group -empty -n  $zu_A;
              setAttr ($zu_A+".visibility") 0;
              setAttr -lock true ($zu_A+".v");   
              string$qvmian_zu[]=`listRelatives -p $qvmian_temp`; 
              //int$panduan_A=`objExists $qvmian_zu[0]`;
              if($qvmian_zu[0]!=$all_eye_jiemao_grp){ parent $zu_A $all_eye_jiemao_grp;}
             }
          spaceLocator -p 0 0 0 -n $eye_loc;
          group -n $eye_loc_grp_a;
          group -n $eye_loc_grp_b;
          parent $eye_loc_grp_b $zu_A;
          scaleConstraint  $headbn $eye_loc_grp_b;//缩放约束
          connectAttr -f ($qvmian_pointOnSurfaceInfo+".position") ($eye_loc_grp_b+".t");//连接定位器  这个位置是曲面的位置  与曲线顶点的位置有偏移
          ///////////////////矫正偏移  保证定位器一点在曲线点上/////////////////////
          xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_a;
          string$loc_sheps[]=`listRelatives -s $eye_loc`; 
          string$loc_shep=$loc_sheps[0];
          connectAttr -f ($loc_shep+".worldPosition[0]")  ($qvxian_temp+".controlPoints["+$i+"]");//定位器控制曲线
          
          
           } 
        delete $qvmian_closestPointOnSurface;
     
     }
  
  
  
    if($type_b=="mesh")///如果是模型
      {
       /////////////////////////////创建曲面信息节点/////////////////////////////////////////////////////
       string$qvmian_closestPointOnSurface=($qvxian_temp+"_closestPointOnMesh_yanpi");
       string$qvmian_shape[]=`listRelatives -s $qvmian_temp`; 
       string$qvmianshape=$qvmian_shape[0];
       int$panduan_B=`objExists $qvmian_closestPointOnSurface`;
       if($panduan_B==1){delete $qvmian_closestPointOnSurface;}
       shadingNode -asUtility closestPointOnMesh  -n $qvmian_closestPointOnSurface;
       connectAttr -force ($qvmianshape+".worldMesh[0]") ($qvmian_closestPointOnSurface+".inMesh");
        /////////////选中曲线////////////////////////
      select -r ($qvxian_temp+".cv[0:999999999]");
      string $cvs[]=`ls -sl -fl`;
      for ($i=0;$i<size($cvs);$i++)
         {
         ////////////////////创建毛囊////////////////////////////
         string$cv=$cvs[$i];
         float$pos_dia[]=`xform -q -ws -t $cv`;
         string$maonang=($qvxian_temp+$i+"_gensuiShape");
         createNode "follicle" -n $maonang  ;//创建毛囊
         string$maonang_tt[]=`listRelatives -p $maonang`;
         string$maonang_t=$maonang_tt[0];
         connectAttr -f ($maonang+".outTranslate") ($maonang_t+".translate");
         connectAttr -f ($maonang+".outRotate") ($maonang_t+".rotate");
         setAttr -type float3 ($qvmian_closestPointOnSurface+".inPosition") $pos_dia[0] $pos_dia[1] $pos_dia[2];
         float$U=`getAttr ($qvmian_closestPointOnSurface+".parameterU")`;
         float$V=`getAttr ($qvmian_closestPointOnSurface+".parameterV")`;
         setAttr ($maonang+".parameterU") $U;
         setAttr ($maonang+".parameterV") $V;
         connectAttr -force ($shape_mode+".outMesh") ($maonang+".inputMesh");
         connectAttr -force ($shape_mode+".worldMatrix[0]") ($maonang+".inputWorldMatrix");
  
   
        ///////////////////////////创建定位器连接到曲线上（定位器被曲面控制 定位器控制曲线）//////////////////////////////////////////////////
        string$zu_A=($qvxian_temp+"_eye_grp_loc");
        string$eye_loc=($qvxian_temp+"_eye_loc_"+$i);
        string$eye_loc_grp_a=($eye_loc+"_GRP_A");
        string$eye_loc_grp_b=($eye_loc+"_GRP_B");
        string$all_eye_jiemao_grp="all_eye_jiemao_grp";
        zxb_ADD_kongzu_proc($all_eye_jiemao_grp);  
        string$mode_ex_grp[]=`listRelatives -p $all_eye_jiemao_grp`; 
        if($mode_ex_grp[0]!="Face_Group"){parent $all_eye_jiemao_grp "Face_Group";}
        string$ex_grps[]=`listRelatives -p $temp_qvxian`; 
       if($ex_grps[0]!=$all_eye_jiemao_grp){parent $temp_qvxian $all_eye_jiemao_grp;}
       int$panduan_A=`objExists $zu_A`;
      if($panduan_A==0)
        {
          select -cl  ;
          group -empty -n  $zu_A;
          setAttr ($zu_A+".visibility") 0; 
          setAttr -lock true ($zu_A+".v");  
          string$qvmian_zu[]=`listRelatives -p $qvmian_temp`; 
          if($qvmian_zu[0]!=$all_eye_jiemao_grp){ parent $zu_A $all_eye_jiemao_grp;} 
        }
      
      spaceLocator -p 0 0 0 -n $eye_loc;
      group -n $eye_loc_grp_a;
      group -n $eye_loc_grp_b;
      parent $eye_loc_grp_b $zu_A;
      delete`pointConstraint $maonang_t $eye_loc_grp_b`;
      parent $eye_loc_grp_b $maonang_t ;
      parent $maonang_t  $zu_A;
      scaleConstraint  $headbn $maonang_t;//缩放约束
      //connectAttr -f ($qvmian_pointOnSurfaceInfo+".position") ($eye_loc_grp_b+".t");//连接定位器  这个位置是曲面的位置  与曲线顶点的位置有偏移
      ///////////////////矫正偏移  保证定位器一点在曲线点上/////////////////////
      xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_a;
      string$loc_sheps[]=`listRelatives -s $eye_loc`; 
      string$loc_shep=$loc_sheps[0];
      connectAttr -f ($loc_shep+".worldPosition[0]")  ($qvxian_temp+".controlPoints["+$i+"]");//定位器控制曲线
      } 
     delete $qvmian_closestPointOnSurface;
   }
      select -r $temp_qvxian;
      select -add $UI_head_mode;   
      string$yuandi_qvxian=zxb_qvxian_to_qvxian_proc($headbn) ;
      $qvxian_head_temp+=$yuandi_qvxian+" ";
      if($iii==0){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_L_UP");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_L_UP") $yuandi_qvxian ;}
      if($iii==1){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_L_DW");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_L_DW") $yuandi_qvxian ;}
      if($iii==2){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_R_UP");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_R_UP") $yuandi_qvxian ;}
      if($iii==3){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_R_DW");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_R_DW") $yuandi_qvxian ;}
  
      }
   }

setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian") $qvxian_head_temp;
}



//////////////////////////模型上的曲线控制器原地碰撞曲线///////////////////////////////////////////
global proc string zxb_qvxian_to_qvxian_proc(string$head_bn)
{
string $qvxian[]=`ls -sl`;//跟随的曲线
string$headbn=$head_bn;//载入头部关节
string$gensui_qvxian=$qvxian[0];
string$yuandi_qvxian=($qvxian[0]+"_qvxianA");
select -r $gensui_qvxian;
duplicate -rr -n $yuandi_qvxian;
string$yuanshiqvxian_shapes[]=`listRelatives -s $yuandi_qvxian`;
string$yuanshiqvxian_shape=$yuanshiqvxian_shapes[0];
string$gensui_shapes[]=`listRelatives -s $gensui_qvxian`;
string$gensui_shape=$gensui_shapes[0];

string$qvxian_zuijiandian_jiedian=($yuandi_qvxian+"_nearestPointOnCurve_jiemao");
int$ex=`objExists $qvxian_zuijiandian_jiedian`;
 if($ex==1){delete $qvxian_zuijiandian_jiedian;}
createNode nearestPointOnCurve -n $qvxian_zuijiandian_jiedian;//创建曲线最近点节点
connectAttr -force ($gensui_shape+".worldSpace[0]") ($qvxian_zuijiandian_jiedian+".inputCurve");

select -r ($yuandi_qvxian+".cv[0:999999]");
string $cvs[]=`ls -sl -fl`;
for ($i=0;$i<size($cvs);$i++)
    {
    string$cv=$yuandi_qvxian+".cv["+$i+"]";
    float$pos_dia[]=`xform -q -ws -t $cv`;
    string$zu_A=($yuandi_qvxian+"_eye_grp_loc");
    string$eye_loc=($yuandi_qvxian+"_eye_loc_"+$i);
    string$eye_loc_grp_a=($eye_loc+"_GRP_A");
    string$eye_loc_grp_b=($eye_loc+"_GRP_B");
    int$panduan_A=`objExists $zu_A`;
    if($panduan_A==0)
        {
         select -cl  ;
         group -empty -n  $zu_A;
         setAttr ($zu_A+".visibility") 0;
         setAttr -lock true ($zu_A+".v"); 
         zxb_ADD_kongzu_proc("all_eye_jiemao_grp");
         parent   $zu_A ("all_eye_jiemao_grp");
        }
      
      spaceLocator -p 0 0 0 -n $eye_loc;
      group -n $eye_loc_grp_a;
      group -n $eye_loc_grp_b;
      parent $eye_loc_grp_b $zu_A;
      xform -ws -t  $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_b;
      string$loc_shapes[]=`listRelatives -s $eye_loc`;
      string$loc_shap=$loc_shapes[0];
      connectAttr -f  ($loc_shap+".worldPosition[0]") ($yuanshiqvxian_shape+".controlPoints["+$i+"]");
      
      string$kongzhi_loc=($yuandi_qvxian+"_kongzhi_loc_"+$i);
      string$kongzhi_loc_grp_a=($eye_loc+"konzghi_GRP_A");
      string$kongzhi_loc_grp_b=($eye_loc+"kongzhi_GRP_B");
      string$kongzhi_grp=($yuandi_qvxian+"_konzghi_root_loc_"+$i);

      spaceLocator -p 0 0 0 -n $kongzhi_loc;
      group -n $kongzhi_loc_grp_a;
      group -n $kongzhi_loc_grp_b;
      
      int$panduan_A=`objExists $kongzhi_grp`;
      if($panduan_A==0)
        {
         select -cl  ;
         group -empty -n  $kongzhi_grp;
         setAttr ($kongzhi_grp+".visibility") 0;
         setAttr -lock true ($kongzhi_grp+".v");  
         zxb_ADD_kongzu_proc("all_eye_jiemao_grp");
         zxb_ADD_kongzu_proc("all_eye_jiemao_grp_yuesu");
         string$ex_grp[]=`listRelatives -p "all_eye_jiemao_grp_yuesu"`; 
         if($ex_grp[0]!="all_eye_jiemao_grp"){parent "all_eye_jiemao_grp_yuesu"  "all_eye_jiemao_grp";}
         parent $kongzhi_grp "all_eye_jiemao_grp_yuesu";
         parentConstraint  $headbn $kongzhi_grp;
         scaleConstraint  $headbn $kongzhi_grp;
          
        }
       
     parent $kongzhi_loc_grp_b $kongzhi_grp;
     xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $kongzhi_loc_grp_b;
     connectAttr -f  ($kongzhi_loc+".t") ($eye_loc+".t");
     
     
     
      string$gensui_loc=($yuandi_qvxian+"_gensui_loc_"+$i);
      string$gensui_loc_grp_a=($eye_loc+"gensui_GRP_A");
      string$gensui_loc_grp_b=($eye_loc+"gensui_GRP_B");
      string$gensui_grp=($yuandi_qvxian+"_gensui_root_loc_"+$i);

      spaceLocator -p 0 0 0 -n $gensui_loc;
      group -n $gensui_loc_grp_a;
      group -n $gensui_loc_grp_b;
      parent  $gensui_loc_grp_b $zu_A;
      xform -ws -t  $pos_dia[0] $pos_dia[1] $pos_dia[2]  $gensui_loc_grp_b;
      scaleConstraint  $headbn $gensui_loc_grp_a;//缩放约束

       string$qvxianjiedian=($yuandi_qvxian+"_pointOnCurveInfo_jiemao_A"+$i);
       int$ex=`objExists$qvxianjiedian`;
       if($ex==1){delete $qvxianjiedian;}
       createNode "pointOnCurveInfo" -n $qvxianjiedian;//创建曲线信息节点
       connectAttr -force ($gensui_shape+".worldSpace[0]") ($qvxianjiedian+".inputCurve");
       setAttr -type float3 ($qvxian_zuijiandian_jiedian+".inPosition") $pos_dia[0] $pos_dia[1]$pos_dia[2];
       float$UV=`getAttr  ($qvxian_zuijiandian_jiedian+".parameter")`;
       setAttr ($qvxianjiedian+".parameter") $UV;
       delete`pointConstraint $kongzhi_loc $gensui_loc_grp_b `;
       connectAttr -force ($qvxianjiedian+".position")  ($gensui_loc_grp_b +".t");
   
       pointConstraint  $gensui_loc $kongzhi_loc;
      }
      
delete $qvxian_zuijiandian_jiedian;

 return $yuandi_qvxian;
}




////////////////////////////////////////计算碰撞关节的角度////////////////////////////////////////////////////////////////
global proc zxb_jiemao_pengzhuangguanjie_chengxu_proc(){
    
    
string $bns[]=`ls -sl`;//选择计算关节
//string$mode="Mery_geo_up_eyelashMesh_base_pengzhuang";
string$qv_aaa=`textFieldGrp -q -tx  UI_yuandi_qvxian`;
string$loc_aaaa=`textFieldGrp -q -tx  UI_yuandi_loc`;
string$jiaodu_aaaa=`textFieldGrp -q -tx   UI_yuandi_jiaodu`;

string $temp_name[];
int $nemt=`tokenize $qv_aaa " " $temp_name`;//分离字符串存到变量

string$qv=$temp_name[0];//载入曲线
int$shuliang=$loc_aaaa;
int$jiaodu=$jiaodu_aaaa;


string$qvxian_zuijiandian_jiedian=($qv+"_nearestPointOnCurve_jiemao_jiancha");
int$ex=`objExists $qvxian_zuijiandian_jiedian`;
 if($ex==1){delete $qvxian_zuijiandian_jiedian;}
createNode nearestPointOnCurve -n $qvxian_zuijiandian_jiedian;//创建曲线最近点节点
string$qvxian_shaps[]=`listRelatives -s $qv`;
string$qvxian_shap=$qvxian_shaps[0];
connectAttr -force ($qvxian_shap+".worldSpace[0]") ($qvxian_zuijiandian_jiedian+".inputCurve");


for($i=0;$i<size($bns);$i++)
   {      
    
      
      
    string$bn=$bns[$i];
    string$en_bns[]=`listRelatives -c $bn`;
    string$en_bn=$en_bns[0];
    string$loc_grp=($bn+"_loc_temp_grp");
    select -cl  ; 
    group -em -n $loc_grp;
    parentConstraint  $bn $loc_grp;
    float$en_bn_tsx=`getAttr ($en_bn+".tx")`;
    float$zhi=$en_bn_tsx/($shuliang-1);
    for($j=0;$j<$shuliang;$j++)
       {
         string$loc=($bn+"_loc_temp"+$j);
         spaceLocator -p 0 0 0 -n $loc;
          parent $loc $loc_grp;
          delete`parentConstraint  $loc_grp $loc`;
          setAttr($loc+".tx") ($j*$zhi);
       }
       
       
   global string $gSelect;
   global string $gMainProgressBar;
   setToolTo $gSelect;
    progressBar -e -st ("计算位置...") -bp -ii 1 -min 0 -max $jiaodu $gMainProgressBar;
     float$diss=10000000;  
     float$rz=0;
     int$loc_shu=0;
     for($j=0;$j<$jiaodu;$j++)
        {
            
            
        if(`progressBar -q -ic $gMainProgressBar`)
        break;
        progressBar -e -s 1 $gMainProgressBar;  
        setAttr ($bn+".rz") $j;
        
         for($jj=0;$jj<$shuliang;$jj++)
             {
             string$loc=($bn+"_loc_temp"+$jj);
             float$loc_pos[]=`xform -q -ws -t $loc`;
             setAttr ($qvxian_zuijiandian_jiedian+".inPosition") $loc_pos[0] $loc_pos[1] $loc_pos[2];
             float$qvxian_pos[]=`getAttr ($qvxian_zuijiandian_jiedian+".position")`;
             float$cdiss=mag(<<$qvxian_pos[0],$qvxian_pos[1],$qvxian_pos[2]>>-<<$loc_pos[0],$loc_pos[1],$loc_pos[2]>>);
             if($cdiss<$diss)
                {
                $diss=$cdiss;
                $rz=$j;
                $loc_shu=$jj;
                }
             }
        
        
        }
        
        
     
     setAttr ($bn+".rz") $rz;
     float$txx=`getAttr ($bn+"_loc_temp"+$loc_shu+".tx")`;
     setAttr ($en_bn+".tx") $txx;
     delete $loc_grp; 
     progressBar -e -ep $gMainProgressBar;
   
   }
   
delete $qvxian_zuijiandian_jiedian;   
  
}






///////////////////////////////////////睫毛碰撞//////////////////////////////////////////////////////////


global proc zxb_jiemao_pengzhuang_proc()
{
string$pengzhuang_qvxian_ss[]={"UI_jiemao_pengzhuang_bn_up_R","UI_jiemao_pengzhuang_bn_dw_R","UI_jiemao_pengzhuang_bn_up_L","UI_jiemao_pengzhuang_bn_dw_L"};
string $toubukongzhiqi=`textFieldGrp -q -tx UI_head_controller `;
string$pengzhuang_qvxian_ssa[]={"pengzhuang_qvxian_L_UP","pengzhuang_qvxian_L_DW","pengzhuang_qvxian_R_UP","pengzhuang_qvxian_R_DW"};
string$eye_coms=`getAttr ($toubukongzhiqi+".eye_con")`;
string$eye_coma[]=stringToStringArray($eye_coms, " ");
for ($i=0;$i<size($pengzhuang_qvxian_ss);$i++)
    {
     string$UI_name=$pengzhuang_qvxian_ss[$i];
     string$UI_name_shuxing=$pengzhuang_qvxian_ssa[$i];
     int$qvyu=$i%2;
     string$eye_zongkongzhi="";
     if($i<=1){$eye_zongkongzhi=$eye_coma[0];}else{$eye_zongkongzhi=$eye_coma[1];}
     string $temp_ui_tex=`textFieldGrp -q -tx $UI_name`;//
     string$qvxian_grp_s[]=stringToStringArray($temp_ui_tex, " ");
    
     string$xian="";
      int$ex_ww=`objExists ($toubukongzhiqi+"."+$UI_name_shuxing)`;//判断曲线是否存在
     if($ex_ww==1){ $xian=`getAttr ($toubukongzhiqi+"."+$UI_name_shuxing)`;}
     int$ex_A=`objExists $xian`;//判断曲线是否存在
     int$ex=`objExists $qvxian_grp_s[0]`;//判断曲线是否存在
     int$aaa_ex_panduan=$ex_A+$ex;
     if($aaa_ex_panduan==2)
       {
        select -r $qvxian_grp_s;   
        string$all_quanzhongguanjie=zxb_jiemao_pengzhuangyuesu_zhucengxu_proc($qvyu,$xian,$eye_zongkongzhi);
        }
     }

}




global proc string zxb_jiemao_pengzhuangyuesu_zhucengxu_proc(int$shangxia,string$temp_chuandiqvxian,string$eye_kongzhiqi)
{

string $bns[]=`ls -sl`;//选中所有关节

int$aaa=$shangxia;
string$qvv=$temp_chuandiqvxian;
string$klk=$eye_kongzhiqi ;

string$qv=$qvv;//载入在原地位置的曲线
string$yaqiukongzhii=$klk;//眼睛总控制器
int$shangxia=$aaa;//判断上下睫毛
string$OBJ[];
clear $OBJ;
string$qvxianshap_s[]=` listRelatives -s $qv`;
string$qvxianshap=$qvxianshap_s[0];
string$shuxing="jiemao_gensui_UP";
if($shangxia==1){$shuxing="jiemao_gensui_DW";}
int$ex=`objExists  ($yaqiukongzhii+"."+$shuxing)`;
if($ex==0)
  {
  select -r  $yaqiukongzhii;
  addAttr -ln $shuxing  -at double  -dv 0 -k 1 $yaqiukongzhii;
  setAttr -keyable false -channelBox true ($yaqiukongzhii+"."+$shuxing);
  }

string$all_grp=($qv+"_all_grp");
 int$ex=`objExists $all_grp`; 
 if($ex==0)
   {
         select -cl  ;
         group -empty -n  $all_grp;
         setAttr ($all_grp+".visibility") 0;
         setAttr -lock true ($all_grp+".v");  
         parent    $all_grp "all_eye_jiemao_grp";
   }
   
string$temp_a_guanjie="";   
for($i=0;$i<size($bns);$i++)
    {
        string$bn=$bns[$i];
        string$bnn=($bn+"_A");
        print $bnn; 
        $temp_a_guanjie+=$bnn+" ";
        string$bnn_end=($bn+"_A_s");
        string$qxian_name=($bn+"_xiangjiaoxian_"+$i);
        select -r $bn;
        duplicate -rr -n $bnn ;
        string$bnn_s[]=` listRelatives -c -pa $bn`;
        string$bnn_ss[]=` listRelatives -c -pa $bnn`;
         rename $bnn_ss[0] $bnn_end;
        delete  $bnn_s[0];
        parent $bnn $bn ;
        $OBJ[$i]=$bnn;
        
        float$tx=`getAttr ($bnn_end+".tx")`;
        curve -d 1 -p 0 0 0 -p 0 ($tx*10) 0 -k 0 -k 1 -n $qxian_name;//创建曲线
        select -r $qxian_name;
        CenterPivot;
        delete`pointConstraint $bnn_end $qxian_name`;
        parent $qxian_name $bn ;
        setAttr ($qxian_name+".visibility") 0;
        setAttr -lock true ($qxian_name+".v");
        
        string$xiangjiao=($bn+"_curveIntersect_jiemao_penzguang");
        int$ex=`objExists $xiangjiao`;
        if($ex==1){delete $xiangjiao;}
        createNode "curveIntersect" -n $xiangjiao ;//曲线相交点节点
        string$bnqvxianshap_s[]=` listRelatives -s $qxian_name`;
        string$bnqvxianshap=$bnqvxianshap_s[0];
        connectAttr -force ($qvxianshap+".worldSpace[0]") ($xiangjiao+".inputCurve1");
        connectAttr -force ($bnqvxianshap+".worldSpace[0]") ($xiangjiao+".inputCurve2");
        setAttr ($xiangjiao+".useDirection") 1;
        setAttr -type float3 ($xiangjiao+".direction") 0 0 1;

        string$loc=($bn+"_loc_A_"+$i);
        string$loc_grpA=($loc+"_A");
        spaceLocator -p 0 0 0 -n $loc;
        group -n $loc_grpA;
        
        parent $loc_grpA  $all_grp;
        
        string$qvxianjiedian=($bn+"_pointOnCurveInfo_jiemao_xiangjiao_"+$i);
        int$ex=`objExists $qvxianjiedian`;    ///判断
        if($ex==1){delete $qvxianjiedian;}
        createNode "pointOnCurveInfo" -n $qvxianjiedian;
        connectAttr -force ($qvxianshap+".worldSpace[0]") ($qvxianjiedian+".inputCurve");
        connectAttr -force ($xiangjiao+".parameter1[0]") ($qvxianjiedian+".parameter");
        connectAttr -force  ($qvxianjiedian+".position")  ($loc_grpA+".t");
        string$xiangshang=($bn+"_xiangshang_"+$i);
        select -r $bnn;
        duplicate -rr -n $xiangshang ;
        string$bnn_s_temp[]=` listRelatives -c -pa $xiangshang`;
        delete $bnn_s_temp[0];
        
        float$rot=`getAttr  ($xiangshang+".rz")`;
        if(abs($rot)>40){$rot=40;}
        setAttr ($xiangshang+".rz") ($rot*-1);
        
        string$cbnn_A=($bnn+"_xuanzhuan_temp"+$i);
        select -r $bnn;
        duplicate -rr -n $cbnn_A;
        delete`orientConstraint  $cbnn_A $loc_grpA`;
        delete $cbnn_A;
        if($shangxia==1)
           {
              setAttr   ($bnn+".rz") 0;
            }
        select -r $loc;
        select -add $bnn;
        string$dianyuesu[]=`aimConstraint -mo -weight 1 -aimVector 1 0 0 -upVector 0 0 1 -worldUpType "objectrotation" -worldUpVector 0 0 1 -worldUpObject $xiangshang`;
        float$obj_rot=`getAttr  ($bnn+".rz")`;
        if($shangxia==0)
            { transformLimits -rz -360 0 -erz 1 1 $bnn;
            }else
                {transformLimits -rz 0 360 -erz 1 1 $bnn;}
       
        transformLimits -rx 0 0 -erx 1 1 $bnn;
        transformLimits -ry 0 0 -ery 1 1 $bnn;
        

        string$shuxing_A=($shuxing+$bn+"_A_"+$i);
        int$ex=`objExists  ($yaqiukongzhii+"."+$shuxing_A)`;
        if($ex==0)
          {
          select -r  $yaqiukongzhii;
          addAttr -ln $shuxing_A  -at double  -dv 0 -k 1 $yaqiukongzhii;
          setAttr -keyable false -channelBox true ($yaqiukongzhii+"."+$shuxing_A);
          }
          
          
          
        string$jiajian_A=($bn+"_plusMinusAverage_jiemao_penzguang"+$i);
        int$ex=`objExists $jiajian_A`;    ///判断
        if($ex==1){delete $jiajian_A;}

        shadingNode -asUtility plusMinusAverage -n $jiajian_A;//创建加减节点
        connectAttr -force ($yaqiukongzhii+"."+$shuxing) ($jiajian_A+".input1D[0]");
        connectAttr -force ($yaqiukongzhii+"."+$shuxing_A) ($jiajian_A+".input1D[1]");
        
        string$chengchu_A=($bn+"_multiplyDivide_jiemao_penzguang"+$i);
        int$ex=`objExists $chengchu_A`;    ///判断
        if($ex==1){delete $chengchu_A;}
        shadingNode -asUtility multiplyDivide -n$chengchu_A ;//创建乘除节点
        connectAttr -force  ($jiajian_A+".output1D") ($chengchu_A+".input1X");
        
        float$loc_pos[]=`xform -q -ws -t $loc`;
        float$bn_pos[]=`xform -q -ws -t $bnn_end`;
        float$a_diss=mag(<<$loc_pos[0],$loc_pos[1],$loc_pos[2]>>-<<$bn_pos[0],$bn_pos[1],$bn_pos[2]>>);
        float$offste_diss=($a_diss*0.1);
        setAttr ($chengchu_A+".input2X") $offste_diss;
        
        connectAttr -force  ($chengchu_A+".outputX")  ($loc+".ty");

    }
return $temp_a_guanjie ;  
} 



//////////////////////计算嘴巴权重/////////////////////////////


/////////////////////提取曲线A////////////////////
global proc zxb_jaw_chuangjianqvxian_A(string$vxian_temp,string$UI_upjaw_vex,string$UI_dwjaw_vex, string$UI_jwa_vex,string$UI_UI_Jawknot_vex,string$UI_UI_head_mode)
{
string$qvxian=$vxian_temp;
float $pos_up[]=`xform -q -ws -t $UI_upjaw_vex`;//顶点上
float $pos_dw[]=`xform -q -ws -t $UI_dwjaw_vex`;//顶点下
float $pos_UI_jwa[]=`xform -q -ws -t $UI_jwa_vex`;//下巴顶点
float $pos_Jawknot_vex[]=`xform -q -ws -t $UI_UI_Jawknot_vex`;//颌结
curve -d 1 -p 0 0 0 -p 1 0 0 -k 0 -k 1  -n $qvxian;
xform -ws -t  $pos_up[0] $pos_up[1] $pos_up[2]  ($qvxian+".cv[0]");
xform -ws -t  $pos_UI_jwa[0] $pos_UI_jwa[1] $pos_UI_jwa[2]  ($qvxian+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 2 -d 1 -tol 0.001 $qvxian;
select -r ($qvxian+".cv[2:3]") ;
delete ;
xform -ws -t  $pos_dw[0] $pos_dw[1] $pos_dw[2] ($qvxian+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 1 -tol 0.001 $qvxian;
select -r ($qvxian+".cv[2]") ;
delete ;
xform -ws -t  $pos_Jawknot_vex[0] $pos_Jawknot_vex[1] $pos_Jawknot_vex[2] ($qvxian+".cv[2]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 3 -tol 0.001 $qvxian;
select -r ($qvxian+".cv[0:9999999]") ;
string$vex_s[]=`ls -sl -fl`;
for ($i=0;$i<size($vex_s);$i++)
    {
     string$loc_temp=$qvxian+"loc_"+$i;
     string$loc_temp_grp=$qvxian+"loc_"+$i+"_grp";
     string$loc_temp_grp_A=$qvxian+"loc_"+$i+"_grp_a";
     string$cv_vex=$vex_s[$i];
     string$name=($qvxian+"_temp_jaw_closestPointOnMesha_"+$i);
     zxb_ADD_createNode_proc($name,"closestPointOnMesh");
     string $mode_shape[]=`listRelatives -s $UI_UI_head_mode`; 
     connectAttr -force ($mode_shape[0]+".worldMesh[0]") ($name+".inMesh");
     string$nearestPointOnCurve_A=($qvxian+"nearestPointOnCurve_A"+$i);
     zxb_ADD_createNode_proc($nearestPointOnCurve_A,"nearestPointOnCurve");
     string $qvxian_shape[]=`listRelatives -s $qvxian`; 
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($nearestPointOnCurve_A+".inputCurve");
     string$pointOnCurveInfo_A=($qvxian+"pointOnCurveInfo_A"+$i);
     zxb_ADD_createNode_proc($pointOnCurveInfo_A,"pointOnCurveInfo");
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($pointOnCurveInfo_A+".inputCurve");
     spaceLocator -p 0 0 0 -n $loc_temp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp_A ;
     float $pos_vex[]=`xform -q -ws -t $cv_vex`;
     setAttr -type float3 ($nearestPointOnCurve_A+".inPosition") $pos_vex[0] $pos_vex[1] $pos_vex[2];
     setAttr ($pointOnCurveInfo_A+".turnOnPercentage") 1;
     float$parameter_temp=getAttr ($nearestPointOnCurve_A+".parameter");
     setAttr ($pointOnCurveInfo_A+".parameter")$parameter_temp;
     connectAttr -f ($pointOnCurveInfo_A+".position") ($loc_temp_grp+".translate");
     delete `pointConstraint $loc_temp_grp $loc_temp`;
     connectAttr -f  ($loc_temp+".translate") ($qvxian+".controlPoints["+$i+"]");
     delete `pointConstraint  $loc_temp_grp $loc_temp_grp_A `;
     connectAttr -force ($loc_temp_grp+".translateX") ($name+".inPositionX");
     connectAttr -force ($loc_temp_grp+".translateY") ($name+".inPositionY");
     connectAttr -force ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     connectAttr -f ($name+".position") ($loc_temp_grp_A+".translate");
     disconnectAttr ($loc_temp_grp+".translateX") ($name+".inPositionX");
     disconnectAttr ($loc_temp_grp+".translateY") ($name+".inPositionY");
     disconnectAttr ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     delete `pointConstraint   $loc_temp_grp_A $loc_temp`;
     delete $loc_temp $loc_temp_grp  $loc_temp_grp_A  $nearestPointOnCurve_A $pointOnCurveInfo_A $name;
    }
 }
 
 /////////////////////提取曲线B////////////////////
global proc zxb_jaw_chuangjianqvxian_B(string$qvxian_B,string$UI_upjaw_vex,string$UI_pomum_vex, string $UI_dwjaw_vex,string$UI_UI_Jawknot_vex,string$UI_UI_head_mode)
{
float $pos_up[]=`xform -q -ws -t $UI_upjaw_vex`;//顶点上
float $pos_dw[]=`xform -q -ws -t $UI_dwjaw_vex`;//顶点下
float $pos_Jawknot_vex[]=`xform -q -ws -t $UI_UI_Jawknot_vex`;//颌结  
float $pos_UI_pomum_vex[]=`xform -q -ws -t $UI_pomum_vex`;
curve -d 1 -p 0 0 0 -p 1 0 0 -k 0 -k 1  -n $qvxian_B;
xform -ws -t  $pos_up[0] $pos_up[1] $pos_up[2]  ($qvxian_B+".cv[0]");
xform -ws -t  $pos_UI_pomum_vex[0] $pos_UI_pomum_vex[1] $pos_UI_pomum_vex[2] ($qvxian_B+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 2 -d 1 -tol 0.001 $qvxian_B;
select -r ($qvxian_B+".cv[2:3]") ;
delete ;
select -r  $UI_dwjaw_vex;
pickWalk -d down;
pickWalk -d down;
pickWalk -d down;
string$dw_vex[]=`ls -sl -fl`;
float $pos_dw_vex[]=`xform -q -ws -t $dw_vex[0]`;
xform -ws -t $pos_dw_vex[0] $pos_dw_vex[1] $pos_dw_vex[2] ($qvxian_B+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 3 -tol 0.001 $qvxian_B;
select -r ($qvxian_B+".cv[0:9999999]") ;
string$vex_s_a[]=`ls -sl -fl`;
for ($i=0;$i<size($vex_s_a);$i++)
    {
     string$loc_temp=$qvxian_B+"loc_"+$i;
     string$loc_temp_grp=$qvxian_B+"loc_"+$i+"_grp";
     string$loc_temp_grp_A=$qvxian_B+"loc_"+$i+"_grp_a";
     string$cv_vex=$vex_s_a[$i];
     string$name=($qvxian_B+"_temp_jaw_closestPointOnMesha_"+$i);
     zxb_ADD_createNode_proc($name,"closestPointOnMesh");
     string $mode_shape[]=`listRelatives -s $UI_UI_head_mode`; 
     connectAttr -force ($mode_shape[0]+".worldMesh[0]") ($name+".inMesh");
     string$nearestPointOnCurve_A=($qvxian_B+"nearestPointOnCurve_A"+$i);
     zxb_ADD_createNode_proc($nearestPointOnCurve_A,"nearestPointOnCurve");
     string $qvxian_shape[]=`listRelatives -s $qvxian_B`; 
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($nearestPointOnCurve_A+".inputCurve");
     string$pointOnCurveInfo_A=($qvxian_B+"pointOnCurveInfo_A"+$i);
     zxb_ADD_createNode_proc($pointOnCurveInfo_A,"pointOnCurveInfo");
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($pointOnCurveInfo_A+".inputCurve");
     spaceLocator -p 0 0 0 -n $loc_temp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp_A ;
     float $pos_vex[]=`xform -q -ws -t $cv_vex`;
     setAttr -type float3 ($nearestPointOnCurve_A+".inPosition") $pos_vex[0] $pos_vex[1] $pos_vex[2];
     setAttr ($pointOnCurveInfo_A+".turnOnPercentage") 1;
     float$parameter_temp=getAttr ($nearestPointOnCurve_A+".parameter");
     setAttr ($pointOnCurveInfo_A+".parameter")$parameter_temp;
     connectAttr -f ($pointOnCurveInfo_A+".position") ($loc_temp_grp+".translate");
     delete `pointConstraint $loc_temp_grp $loc_temp`;
     connectAttr -f  ($loc_temp+".translate") ($qvxian_B+".controlPoints["+$i+"]");
     delete `pointConstraint  $loc_temp_grp $loc_temp_grp_A `;
     connectAttr -force ($loc_temp_grp+".translateX") ($name+".inPositionX");
     connectAttr -force ($loc_temp_grp+".translateY") ($name+".inPositionY");
     connectAttr -force ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     connectAttr -f ($name+".position") ($loc_temp_grp_A+".translate");
     disconnectAttr ($loc_temp_grp+".translateX") ($name+".inPositionX");
     disconnectAttr ($loc_temp_grp+".translateY") ($name+".inPositionY");
     disconnectAttr ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     delete `pointConstraint   $loc_temp_grp_A $loc_temp`;
     delete $loc_temp $loc_temp_grp  $loc_temp_grp_A  $nearestPointOnCurve_A $pointOnCurveInfo_A $name;
    }
}



 /////////////////////提取曲线C////////////////////

global proc zxb_jaw_chuangjianqvxian_C(string$array_wai[],string$qvxian_C,string $UI_UI_cheek,string$UI_upjaw_vex, string$UI_UI_head_mode)
{
float $pos_up[]=`xform -q -ws -t $UI_upjaw_vex`;
float $pos_UI_UI_cheek_vex[]=`xform -q -ws -t $UI_UI_cheek`;

select -r $array_wai;
ConvertSelectionToVertices;
string $dingdian[]=`ls -sl -fl`;
string$R_cv="";
string$L_cv="";
string$vtxs[]=$dingdian;
float$dd=-100000000000000;
float$xx=1000000000000000;
float$uppp=0;
string$dian_L="";
string$dian_R="";
string$dian_up="";
for ($i=0;$i<size($vtxs);$i++)
    {
    string$vtx=$vtxs[$i];
    float$bn_pos[]=`xform -q -ws -t $vtx`;
    if($bn_pos[0]>$dd)
      {
      $dd=$bn_pos[0];
      $dian_L=$vtx;
      }
   if($bn_pos[0]<$xx)
    {
     $xx=$bn_pos[0];
     $dian_R=$vtx;
    }
    if($bn_pos[2]>$uppp)  
      {
        $uppp=$bn_pos[2];
        $dian_up=$vtx;
       }      
   }
$L_cv=$dian_L;   
$R_cv=$dian_R;



curve -d 1 -p 0 0 0 -p 1 0 0 -k 0 -k 1  -n $qvxian_C;
xform -ws -t  $pos_up[0] $pos_up[1] $pos_up[2]  ($qvxian_C+".cv[0]");
float $pos_UP_vex[]=`xform -q -ws -t $dian_R`;
float $pos_UP_vex_z[]=`xform -q -ws -t$dian_up`;
xform -ws -t  0 $pos_UP_vex[1] $pos_UP_vex_z[2]  ($qvxian_C+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 2 -d 1 -tol 0.001 $qvxian_C;
select -r ($qvxian_C+".cv[2:3]") ;
delete ;
xform -ws -t  $pos_UI_UI_cheek_vex[0] $pos_UI_UI_cheek_vex[1] $pos_UI_UI_cheek_vex[2]  ($qvxian_C+".cv[1]");
rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 1 -tol 0.001$qvxian_C;
select -r ($qvxian_C+".cv[1]") ;
delete ;
xform -ws -t  $pos_UP_vex[0] $pos_UP_vex[1] $pos_UP_vex[2]  ($qvxian_C+".cv[2]");

rebuildCurve -ch 1 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 4 -d 3 -tol 0.001 $qvxian_C;
select -r ($qvxian_C+".cv[0:9999999]") ;
string$vex_s_b[]=`ls -sl -fl`;
for ($i=0;$i<size($vex_s_b);$i++)
    {
     string$loc_temp=$qvxian_C+"loc_"+$i;
     string$loc_temp_grp=$qvxian_C+"loc_"+$i+"_grp";
     string$loc_temp_grp_A=$qvxian_C+"loc_"+$i+"_grp_a";
     string$cv_vex=$vex_s_b[$i];
     string$name=($qvxian_C+"_temp_jaw_closestPointOnMesha_"+$i);
     zxb_ADD_createNode_proc($name,"closestPointOnMesh");
     string $mode_shape[]=`listRelatives -s $UI_UI_head_mode`; 
     connectAttr -force ($mode_shape[0]+".worldMesh[0]") ($name+".inMesh");
     string$nearestPointOnCurve_A=($qvxian_C+"nearestPointOnCurve_A"+$i);
     zxb_ADD_createNode_proc($nearestPointOnCurve_A,"nearestPointOnCurve");
     string $qvxian_shape[]=`listRelatives -s $qvxian_C`; 
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($nearestPointOnCurve_A+".inputCurve");
     string$pointOnCurveInfo_A=($qvxian_C+"pointOnCurveInfo_A"+$i);
     zxb_ADD_createNode_proc($pointOnCurveInfo_A,"pointOnCurveInfo");
     connectAttr -force  ($qvxian_shape[0]+".worldSpace[0]") ($pointOnCurveInfo_A+".inputCurve");
     spaceLocator -p 0 0 0 -n $loc_temp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp ;
     spaceLocator -p 0 0 0 -n $loc_temp_grp_A ;
     float $pos_vex[]=`xform -q -ws -t $cv_vex`;
     setAttr -type float3 ($nearestPointOnCurve_A+".inPosition") $pos_vex[0] $pos_vex[1] $pos_vex[2];
     setAttr ($pointOnCurveInfo_A+".turnOnPercentage") 1;
     float$parameter_temp=getAttr ($nearestPointOnCurve_A+".parameter");
     setAttr ($pointOnCurveInfo_A+".parameter")$parameter_temp;
     connectAttr -f ($pointOnCurveInfo_A+".position") ($loc_temp_grp+".translate");
     delete `pointConstraint $loc_temp_grp $loc_temp`;
     connectAttr -f  ($loc_temp+".translate") ($qvxian_C+".controlPoints["+$i+"]");
     delete `pointConstraint  $loc_temp_grp $loc_temp_grp_A `;
     connectAttr -force ($loc_temp_grp+".translateX") ($name+".inPositionX");
     connectAttr -force ($loc_temp_grp+".translateY") ($name+".inPositionY");
     connectAttr -force ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     connectAttr -f ($name+".position") ($loc_temp_grp_A+".translate");
     disconnectAttr ($loc_temp_grp+".translateX") ($name+".inPositionX");
     disconnectAttr ($loc_temp_grp+".translateY") ($name+".inPositionY");
     disconnectAttr ($loc_temp_grp+".translateZ") ($name+".inPositionZ");
     delete `pointConstraint   $loc_temp_grp_A $loc_temp`;
     delete $loc_temp $loc_temp_grp  $loc_temp_grp_A  $nearestPointOnCurve_A $pointOnCurveInfo_A $name;
    }
   
}


/////////////////提取曲面///////////////////////
global proc string zxb_jaw_qvmian_to_mode_tiehe(string$qvxian_B,string$qvxian,string$qvxian_C,string$UI_UI_head_mode)
{
/////////////放样曲面///////////////////
string$mode_temp_lopt[]=`loft -ch 1 -u 1 -c 0 -ar 1 -d 3 -ss 10 -rn 0 -po 0 -rsn true $qvxian_B  $qvxian $qvxian_C`;
string $loftedSurface_shape[]=`listRelatives -s $mode_temp_lopt[0]`; 

//////////自动调整曲面形态///////////////
select -r ($mode_temp_lopt[0]+".cv[0:999999999][0:9999999999]") ;
string$dingdian[]=`ls -sl -fl`;
string$temp_grp="temp_loc_grp";
zxb_ADD_kongzu_proc($temp_grp);;
for ($i=0;$i<size($dingdian);$i++)
   {
    string$cv_temp=$dingdian[$i];
    string$loc_temp=$qvxian+"loc_"+$i;
    string$loc_temp_grp=$qvxian+"loc_"+$i+"_grp";
    
    string$loc_temp_A=$qvxian+"loc_a"+$i+"_grp";
    string$loc_temp_grpA=$qvxian+"loc_"+$i+"_grpA";
    spaceLocator -p 0 0 0 -n $loc_temp ;
    group -n  $loc_temp_grp;
    parent $loc_temp_grp $temp_grp;
    spaceLocator -p 0 0 0 -n $loc_temp_A;
    group -n  $loc_temp_grpA;
    parent $loc_temp_grpA  $temp_grp;
    string$name=($qvxian+"_temp_jaw_closestPointOnMesha_"+$i);
    zxb_ADD_createNode_proc($name,"closestPointOnMesh");
    string $mode_shape[]=`listRelatives -s $UI_UI_head_mode`; 
    connectAttr -force ($mode_shape[0]+".worldMesh[0]") ($name+".inMesh");
    float $pos_vex[]=`xform -q -ws -t $cv_temp`;
    setAttr -type float3 ($name+".inPosition") $pos_vex[0] $pos_vex[1] $pos_vex[2];
    xform -ws -t  $pos_vex[0] $pos_vex[1] $pos_vex[2] $loc_temp_grp;
    xform -ws -t  $pos_vex[0] $pos_vex[1] $pos_vex[2] $loc_temp_grpA;
    
    
    connectAttr -f  ($loc_temp+".translate") ($loftedSurface_shape[0]+".controlPoints["+$i+"]");
    connectAttr -f ($name+".position") ($loc_temp_grpA+".translate") ;
    pointConstraint $loc_temp_A $loc_temp;

    
    delete  $name   ;
    //delete $loc_temp_grp $loc_temp_grpA;
    }

delete   $temp_grp;
return $mode_temp_lopt[0];
}



////////////创建曲线并提取曲线//////////
global proc proczxb_jaw_to_curve()
{
string $UI_upjaw_vex=`textFieldGrp -q -tx  UI_upjaw`;
string $UI_dwjaw_vex=`textFieldGrp -q -tx  UI_dwjaw`;
string $UI_jwa_vex=`textFieldGrp -q -tx  UI_jwa_point`;
string $UI_pomum_vex=`textFieldGrp -q -tx  UI_pomum`;
string $UI_UI_Jawknot_vex=`textFieldGrp -q -tx  UI_Jawknot`;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $UI_UI_cheek=`textFieldGrp -q -tx  UI_cheek`;
string $UI_mouth_oral_wire=`textFieldGrp -q -tx  UI_mouth_oral_wire`;
string $UI_mouth_oral_wire_s[] = stringToStringArray($UI_mouth_oral_wire, " ");//字符串转化数组
string $UI_UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $zuiba_wai=`textFieldGrp -q -tx  UI_mouth_outer_wire`;
string $array_wai[] = stringToStringArray($zuiba_wai, " ");//字符串转化数组
//string $array_bs_mode[] = stringToStringArray($mode_ss, " ");//字符串转化数组
string$qvxian="Face_JAW_curve";
string$qvxian_B="Face_JAW_curve_dw";
string$qvxian_C="Face_JAW_curve_UP";
zxb_jaw_chuangjianqvxian_A($qvxian,$UI_upjaw_vex,$UI_dwjaw_vex, $UI_jwa_vex,$UI_UI_Jawknot_vex,$UI_UI_head_mode);//曲线  //顶点上  //顶点下 //下巴顶点//颌结 //模型
zxb_jaw_chuangjianqvxian_B($qvxian_B,$UI_upjaw_vex,$UI_pomum_vex, $UI_dwjaw_vex,$UI_UI_Jawknot_vex,$UI_UI_head_mode);
zxb_jaw_chuangjianqvxian_C($array_wai,$qvxian_C, $UI_UI_cheek,$UI_upjaw_vex,$UI_UI_head_mode);
zxb_ADD_kongzu_proc("jaw_curve_grp");
zxb_ADD_kongzu_proc("Face_Group");
parent  "jaw_curve_grp" "Face_Group";
parent  $qvxian "jaw_curve_grp";
parent  $qvxian_B "jaw_curve_grp";
parent  $qvxian_C "jaw_curve_grp";
zxb_tiqv_lipmode;
 }
 
 
 
 
 ////////////找到所有下巴顶点//////////////////
global proc zxb_jaw_exv_all(string$loftedSurface_mingzi,string$open_mouth_lay,string$UI_mouth_oral_wire_ss[],string$UI_UI_head_mode)
{
 
 string$qvmian=$loftedSurface_mingzi;
string$bs_mode_temp=$open_mouth_lay;
//string$bs_mode_temp="open_mouth_lay";
string $UI_UI_cheek=`textFieldGrp -q -tx  UI_cheek`;
string $zuiba_wai=`textFieldGrp -q -tx  UI_mouth_outer_wire`;
string  $zuiba_wai_s[] = stringToStringArray($zuiba_wai, " ");

select -r$qvmian;
string$nurbsToSubd[]=`nurbsToSubdiv -rn false -mp true -ch 0 -aut off  -maxPolyCount 1000 $qvmian`;
string $nurbsToSubd_shape[]=`listRelatives -s $nurbsToSubd[0]`; 
string$nurbsToSubd_mode[]=`subdToPoly -ch off -aut on -format 1 -depth 0 -sampleCount 5 -maxPolys 1 -extractPointPosition 0 -shareUVs 1 -subdNormals 0 $nurbsToSubd_shape[0]`;
delete  $nurbsToSubd_shape[0];
select -r$qvmian;
parent  $qvmian"jaw_curve_grp";
delete $qvmian;
//parent

parent $nurbsToSubd_mode[0] "jaw_curve_grp";
///////////////////下巴所有点的大概范围/////////////////
select -cl  ;
select -r  $nurbsToSubd_mode[0];
select -add $bs_mode_temp;
zxb_xuandian;
//select `ls -sl`;PolySelectTraverse 1;select `ls -sl`;
string$op_mode_cvxs[]=`ls -sl -fl`;
//delete $nurbsToSubd_mode[0];
//////////////嘴唇所有顶点/////////////////
//string$lip_mode_ss=`zxb_tiqv_lipmode`;//提取模型
//string$lip_mode_s[] = stringToStringArray($lip_mode_ss, " ");  
string$mode_mingzi="lip_mode_plane"+" "+"lip_mode_plane_nei";
string$mode_lip_cop="lip_mode_plane_cop";
string$mode_lip_cop_nei="lip_mode_plane_cop_nei";
select -r "lip_mode_plane";
duplicate -rr -n $mode_lip_cop;

select -r "lip_mode_plane_nei";
duplicate -rr -n $mode_lip_cop_nei;


string$lip_mode=$mode_lip_cop;
select -r $lip_mode;
select -add  $bs_mode_temp;
zxb_xuandian;
string$lip_mode_cvxs[]=`ls -sl -fl`;

////////区分嘴唇上下顶点//////////////
zxb_vex_xuan($lip_mode,$zuiba_wai_s);

string$lip_mode_A_cvxs[]=`ls -sl -fl`;
string$vex_RL=`zxb_vex_RL_PROC($lip_mode_A_cvxs)`;
string  $vex_RL_s[] = stringToStringArray($vex_RL, " ");
string $zuiba_nei=`textFieldGrp -q -tx  UI_mouth_inside_wire`;
string $zuiba_nei_s[] = stringToStringArray( $zuiba_nei, " ");
zxb_vex_xuan($lip_mode,$zuiba_nei_s);
string$lip_mode_B_cvxs[]=`ls -sl -fl`;
string$vex_RL_a=`zxb_vex_RL_PROC($lip_mode_B_cvxs)`;
string  $vex_RL_s_A[] = stringToStringArray($vex_RL_a, " ");
select -r $vex_RL_s[1];
select -add $vex_RL_s_A[1];
SelectEdgeLoopSp;
polySelectSp -loop;
ConvertSelectionToContainedEdges;
doMenuComponentSelectionExt($lip_mode, "edge", 0);
DetachComponent;
select -r $vex_RL_s[0];
select -add $vex_RL_s_A[0];
SelectEdgeLoopSp;
polySelectSp -loop;
ConvertSelectionToContainedEdges;
doMenuComponentSelectionExt($lip_mode, "edge", 0);
DetachComponent;
polyChipOff -ch 1 -kft 1 -dup 0 -off 0 ($lip_mode+".f[0:99999999999999999]");
string $mode_shpe[]=`listRelatives -s $lip_mode`; 
string$modess[]=`polySeparate -rs 1 -ch 1 $mode_shpe[0]`;
select -r  $modess[0];
DeleteHistory;
select -r  $modess[1];
DeleteHistory;
select -r ($modess[0]+".vtx[0:999999999]") ;
string$temp_Cluster[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp";
delete`pointConstraint $temp_Cluster[1]  "zuiba_temp"`;
float$loc_pos[]=`xform -q -ws -t "zuiba_temp"`;
delete $temp_Cluster[1] "zuiba_temp";
select -r ($modess[1]+".vtx[0:999999999]") ;
string$temp_Cluster_a[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp_A";
delete`pointConstraint$temp_Cluster_a[1]  "zuiba_temp_A"`;
float$loc_pos_a[]=`xform -q -ws -t "zuiba_temp_A"`;
delete $temp_Cluster_a[1]  "zuiba_temp_A";
string$uo_mian="";
if($loc_pos[1]>$loc_pos_a[1]){$uo_mian=$modess[1];}else{$uo_mian=$modess[0];}
select -r $uo_mian;
select -add $bs_mode_temp;
zxb_xuandian;
string$xia_excvss[]=`ls -sl -fl`;



/////////////////查找内部口腔下半部分权重///////////////////////
select -r $UI_mouth_oral_wire_ss;
PolySelectConvert 3;
string$nei_temp_ss_cv[]=`ls -sl -fl`;
zxb_vex_xuan($mode_lip_cop_nei,$nei_temp_ss_cv);
string$nei_temp_lip_cv[]=`ls -sl -fl`;
string$nei_vex_rl_temp=zxb_vex_RL_PROC($nei_temp_lip_cv);
string $nei_vex_rl_temp_s[] = stringToStringArray($nei_vex_rl_temp, " ");//字符串转化数组
select -r ($mode_lip_cop_nei+".vtx[0:999999999999999999999]") ;
string$nei_excvss[]=`ls -sl -fl`;
select -cl  ;
float$lip_xyz_pos[]=`xform -q -ws -t $nei_vex_rl_temp_s[1]`;
for ($i=0;$i<size($nei_excvss);$i++)
    {
        string$temp_vex_temp_dian=$nei_excvss[$i];
        float$lip_pos_temp_exv[]=`xform -q -ws -t $temp_vex_temp_dian`;
        if($lip_pos_temp_exv[1]<$lip_xyz_pos[1]){select -add $temp_vex_temp_dian;}
     }

string$all_nei_excv_tempss[]=`ls -sl -fl`;
zxb_vex_xuan($bs_mode_temp,$all_nei_excv_tempss);
string$all_nei_excv_temp[]=`ls -sl -fl`;


////////////排除嘴唇顶点//////////////
select -cl  ;
hilite $bs_mode_temp;
select -add $op_mode_cvxs;
select -d $lip_mode_cvxs;
select -add  $xia_excvss;
select -add  $all_nei_excv_temp;
symmetricModelling -e -symmetry true; if (true) SymmetrizeSelection;
symmetricModelling -e -symmetry false; if (false) SymmetrizeSelection;

string$xiaba_exc[]=`ls -sl -fl`;
select -cl  ;
string$nei_xian_ss=zxb_mode_huanxian($UI_mouth_oral_wire_ss,$bs_mode_temp);
string $nei_xian_ss_s[] = stringToStringArray($nei_xian_ss, " ");//字符串转化数组
select -r $nei_xian_ss_s;
select -r $open_mouth_lay;
setAttr ($open_mouth_lay+".visibility") 1;
setAttr ($UI_UI_head_mode+".visibility") 0;
setAttr ("lip_mode_plane"+".visibility") 0;
setAttr ("lip_mode_plane_nei"+".visibility") 0;


delete $mode_lip_cop  $mode_lip_cop_nei $nurbsToSubd[0] ; 
select -r  $xiaba_exc;
 }



//////////////////////提取嘴巴模型////////////////////////////////////////////
//////////////////////提取嘴巴模型////////////////////////////////////////////
//////////////////////提取嘴巴模型////////////////////////////////////////////
global proc string zxb_tiqv_lipmode()
{
string $zuiba_wai=`textFieldGrp -q -tx  UI_mouth_outer_wire`;
string $zuiba_zhongjian=`textFieldGrp -q -tx  UI_mouth_inside_wire`;
string $zuiba_nei=`textFieldGrp -q -tx  UI_mouth_oral_wire`;
string $mode_jichu=`textFieldGrp -q -tx  UI_head_mode`;

string $array_wai[] = stringToStringArray($zuiba_wai, " ");//字符串转化数组
string $array_zhongjian[] = stringToStringArray($zuiba_zhongjian, " ");//字符串转化数组
string $array_nei[] = stringToStringArray($zuiba_nei, " ");//字符串转化数组

string$mode=$mode_jichu+"_copy";
select -r $mode_jichu ;
duplicate -rr -n $mode;
parent -w;

string$xian_waiss=zxb_mode_huanxian($array_wai,$mode);
string $array_wais[] = stringToStringArray($xian_waiss, " ");//字符串转化数组
string$xian_neiss=zxb_mode_huanxian($array_nei,$mode);
string $array_neis[] = stringToStringArray($xian_neiss, " ");//字符串转化数组

doMenuComponentSelectionExt($mode, "edge", 0);
select -r $array_wais ;
select -add   $array_neis;

DetachComponent;
select -cl  ;
select -r $mode;
hilite $mode ;
polyChipOff -ch 1 -kft 1 -dup 0 -off 0 ($mode+".f[0:99999999999999999]");
string $mode_shpe[]=`listRelatives -s $mode`; 
string$modess[]=`polySeparate -rs 1 -ch 1 $mode_shpe[0]`;
select -r $array_wai;
string$temp_Cluster_a[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp_duibi";
delete`pointConstraint $temp_Cluster_a[1]  "zuiba_temp_duibi"`;
float$zhongxian_pos_a[]=`xform -q -ws -t "zuiba_temp_duibi"`;
float$temp_mag=10000000000000000;
string$tiqv_mode="";
int$cv_ex=0;
float$bobx_ex=0;
string$shengti_mode="";
int$mode_seze=size($modess);
if($mode_seze<4){error "分离模型大于3个";}
for ($i=0;$i<(size($modess)-1);$i++)
    {
     string$temp_mode=$modess[$i];
     select -r ($temp_mode+".vtx[0:999999999]") ;
     string$temp_Cluster[]=` newCluster " -envelope 1"`;
     spaceLocator -p 0 0 0 -n "zuiba_temp";
     delete`pointConstraint $temp_Cluster[1]  "zuiba_temp"`;
      float$loc_pos[]=`xform -q -ws -t "zuiba_temp"`;
      float $weizhi=mag(<<$loc_pos[0],$loc_pos[1],$loc_pos[2]>>-<< $zhongxian_pos_a[0] ,$zhongxian_pos_a[1] ,$zhongxian_pos_a[2]>>);////////计算距离
      delete $temp_Cluster[1]  "zuiba_temp";
      if($weizhi<$temp_mag){$temp_mag=$weizhi;$tiqv_mode=$temp_mode;}
     
      if($mode_seze>2)
        {
        float$bbobx_max[]=`getAttr ($temp_mode+".boundingBoxMax")`;
        if($bbobx_max[2]>$bobx_ex)
           {
           $shengti_mode=$temp_mode;
           $bobx_ex=$bbobx_max[2];
            }
        }
     
    }


select -r $array_nei;
string$temp_Cluster_nei[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp_duibi_nei";
delete`pointConstraint $temp_Cluster_nei[1]  "zuiba_temp_duibi_nei"`;
float$zhongxian_pos_a_nei[]=`xform -q -ws -t "zuiba_temp_duibi_nei"`;
float$temp_mag_nei=10000000000000000;
string$tiqv_mode_nei="";
for ($i=0;$i<(size($modess)-1);$i++)
    {
     string$temp_mode=$modess[$i];
     if($temp_mode!=$tiqv_mode)
       {
        zxb_vex_xuan($temp_mode,$array_nei);
        string$temp_Cluster_nei_temp[]=` newCluster " -envelope 1"`;
        spaceLocator -p 0 0 0 -n "zuiba_temp_duibi_nei_temp";  
        delete`pointConstraint $temp_Cluster_nei_temp[1]  "zuiba_temp_duibi_nei_temp"`;
        float$zhongxian_pos_a_nei_temp[]=`xform -q -ws -t "zuiba_temp_duibi_nei_temp"`;
       
        float $temp_mag_nei_temp=mag(<<$zhongxian_pos_a_nei[0],$zhongxian_pos_a_nei[1],$zhongxian_pos_a_nei[2]>>-<<$zhongxian_pos_a_nei_temp[0],$zhongxian_pos_a_nei_temp[1],$zhongxian_pos_a_nei_temp[2]>>);////////计算距离
        if($temp_mag_nei_temp<$temp_mag_nei)
          { 
           $temp_mag_nei= $temp_mag_nei_temp;
           $tiqv_mode_nei=$temp_mode;
           }
        delete  "zuiba_temp_duibi_nei_temp"  $temp_Cluster_nei_temp[1];
        
           
        }
    }

delete  "zuiba_temp_duibi_nei"  $temp_Cluster_nei[1];
delete  "zuiba_temp_duibi"$temp_Cluster_a[1];
select -r $tiqv_mode $tiqv_mode_nei;
DeleteHistory;
select -r $modess;
select -d  $tiqv_mode $tiqv_mode_nei;
Delete;
rename $tiqv_mode "lip_mode_plane";
rename $tiqv_mode_nei "lip_mode_plane_nei";
select -r "lip_mode_plane" "lip_mode_plane_nei";
parent -w;
delete $mode;
string$mode_mingzi="lip_mode_plane"+" "+"lip_mode_plane_nei";

parent "lip_mode_plane" "jaw_curve_grp";
parent "lip_mode_plane_nei" "jaw_curve_grp";


return  $mode_mingzi;
}



 
global proc zxb_jaw_jisuanquanzhong()
{
string $UI_upjaw_vex=`textFieldGrp -q -tx  UI_upjaw`;
string $UI_dwjaw_vex=`textFieldGrp -q -tx  UI_dwjaw`;
string $UI_jwa_vex=`textFieldGrp -q -tx  UI_jwa_point`;
string $UI_pomum_vex=`textFieldGrp -q -tx  UI_pomum`;
string $UI_UI_Jawknot_vex=`textFieldGrp -q -tx  UI_Jawknot`;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $UI_UI_cheek=`textFieldGrp -q -tx  UI_cheek`;
string $UI_mouth_oral_wire=`textFieldGrp -q -tx  UI_mouth_oral_wire`;
string $UI_mouth_oral_wire_s[] = stringToStringArray($UI_mouth_oral_wire, " ");//字符串转化数组
string $UI_UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $zuiba_wai=`textFieldGrp -q -tx  UI_mouth_outer_wire`;
string $array_wai[] = stringToStringArray($zuiba_wai, " ");//字符串转化数组
string$mode_ss=getAttr ($UI_UI_head_controller+".base_bs_mode");
string$jaw_root_bn=getAttr ($UI_UI_head_controller+".jaw_root_bn");
string$UI_jaw_bn=getAttr ($UI_UI_head_controller+".UI_jaw_bn");
string $array_bs_mode[] = stringToStringArray($mode_ss, " ");//字符串转化数组
float $pos_up[]=`xform -q -ws -t $UI_upjaw_vex`;
float $pos_dw[]=`xform -q -ws -t $UI_dwjaw_vex`;
float $pos_UI_jwa[]=`xform -q -ws -t $UI_jwa_vex`;
float $pos_Jawknot_vex[]=`xform -q -ws -t $UI_UI_Jawknot_vex`;
float $pos_UI_pomum_vex[]=`xform -q -ws -t $UI_pomum_vex`;
float $pos_UI_UI_cheek_vex[]=`xform -q -ws -t $UI_UI_cheek`;
string$qvxian="Face_JAW_curve";
string$qvxian_B="Face_JAW_curve_dw";
string$qvxian_C="Face_JAW_curve_UP";
////////////创建3条曲线 提取模型///////////////////////

/////创建曲面并贴合模型//
string$loftedSurface_mingzi=zxb_jaw_qvmian_to_mode_tiehe($qvxian_B,$qvxian,$qvxian_C,$UI_UI_head_mode);
zxb_jaw_exv_all($loftedSurface_mingzi,$array_bs_mode[0],$UI_mouth_oral_wire_s,$UI_UI_head_mode);
//////////转化为模型/////////////////////////
string$xiaba_exc[]=`ls -sl -fl`;
select -cl  ;
select -r lip_mode_plane ;
select -add $array_bs_mode[0] ;
zxb_xuandian;
string$lip_all_exc[]=`ls -sl -fl`;
//////////////////张嘴权重重置//////////////

string $skinCluster_A=`findRelatedSkinCluster $array_bs_mode[0]` ;//访问蒙皮节点
string $All_bn[]=`skinCluster -q  -inf  $skinCluster_A`;//查询蒙皮的所有关节
for ($i=0;$i<size($All_bn);$i++)
    {
      string$temo_bn=$All_bn[$i];
      ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
      setAttr ($temo_bn+".liw") 0;
     }
for ($i=0;$i<size($All_bn);$i++)
    {
      string$temo_bn=$All_bn[$i];
      ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
      setAttr ($temo_bn+".liw") 0;
     }

ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
setSmoothSkinInfluence $jaw_root_bn;
artAttrSkinPaintCtx -e -clear `currentCtx` ;


/////////下巴权重刷计算////////////////////
select -r$xiaba_exc;
hilite $array_bs_mode[0];
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
setSmoothSkinInfluence $UI_jaw_bn;
artAttrSkinPaintCtx -e -clear `currentCtx` ;

select -r $array_bs_mode[0];
removeUnusedInfluences;
select -r$xiaba_exc;
select `ls -sl`;PolySelectTraverse 1;select `ls -sl`;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
//setAttr "FKJaw_M.rotateZ" 30;
for ($i=0;$i<60;$i++)
    {
     setSmoothSkinInfluence $UI_jaw_bn;
    artAttrSkinPaintCtx -e -clear `currentCtx` ;
     }


select -r $lip_all_exc;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
for ($i=0;$i<5;$i++)
    {
     setSmoothSkinInfluence $UI_jaw_bn;
    artAttrSkinPaintCtx -e -clear `currentCtx` ;
     }
     
select -r $lip_all_exc;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
for ($i=0;$i<5;$i++)
    {
     setSmoothSkinInfluence $jaw_root_bn;
    artAttrSkinPaintCtx -e -clear `currentCtx` ;
     }

select -cl  ;
select -r $lip_all_exc;
/*doMenuComponentSelectionExt($array_bs_mode[0], "vertex", 0);
InvertSelection ;*/
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $array_bs_mode[0];
for ($i=0;$i<10;$i++)
    {
     setSmoothSkinInfluence $jaw_root_bn;
    artAttrSkinPaintCtx -e -clear `currentCtx` ;
     }

////计算整体嘴巴权重/////
zxb_jaw_lip_zhengti;

setAttr ($UI_UI_head_mode+".visibility") 1;

button -e -en 0 zuibazhengti_button_delete;

}




/////////////////////////////计算整体嘴巴权重/////////////////////////////////
global proc zxb_jaw_lip_zhengti()
{

string $UI_UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $UI_UI_all_dead_vertex=`textFieldGrp -q -tx  "UI_all_head_vertex"`;
string $UI_all_dead_vertex_s[]= stringToStringArray($UI_UI_all_dead_vertex, " ");//字符串转化数组
string$mode_ss=getAttr ($UI_UI_head_controller+".base_bs_mode");
string$jaw_root_bn=getAttr ($UI_UI_head_controller+".jaw_root_bn");
string$UI_jaw_bn=getAttr ($UI_UI_head_controller+".UI_jaw_bn");
string$UI_jaw_zhengti_bn=getAttr ($UI_UI_head_controller+".jaw_zhengti_bn");
string $array_bs_mode[]= stringToStringArray($mode_ss, " ");//字符串转化数组
string$mode_zhengti=$array_bs_mode[1];
setAttr ($array_bs_mode[0]+".visibility") 0;
setAttr ($mode_zhengti+".visibility") 1;
setAttr "Face_JAW_curve_UP.visibility" 0;
setAttr "Face_JAW_curve.visibility" 0;
setAttr "Face_JAW_curve_dw.visibility" 0;
select -cl  ;
select -r "lip_mode_plane" ;
select -add $mode_zhengti;
zxb_xuandian;
string$zhengti_exc[]=`ls -sl -fl`;

zxb_vex_xuan($mode_zhengti,$UI_all_dead_vertex_s);
select -d $zhengti_exc ;
string$zhengti_exc_temp[]=`ls -sl -fl`;

zxb_vex_xuan($array_bs_mode[2],$zhengti_exc);
string$aaaa_exc_temp[]=`ls -sl -fl`;
zxb_vex_xuan($array_bs_mode[2],$UI_all_dead_vertex_s);
string$alllwai_exc_temp[]=`ls -sl -fl`;
//////////////////整体权重重置//////////////

select -cl  ;
string $skinCluster_A=`findRelatedSkinCluster $mode_zhengti` ;//访问蒙皮节点
string $All_bn[]=`skinCluster -q  -inf  $skinCluster_A`;//查询蒙皮的所有关节
for ($i=0;$i<size($All_bn);$i++)
    {
      string$temo_bn=$All_bn[$i];
      ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
      setAttr ($temo_bn+".liw") 0;
     }
for ($i=0;$i<size($All_bn);$i++)
    {
      string$temo_bn=$All_bn[$i];
      ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
      setAttr ($temo_bn+".liw") 0;
     }

ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
setSmoothSkinInfluence $jaw_root_bn;
artAttrSkinPaintCtx -e -clear `currentCtx` ;


/////////下巴权重刷计算////////////////////
select -r $zhengti_exc;
doMenuComponentSelectionExt($mode_zhengti, "vertex", 1);
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
setSmoothSkinInfluence $UI_jaw_zhengti_bn;
artAttrSkinPaintCtx -e -clear `currentCtx` ;





select -r  $mode_zhengti;
removeUnusedInfluences;
select -r $zhengti_exc_temp;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<10;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
     
     
string $temp_vex="";
string $temp_vex_A="";
global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("计算顶点顶点...") -bp -ii 1 -min 0 -max (size($zhengti_exc_temp)) $gMainProgressBar;
for ($i=0;$i<size($zhengti_exc_temp);$i++)
{
if(`progressBar -q -ic $gMainProgressBar`)
break;
progressBar -e -s 1 $gMainProgressBar;  
  string$dingdian=$zhengti_exc_temp[$i];
   float$quznzhong=`skinPercent  -t $UI_jaw_zhengti_bn -q   $skinCluster_A $dingdian`;
  if($quznzhong>0)
     {
       $temp_vex+=$dingdian+" ";
      }
  if($quznzhong>0.1)
     {
      $temp_vex_A+=$dingdian+" ";
      }

}
progressBar -e -ep $gMainProgressBar;

string $temp_vexs[]= stringToStringArray($temp_vex, " ");//字符串转化数组

select -r $temp_vexs;

ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<100;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
     


string $temp_vex_A="";
string $temp_vex_B="";
global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("计算顶点顶点...") -bp -ii 1 -min 0 -max (size($zhengti_exc_temp)) $gMainProgressBar;
for ($i=0;$i<size($zhengti_exc_temp);$i++)
{
if(`progressBar -q -ic $gMainProgressBar`)
break;
progressBar -e -s 1 $gMainProgressBar;  
  string$dingdian=$zhengti_exc_temp[$i];
   float$quznzhong=`skinPercent  -t $UI_jaw_zhengti_bn -q   $skinCluster_A $dingdian`;

  if($quznzhong<0.99&&$quznzhong>0.5)
     {
      $temp_vex_A+=$dingdian+" ";
      }
  if($quznzhong<0.5&&$quznzhong>0.1)
    {
     $temp_vex_B+=$dingdian+" ";
     }

}
progressBar -e -ep $gMainProgressBar;
string $temp_vexs_a[]= stringToStringArray($temp_vex_A, " ");//字符串转化数组
string $temp_vexs_b[]= stringToStringArray($temp_vex_B, " ");//字符串转化数组
select -r$temp_vexs_a;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 0.99 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<20;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
     
select -r$temp_vexs_b;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 0.7 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<10;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
select -r$temp_vexs_a;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 0.99 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<3;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
     
     
     
select -r$temp_vexs_b;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 0.7 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<10;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
     
select -r $temp_vexs;
ArtPaintSkinWeightsToolOptions; changeSelectMode -object; select -add $mode_zhengti;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<20;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
  
     
string $zuiba_nei=`textFieldGrp -q -tx  UI_mouth_inside_wire`;
string $zuiba_nei_s[] = stringToStringArray( $zuiba_nei, " "); 
select -r$zuiba_nei_s;
ConvertSelectionToVertices;
string $UI_UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
doMenuComponentSelectionExt($UI_UI_head_mode, "vertex", 1);
string$nei_exc_temp[]=`ls -sl -fl`;
zxb_vex_xuan($array_bs_mode[2],$nei_exc_temp);

string$nei_exc_s[]=`ls -sl -fl`;
string$rl_vex=zxb_vex_RL_PROC($nei_exc_s);
string$rl_vex_s[] = stringToStringArray($rl_vex, " "); 


select -r $array_bs_mode[0];
select -add $array_bs_mode[3];
CopySkinWeights;
select -r $array_bs_mode[0];
select -add $array_bs_mode[2];
CopySkinWeights;

select -r$array_bs_mode[2];
removeUnusedInfluences;

select -r "lip_mode_plane" ;
select -add $array_bs_mode[2] ;
zxb_xuandian;
string$repeated_exc_temp[]=`ls -sl -fl`;
select -r $rl_vex_s[0];
artAttrSkinWeightCopy;
select -r $repeated_exc_temp;
artAttrSkinWeightPaste;
select -r$temp_vexs;
zxb_vex_xuan($array_bs_mode[2],$temp_vexs_a);
ArtPaintSkinWeightsToolOptions; 
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
setSmoothSkinInfluence $jaw_root_bn;
for ($i=0;$i<100;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
select -r $alllwai_exc_temp;
select -d $aaaa_exc_temp;
ArtPaintSkinWeightsToolOptions; 
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
setSmoothSkinInfluence $jaw_root_bn;
for ($i=0;$i<5;$i++)
    {
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     }
setAttr ($array_bs_mode[2]+".visibility") 0;
setAttr ($array_bs_mode[1]+".visibility") 0;

}

global proc zxb_lalianbaoguo_A_poc()
 {
string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器 
string$lalian_modess=` getAttr ($Controller+".base_bs_mode ")`;
 string $lalian_modes[]= stringToStringArray($lalian_modess, " ");//反向嘴巴模型
string $lalian_modces=$lalian_modes[3];
string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
zxb_ADD_shuxing_string_proc( $Controller,"wir");

string $qvxianDs=getAttr ($Controller+".lip_follow_qvxian");  //跟随曲线lip_open_qvxian
string $zhangzuiqvxians=getAttr ($Controller+".lip_open_qvxian"); //张嘴曲线lip_follow_qvxian
string$qvxianDss[]=stringToStringArray($qvxianDs, " ");
string$zhangzuiqvxianss[]=stringToStringArray($zhangzuiqvxians, " ");
string$mod[];
clear $mod;
int $nemt=`tokenize  $lalian_modces " " $mod`;//分离字符串存到变量
string$lalian_modce=$mod[0];
string$aii_wir_bs="";
for ($i=0;$i<size($qvxianDss);$i++)
    {
    string$qvxian=$qvxianDss[$i];
    string$wir_ebs="zxb_wir_"+$i;
    $aii_wir_bs+=$wir_ebs+" ";
    string$qvxian_A=$zhangzuiqvxianss[$i];
    string$baoguoa[]=`wire -gw false -en 1.000000 -ce 0.000000 -li 0.000000 -n $wir_ebs -w $qvxian $lalian_modce  `;
    setAttr ($baoguoa[0]+".rotation") 0.2;
    setAttr ($baoguoa[0]+".dropoffDistance[0]") 10;
    select -r  $qvxian_A;
    select -add  $qvxian_A ($qvxian+"BaseWire");
    string$bs[]=`blendShape`;
    setAttr ($bs[0]+"."+$qvxian_A) 1;
    }
setAttr -type "string" ($Controller+".wir") $aii_wir_bs ;
zxb_fase_wire_proc;//创建包裹
zxb_lailian_sheziqvdong_poc;//创建驱动
zxb_bolangzui_proc($qvxianDss);//跟随曲线创建波浪嘴巴
button -e -en 0 headhunhebianxing_button;
}




/////////////////////拉链嘴巴权重计算
global proc zxb_fase_wire_proc()
{
 
  string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
  string$lalian_modess=` getAttr ($Controller+".base_bs_mode ")`;
  string $lalian_modes[]= stringToStringArray($lalian_modess, " ");//反向嘴巴模型
  string $modces=$lalian_modes[3];
  
  string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
  string $all_exv=`textFieldGrp -q -tx  UI_all_head_vertex`;//变形模型 
  string$all_exvs[]=stringToStringArray($all_exv, " ");
  select -r ("lip_mode_plane"+".vtx[0:9999999999999999999999999]") ;
  string$lip_exvss[]=`ls -sl -fl`;
  zxb_vex_xuan($modces,$lip_exvss);
  string$mode_lip_exvss[]=`ls -sl -fl`;
  

  string$mode_up_dw=`zxb_mode_exv_up_dw`;
  string$mode_up_dws[]=stringToStringArray($mode_up_dw, " ");
  select -r ($mode_up_dws[0]+".vtx[0:9999999999999999999999999]") ;
  string$all_dw_cvs[]= `ls -sl -fl`;
  zxb_vex_xuan($modces,$all_dw_cvs);
  string$mode_all_dw_cvs[]= `ls -sl -fl`;
  select -r ($mode_up_dws[1]+".vtx[0:9999999999999999999999999]") ;
  string$all_up_cvs[]= `ls -sl -fl`;
  zxb_vex_xuan($modces,$all_up_cvs);
  string$mode_all_up_cvs[]= `ls -sl -fl`;
  delete "lip_mode_plane_cop";
  select -cl  ;

  string $wirsss=getAttr ( $Controller+".wir"); 
  string$wirs[]=stringToStringArray($wirsss, " ");
  
   zxb_vex_xuan($modces,$all_exvs);
  string$all_exvss[]= `ls -sl -fl`;
  
  select -r "lip_mode_plane_nei.vtx[0:9999999999999999999]" ;
 string$all_exv_nei_xuanran[]= `ls -sl -fl`;
 string$all_exv_neiss= zxb_vex_xuan($modces,$all_exv_nei_xuanran);
 string$all_exv_neis[]=`ls -sl -fl`;
  for ($i=0;$i<size($wirs);$i++)
      {
          string$wir=$wirs[$i];
          select -r$modces;
          artSetToolAndSelectAttr( "artAttrCtx", "wire."+$wir+".weights" );
          artAttrCtx -e -value 0 `currentCtx`;
          artAttrPaintOperation artAttrCtx Replace;
          artAttrCtx -e -clear `currentCtx`;
          select -cl  ;
          if($i==0){ select -r $mode_all_up_cvs;}else{ select -r $mode_all_dw_cvs;}
         
          artAttrCtx -e -value 1 `currentCtx`;
          artAttrPaintOperation artAttrCtx Replace;
          artAttrCtx -e -clear `currentCtx`;
          select -r $all_exvss;
          if($i==0){select -d $mode_all_up_cvs;}else{select -d $mode_all_dw_cvs;}
          artAttrPaintOperation artAttrCtx Smooth;
          for ($j=0;$j<10;$j++)
              {
               artAttrCtx -e -clear `currentCtx`;
               }
               
               
           string$outer_wire=`textFieldGrp -q -tx UI_mouth_outer_wire `;
           string$outer_wires[]=stringToStringArray($outer_wire," ");
           select -r$outer_wires;
           ConvertSelectionToVertices;
            string$all_zhongjian[]= `ls -sl -fl`;
           
           string$outer_wiress=zxb_mode_huanxian($all_zhongjian,$modces);
           string$outer_wires_temp[]=stringToStringArray($outer_wiress," ");
           string$rl_s=zxb_vex_RL_PROC($outer_wires_temp);
           string$rl_ss[]=stringToStringArray($rl_s," ");
           //select -r$rl_ss;
           
          select -cl  ;
          select -r $all_exvss;
          if($i==0){select -d $mode_all_up_cvs;}else{select -d $mode_all_dw_cvs;}
          string$temp_vex_updw[]=`ls -sl -fl`;
          select -cl  ;
          global string $gSelect;
          global string $gMainProgressBar;
          setToolTo $gSelect;
          progressBar -e -st ("查找蔟权重...") -bp -ii 1 -min 0 -max `size($temp_vex_updw)` $gMainProgressBar;//开始
          for ($ii=0;$ii<size($temp_vex_updw);$ii++)
               {
                    if(`progressBar -q -ic $gMainProgressBar`)   //循环内
                    break;
                     progressBar -e -s 1 $gMainProgressBar;  
                 string$vex_temp=$temp_vex_updw[$ii];
                 float$zhia[]=`percent -q -v $wir $vex_temp `;
                 if($zhia[0]<0.8&&$zhia[0]>0.01){select -add $vex_temp;}
                 //help percent
               }
           progressBar -e -ep $gMainProgressBar;  //结束
           
         string$temp_vex_updw_A[]=`ls -sl -fl`; 
         select -cl  ;
         for ($ii=0;$ii<size($temp_vex_updw_A);$ii++)
             {
               string$vex_temp=$temp_vex_updw_A[$ii];
               float $temp_pos_a[]=`xform -q -ws -t $vex_temp`;//////查询位置
               float $temp_pos_b[];
               if($i==0)
                 {   
                 $temp_pos_b =`xform -q -ws -t $rl_ss[0]`;
                 if( $temp_pos_a[1]>$temp_pos_b[1])
                   {
                       select -add $vex_temp;
                    }
                 }else
                     {
                         $temp_pos_b =`xform -q -ws -t $rl_ss[1]`;
                          if( $temp_pos_a[1]<$temp_pos_b[1])
                            {
                            select -add $vex_temp;
                              }
                      }
               
               
                
              }
        select -d $mode_all_up_cvs $mode_all_dw_cvs  $all_exv_neis;
       // select -r  $all_exv_neis;
        artSetToolAndSelectAttr( "artAttrCtx", "wire."+$wir+".weights" );
        artAttrCtx -e -value 0.9 `currentCtx`;
        artAttrPaintOperation artAttrCtx Replace;
        artAttrCtx -e -clear `currentCtx`;
        artAttrPaintOperation artAttrCtx Smooth;
        for ($j=0;$j<10;$j++)
            {
             artAttrCtx -e -clear `currentCtx`;
             }
             
         select -r $all_exvss;  
         
        artSetToolAndSelectAttr( "artAttrCtx", "wire."+$wir+".weights" );
        artAttrPaintOperation artAttrCtx Smooth;
        for ($j=0;$j<10;$j++)
            {
             artAttrCtx -e -clear `currentCtx`;
             }  
         
      }



}


  
  ///////////////////////区分嘴巴上下模型//////////////////////////////
global proc string zxb_mode_exv_up_dw()
{
string $zuiba_wai=`textFieldGrp -q -tx  UI_mouth_outer_wire`;
string  $zuiba_wai_s[] = stringToStringArray($zuiba_wai, " ");

string$mode_mingzi="lip_mode_plane"+" "+"lip_mode_plane_nei";
string$mode_lip_cop="lip_mode_plane_cop";
string$mode_lip_cop_nei="lip_mode_plane_cop_nei";
select -r "lip_mode_plane";
duplicate -rr -n $mode_lip_cop;

select -r "lip_mode_plane_nei";
duplicate -rr -n $mode_lip_cop_nei;

string$bs_mode_temp="SM_LiuXianZongDiZi8_Body";
string$lip_mode=$mode_lip_cop;
select -r $lip_mode;
select -add  $bs_mode_temp;
zxb_xuandian;
string$lip_mode_cvxs[]=`ls -sl -fl`;

////////区分嘴唇上下顶点//////////////
zxb_vex_xuan($lip_mode,$zuiba_wai_s);

string$lip_mode_A_cvxs[]=`ls -sl -fl`;
string$vex_RL=`zxb_vex_RL_PROC($lip_mode_A_cvxs)`;
string  $vex_RL_s[] = stringToStringArray($vex_RL, " ");
string $zuiba_nei=`textFieldGrp -q -tx  UI_mouth_inside_wire`;
string $zuiba_nei_s[] = stringToStringArray( $zuiba_nei, " ");
zxb_vex_xuan($lip_mode,$zuiba_nei_s);
string$lip_mode_B_cvxs[]=`ls -sl -fl`;
string$vex_RL_a=`zxb_vex_RL_PROC($lip_mode_B_cvxs)`;
string  $vex_RL_s_A[] = stringToStringArray($vex_RL_a, " ");
select -r $vex_RL_s[1];
select -add $vex_RL_s_A[1];
SelectEdgeLoopSp;
polySelectSp -loop;
ConvertSelectionToContainedEdges;
doMenuComponentSelectionExt($lip_mode, "edge", 0);
DetachComponent;
select -r $vex_RL_s[0];
select -add $vex_RL_s_A[0];
SelectEdgeLoopSp;
polySelectSp -loop;
ConvertSelectionToContainedEdges;
doMenuComponentSelectionExt($lip_mode, "edge", 0);
DetachComponent;
polyChipOff -ch 1 -kft 1 -dup 0 -off 0 ($lip_mode+".f[0:99999999999999999]");
string $mode_shpe[]=`listRelatives -s $lip_mode`; 
string$modess[]=`polySeparate -rs 1 -ch 1 $mode_shpe[0]`;
select -r  $modess[0];
DeleteHistory;
select -r  $modess[1];
DeleteHistory;
select -r ($modess[0]+".vtx[0:999999999]") ;
string$temp_Cluster[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp";
delete`pointConstraint $temp_Cluster[1]  "zuiba_temp"`;
float$loc_pos[]=`xform -q -ws -t "zuiba_temp"`;
delete $temp_Cluster[1] "zuiba_temp";
select -r ($modess[1]+".vtx[0:999999999]") ;
string$temp_Cluster_a[]=` newCluster " -envelope 1"`;
spaceLocator -p 0 0 0 -n "zuiba_temp_A";
delete`pointConstraint$temp_Cluster_a[1]  "zuiba_temp_A"`;
float$loc_pos_a[]=`xform -q -ws -t "zuiba_temp_A"`;
delete $temp_Cluster_a[1]  "zuiba_temp_A";
string$uo_mian="";
string$up_mian="";
if($loc_pos[1]>$loc_pos_a[1]){$uo_mian=$modess[1]; $up_mian=$modess[0];}else{$uo_mian=$modess[0];$up_mian=$modess[1];}
string $all_mode=$uo_mian+" "+$up_mian+" ";
delete "lip_mode_plane_cop_nei" ;
return $all_mode;
}

/////////////////设置拉链驱动/////////////////////
global proc zxb_lailian_sheziqvdong_poc()
{
  string$Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
  string$loc_temp=getAttr   ($Controller+".lalianloc");
  string$loc_temp_s[]=stringToStringArray($loc_temp, " ");
  
  string $qvxians=`textFieldGrp -q -tx  UI_jaw_controller`;
  string$qvxianss[];
  clear $qvxianss;
  int $nemt=`tokenize  $qvxians " " $qvxianss`;//分离字符串存到变量
  string$qvxian=$qvxianss[0];
  for ($i=0;$i<size($loc_temp_s);$i++)
  {
   
   string$loc=$loc_temp_s[$i];
   int$a=0;
   string$rrll="";
      
   if($i==0){$a=1;$rrll="L";}else{$a=0;$rrll="R";}
   string$loc_b=$loc_temp_s[$a];
   
   int $ex=`objExists ($qvxian+".lalian_L")`;//查询这个物体是否纯在
   if($ex==0){addAttr -ln "lalian_L"  -at double  -min 0 -max 10 -dv 0 -k  1 $qvxian;}//添加属性  
   
    $ex=`objExists ($qvxian+".lalian_R")`;//查询这个物体是否纯在
    if($ex==0){addAttr -ln "lalian_R"  -at double  -min 0 -max 10 -dv 0 -k  1 $qvxian;}//添加属性  
    
    float$loc_pos=`getAttr ($loc+".tx")`;
    float$loc_b_pos=`getAttr ($loc_b+".tx")`;
   setDrivenKeyframe -itt "linear" -ott "spline" -v $loc_pos -dv 0 -cd ($qvxian+".lalian_"+$rrll) ($loc+".tx");  
   setDrivenKeyframe -itt "linear" -ott "spline" -v $loc_b_pos -dv 10 -cd ($qvxian+".lalian_"+$rrll) ($loc+".tx");  
  }
}




//////////////////////////////
/////////////////////////////////设置嘴巴波浪///////////////////////////
global proc zxb_bolangzui_proc(string$bianliang[])
{

//string $bianliang[]=`ls -sl `;//选中曲线D  

for($i=0;$i<size($bianliang);$i++)
{
   string $qvxian_D=$bianliang[$i];
   select -r $qvxian_D;
  duplicate -rr -n ($qvxian_D+"_bolang");
    string $grpchids[]=`listRelatives -c ($qvxian_D+"_locGrp")`;
    
    int $panduan=`objExists ($qvxian_D+"_bolanggrp") `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp");
        setAttr ($qvxian_D+"_bolanggrp.visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp.v");
         parent   ($qvxian_D+"_bolanggrp") "Face_zipper_Group";
     }
     
     string$boliang=($bianliang[0]+"_bolang_all");
     
    int $panduan=`objExists $boliang `;
    if ($panduan==0)
    {
        select -cl  ;
        group -empty -n $boliang ;
       setAttr ($boliang+".visibility") 0;
       setAttr -lock true -keyable false -channelBox false ($boliang+".v");
       setAttr -lock true -keyable false -channelBox false ($boliang+".v");
     
        parent   $boliang "Face_zipper_Group";
     }
     
   
     
     /////////////////////////复制曲线D的定位器   属性控制拉链嘴的组//////////////////////////////
   string $objloc_d[];//定义定位器的所有物体  复制出来的定位器的名字
   clear $objloc_d;
   for($j=0;$j<size($grpchids);$j++)
   {
     string $qvxian_D_locA= $grpchids[$j];
     string $loc_chids[]=`listRelatives -c  -type "transform" $qvxian_D_locA`;
     string $obj="";

     for($ii=0;$ii<size($loc_chids);$ii++)
       {
       int $panduan=`objExists ($loc_chids[$ii]+".offsetZ")`;
       if ($panduan==0){$obj=$loc_chids[$ii];}
       }
     select -r $obj ;
     duplicate -rr -n ($obj+"_bolang");
     parent ($obj+"_bolang") ($qvxian_D+"_bolanggrp");
     string $zu_zi[]=`listRelatives -c -ad  -type  "transform" -fullPath ($obj+"_bolang")`;
     string $zu_zi_A[]=`listRelatives -c -ad  -type  "transform" ($obj+"_bolang")`;
     string $bolangloc="";

     for($iii=0;$iii<size($zu_zi);$iii++)////重命名
      {
          string $ziwuti=$zu_zi[$iii];
          //select -r $ziwuti;
          rename  $ziwuti ($zu_zi_A[$iii]+"_bolang");
          string$loc_shap[]=`listRelatives -s ($zu_zi_A[$iii]+"_bolang")`;
          if($loc_shap[0]==""&&$iii==0){ delete($zu_zi_A[$iii]+"_bolang");}
          if($loc_shap[0]!="")
            {
             string$tepe_B=`nodeType $loc_shap[0]`;
            if($tepe_B=="locator"){$bolangloc=($zu_zi_A[$iii]+"_bolang");}
             }

         
         
        
    
       }
      string $loc_zu[]=`listRelatives -c  -type  "transform"  $obj`;
      string $lalian_loczu=$loc_zu[0];

     connectAttr -f ($bolangloc+".t") ($lalian_loczu+".t");
     select -r $bolangloc;

     $objloc_d[$j] = $bolangloc;//把定位器的名称保存到变量里   复制出来的定位器的名字
   }
  ///////////////////创建曲线///////////////////
   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $kaishi_pos_B[]=`xform -q -ws -t  ($qvxian_D+".cv[+"+size($grpchids)+"]")`;
    int $panduan=`objExists ($qvxian_D+"_bolang")`;
    if($panduan==1){ delete ($qvxian_D+"_bolang");}
    
  curve -d 1 -p $kaishi_pos_A[0] $kaishi_pos_A[1] $kaishi_pos_A[2] -p $kaishi_pos_B[0] $kaishi_pos_B[1] $kaishi_pos_B[2] -n($qvxian_D+"_bolang"); //创建曲线
  setAttr ($qvxian_D+"_bolang.visibility") 0;
  setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang.v");
  rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s 2 -d 3 -tol 0.01 ($qvxian_D+"_bolang");//重建曲线
  /////////////创建曲线信息节点///////////////////////////
     int $panduan=`objExists ($qvxian_D+"qvxianzuijingdianjiedian")`;
     if($panduan==1){ delete ($qvxian_D+"qvxianzuijingdianjiedian");}
   createNode nearestPointOnCurve -n ($qvxian_D+"qvxianzuijingdianjiedian");//创建曲线最近点节点
   string $qvxian_D_shp[]=`listRelatives -s $qvxian_D`;
   connectAttr -force ($qvxian_D_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点

    
    /////////////////判断是否翻转曲线起始点/////////////////
    
    float $dian_temp_kaishi[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[0]")`;
    float $dian_temp_jiesu[]=`xform -q -ws -t ($qvxian_D+"_bolang.cv[4]")`;
    float $dian_temp_kaishi_A[]=`xform -q -ws -t ($qvxian_D+".cv[0]")`;
    float$dis=mag(<<$dian_temp_kaishi[0],$dian_temp_kaishi[1],$dian_temp_kaishi[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);
    float$dis_a=mag(<<$dian_temp_jiesu[0],$dian_temp_jiesu[1],$dian_temp_jiesu[2]>>-<<$dian_temp_kaishi_A[0],$dian_temp_kaishi_A[1],$dian_temp_kaishi_A[2]>>);

    if($dis>$dis_a){reverseCurve -ch 0 -rpo 1 ($qvxian_D+"_bolang");}
    parent ($qvxian_D+"_bolang") $boliang;
    
    //////////////////创建蔟//////////////
    int $cv_size=5;
    for($a=0;$a<$cv_size;$a++)//创建蔟
     {
      select -r ($qvxian_D+"_bolang.cv["+$a+"]"); 
       
     CreateCluster ;
     rename ($qvxian_D+"_bolang_cu_"+$a);
     spaceLocator -p 0 0 0 -n ($qvxian_D+"_bolang_cu_loc_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_D_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_C_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_B_"+$a);
     group -n ($qvxian_D+"_bolang_cu_grp_A_"+$a);
     setAttr ($qvxian_D+"_bolang_cu_grp_A_"+$a+".visibility") 0;
     setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolang_cu_grp_A_"+$a+".v");
     delete`pointConstraint  ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_grp_A_"+$a)`;
     parent ($qvxian_D+"_bolang_cu_"+$a) ($qvxian_D+"_bolang_cu_loc_"+$a);
     parent ($qvxian_D+"_bolang_cu_grp_A_"+$a) $boliang;
      }
     
     ///////////////////////蔟控制复制出来定位器//////////////////////////////
     
     
      int $panduan_A=`objExists ($qvxian_D+"_bolanggrp"+"_A")`;
      if ($panduan_A==0)
      { select -cl  ;
        group -empty -n ($qvxian_D+"_bolanggrp"+"_A");
        setAttr ($qvxian_D+"_bolanggrp"+"_A"+".visibility") 0;
        setAttr -lock true -keyable false -channelBox false ($qvxian_D+"_bolanggrp"+"_A"+".v");
       }
    string $qvxian_D_boliang_shp[]=`listRelatives -s ($qvxian_D+"_bolang")`;
   connectAttr -force ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($qvxian_D+"qvxianzuijingdianjiedian"+".inputCurve");//曲线链接到曲线信息节点
   for($aa=0;$aa<size($objloc_d);$aa++)
   {
        string $loc_d=$objloc_d[$aa];
        float $pos[]=`xform -q -ws -t $loc_d`;
       setAttr -type float3  ($qvxian_D+"qvxianzuijingdianjiedian.inPosition") $pos[0] $pos[1] $pos[2];
      float $weozh=`getAttr  ($qvxian_D+"qvxianzuijingdianjiedian.parameter")`;
      
      int $panduan_l=`objExists ($loc_d+"_pointOnCurveInfo_"+$aa)`;
      if($panduan_l==1){delete ($loc_d+"_pointOnCurveInfo_"+$aa); }
     createNode "pointOnCurveInfo" -n ($loc_d+"_pointOnCurveInfo_"+$aa);//创建曲线最近点节点
     connectAttr -force  ($qvxian_D_boliang_shp[0]+".worldSpace[0]")  ($loc_d+"_pointOnCurveInfo_"+$aa+".inputCurve");
     setAttr ($loc_d+"_pointOnCurveInfo_"+$aa+".parameter") $weozh;
     
     spaceLocator -p 0 0 0 -n ( $loc_d+"_A_loc_"+$a);
     connectAttr -force ($loc_d+"_pointOnCurveInfo_"+$aa+".position") ( $loc_d+"_A_loc_"+$a+".t");
     parent ( $loc_d+"_A_loc_"+$a) ($qvxian_D+"_bolanggrp"+"_A");
     pointConstraint -mo ( $loc_d+"_A_loc_"+$a)   $loc_d;
   }
  
   delete  ($qvxian_D+"qvxianzuijingdianjiedian");
   parent ($qvxian_D+"_bolanggrp"+"_A") $boliang;
   
   ///////////////////创建控制器////////////////////////
   
   string $qvxianname=($qvxian_D+"UP_bolangqvxian");
   if($i==1){$qvxianname=($qvxian_D+"DN_bolangqvxian");}
   
    string$head_Controller=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
   zxb_ADD_shuxing_string_proc($head_Controller,"boliang_controller");
    string$all_boliang_controller_temp=`getAttr ($head_Controller+".boliang_controller")`;
   string$all_Controller=$qvxianname+" ";
   if($all_boliang_controller_temp=="")
     { 
     setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
    
    }
   else
   {
       
   $all_Controller=$all_boliang_controller_temp+" "+$all_Controller;
   setAttr -type "string" ($head_Controller+".boliang_controller") $all_Controller;
   }
  
   
 

   float $kaishi_pos_A[]=`xform -q -ws -t  ($qvxian_D+".cv[0]")`;
   float $qvxian_MM_pos[]=`xform -q -ws -t  ($qvxian_D+"_bolang.cv[2]")`;
   float $rsd= `abs($kaishi_pos_A[0])`;
  circle -c 0 0 0 -nr 0 1 0 -sw 360 -r $rsd -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $qvxianname; 
  group -n ($qvxianname+"_grp_B");
  group -n ($qvxianname+"_grp_A");
  select -r  ($qvxianname+".cv[0]") ($qvxianname+".cv[2]") ($qvxianname+".cv[4]") ($qvxianname+".cv[6]") ;
  scale -r -p 0cm 0cm 0cm 0.417937 0.417937 0.417937 ;
  if($i==0)
  {  
  move -r -os -wd 0 ($rsd*0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*0.5) ($rsd*1.5) ;
  }else
  {
  move -r -os -wd 0 ($rsd*-0.5) 0 ;
  select -r  ($qvxianname+".cv[0:99999999]");
  move -r -os -wd 0 ($rsd*-0.5) ($rsd*1.5) ;
  }
 
  xform  -ws -t $qvxian_MM_pos[0] $qvxian_MM_pos[1] $qvxian_MM_pos[2]($qvxianname+"_grp_A");
  
  string $shape[]=`listRelatives -s $qvxianname`;
    setAttr ($shape[0]+".overrideEnabled") 1;
    setAttr ($shape[0]+".overrideColor") 16;
  parent   ($qvxianname+"_grp_A") "Face_zipper_Group";
  
    
    
    ////////////////////表达式//////////////////////////
   
    float $rsd= ($kaishi_pos_A[0]*0.35);
    float$aaaa= `abs ($rsd)`;
     float $temp=$aaaa;
    addAttr -ln "upty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "dnty"  -at double  -dv 1 -k 1 $qvxianname;
    addAttr -ln "pianyi"  -at double  -dv 0 -k 1 $qvxianname;
    addAttr -ln "upsl"  -at double  -dv $temp -k 1 $qvxianname;
    addAttr -ln "dntsl"  -at double  -dv ($temp*-1) -k 1 $qvxianname;
    setAttr -keyable false -channelBox true ($qvxianname+".upsl");
    setAttr -keyable false -channelBox true ($qvxianname+".dntsl");
    string $grp_C1=($qvxian_D+"_bolang_cu_grp_C_1");
    string $grp_C2=($qvxian_D+"_bolang_cu_grp_C_2");
    string $grp_C3=($qvxian_D+"_bolang_cu_grp_C_3");
    string $grp_B1=($qvxian_D+"_bolang_cu_grp_B_1");
    string $grp_B2=($qvxian_D+"_bolang_cu_grp_B_2");
    string $grp_B3=($qvxian_D+"_bolang_cu_grp_B_3");
    float $temp_[]=`xform -q -ws -t  $grp_C2`;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B3+".scalePivot") ($grp_B3+".rotatePivot") ;
    move -rpr $temp_[0] $temp_[1] $temp_[2] ($grp_B1+".scalePivot") ($grp_B1+".rotatePivot") ;
    string $exp="";
    $exp+=($grp_C1+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6+"+$qvxianname+".tx));\n");
    $exp+=($grp_C3+".ty=clamp(("+$qvxianname+".dntsl*"+$qvxianname+".dnty),("+$qvxianname+".upsl*"+$qvxianname+".upty),("+$qvxianname+".ty*0.6-"+$qvxianname+".tx));\n");
    $exp+=($grp_C2+".ty=("+$grp_C1+".ty+"+$grp_C3+".ty);\n");
    $exp+=($grp_C1+".tz="+$grp_C3+".tz=("+$qvxianname+".tz*0.5);\n");
    $exp+=($grp_B2+".tz=("+$grp_B1+".tz+"+$grp_B3+".tz);\n");
    $exp+=($grp_B1+".sx="+$grp_B3+".sx=("+$qvxianname+".sx);\n");
    $exp+=($grp_C1+".tx="+$grp_C2+".tx="+$grp_C3+".tx="+$qvxianname+".pianyi*0.1;\n");
    $exp+=($grp_B3+".rx="+$grp_B1+".rx="+$qvxianname+".rx;\n");
    $exp+=($grp_B3+".ry="+$grp_B1+".ry="+$qvxianname+".ry;\n");
    $exp+=($grp_B3+".rz="+$grp_B1+".rz="+$qvxianname+".rz;\n");
int$panduan_biaodashi=`objExists ($qvxian_D+"_biaodashi")`;
if($panduan_biaodashi==1){delete ($qvxian_D+"_biaodashi") ;}
expression -s $exp  -o ($qvxian_D+"_biaodashi") -ae 1 -uc all ;

}
}



///////////////////////////////创建表情控制面板////////////////////////////////////////////////////////////////
global proc zxb_zxb_all_faceFrame_proc()
{
 zxb_zxb_faceFrame_proc;//创建面板
 zxb_qvdong_faceFrame_proc;//设置驱动
}


global proc zxb_qvdong_faceFrame_proc()
{

string$jaw_controller=`textFieldGrp -q -tx "UI_jaw_controller" `;
string$head_controller=`textFieldGrp -q -tx "UI_head_controller"`;
string$zhengticon=`getAttr ($head_controller+".jaw_controller")`;
string$Corner_array[]={"ctrlMouthCorner_R","ctrlMouthCorner_L","ctrlMouth_M","ctrlMouth_MM", "ctrlMouth_MMUP" , "ctrlMouth_MMDW","ctrlNose_R","ctrlNose_L" ,"ctrlCheek_R","ctrlCheek_L","ctrlEye_R","ctrlEye_L","ctrlBrow_R","ctrlBrow_L"};
string$cheek_conss=`getAttr ($head_controller+".cheek_con")`;
string$cheek_cons[]=stringToStringArray($cheek_conss, " ");
for ($i=0;$i<size($Corner_array);$i++)
    {
       string$Corner=$Corner_array[$i];
       string$Corner_frame=$Corner+"_frame";
       if($Corner=="ctrlMouthCorner_R")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") -1.5;
           setAttr ($Corner_frame+".translateY") -4.5;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }

           
           
            string $cheek_cons_fu[]=`listRelatives -p $cheek_cons[0]`;
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_R.translateY" ($cheek_cons_fu[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1  -cd "ctrlMouthCorner_R.translateY" ($cheek_cons_fu[0]+".translateX");  
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_R.translateY" ($cheek_cons_fu[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1  -cd "ctrlMouthCorner_R.translateY" ($cheek_cons_fu[0]+".translateX");  
           
           
            setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_R.translateX" ($cheek_cons_fu[0]+".translateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1  -cd "ctrlMouthCorner_R.translateX" ($cheek_cons_fu[0]+".translateZ");  
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_R.translateX" ($cheek_cons_fu[0]+".translateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1  -cd "ctrlMouthCorner_R.translateX" ($cheek_cons_fu[0]+".translateZ");  
           
           
           
         }
          if($Corner=="ctrlMouthCorner_L")
         {
            zxb_anniu_fangxing($Corner);  
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") 1.5;
           setAttr ($Corner_frame+".translateY") -4.5;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           string $cheek_cons_fu[]=`listRelatives -p $cheek_cons[1]`;
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_L.translateY" ($cheek_cons_fu[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1  -cd "ctrlMouthCorner_L.translateY" ($cheek_cons_fu[0]+".translateX");  
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_L.translateY" ($cheek_cons_fu[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1  -cd "ctrlMouthCorner_L.translateY" ($cheek_cons_fu[0]+".translateX");  
           
           
            setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_L.translateX" ($cheek_cons_fu[0]+".translateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1  -cd "ctrlMouthCorner_L.translateX" ($cheek_cons_fu[0]+".translateZ");  
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouthCorner_L.translateX" ($cheek_cons_fu[0]+".translateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1  -cd "ctrlMouthCorner_L.translateX" ($cheek_cons_fu[0]+".translateZ");  
         }
         
           if($Corner=="ctrlMouth_M")
         {
             string $fujiedians[]=`listRelatives -p  ($jaw_controller)`;
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouth_M.translateY" ($fujiedians[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv-1  -v 20 -cd "ctrlMouth_M.translateY" ($fujiedians[0]+".rotateZ"); //设置驱动张嘴
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouth_M.translateY" ($zhengticon+".translateY");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd "ctrlMouth_M.translateY" ($zhengticon+".translateY"); //设置驱动嘴巴向上顶
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 1  -cd "ctrlMouth_M.translateX" ($zhengticon+".scaleZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 0.5 -cd "ctrlMouth_M.translateX" ($zhengticon+".scaleZ"); //设置驱动张嘴
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 1  -cd "ctrlMouth_M.translateX" ($zhengticon+".scaleZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1.2 -cd "ctrlMouth_M.translateX" ($zhengticon+".scaleZ"); //设置驱动张嘴
           zxb_ADD_shuxing_double_B_proc("ctrlMouth_M","Face_open_reverse",0,10) ;
           zxb_ADD_shuxing_double_B_proc("ctrlMouth_M","lalian_L",0,10) ;
           zxb_ADD_shuxing_double_B_proc("ctrlMouth_M","lalian_R",0,10) ;
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouth_M.Face_open_reverse" ($jaw_controller+".Face_open_reverse");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv  10  -v 10 -cd "ctrlMouth_M.Face_open_reverse" ($jaw_controller+".Face_open_reverse"); //设置驱动张嘴
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouth_M.lalian_L" ($jaw_controller+".lalian_L");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv  10  -v 10 -cd "ctrlMouth_M.lalian_L" ($jaw_controller+".lalian_L"); //设置驱动张嘴
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd "ctrlMouth_M.lalian_R" ($jaw_controller+".lalian_R");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv  10  -v 10 -cd "ctrlMouth_M.lalian_R" ($jaw_controller+".lalian_R"); //设置驱动张嘴
           
           
           
           
          
         }
          if($Corner=="ctrlMouth_MM")
            {
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($zhengticon+".translateY");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ($Corner+".translateY") ($zhengticon+".translateY"); //设置驱动嘴巴向上顶
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($zhengticon+".translateY");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ($Corner+".translateY")($zhengticon+".translateY"); //设置驱动嘴巴向上顶
               setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateX") ($zhengticon+".translateX");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ($Corner+".translateX") ($zhengticon+".translateX"); //设置驱动嘴巴向上顶
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateX") ($zhengticon+".translateX");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ($Corner+".translateX")($zhengticon+".translateX"); //设置驱动嘴巴向上顶
             }
          if($Corner=="ctrlMouth_MMUP")
            {
             string$all_boliang_controller=`getAttr ($head_controller+".boliang_controller")`;
             string$all_boliang_controllers[]=stringToStringArray($all_boliang_controller, "   ");
             
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($all_boliang_controllers[0]+".translateY");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ($Corner+".translateY") ($all_boliang_controllers[0]+".translateY") ; 
              
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateY")($all_boliang_controllers[0]+".translateY") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ($Corner+".translateY") ($all_boliang_controllers[0]+".translateY"); 
              
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($all_boliang_controllers[0]+".translateX") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ($Corner+".translateX")($all_boliang_controllers[0]+".translateX"); 
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($all_boliang_controllers[0]+".translateX") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ($Corner+".translateX")($all_boliang_controllers[0]+".translateX"); 
             
             } 
             
             if($Corner=="ctrlMouth_MMDW")
            {
             string$all_boliang_controller=`getAttr ($head_controller+".boliang_controller")`;
             string$all_boliang_controllers[]=stringToStringArray($all_boliang_controller, " ");
             
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($all_boliang_controllers[1]+".translateY");  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ($Corner+".translateY") ($all_boliang_controllers[1]+".translateY") ; 
              
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateY")($all_boliang_controllers[1]+".translateY") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ($Corner+".translateY") ($all_boliang_controllers[1]+".translateY"); 
              
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($all_boliang_controllers[1]+".translateX") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ($Corner+".translateX")($all_boliang_controllers[1]+".translateX"); 
              setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($all_boliang_controllers[1]+".translateX") ;  
              setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ($Corner+".translateX")($all_boliang_controllers[1]+".translateX"); 
             
             } 
        
        
        if($Corner=="ctrlNose_R")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") -1.5;
           setAttr ($Corner_frame+".translateY") -0.5;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           
         }
       if($Corner=="ctrlNose_L")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") 1.5;
           setAttr ($Corner_frame+".translateY") -0.5;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
         }
         
         
       if($Corner=="ctrlCheek_R")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") -1.5;
           setAttr ($Corner_frame+".translateY") 1.2;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;

           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
         }
       if($Corner=="ctrlCheek_L")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") 1.5;
           setAttr ($Corner_frame+".translateY") 1.2;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
         }
       if($Corner=="ctrlEye_R")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") -1.5;
           setAttr ($Corner_frame+".translateY") 2.9;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           select -r ctrlEye_R ;
           duplicate -rr -n "ctrlEye_R_UP" ;
           select -r ctrlEye_R_UP.cv[0:9999999] ;
           scale  2 2 2   ;
           select -r ctrlEye_R_UP.cv[5] ;
           move -r -os -wd 0 0.5 0 ;
           select -r ctrlEye_R_UP.cv[4] ctrlEye_R_UP.cv[6] ;
           move -r -os -wd 0 0.3 0 ;
           select -r ctrlEye_R ;
           duplicate -rr -n "ctrlEye_R_DW" ;
           select -r ctrlEye_R_DW.cv[0:9999999] ;
           scale  2 2 2   ;
           select -r ctrlEye_R_DW.cv[1] ;
           move -r -os -wd 0 -0.5 0 ;
           select -r ctrlEye_R_DW.cv[0] ctrlEye_R_DW.cv[2] ;
           move -r -os -wd 0 -0.3 0 ;
           select -r ctrlEye_R ;
           duplicate -rr -n "ctrlEye_R_MM" ;
           select -r ctrlEye_R_MM.cv[0:9999999] ;
           scale  3 3 3    ;
           string$all_boliang_controller=`getAttr ($head_controller+".boliang_controller")`;
           string$all_boliang_controllers[]=stringToStringArray($all_boliang_controller, "   ");
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_R_UP"+".translateY") ($all_boliang_controllers[2]+".translateY");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ("ctrlEye_R_UP"+".translateY") ($all_boliang_controllers[2]+".translateY") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_UP"+".translateY")($all_boliang_controllers[2]+".translateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ("ctrlEye_R_UP"+".translateY") ($all_boliang_controllers[2]+".translateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_UP"+".translateX")($all_boliang_controllers[2]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ("ctrlEye_R_UP"+".translateX")($all_boliang_controllers[2]+".translateX"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_UP"+".translateX")($all_boliang_controllers[2]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ("ctrlEye_R_UP"+".translateX")($all_boliang_controllers[2]+".translateX"); 

           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_R_DW"+".translateY") ($all_boliang_controllers[3]+".translateY");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ("ctrlEye_R_DW"+".translateY") ($all_boliang_controllers[3]+".translateY") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_DW"+".translateY")($all_boliang_controllers[3]+".translateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ("ctrlEye_R_DW"+".translateY") ($all_boliang_controllers[3]+".translateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_DW"+".translateX")($all_boliang_controllers[3]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ("ctrlEye_R_DW"+".translateX")($all_boliang_controllers[3]+".translateX"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_DW"+".translateX")($all_boliang_controllers[3]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ("ctrlEye_R_DW"+".translateX")($all_boliang_controllers[3]+".translateX"); 
           
           string$all_eye_con=`getAttr ($head_controller+".eye_con")`;
           string$all_eye_con_s[]=stringToStringArray($all_eye_con, "   ");
           string $fu_s[]=`listRelatives -p $all_eye_con_s[0]`; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_R_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd   ("ctrlEye_R_MM"+".translateY") ($fu_s[0]+".rotateZ") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd ("ctrlEye_R_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_MM"+".translateX")($fu_s[0]+".rotateY");  ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd    ("ctrlEye_R_MM"+".translateX")($fu_s[0]+".rotateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_R_MM"+".translateX")($fu_s[0]+".rotateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd  ("ctrlEye_R_MM"+".translateX")($fu_s[0]+".rotateY");
           
           string$all_eye_con_B=`getAttr ($head_controller+".eye_con_b")`;
           string$all_eye_con_B_s[]=stringToStringArray($all_eye_con_B, "   ");
           string $fu_A_s[]=`listRelatives -p $all_eye_con_B_s[0]`; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd   ($Corner+".translateY") ($fu_A_s[0]+".rotateZ") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($fu_A_s[0]+".rotateY");  ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd    ($Corner+".translateX")($fu_A_s[0]+".rotateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($fu_A_s[0]+".rotateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd  ($Corner+".translateX")($fu_A_s[0]+".rotateY");  
           
           zxb_ADD_shuxing_double_A_proc("ctrlEye_R_MM","lalian_L");
           zxb_ADD_shuxing_double_A_proc("ctrlEye_R_MM","lalian_R");
           string$eye_lalianloc_R_all=`getAttr ($head_controller+".eye_lalianloc_R")`;
           string$eye_lalianloc_R_all_s[]=stringToStringArray($eye_lalianloc_R_all, " ");
           
           float $trs_A=`getAttr ($eye_lalianloc_R_all_s[0]+".translateX")`;
           float $trs_B=`getAttr ($eye_lalianloc_R_all_s[1]+".translateX")`;
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v $trs_A  -cd  ("ctrlEye_R_MM.lalian_L") ($eye_lalianloc_R_all_s[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 10  -v $trs_B -cd    ("ctrlEye_R_MM.lalian_L") ($eye_lalianloc_R_all_s[0]+".translateX"); 
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v$trs_B  -cd  ("ctrlEye_R_MM.lalian_R") ($eye_lalianloc_R_all_s[1]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 10  -v $trs_A  -cd    ("ctrlEye_R_MM.lalian_R") ($eye_lalianloc_R_all_s[1]+".translateX"); 
           
         }
       if($Corner=="ctrlEye_L")
         { 
           zxb_anniu_fangxing($Corner);
           softSelect-softSelectEnabled 0;
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") 1.5;
           setAttr ($Corner_frame+".translateY") 2.9;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           
           select -r ctrlEye_L ;
           duplicate -rr -n "ctrlEye_L_UP" ;
           select -r ctrlEye_L_UP.cv[0:9999999] ;
           scale  2 2 2   ;
           select -r ctrlEye_L_UP.cv[5] ;
           move -r -os -wd 0 0.5 0 ;
           select -r ctrlEye_L_UP.cv[4] ctrlEye_L_UP.cv[6] ;
           move -r -os -wd 0 0.3 0 ;
           select -r ctrlEye_L ;
           duplicate -rr -n "ctrlEye_L_DW" ;
           select -r ctrlEye_L_DW.cv[0:9999999] ;
           scale  2 2 2   ;
           select -r ctrlEye_L_DW.cv[1] ;
           move -r -os -wd 0 -0.5 0 ;
           select -r ctrlEye_L_DW.cv[0] ctrlEye_L_DW.cv[2] ;
           move -r -os -wd 0 -0.3 0 ;
           select -r ctrlEye_L ;
           duplicate -rr -n "ctrlEye_L_MM" ;
           select -r ctrlEye_L_MM.cv[0:9999999] ;
           scale  3 3 3    ;
           
           
            string$all_boliang_controller=`getAttr ($head_controller+".boliang_controller")`;
           string$all_boliang_controllers[]=stringToStringArray($all_boliang_controller, "   ");
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_L_UP"+".translateY") ($all_boliang_controllers[4]+".translateY");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ("ctrlEye_L_UP"+".translateY") ($all_boliang_controllers[4]+".translateY") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_UP"+".translateY")($all_boliang_controllers[4]+".translateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ("ctrlEye_L_UP"+".translateY") ($all_boliang_controllers[4]+".translateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_UP"+".translateX")($all_boliang_controllers[4]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ("ctrlEye_L_UP"+".translateX")($all_boliang_controllers[4]+".translateX"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_UP"+".translateX")($all_boliang_controllers[4]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ("ctrlEye_L_UP"+".translateX")($all_boliang_controllers[4]+".translateX"); 
           
           
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_L_DW"+".translateY") ($all_boliang_controllers[5]+".translateY");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd   ("ctrlEye_L_DW"+".translateY") ($all_boliang_controllers[5]+".translateY") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_DW"+".translateY")($all_boliang_controllers[5]+".translateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd ("ctrlEye_L_DW"+".translateY") ($all_boliang_controllers[5]+".translateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_DW"+".translateX")($all_boliang_controllers[5]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v 1 -cd    ("ctrlEye_L_DW"+".translateX")($all_boliang_controllers[5]+".translateX"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_DW"+".translateX")($all_boliang_controllers[5]+".translateX") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v -1 -cd  ("ctrlEye_L_DW"+".translateX")($all_boliang_controllers[5]+".translateX"); 
           
           
           string$all_eye_con=`getAttr ($head_controller+".eye_con")`;
           string$all_eye_con_s[]=stringToStringArray($all_eye_con, "   ");
           string $fu_s[]=`listRelatives -p $all_eye_con_s[1]`; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ("ctrlEye_L_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd   ("ctrlEye_L_MM"+".translateY") ($fu_s[0]+".rotateZ") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd ("ctrlEye_L_MM"+".translateY") ($fu_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_MM"+".translateX")($fu_s[0]+".rotateY");  ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd    ("ctrlEye_L_MM"+".translateX")($fu_s[0]+".rotateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ("ctrlEye_L_MM"+".translateX")($fu_s[0]+".rotateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd  ("ctrlEye_L_MM"+".translateX")($fu_s[0]+".rotateY");
           
           string$all_eye_con_B=`getAttr ($head_controller+".eye_con_b")`;
           string$all_eye_con_B_s[]=stringToStringArray($all_eye_con_B, "   ");
           string $fu_A_s[]=`listRelatives -p $all_eye_con_B_s[1]`; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd   ($Corner+".translateY") ($fu_A_s[0]+".rotateZ") ; 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd ($Corner+".translateY") ($fu_A_s[0]+".rotateZ");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($fu_A_s[0]+".rotateY");  ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v -15 -cd    ($Corner+".translateX")($fu_A_s[0]+".rotateY"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd   ($Corner+".translateX")($fu_A_s[0]+".rotateY") ;  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v 15 -cd  ($Corner+".translateX")($fu_A_s[0]+".rotateY");  
           
           
           zxb_ADD_shuxing_double_A_proc("ctrlEye_L_MM","lalian_L");
           zxb_ADD_shuxing_double_A_proc("ctrlEye_L_MM","lalian_L");
           string$eye_lalianloc_L_all=`getAttr ($head_controller+".eye_lalianloc_L")`;
           string$eye_lalianloc_L_all_s[]=stringToStringArray($eye_lalianloc_L_all, " ");
           
           float $trs_A=`getAttr ($eye_lalianloc_L_all_s[0]+".translateX")`;
           float $trs_B=`getAttr ($eye_lalianloc_L_all_s[1]+".translateX")`;
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v $trs_A  -cd  ("ctrlEye_L_MM.lalian_L") ($eye_lalianloc_L_all_s[0]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 10  -v $trs_B -cd    ("ctrlEye_L_MM.lalian_L") ($eye_lalianloc_L_all_s[0]+".translateX"); 
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v $trs_B   -cd  ("ctrlEye_L_MM.lalian_L") ($eye_lalianloc_L_all_s[1]+".translateX");  
           setDrivenKeyframe -itt "linear" -ott "spline" -dv 10  -v $trs_A  -cd    ("ctrlEye_L_MM.lalian_L") ($eye_lalianloc_L_all_s[1]+".translateX"); 
           
           
         }
         
       if($Corner=="ctrlBrow_R")
         { 
         softSelect-softSelectEnabled 0;
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") -1.5;
           setAttr ($Corner_frame+".translateY") 4.7;
          string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           
           
         }
         if($Corner=="ctrlBrow_L")
         { 
           zxb_anniu_fangxing($Corner);
           setAttr -type float3 ($Corner_frame+".scale") 0.5 0.5 0.5;
           setAttr ($Corner_frame+".translateX") 1.5;
           setAttr ($Corner_frame+".translateY") 4.7;
           string $shape[]=`listRelatives  -s $Corner_frame`;
           setAttr ($shape[0]+".overrideEnabled") 1;
           setAttr ( $shape[0]+".overrideDisplayType") 2;
           setAttr ($shape[1]+".overrideEnabled") 1;
           setAttr ( $shape[1]+".overrideDisplayType") 2;
           
           string $tex_ssss[]=`listRelatives  -type "transform"  -c  $Corner_frame`;
           string$qvxian_temp_sss=$tex_ssss[1];
           string $tex_ssss_qvxian[]=`listRelatives    -c  $qvxian_temp_sss`;
           string $qvxian_temp_sss_suzu[]=`listRelatives  -s $tex_ssss_qvxian[0]`;
           for ($uuu=0;$uuu<size($qvxian_temp_sss_suzu);$uuu++)
               {
                 string$temp_shep_aaa=$qvxian_temp_sss_suzu[$uuu];
                setAttr ($temp_shep_aaa+".overrideEnabled") 1;
                setAttr ( $temp_shep_aaa+".overrideDisplayType") 2;
    
                }
           
         }
 
   }
   
   
string$head_controller=`textFieldGrp -q -tx "UI_head_controller"`;
string$all_lip_con_sss=`getAttr ($head_controller+".lip_secondarycontroller")`;
string$all_head_faceFrame_lip_sss=`getAttr ($head_controller+".head_faceFrame_lip")`;
string$all_lip_con_s[]=stringToStringArray($all_lip_con_sss, " ");
string$all_head_faceFrame_lip_s[]=stringToStringArray($all_head_faceFrame_lip_sss, " ");
string$Mouth_sub_L_UP_B=$all_head_faceFrame_lip_s[3];
string$Mouth_sub_L_UP_A=$all_head_faceFrame_lip_s[2];
string$Mouth_sub_M_UP=$all_head_faceFrame_lip_s[0];
string$Mouth_sub_M_DW=$all_head_faceFrame_lip_s[1];
string$Mouth_sub_R_UP_B=$all_head_faceFrame_lip_s[5];
string$Mouth_sub_R_UP_A=$all_head_faceFrame_lip_s[4];
string$Mouth_sub_L_DW_B=$all_head_faceFrame_lip_s[7];
string$Mouth_sub_L_DW_A=$all_head_faceFrame_lip_s[6];
string$Mouth_sub_R_DW_B=$all_head_faceFrame_lip_s[9];
string$Mouth_sub_R_DW_A=$all_head_faceFrame_lip_s[8];
string$all_faceFrame_ss[]={$Mouth_sub_L_UP_B,$Mouth_sub_L_UP_A,$Mouth_sub_M_UP,$Mouth_sub_R_UP_A,$Mouth_sub_R_UP_B,$Mouth_sub_L_DW_B,$Mouth_sub_L_DW_A,$Mouth_sub_M_DW,$Mouth_sub_R_DW_A,$Mouth_sub_R_DW_B};

for($i=0;$i<size($all_faceFrame_ss);$i++)
   {
   	string$temp_faceFrame_s=$all_faceFrame_ss[$i];
   	string$temp_lipcon_s=$all_lip_con_s[$i];
   	string $temp_lipcon_s_grp_A[]=`listRelatives -p $temp_lipcon_s`;
   	string $temp_lipcon_s_grp_B[]=`listRelatives -p $temp_lipcon_s_grp_A[0]`;
   	string $temp_lipcon_s_grp_C[]=`listRelatives -p $temp_lipcon_s_grp_B[0]`;
   	string $temp_lipcon_s_grp_D[]=`listRelatives -p $temp_lipcon_s_grp_C[0]`;
   	string $temp_lipcon_s_grp_E[]=`listRelatives -p $temp_lipcon_s_grp_D[0]`;
   	string $temp_lipcon_s_grp_F[]=`listRelatives -p $temp_lipcon_s_grp_E[0]`;
   	string $temp_lipcon_s_grp_G[]=`listRelatives -p $temp_lipcon_s_grp_F[0]`;
   	float$temo_float=1;
   	float$temo_float_a=-1;
   	if($i>=5){$temo_float=-1; $temo_float_a=1;}
   	setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($temp_faceFrame_s+".translateX") ($temp_lipcon_s_grp_G[0]+".translateX");  
     setDrivenKeyframe -itt "linear" -ott "spline" -dv 1  -v $temo_float -cd   ($temp_faceFrame_s+".translateX") ($temp_lipcon_s_grp_G[0]+".translateX") ; 
     
     setDrivenKeyframe -itt "linear" -ott "spline" -dv 0  -v 0  -cd  ($temp_faceFrame_s+".translateX") ($temp_lipcon_s_grp_G[0]+".translateX");  
     setDrivenKeyframe -itt "linear" -ott "spline" -dv -1  -v $temo_float_a -cd   ($temp_faceFrame_s+".translateX") ($temp_lipcon_s_grp_G[0]+".translateX") ;

   	
   }

  
  
  
 
 button -e -en 0 hedemianbankuan_wancheng_button;
}

global proc zxb_zxb_faceFrame_proc()
{
$teststring=`textFieldGrp -q -tx UI_head_mode `;
$con=`textFieldGrp -q -tx UI_head_controller `;
int$ex=`objExists $teststring`; 
if($ex==0){ error  "头部模型没有载入" ;}
int$ex=`objExists $con`; 
if($ex==0){ error  "头部控制器没有载入" ;}
string $mode_sheps[]=`listRelatives -s $teststring`;
int$ex=`objExists ($mode_sheps[0]+".outMesh")`; 
if($ex==0){ error  "载入的头部物体不是多边形网格" ;}
string$faceFrame="zxb_faceFrame";
curve -d 3 -p -6 -6 0 -p 6 -6 0 -p 6 -6 0 -p 6 -6 0 -p 6 6 0 -p 6 6 0 -p 6 6 0 -p -6 6 0 -p -6 6 0 
-p -6 6 0 -p -6 -6 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8  -n $faceFrame;
setAttr ($faceFrame+".scaleX") 0.5;
select -r $faceFrame;
channelBoxCommand -freezeScale;
select -r  $faceFrame;
duplicate -rr -n ($faceFrame+"_temp");
scale 0.975 0.975 0.975;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
pickWalk -d down;
select -add  $faceFrame;
parent -s -r;
delete ($faceFrame+"_temp");
select -r $faceFrame;
addAttr -ln "FrameHnum"  -at long;
string $con_sheps[]=`listRelatives -s $con`;
float$obx_Max[]=`getAttr ($con_sheps[0]+".boundingBoxMax")`;////绑定box节点
float$soce=$obx_Max[0]*0.1;
string$kongzu=$faceFrame+"_grp";
zxb_ADD_kongzuA_proc( $kongzu,$faceFrame);
string$lip_Frame="lip_Frame";
curve -d 3 -p -6 -6 0 -p 6 -6 0 -p 6 -6 0 -p 6 -6 0 -p 6 6 0 -p 6 6 0 -p 6 6 0 -p -6 6 0 -p -6 6 0 
-p -6 6 0 -p -6 -6 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8  -n $lip_Frame;
setAttr ($lip_Frame+".translateY") -2.6301722044;
setAttr ($lip_Frame+".scaleX") 0.35;
setAttr ($lip_Frame+".scaleY") 0.17;
makeIdentity -apply true -t 1 -r 1 -s 1 -n 0;

string $shape_a[]=`listRelatives  -s $lip_Frame`;
setAttr ( $shape_a[0]+".overrideEnabled") 1;
setAttr (  $shape_a[0]+".overrideDisplayType") 2;
parent $lip_Frame  $faceFrame;
select -r $lip_Frame;
makeIdentity -apply true -t 1 -r 1 -s 1 -n 0;

circle -ch 0 -o on -r 0.15 -n "ctrlMouth_M";

string$ctrlMouth_M_grp="ctrlMouth_M_grp";
zxb_ADD_kongzu_proc($ctrlMouth_M_grp);
delete `pointConstraint $lip_Frame $ctrlMouth_M_grp`;
parent  $ctrlMouth_M_grp $lip_Frame;
setAttr "ctrlMouth_M_grp.scaleX" 2;
setAttr "ctrlMouth_M_grp.scaleY" 0.8;

parent "ctrlMouth_M" $ctrlMouth_M_grp;

setAttr "ctrlMouth_M.rotateZ" 0;
setAttr "ctrlMouth_M.translateX" 0;
setAttr "ctrlMouth_M.translateY" 0;
setAttr "ctrlMouth_M.translateZ" 0;
setAttr "ctrlMouth_M.rotateX" 0;
setAttr "ctrlMouth_M.rotateY" 0;
setAttr "ctrlMouth_M.scaleZ" 1;
setAttr "ctrlMouth_M.scaleX" 1;
setAttr "ctrlMouth_M.scaleY" 1;
setAttr "ctrlMouth_M.scaleY" 1.2;
setAttr "ctrlMouth_M.scaleX" 0.5;
select -r "ctrlMouth_M";
makeIdentity -apply true -t 1 -r 1 -s 1 -n 0;
select -r "ctrlMouth_M";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.tz";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.rx";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.ry";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.rz";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.sx";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.sy";
setAttr -lock true -keyable false -channelBox false "ctrlMouth_M.sz";

transformLimits -tx -1 1 -etx 1 1 ctrlMouth_M;
transformLimits -ty -1 1 -ety 1 1 ctrlMouth_M;

setAttr ("ctrlMouth_M"+".overrideEnabled") 1;
setAttr ("ctrlMouth_M"+".overrideColor") 22;

select -r ctrlMouth_M ;
duplicate -rr -n "ctrlMouth_MM" ;

select -r ctrlMouth_M.cv[0:9999999] ;
scale -r -p 0cm -2.630172cm 0cm 4 4 4  ;

select -r ctrlMouth_MM.cv[0:9999999] ;
scale -r -p 0cm -2.630172cm 0cm 2 2 2  ;


select -r ctrlMouth_M ;
duplicate -rr -n "ctrlMouth_MMUP" ;
select -r ctrlMouth_MMUP.cv[0:9999999] ;
scale -r -p 0cm -2.630172cm 0cm 0.2 0.2 0.2   ;
select -r ctrlMouth_MMUP.cv[5] ;
move -r -os -wd 0 0.24304 0 ;
select -r ctrlMouth_MMUP.cv[4] ctrlMouth_MMUP.cv[6] ;
move -r -os -wd 0 0.135477 0 ;


select -r ctrlMouth_M ;
duplicate -rr -n "ctrlMouth_MMDW" ;
select -r ctrlMouth_MMDW.cv[0:9999999] ;
scale -r -p 0cm -2.630172cm 0cm 0.2 0.2 0.2  ;

select -r ctrlMouth_MMDW.cv[1] ;
move -r -os -wd 0 -0.24304 0 ;
select -r ctrlMouth_MMDW.cv[2] ctrlMouth_MMDW.cv[0] ;
move -r -os -wd 0 -0.135477 0 ;


zxb_ADD_shuxing_string_proc($con,"ctrlMouth_M");
setAttr -type "string"($con+".ctrlMouth_M") $lip_Frame;





string$all_ciji_name[]={"Mouth_sub_M_UP","Mouth_sub_M_DW","Mouth_sub_L_UP_A","Mouth_sub_L_UP_B","Mouth_sub_R_UP_A","Mouth_sub_R_UP_B","Mouth_sub_L_DW_A","Mouth_sub_L_DW_B","Mouth_sub_R_DW_A","Mouth_sub_R_DW_B"};
string$all_ciji_GRP_name[]={"Mouth_sub_M_UP_GRP","Mouth_sub_M_DW_GRP","Mouth_sub_L_UP_A_GRP","Mouth_sub_L_UP_B_GRP","Mouth_sub_R_UP_A_GRP","Mouth_sub_R_UP_B_GRP","Mouth_sub_L_DW_A_GRP","Mouth_sub_L_DW_B_GRP","Mouth_sub_R_DW_A_GRP","Mouth_sub_R_DW_B_GRP"};
string$all_ciji_GRP_As_name[]={"Mouth_sub_M_UP_GRP_As","Mouth_sub_M_DW_GRP_As","Mouth_sub_L_UP_A_GRP_As","Mouth_sub_L_UP_B_GRP_As","Mouth_sub_R_UP_A_GRP_As","Mouth_sub_R_UP_B_GRP_As","Mouth_sub_L_DW_A_GRP_As","Mouth_sub_L_DW_B_GRP_As","Mouth_sub_R_DW_A_GRP_As","Mouth_sub_R_DW_B_GRP_As"};
string$all_kongzhiqi_sss="";
for($i=0;$i<size($all_ciji_name);$i++)
   {
   string$temp_con_nem=$all_ciji_name[$i];
   $all_kongzhiqi_sss+=$temp_con_nem+" ";
   string$temp_grp_nem=$all_ciji_GRP_As_name[$i];
    string$temp_grp_nem_A=$all_ciji_GRP_name[$i];
   curve -d 1 -p -4 0 0 -p -2 0 2 -p -2 0 1 -p 2 0 1 -p 2 0 2 -p 4 0 0 -p 2 0 -2 -p 2 0 -1 -p -2 0 -1 -p -2 0 -2 -p -4 0 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 9 -k 10 -n $temp_con_nem;
   string $Mouth_sub_M_UP_shep[]=`listRelatives  -s $temp_con_nem`;
   setAttr ( $Mouth_sub_M_UP_shep[0]+".overrideEnabled") 1;
   setAttr ( $Mouth_sub_M_UP_shep[0]+".overrideColor") 13;
   zxb_ADD_kongzuA_proc($temp_grp_nem_A,$temp_con_nem);
   zxb_ADD_kongzuA_proc($temp_grp_nem,$temp_grp_nem_A);
   setAttr ($temp_grp_nem+".rotateX") 90;
   setAttr ($temp_grp_nem+".rotateZ") 90;
   setAttr  ($temp_grp_nem+".scaleX") 0.02;
   setAttr  ($temp_grp_nem+".scaleY") 0.02;
   setAttr  ($temp_grp_nem+".scaleZ") 0.02;
   
  
   
   parent  $temp_grp_nem $ctrlMouth_M_grp;
   setAttr ($temp_grp_nem+".translateX") 0;
   setAttr ($temp_grp_nem+".translateY") 0;
   setAttr ($temp_grp_nem+".translateZ") 0;
   setAttr  ($temp_grp_nem_A+".scaleX") 3.5350759865;
   setAttr  ($temp_grp_nem_A+".scaleY") 3.5350759865;
   setAttr  ($temp_grp_nem_A+".scaleZ") 3.5350759865;
   
   select -r ($temp_con_nem+".cv[0:99999]") ;

   scale -r -p 0cm -2.630172cm 0cm 0.273728 0.273728 0.273728 ;
   
   select -r  $temp_grp_nem;
   parent -w;
   
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".ty");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".tz");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".rx");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".ry");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".rz");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".sx");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".sy");
   setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".sz");
   //setAttr -lock true -keyable false -channelBox false ($temp_con_nem+".v");
   transformLimits -tx -1 1 -etx 1 0 $temp_con_nem;
   transformLimits -tx -1 1 -etx 1 1 $temp_con_nem;
   
    if($i==0)
     {
     	parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
       
     }
     
    if($i==1)
     {
     	
       setAttr ($temp_grp_nem+".rotateZ") -90;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
    if($i==2)
     {
       setAttr ($temp_grp_nem+".rotateZ") 65;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
     
       if($i==3)
     {
       setAttr ($temp_grp_nem+".rotateZ") 40;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
     
     if($i==4)
     {
       setAttr ($temp_grp_nem+".rotateZ") 115;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
      if($i==5)
     {
       setAttr ($temp_grp_nem+".rotateZ") 140;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }

       if($i==6)
     {
       setAttr ($temp_grp_nem+".rotateZ") -65;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
     
       if($i==7)
     {
       setAttr ($temp_grp_nem+".rotateZ") -40;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
     
    if($i==8)
     {
       setAttr ($temp_grp_nem+".rotateZ") -115;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     }
     if($i==9)
     {
       setAttr ($temp_grp_nem+".rotateZ") -140;
       parent  $temp_grp_nem $ctrlMouth_M_grp;
       setAttr ($temp_grp_nem_A+".translateX") 40;
      
     } 
    
   }




setAttr ($kongzu+".scale") $soce $soce $soce;
delete`pointConstraint $con $kongzu`;//点约束
setAttr ($kongzu+".translateX") $obx_Max[0] ;
setAttr ($kongzu+".translateZ") $obx_Max[2] ;
string$miaban="head_mianabn";
zxb_ADD_shuxing_string_proc($con,$miaban);
setAttr -type "string"($con+"."+$miaban) $faceFrame;
parent  $kongzu $con;
string $shape[]=`listRelatives  -s $faceFrame`;
setAttr ($shape[0]+".overrideEnabled") 1;
setAttr ( $shape[0]+".overrideDisplayType") 2;

setAttr ($shape[1]+".overrideEnabled") 1;
setAttr ( $shape[1]+".overrideDisplayType") 2;
string$head_faceFrame_lip="head_faceFrame_lip";

zxb_ADD_shuxing_string_proc($con,$head_faceFrame_lip);
setAttr -type "string"($con+"."+$head_faceFrame_lip) $all_kongzhiqi_sss;

}
 global proc  zxb_anniu_fangxing(string$frame_controller)
{

string$con=`textFieldGrp -q -tx UI_head_controller `;
string$zxb_faceFrame=getAttr ($con+".head_mianabn"); 
$teststring=`textFieldGrp -q -tx UI_head_mode `;
string$anniu_name=$frame_controller+"_frame";//按钮边框名字
string$name_yuanxing=$frame_controller;
string$name_tex=$frame_controller+"_tex";
int $selec=1;//缩放
float $minH=-1;
float $maxH=1;
float $minV=-1;
float $maxV=1;
int $vv=0;//角度
//////////////////////////////
curve -d 3 -p -1 1 0 -p 1 1 0 -p 1 1 0 -p 1 1 0 -p 1 -1 0 -p 1 -1 0 -p 1 -1 0 -p -1 -1 0 -p -1 -1 0 
-p -1 -1 0 -p -1 1 0 -k 0 -k 0 -k 0 -k 1 -k 2 -k 3 -k 4 -k 5 -k 6 -k 7 -k 8 -k 8 -k 8 -n $anniu_name;

select -r $anniu_name;
duplicate -rr -n ($anniu_name+"_temp");

if($selec==1)
  {
      scale 1.1 1.1 1.1;
      makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
  }

pickWalk -d down;
select -add ($anniu_name);
parent -s -r;
delete($anniu_name+"_temp");
select -r $anniu_name;
scale 1.2 1.2 1.2;
makeIdentity -apply true -t 0 -r 1 -s 1 -n 0;
if($vv==1)
{
setAttr ($anniu_name+".rz") 45;
select -r ($anniu_name+".cv[0:*]");
rotate -r 0 0 -45;
}
circle -ch 0 -o on -r 0.15 -n $name_yuanxing;
//string $shape[]=`listRelatives  -s $name_yuanxing`;
setAttr ($name_yuanxing+".overrideEnabled") 1;
setAttr ($name_yuanxing+".overrideColor") 22;
string $b[]=`ls -sl`;
setAttr -lock true ($b[0]+".rx");
setAttr -lock true ($b[0]+".ry");
setAttr -lock true ($b[0]+".rz");
setAttr -lock true ($b[0]+".sx");
setAttr -lock true ($b[0]+".sy");
setAttr -lock true ($b[0]+".sz");
setAttr -lock true ($b[0]+".v");
setAttr -lock true ($b[0]+".tz");
select -add $anniu_name;
parent;
string $tempN[]=`ls -sl`;
transformLimits -tx $minH $maxH -etx 1 1 ($tempN[0]);
transformLimits -ty $minV $maxV -ety 1 1 ($tempN[0]);
transformLimits -tz 0 0  -etz 1 1 ($tempN[0]);

textCurves -ch 0 -f "Times New Roman|h-13|w400|c0" -t $frame_controller;
string $sel[]=`ls -sl`;
rename $sel[0] ($anniu_name+"_temp");
string $childs[]=`listRelatives -fullPath -c  ($anniu_name+"_temp")`;

for($i=0;$i<size($childs);$i++)
{
  string $c[]=`listRelatives -fullPath -c ($childs[$i])`;
  for($j=0;$j<size($c);$j++)
  {
  select -r ($c[$j]);
  select -add  ($anniu_name+"_temp");
  parent;
  }
delete ($childs[$i]);
}

string $childs[]=`listRelatives -fullPath -c  ($anniu_name+"_temp")`;
select -r $childs[0];
rename $name_tex;
string $currentN[]=`ls -sl`;

for($i=1;$i<size($childs);$i++)
   {
  select -r ($childs[$i]);
  makeIdentity -apply true -t 1 -r 1 -s 0 -n 0;
  pickWalk -d down;
  select -add $currentN[0];
  parent -s -r;
  delete ($childs[$i]);
   }


select -r $currentN[0];
CenterPivot;
scale 0.75 0.75 0.75;
spaceLocator -p 0 0 0 -n ($name_tex+"_loc");
move 0 -1.8 0 ;
select -add $currentN[0];
delete `pointConstraint`;
delete  ($name_tex+"_loc");
select -r $currentN[0];
string$name_tex_grp=$name_tex+"_grp";
group -n $name_tex_grp;
CenterPivot;
select -add $anniu_name ;
parent;
delete ($anniu_name+"_temp");


select -r $anniu_name;
select -add $zxb_faceFrame  ;
parent;
setAttr ($anniu_name+".tx") 0;
setAttr ($anniu_name+".ty") 0;
setAttr ($anniu_name+".tz") 0;
setAttr ($anniu_name+".sx") 1;
setAttr ($anniu_name+".sy") 1;
setAttr ($anniu_name+".sz") 1;
setAttr ($anniu_name+".rx") 0;
setAttr ($anniu_name+".ry") 0;
setAttr ($anniu_name+".rz") 0;




}


//////////////////////////////次级控制器跟随//////////////////////////////////////
global proc zxb_lip_ciji_controller_genshui() 
{
string $head_controller=`textFieldGrp -q -tx UI_head_controller `;
string$controller_ss=`getAttr ($head_controller+".lip_secondarycontroller")`;
string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
string $head_joinr=`textFieldGrp -q -tx UI_head_bn `;
string$controller_s[]= stringToStringArray($controller_ss, " ");

string $UI_smiless=`textFieldGrp -q -tx UI_smile `;
string $UI_smile_s[]= stringToStringArray( $UI_smiless, " ");

string$R_EXT="";
string$L_EXT="";
string$cheek_s[]=$UI_smile_s;
for ($i=0;$i<size($cheek_s);$i++)
     {
       string$ext=$cheek_s[$i];
       float $temp[]=`xform -q -ws -t $ext`;//////查询位置

       if( $temp[0]<-0.0000001){$R_EXT=$ext;}else{$L_EXT=$ext;}
     }

int$ex=`objExists "temp_loc_R_con"`; ///判断
if($ex==0)
{	
spaceLocator -p 0 0 0 -n "temp_loc_R";
float $temp_pos[]=`xform -q -ws -t $R_EXT`;//////查询位置
setAttr -type float3  "temp_loc_R.translate" $temp_pos[0]  $temp_pos[1]  $temp_pos[2];
zxb_child_object_proc($head_mode,$head_joinr,"temp_loc_R",0,1,0,0); 
delete  "temp_loc_R";

spaceLocator -p 0 0 0 -n "temp_loc_L";
 float $temp_pos[]=`xform -q -ws -t $L_EXT`;//////查询位置
setAttr -type float3  "temp_loc_L.translate" $temp_pos[0]  $temp_pos[1]  $temp_pos[2];
zxb_child_object_proc($head_mode,$head_joinr,"temp_loc_L",0,1,0,0); 
delete  "temp_loc_L";
string$controller_RL="temp_loc_R_con"+" "+"temp_loc_L_con";

zxb_ADD_shuxing_string_proc($head_controller,"cheek_con");
setAttr -type "string" ($head_controller+".cheek_con")$controller_RL;
}
setAttr ("temp_loc_L_con"+".zhouxiangX") 45;
setAttr ("temp_loc_R_con"+".zhouxiangX") -45;
for ($i=0;$i<size($controller_s);$i++)
     {
      string$temp_bianliang=$controller_s[$i];
      
      
      string$mingzi[];
      clear $mingzi;//清除数组
      int $nemt=`tokenize $temp_bianliang "_" $mingzi`;//分离字符串存到变量
      int$zhushzi=$mingzi[6];
      if($zhushzi<3&&$zhushzi>0)
        {
        	
         select -cl  ;
         select -r $temp_bianliang;
         select -add temp_loc_L_con ;
         zxb_ciji_gensui_proc_trs_a;
         string $temp_fu_a[]=`listRelatives -p temp_loc_L_con`; 
         string $temp_fu_b[]=`listRelatives -p $temp_fu_a[0]`; 
         string $temp_fu_c[]=`listRelatives -p $temp_fu_b[0]`; 
         string $temp_fu_d[]=`listRelatives -p $temp_fu_c[0]`; 
         string $temp_fu_e[]=`listRelatives -p $temp_fu_d[0]`; 
         string $temp_fu_f[]=`listRelatives -p $temp_fu_e[0]`; 
         string $temp_fu_g[]=`listRelatives -p $temp_fu_f[0]`; 
         string$shuzu_temp_all[]={"temp_loc_L_con",$temp_fu_a[0],$temp_fu_b[0],$temp_fu_c[0],$temp_fu_d[0],$temp_fu_e[0],$temp_fu_f[0],$temp_fu_g[0]};
         for ($p=0;$p<size($shuzu_temp_all);$p++)
             {
              string$shuxing_name_temp=$shuzu_temp_all[$p];
              
              string$shuxing_xyz[]={($shuxing_name_temp+"suofang_X"),($shuxing_name_temp+"suofang_Y"),($shuxing_name_temp+"suofang_Z"),($shuxing_name_temp+"xuanzhuan_X"),($shuxing_name_temp+"xuanzhuan_Y"),($shuxing_name_temp+"xuanzhuan_Z"),($shuxing_name_temp+"xuanzhuan_X")};
              for ($Y=0;$Y<size($shuxing_xyz);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0;
                   }
                   
              string$shuxing_xyz_weiyi[]={($shuxing_name_temp+"weiyi_X"),($shuxing_name_temp+"weiyi_Y"),($shuxing_name_temp+"weiyi_Z")};
              for ($Y=0;$Y<size($shuxing_xyz_weiyi);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz_weiyi[$Y];
                     if($zhushzi==1){setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0.8;}
                     if($zhushzi==2){setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0.1;}
                     
                   }
             }

         setAttr ($temp_bianliang+".zhouxiangX") 45;
        }
      if($zhushzi>3)
        {
         select -cl  ;
         select -r $temp_bianliang;
         select -add temp_loc_R_con ;
         zxb_ciji_gensui_proc_trs_a;
         string $temp_fu_a[]=`listRelatives -p temp_loc_R_con`; 
         string $temp_fu_b[]=`listRelatives -p $temp_fu_a[0]`; 
         string $temp_fu_c[]=`listRelatives -p $temp_fu_b[0]`; 
         string $temp_fu_d[]=`listRelatives -p $temp_fu_c[0]`; 
         string $temp_fu_e[]=`listRelatives -p $temp_fu_d[0]`; 
         string $temp_fu_f[]=`listRelatives -p $temp_fu_e[0]`; 
         string $temp_fu_g[]=`listRelatives -p $temp_fu_f[0]`; 
         string$shuzu_temp_all[]={"temp_loc_R_con",$temp_fu_a[0],$temp_fu_b[0],$temp_fu_c[0],$temp_fu_d[0],$temp_fu_e[0],$temp_fu_f[0],$temp_fu_g[0]};
         for ($p=0;$p<size($shuzu_temp_all);$p++)
             {
              string$shuxing_name_temp=$shuzu_temp_all[$p];
              
              string$shuxing_xyz[]={($shuxing_name_temp+"suofang_X"),($shuxing_name_temp+"suofang_Y"),($shuxing_name_temp+"suofang_Z"),($shuxing_name_temp+"xuanzhuan_X"),($shuxing_name_temp+"xuanzhuan_Y"),($shuxing_name_temp+"xuanzhuan_Z"),($shuxing_name_temp+"xuanzhuan_X")};
              for ($Y=0;$Y<size($shuxing_xyz);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0;
                   }
                   
              string$shuxing_xyz_weiyi[]={($shuxing_name_temp+"weiyi_X"),($shuxing_name_temp+"weiyi_Y"),($shuxing_name_temp+"weiyi_Z")};
              for ($Y=0;$Y<size($shuxing_xyz_weiyi);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz_weiyi[$Y];
                     if($zhushzi==5){setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0.8;}
                     if($zhushzi==4){setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0.1;}
                     
                   }
             }

         setAttr ($temp_bianliang+".zhouxiangX") -45;
        }
     if($zhushzi==0)
       {
        float $temp_pos_a[]=`xform -q -ws -t $temp_bianliang`;//////查询位置
         select -r $temp_bianliang;
         if( $temp_pos_a[0]>0)
            {
            	
             select -add temp_loc_L_con ;
             zxb_ciji_gensui_proc_trs_a;
         string $temp_fu_a[]=`listRelatives -p temp_loc_L_con`; 
         string $temp_fu_b[]=`listRelatives -p $temp_fu_a[0]`; 
         string $temp_fu_c[]=`listRelatives -p $temp_fu_b[0]`; 
         string $temp_fu_d[]=`listRelatives -p $temp_fu_c[0]`; 
         string $temp_fu_e[]=`listRelatives -p $temp_fu_d[0]`; 
         string $temp_fu_f[]=`listRelatives -p $temp_fu_e[0]`; 
         string $temp_fu_g[]=`listRelatives -p $temp_fu_f[0]`; 
         string$shuzu_temp_all[]={"temp_loc_L_con",$temp_fu_a[0],$temp_fu_b[0],$temp_fu_c[0],$temp_fu_d[0],$temp_fu_e[0],$temp_fu_f[0],$temp_fu_g[0]};
         for ($p=0;$p<size($shuzu_temp_all);$p++)
             {
              string$shuxing_name_temp=$shuzu_temp_all[$p];
              
              string$shuxing_xyz[]={($shuxing_name_temp+"suofang_X"),($shuxing_name_temp+"suofang_Y"),($shuxing_name_temp+"suofang_Z"),($shuxing_name_temp+"xuanzhuan_X"),($shuxing_name_temp+"xuanzhuan_Y"),($shuxing_name_temp+"xuanzhuan_Z"),($shuxing_name_temp+"xuanzhuan_X")};
              for ($Y=0;$Y<size($shuxing_xyz);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0;
                   }
              string$shuxing_xyz_weiyi[]={($shuxing_name_temp+"weiyi_X"),($shuxing_name_temp+"weiyi_Y"),($shuxing_name_temp+"weiyi_Z")};
              for ($Y=0;$Y<size($shuxing_xyz_weiyi);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz_weiyi[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 1;
                   }
             }

         setAttr ($temp_bianliang+".zhouxiangX") 45;
            }
            else
               {
               	select -add temp_loc_R_con ;
               	zxb_ciji_gensui_proc_trs_a;
               	
         string $temp_fu_a[]=`listRelatives -p temp_loc_R_con`; 
         string $temp_fu_b[]=`listRelatives -p $temp_fu_a[0]`; 
         string $temp_fu_c[]=`listRelatives -p $temp_fu_b[0]`; 
         string $temp_fu_d[]=`listRelatives -p $temp_fu_c[0]`; 
         string $temp_fu_e[]=`listRelatives -p $temp_fu_d[0]`; 
         string $temp_fu_f[]=`listRelatives -p $temp_fu_e[0]`; 
         string $temp_fu_g[]=`listRelatives -p $temp_fu_f[0]`; 
         string$shuzu_temp_all[]={"temp_loc_R_con",$temp_fu_a[0],$temp_fu_b[0],$temp_fu_c[0],$temp_fu_d[0],$temp_fu_e[0],$temp_fu_f[0],$temp_fu_g[0]};
         for ($p=0;$p<size($shuzu_temp_all);$p++)
             {
              string$shuxing_name_temp=$shuzu_temp_all[$p];
              
              string$shuxing_xyz[]={($shuxing_name_temp+"suofang_X"),($shuxing_name_temp+"suofang_Y"),($shuxing_name_temp+"suofang_Z"),($shuxing_name_temp+"xuanzhuan_X"),($shuxing_name_temp+"xuanzhuan_Y"),($shuxing_name_temp+"xuanzhuan_Z"),($shuxing_name_temp+"xuanzhuan_X")};
              for ($Y=0;$Y<size($shuxing_xyz);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 0;
                   }
              string$shuxing_xyz_weiyi[]={($shuxing_name_temp+"weiyi_X"),($shuxing_name_temp+"weiyi_Y"),($shuxing_name_temp+"weiyi_Z")};
              for ($Y=0;$Y<size($shuxing_xyz_weiyi);$Y++)
                   {
                     string$shuxing_wancheng=$shuxing_xyz_weiyi[$Y];
                     setAttr ($temp_bianliang+"."+$shuxing_wancheng) 1;
                   }
                }
                setAttr ($temp_bianliang+".zhouxiangX") -45;
               
               }
         
       }
      
     }
}


global proc zxb_ciji_gensui_proc_trs_a(){    
//////////////控制器驱动//////////////////
string $bianliang[]=`ls -sl`;//选中控制器  最后选中主控制器
int $size_con=size($bianliang);
string $zuiba_con=$bianliang[($size_con-1)];//嘴角控制器
int $con_num=($size_con-1);
int$weiyi=1;
int$xuanzhun= 1;
int$suofang= 1;

int$trs=$weiyi;
int$rot=$xuanzhun;
int$scl=$suofang;
int$ex;
for ($i=0;$i<$con_num;$i++)
{ 
   string $con=$bianliang[$i];
   select -r $con;
   string$weiyi="";
   
   string $grp_A_s[]=`listRelatives -p $zuiba_con`; 
   string $grp_B_s[]=`listRelatives -p  $grp_A_s[0]`; 
   string $grp_C_s[]=`listRelatives -p  $grp_B_s[0]`; 
   string $grp_D_s[]=`listRelatives -p  $grp_C_s[0]`; 
   string $grp_E_s[]=`listRelatives -p  $grp_D_s[0]`; 
   string $grp_F_s[]=`listRelatives -p  $grp_E_s[0]`;
   string $grp_G_s[]=`listRelatives -p  $grp_F_s[0]`;  
   
   
   string$all_grp_s[]={$zuiba_con,$grp_A_s[0], $grp_B_s[0],$grp_C_s[0],$grp_D_s[0],$grp_E_s[0],$grp_F_s[0],$grp_G_s[0]};
   for ($iii=0;$iii<size($all_grp_s);$iii++)
        {
        	 string$grp_kongzhi=$all_grp_s[$iii];
        	 $zuiba_con=$grp_kongzhi;
        	 string $jianjianjiedian[]= `listConnections -d 1 -s 0 -scn 1($con+".zhaodao_trs")`;
             string$jiedian=$jianjianjiedian[0];
             ///////////////////位移//////////////////////////////////////
             if($trs==1)
               {
                $weiyi="weiyi";
                string $kongzhiqi=$zuiba_con+$weiyi;
                string $kongzhiqi_X=$zuiba_con+$weiyi+"_X";
                string $kongzhiqi_Y=$zuiba_con+$weiyi+"_Y";
                string $kongzhiqi_Z=$zuiba_con+$weiyi+"_Z";
                $ex=`objExists ($con+"."+$grp_kongzhi)`;
                if($ex==0)
                  {
                  addAttr -ln $kongzhiqi -at bool  -dv 0 -k 1 $con;
                  setAttr -lock true ($con+"."+$kongzhiqi);
                  addAttr -ln $kongzhiqi_X -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                  addAttr -ln $kongzhiqi_Y -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                  addAttr -ln $kongzhiqi_Z -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                  setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_X);
                  setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Y);
                  setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Z);
                  
                  string $multiplyDivide_AA=($grp_kongzhi+$kongzhiqi+"_multiplyDivide_AA_"+$con+$iii);
                  int $panduan=`objExists $multiplyDivide_AA`;
                  if($panduan==1){delete $multiplyDivide_AA; }
                  shadingNode -asUtility multiplyDivide -n $multiplyDivide_AA;//创建乘除节点
                  connectAttr -force  ($con+"."+$kongzhiqi_X)  ($multiplyDivide_AA+".input1X");
                  connectAttr -force  ($con+"."+$kongzhiqi_Y)  ($multiplyDivide_AA+".input1Y");
                  connectAttr -force  ($con+"."+$kongzhiqi_Z)  ($multiplyDivide_AA+".input1Z");
                  connectAttr -force  ($zuiba_con+".tx")  ($multiplyDivide_AA+".input2X");
                  connectAttr -force  ($zuiba_con+".ty")  ($multiplyDivide_AA+".input2Y");
                  connectAttr -force  ($zuiba_con+".tz")  ($multiplyDivide_AA+".input2Z");
                  string $inpute3d[]= `listConnections -d 0 -s 1 -scn 1($jiedian+".input3D")`;
                  int$index=size($inpute3d);
                  connectAttr -force   ($multiplyDivide_AA+".output") ($jiedian+".input3D["+$index+"]");
                  }
                }
    
              ///////////////////旋转//////////////////////////
              string $jianjianjiedian[]= `listConnections -d 1 -s 0 -scn 1($con+".zhaodao_rot")`;
              string$jiedian=$jianjianjiedian[0];
              if($rot==1)
                {
                 $weiyi="suofang";

                 string $kongzhiqi=$zuiba_con+$weiyi;
                 string $kongzhiqi_X=$zuiba_con+$weiyi+"_X";
                 string $kongzhiqi_Y=$zuiba_con+$weiyi+"_Y";
                 string $kongzhiqi_Z=$zuiba_con+$weiyi+"_Z";
                 $ex=`objExists($con+"."+$grp_kongzhi)`;
                 if($ex==0)
                   {
                    addAttr -ln $kongzhiqi -at bool  -dv 0 -k 1 $con;
                    setAttr -lock true ($con+"."+$kongzhiqi);
                    addAttr -ln $kongzhiqi_X -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                    addAttr -ln $kongzhiqi_Y -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                    addAttr -ln $kongzhiqi_Z -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
                    setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_X);
                    setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Y);
                    setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Z);
                    string $multiplyDivide_AA=($grp_kongzhi+$kongzhiqi+"_multiplyDivide_AA_"+$con+$iii);
                    int $panduan=`objExists $multiplyDivide_AA`;
                    if($panduan==1){delete $multiplyDivide_AA; }
                    shadingNode -asUtility multiplyDivide -n $multiplyDivide_AA;//创建乘除节点
                    connectAttr -force  ($con+"."+$kongzhiqi_X)  ($multiplyDivide_AA+".input1X");
                    connectAttr -force  ($con+"."+$kongzhiqi_Y)  ($multiplyDivide_AA+".input1Y");
                    connectAttr -force  ($con+"."+$kongzhiqi_Z)  ($multiplyDivide_AA+".input1Z");
                    string $plusMinusAverage_AA=($grp_kongzhi+$kongzhiqi+"_plusMinusAverage_AA");
                    int $panduan=`objExists $plusMinusAverage_AA`;
                    if($panduan==1){delete $plusMinusAverage_AA; }
                    shadingNode -asUtility plusMinusAverage -n $plusMinusAverage_AA;//创建加减节点
                    connectAttr -force  ($zuiba_con+".s")  ($plusMinusAverage_AA+".input3D[0]");
                    setAttr -type float3 ($plusMinusAverage_AA+".input3D[1]") 1 1 1;
                    setAttr ($plusMinusAverage_AA+".operation") 2;
                    connectAttr -force   ($plusMinusAverage_AA+".output3D") ($multiplyDivide_AA+".input2");
                    string $inpute3d[]= `listConnections -d 0 -s 1 -scn 1($jiedian+".input3D")`;
                    int$index=size($inpute3d);
                   connectAttr -force   ($multiplyDivide_AA+".output") ($jiedian+".input3D["+$index+"]");
                   }
             }
                  
        
         /////////////////////////缩放///////////////////////////////
       string $jianjianjiedian[]= `listConnections -d 1 -s 0 -scn 1($con+".zhaodao_scl")`;
       string$jiedian=$jianjianjiedian[0];
       if($scl==1)
         {
         $weiyi="xuanzhuan";

         string $kongzhiqi=$zuiba_con+$weiyi;
         string $kongzhiqi_X=$zuiba_con+$weiyi+"_X";
         string $kongzhiqi_Y=$zuiba_con+$weiyi+"_Y";
         string $kongzhiqi_Z=$zuiba_con+$weiyi+"_Z";
         $ex=`objExists ($con+"."+$grp_kongzhi)`;
        if($ex==0)
          {
          addAttr -ln $kongzhiqi -at bool  -dv 0 -k 1 $con;
          setAttr -lock true ($con+"."+$kongzhiqi);
          addAttr -ln $kongzhiqi_X -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
          addAttr -ln $kongzhiqi_Y -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
          addAttr -ln $kongzhiqi_Z -at double  -dv 0.5 -min -1 -max 2 -k 1 $con;
          setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_X);
          setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Y);
          setAttr -keyable false -channelBox true ($con+"."+$kongzhiqi_Z);
          string $multiplyDivide_AA=($grp_kongzhi+$kongzhiqi+"_multiplyDivide_AA_"+$con+$iii);
          int $panduan=`objExists $multiplyDivide_AA`;
          if($panduan==1){delete $multiplyDivide_AA; }
          shadingNode -asUtility multiplyDivide -n $multiplyDivide_AA;//创建乘除节点
          connectAttr -force  ($con+"."+$kongzhiqi_X)  ($multiplyDivide_AA+".input1X");
          connectAttr -force  ($con+"."+$kongzhiqi_Y)  ($multiplyDivide_AA+".input1Y");
          connectAttr -force  ($con+"."+$kongzhiqi_Z)  ($multiplyDivide_AA+".input1Z");
          connectAttr -force  ($zuiba_con+".rx")  ($multiplyDivide_AA+".input2X");
          connectAttr -force  ($zuiba_con+".ry")  ($multiplyDivide_AA+".input2Y");
          connectAttr -force  ($zuiba_con+".rz")  ($multiplyDivide_AA+".input2Z");
          string $inpute3d[]= `listConnections -d 0 -s 1 -scn 1($jiedian+".input3D")`;
          int$index=size($inpute3d);
          connectAttr -force   ($multiplyDivide_AA+".output") ($jiedian+".input3D["+$index+"]");
         }
       }   
   }  
 }

}

/////////////////////////////////////次级权重计算////////////////////////////////////////////////////

global proc  zxb_zuiba_jisuanquanzhong_pinghua_a(string$all_ciji,string$jisuanguanjie,string$zuida_bn)
{
    
  string$BNS_temp_s=$all_ciji;//所有次级
  string$BNS_temp[]= stringToStringArray($BNS_temp_s, " ");
  string$BNS_temp_MM=$jisuanguanjie;
  string$BNS_temp_M[]= stringToStringArray($BNS_temp_MM, " ");
  
  string$BNS_temp_ROOT=$zuida_bn;
  string$BNS_temp_root[]= stringToStringArray($BNS_temp_ROOT, " ");
  string $zxb_bns[]=$BNS_temp;//骨骼 //按顺序选骨骼 上个程序的名字
  string$zxb_zuiba=$BNS_temp_M[0];//要抢的权重
  string $root=$BNS_temp_root[0];
  string $mode[]=`ls -sl`;//选中模型
  string $modo_name=$mode[0];//模型名字
  
  int$intpos=1;
  int$jingxiang=$intpos;
  string $sknclustet=`findRelatedSkinCluster  $modo_name`;
//setAttr ($sknclustet+".normalizeWeights") 2;
//select -r ($modo_name+".vtx[0:9999999999]");
//string $mode_dian_[]=`ls -sl -fl `;


/////////////////////////////主关节影响的权重顶点/////////////////////////////////////////
  int $mode_dian[]=`polyEvaluate -v   $modo_name`;
  
  string $dingdian_mode[];
  clear $dingdian_mode ;
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("主关节影响的权重顶点...") -bp -ii 1 -min 0 -max $mode_dian[0] $gMainProgressBar;
  for ($i=0;$i<$mode_dian[0];$i++)
    {
     if(`progressBar -q -ic $gMainProgressBar`)
     break;
    progressBar -e -s 1 $gMainProgressBar;  
    string $mode_dianxu=($modo_name+".vtx["+$i+"]");
    float$quznzhong=`skinPercent  -t $zxb_zuiba -q   $sknclustet $mode_dianxu`;
    if($quznzhong>0)
      {
      //skinPercent  -tv $bn  $quznzhong  $sknclustet $mode_dianxu;
      int$size=size($dingdian_mode);
      $dingdian_mode[$size]=$mode_dianxu;
      }


   }
    progressBar -e -ep $gMainProgressBar;
    select -r $dingdian_mode;
    
    /////////////////////////////次级关节影响的权重顶点/////////////////////////////////////////
  string $dingdian_mode_ciji[];
  clear $dingdian_mode_ciji ;
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("次级关节影响的权重顶点...") -bp -ii 1 -min 0 -max `size($zxb_bns)` $gMainProgressBar;
  
  
  for ($j=0;$j<size($zxb_bns);$j++)
  {
    if(`progressBar -q -ic $gMainProgressBar`)
    break;
    progressBar -e -s 1 $gMainProgressBar;  
   string $ciji_bn=$zxb_bns[$j];
   for ($i=0;$i<$mode_dian[0];$i++)
    {


        string $mode_dianxu=($modo_name+".vtx["+$i+"]");
        float$quznzhong=`skinPercent  -t $ciji_bn -q   $sknclustet $mode_dianxu`;
        if($quznzhong>0)
        {
          //skinPercent  -tv $bn  $quznzhong  $sknclustet $mode_dianxu;
          int$size=size($dingdian_mode_ciji);
          $dingdian_mode_ciji[$size]=$mode_dianxu;
        }
    
   }


  } 
   progressBar -e -ep $gMainProgressBar;
   ////////////////////////////减选右边的顶点/////////////////////////////////
   select -r  $dingdian_mode;
   string $temp_dingdian[]=`ls -sl -fl `;
     ///////////////////////备份总关节的模型权重///////////////////////////////
     int $ex=`objExists ($modo_name+"_temp")`;
     if($ex==0)
     {
          select -r  $modo_name;
           duplicate -rr -n  ($modo_name+"_temp");
           string $All_bn[]=`skinCluster -q  -inf  $sknclustet`;
           select -r  $All_bn ($modo_name+"_temp");
           newSkinCluster "-toSelectedBones -mi 30 -omi true -dr 6 -rui 0";  
            select -r $modo_name ;
            select -add ($modo_name+"_temp");
            copySkinWeights  -noMirror -surfaceAssociation closestPoint -influenceAssociation oneToOne -influenceAssociation oneToOne;
            float$ex_vs=getAttr($modo_name+"_temp.visibility") ;
            if($ex_vs==1)
              {
              	setAttr ($modo_name+"_temp.visibility") 0;
            	}
            


      }
     //////////////////平滑权重///////////////////////////////////
     select -r $dingdian_mode;
    for ($a=0;$a<10;$a++){weightHammerVerts;}
    select -r $mode;
    ///////////////////////////找到跟关节//////////////////////////////////
    string $sknclustet_temp_A=`findRelatedSkinCluster ($modo_name+"_temp")`;
    string $All_bn_A[]=`skinCluster -q  -inf $sknclustet_temp_A`;
    string $root_="";
    int $daixoa=0;
    



string $UI_all_dead_vertexss=`textFieldGrp -q -tx UI_all_head_vertex`;
string$UI_all_dead_vertexs[]=stringToStringArray($UI_all_dead_vertexss," ");

zxb_vex_xuan($modo_name,$UI_all_dead_vertexs);
string$haed_all_ext[]=`ls -sl -fl`;
//////////////////////////跟关节的权重复制回去//////////////////////////////////////////
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("计算根关节顶点...") -bp -ii 1 -min 0 -max $mode_dian[0] $gMainProgressBar;
    
     for ($ll=0;$ll<size($haed_all_ext);$ll++)
 {
      if(`progressBar -q -ic $gMainProgressBar`)
      break;
      progressBar -e -s 1 $gMainProgressBar;  
      string $mode_temp_dindian=($modo_name+"_temp.vtx["+$ll+"]");
     float$quznzhong=`skinPercent  -t $root -q  $sknclustet_temp_A $mode_temp_dindian`;
     if($quznzhong>0){skinPercent  -tv $root  $quznzhong  $sknclustet ($modo_name+".vtx["+$ll+"]");}


 
 }
 select -r $modo_name;
 if($jingxiang==1)
 { doMirrorSkinWeightsArgList( 2, { " -mirrorMode YZ -surfaceAssociation closestPoint -influenceAssociation oneToOne" } );


 }


   progressBar -e -ep $gMainProgressBar;
 delete ($modo_name+"_temp");


}



///////

global proc  zxb_zuiba_jisuanquanzhong_pinghua_a_shuzu(string$all_ciji[],string$jisuanguanjie,string$zuida_bn)
{
    
 // string$BNS_temp_s=$all_ciji;//所有次级
  string$BNS_temp[]= $all_ciji;
  string$BNS_temp_MM=$jisuanguanjie;
  string$BNS_temp_M[]= stringToStringArray($BNS_temp_MM, " ");
  
  string$BNS_temp_ROOT=$zuida_bn;
  string$BNS_temp_root[]= stringToStringArray($BNS_temp_ROOT, " ");
  string $zxb_bns[]=$BNS_temp;//骨骼 //按顺序选骨骼 上个程序的名字
  string$zxb_zuiba=$BNS_temp_M[0];//要抢的权重
  string $root=$BNS_temp_root[0];
  string $mode[]=`ls -sl`;//选中模型
  string $modo_name=$mode[0];//模型名字
  
  int$intpos=1;
  int$jingxiang=$intpos;
  string $sknclustet=`findRelatedSkinCluster  $modo_name`;
//setAttr ($sknclustet+".normalizeWeights") 2;
//select -r ($modo_name+".vtx[0:9999999999]");
//string $mode_dian_[]=`ls -sl -fl `;


/////////////////////////////主关节影响的权重顶点/////////////////////////////////////////
  int $mode_dian[]=`polyEvaluate -v   $modo_name`;
  
  string $dingdian_mode[];
  clear $dingdian_mode ;
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("主关节影响的权重顶点...") -bp -ii 1 -min 0 -max $mode_dian[0] $gMainProgressBar;
  for ($i=0;$i<$mode_dian[0];$i++)
    {
     if(`progressBar -q -ic $gMainProgressBar`)
     break;
    progressBar -e -s 1 $gMainProgressBar;  
    string $mode_dianxu=($modo_name+".vtx["+$i+"]");
    float$quznzhong=`skinPercent  -t $zxb_zuiba -q   $sknclustet $mode_dianxu`;
    if($quznzhong>0)
      {
      //skinPercent  -tv $bn  $quznzhong  $sknclustet $mode_dianxu;
      int$size=size($dingdian_mode);
      $dingdian_mode[$size]=$mode_dianxu;
      }


   }
    progressBar -e -ep $gMainProgressBar;
    select -r $dingdian_mode;
    
    /////////////////////////////次级关节影响的权重顶点/////////////////////////////////////////
  string $dingdian_mode_ciji[];
  clear $dingdian_mode_ciji ;
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("次级关节影响的权重顶点...") -bp -ii 1 -min 0 -max `size($zxb_bns)` $gMainProgressBar;
  
  
  for ($j=0;$j<size($zxb_bns);$j++)
  {
    if(`progressBar -q -ic $gMainProgressBar`)
    break;
    progressBar -e -s 1 $gMainProgressBar;  
   string $ciji_bn=$zxb_bns[$j];
   for ($i=0;$i<$mode_dian[0];$i++)
    {


        string $mode_dianxu=($modo_name+".vtx["+$i+"]");
        float$quznzhong=`skinPercent  -t $ciji_bn -q   $sknclustet $mode_dianxu`;
        if($quznzhong>0)
        {
          //skinPercent  -tv $bn  $quznzhong  $sknclustet $mode_dianxu;
          int$size=size($dingdian_mode_ciji);
          $dingdian_mode_ciji[$size]=$mode_dianxu;
        }
    
   }


  } 
   progressBar -e -ep $gMainProgressBar;
   ////////////////////////////减选右边的顶点/////////////////////////////////
   select -r  $dingdian_mode;
   string $temp_dingdian[]=`ls -sl -fl `;
   
/*  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("计算顶点顶点...") -bp -ii 1 -min 0 -max `size($temp_dingdian)` $gMainProgressBar;
    for ($a=0;$a<size($temp_dingdian);$a++)
    {
         if(`progressBar -q -ic $gMainProgressBar`)
         break;
          progressBar -e -s 1 $gMainProgressBar;  
          
        string $temp_diangdian=$temp_dingdian[$a];
        float $temp_pos_A[]=`xform -q -ws -t  $temp_diangdian`;
        if($temp_pos_A[0]<0.00001){select -d $temp_diangdian;}
    
    }
     progressBar -e -ep $gMainProgressBar;*/
     
     
     ///////////////////////备份总关节的模型权重///////////////////////////////
     int $ex=`objExists ($modo_name+"_temp")`;
     if($ex==0)
     {
          select -r  $modo_name;
           duplicate -rr -n  ($modo_name+"_temp");
           string $All_bn[]=`skinCluster -q  -inf  $sknclustet`;
           select -r  $All_bn ($modo_name+"_temp");
           newSkinCluster "-toSelectedBones -mi 30 -omi true -dr 6 -rui 0";  
            select -r $modo_name ;
            select -add ($modo_name+"_temp");
            copySkinWeights  -noMirror -surfaceAssociation closestPoint -influenceAssociation oneToOne -influenceAssociation oneToOne;
            setAttr ($modo_name+"_temp.visibility") 0;
      }
     //////////////////平滑权重///////////////////////////////////
     select -r $dingdian_mode;
    for ($a=0;$a<10;$a++){weightHammerVerts;}
    select -r $mode;
    ///////////////////////////找到跟关节//////////////////////////////////
    string $sknclustet_temp_A=`findRelatedSkinCluster ($modo_name+"_temp")`;
    string $All_bn_A[]=`skinCluster -q  -inf $sknclustet_temp_A`;
    string $root_="";
    int $daixoa=0;
    



string $UI_all_dead_vertexss=`textFieldGrp -q -tx UI_all_head_vertex`;
string$UI_all_dead_vertexs[]=stringToStringArray($UI_all_dead_vertexss," ");

zxb_vex_xuan($modo_name,$UI_all_dead_vertexs);
string$haed_all_ext[]=`ls -sl -fl`;
//////////////////////////跟关节的权重复制回去//////////////////////////////////////////
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("计算根关节顶点...") -bp -ii 1 -min 0 -max $mode_dian[0] $gMainProgressBar;
    
     for ($ll=0;$ll<size($haed_all_ext);$ll++)
 {
      if(`progressBar -q -ic $gMainProgressBar`)
      break;
      progressBar -e -s 1 $gMainProgressBar;  
      string $mode_temp_dindian=($modo_name+"_temp.vtx["+$ll+"]");
     float$quznzhong=`skinPercent  -t $root -q  $sknclustet_temp_A $mode_temp_dindian`;
     if($quznzhong>0){skinPercent  -tv $root  $quznzhong  $sknclustet ($modo_name+".vtx["+$ll+"]");}


 
 }
 select -r $modo_name;
 if($jingxiang==1)
 { doMirrorSkinWeightsArgList( 2, { " -mirrorMode YZ -mirrorInverse -surfaceAssociation closestPoint -influenceAssociation closestJoint" } );


 }


   progressBar -e -ep $gMainProgressBar;
 delete ($modo_name+"_temp");


}

global proc string zxb_quanzhong_lip_jicji_proc(string$quanzhongmode,string$jisuan_bn,string$zhengti_bn,string$all_bn,string$grp)
{
	
	
TranslateToolWithSnapMarkingMenu;
TranslateToolWithSnapMarkingMenu;
selectToolValues nurbsSelect;
selectToolValues nurbsSelect;
	
string $head_mode=`textFieldGrp -q -tx UI_head_mode `;
string $UI_oral_inside_wiree=`textFieldGrp -q -tx UI_oral_inside_wire`;
string$UI_oral_inside_wirees[]=stringToStringArray($UI_oral_inside_wiree," ");
string$curve_temp="curve_temp";
string$all_bn_aa[]=stringToStringArray($all_bn," ");
string $skinCluster=`findRelatedSkinCluster $quanzhongmode` ;//访问蒙皮节点  
string $All_bn_temp[]=`skinCluster -q  -inf  $skinCluster`;//查询蒙皮的所有关节
select -r  $UI_oral_inside_wirees;
ConvertSelectionToVertices;
string$UI_oral_inside_wiree_ext_s[]=`ls -sl -fl`;
string$mode_cop=$head_mode+"_temp_lip_cop";
string$mode=$head_mode+"_temp_lip";;
int$ex=`objExists $mode`; ///判断
if($ex==0)
  {
  	select -r  $head_mode;
   duplicate -rr -n $mode_cop ;
   parent  $mode_cop $grp;
   setAttr ($head_mode+".visibility") 0;
   setAttr ($mode_cop+".visibility") 1;
   zxb_vex_xuan($mode_cop,$UI_oral_inside_wiree_ext_s);
   ConvertSelectionToContainedEdges;
   DetachComponent; 
   string$shepa_cop[]=`listRelatives -s $mode_cop`; 
   select -r  $mode_cop;
   string$modefengli[]=`polySeparate -ch 1$shepa_cop[0]`;
   select -r  $modefengli;
   DeleteHistory;
   select -r ($modefengli[0]+".vtx[0:99999999999999999999]") ;
   string$all_ext_s_a[]=`ls -sl -fl`;
   select -r ($modefengli[1]+".vtx[0:99999999999999999999]") ;
   string$all_ext_s_b[]=`ls -sl -fl`;
     int$panduan_a=size($all_ext_s_a);
  int$panduan_b=size($all_ext_s_b);
   if($panduan_a>$panduan_b){ rename $modefengli[0]  $mode ; delete   $modefengli[1];}else{rename $modefengli[1]  $mode ; delete   $modefengli[0];}
   parent  $mode $grp;
  delete $mode_cop;
  select -r $All_bn_temp;
  select -add  $mode;
  newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui true";   //蒙皮
  	
  	}
print "检查12336";
select -cl  ;

select -r $quanzhongmode;
select -add  $mode;
CopySkinWeights;
select -cl  ;
print "检查12343";
select -r  $mode;
ArtPaintSkinWeightsToolOptions;print "检查12345";
setSmoothSkinInfluence $jisuan_bn; print"检查12346";
artSkinInflListChanging $jisuan_bn 1;print"检查12347";
artSkinInvLockInf artAttrSkinPaintCtx 1;print"检查12348";
setSmoothSkinInfluence $jisuan_bn; print"检查12349";
artSkinInflListChanging $jisuan_bn 1;print "检查123450";
artSkinInvLockInf artAttrSkinPaintCtx 1;print "检查123451";
select -cl  ;print"检查123452";
string $UI_mouth_outer_wire=`textFieldGrp -q -tx UI_mouth_outer_wire`;print"检查123453";
string$UI_mouth_outer_wire_s[]=stringToStringArray($UI_mouth_outer_wire," ");print"检查123454";
string $UI_mouth_inside_wire=`textFieldGrp -q -tx UI_mouth_inside_wire`;print"检查123455";
string$UI_mouth_inside_wire_s[]=stringToStringArray($UI_mouth_inside_wire," ");print "检查12356";
select -r  $UI_mouth_outer_wire_s;
print "检查12358";
ConvertSelectionToVertices;
string$UI_mouth_outer_wire_s_ext_s[]=`ls -sl -fl`;
zxb_vex_xuan($mode,$UI_mouth_outer_wire_s_ext_s);
string$temp_lip_ext_s[]=`ls -sl -fl`;
ConvertSelectionToContainedEdges;
zxb_zuiba_jisuanquanzhong_chuangjianqvxian_a($curve_temp);
select -r ($curve_temp+".cv[0:999999999999999]") ;
string$all_cvs[]=`ls -sl -fl`;
string$jisuan_all_bn="";
for ($i=0;$i<size($all_cvs);$i++)
    {
    string$cv=$all_cvs[$i];
    float $temp_pos_a[]=`xform -q -ws -t $cv`;//查询世界坐标的变量位移
    float$zhi_mag=1000000000000000000000;
    string$temp_bn_n="";
    for ($ii=0;$ii<size($all_bn_aa);$ii++)
        {
        string$bn_temp=$all_bn_aa[$ii];
        float $temp_pos_b[]=`xform -q -ws -t $bn_temp`;//查询世界坐标的变量位移
        float $weizhi_mag=mag(<<$temp_pos_a[0],$temp_pos_a[1],$temp_pos_a[2]>>-<<$temp_pos_b[0],$temp_pos_b[1],$temp_pos_b[2]>>);////////计算距离
        if($weizhi_mag<$zhi_mag)
          {
          $zhi_mag=$weizhi_mag;
          $temp_bn_n=$bn_temp;
          }
        }
    $jisuan_all_bn+=$temp_bn_n+" ";
    }
string $UI_mouth_annular=`textFieldGrp -q -tx UI_mouth_annular `;
string$UI_mouth_annular_s[]=stringToStringArray($UI_mouth_annular, " ");//拷贝权重模型
select -r $UI_mouth_annular_s ;
string$all_xian="";

select -r $UI_mouth_annular_s;
for($j=0;$j<size($UI_mouth_annular_s);$j++)
   {
    string$temp_dian=$UI_mouth_annular_s[$j];
    float $trs_b[]=`xform -q -ws -t $temp_dian`;
    if($trs_b[0]<-0.001)
      {
      select -d $temp_dian;
      }
   }

$UI_mouth_annular_s=`ls -sl -fl`;
select -cl  ;
global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("查找环线...") -bp -ii 1 -min 0 -max `size($UI_mouth_annular_s)` $gMainProgressBar;
for($j=0;$j<size($UI_mouth_annular_s);$j++)
   {
   	if(`progressBar -q -ic $gMainProgressBar`)
   break;
   progressBar -e -s 1 $gMainProgressBar;
   string$temp_dian=$UI_mouth_annular_s[$j];
   select -r$temp_dian;
   ConvertSelectionToVertices;
   string$temp_xian_dian_s[]=`ls -sl -fl`;
   zxb_vex_xuan($mode,$temp_xian_dian_s);
   ConvertSelectionToContainedEdges;
   SelectEdgeLoopSp;
   zxb_zuiba_jisuanquanzhong_A($jisuan_all_bn,$jisuan_bn,$curve_temp);//所有次级骨骼   被抢的权重骨骼    曲线
  
 }
progressBar -e -ep $gMainProgressBar; 

select -r $mode;
 zxb_zuiba_jisuanquanzhong_pinghua_a($jisuan_all_bn,$jisuan_bn,$zhengti_bn);
 delete$curve_temp ;
  return $mode ;
}





global proc  zxb_zuiba_jisuanquanzhong_A(string$all_bn_temp,string$jisuan_bn_temp,string$temp_qvxian_name)//所有次级骨骼   被抢的权重骨骼    曲线  传递字符串
{
string$BNS_temp_s=$all_bn_temp;//所有次级骨骼
string$BNS_temp[]= stringToStringArray($BNS_temp_s, " ");
string$BNS_temp_MM=$jisuan_bn_temp;//被计算骨骼
string$BNS_temp_M[]= stringToStringArray($BNS_temp_MM, " ");
string $zxb_bns[]=$BNS_temp;//骨骼
string$zxb_zuiba;//要抢的权重
string $zxb_skinves[];
string$zxb_zuiba=$BNS_temp_M[0];//要抢的权重
string $qvxian_temp=$temp_qvxian_name;//曲线  
ConvertSelectionToVertices;
string $bian[]=`ls -sl -fl `;
string $qvxian_temp_cv= ($qvxian_temp+".cv[0:999999999]");
select -r  $qvxian_temp_cv;
string $qvxian_temp_cvs[]=`ls -sl -fl `;
int $cvshu=size($qvxian_temp_cvs);//CV数量
int $bnsize=size($zxb_bns); //关节数量
if($cvshu!=$bnsize){error "关节数量 与曲线CV点的数量不一致";}
float $bnsatpos[]=`xform -q -ws -t $zxb_bns[0]`;
float $qvxiansatpos[]=`xform -q -ws -t  $qvxian_temp_cvs[0]`;
float $qvxianendpos[]=`xform -q -ws -t  $qvxian_temp_cvs[(size($qvxian_temp_cvs)-1)]`;
float $kaishidis=mag(<< $bnsatpos[0], $bnsatpos[1], $bnsatpos[2]>>-<< $qvxiansatpos[0], $qvxiansatpos[1], $qvxiansatpos[2]>>);
float $enddis=mag(<< $bnsatpos[0], $bnsatpos[1], $bnsatpos[2]>>-<< $qvxianendpos[0],  $qvxianendpos[1],  $qvxianendpos[2]>>);
if ($kaishidis> $enddis)
{
    reverseCurve -ch 0 -rpo 1 $qvxian_temp;
}
string $poscv="";
float $dis=100000000;
 for ($i=0;$i<size($bian);$i++)
 {
     
     float $pos_A[]=`xform -q -ws -t $bian[$i]`;
   for ($ii=0;$ii<size($qvxian_temp_cvs);$ii++)
   {
    float $pos_B[]=`xform -q -ws -t $qvxian_temp_cvs[$ii]`;
    float $cdis=mag(<<$pos_A[0],$pos_A[1],$pos_A[2]>>-<<$pos_B[0],$pos_B[1],$pos_B[2]>>);
    
    if($cdis<$dis)
    {
     $dis=$cdis;
      $poscv=$qvxian_temp_cvs[$ii];
     }
    }
  }
string $qvxian_cv[];
int $aaaaaa=`tokenize $poscv "["  $qvxian_cv`;
int $aaaaaa=`tokenize $qvxian_cv[1] "]"  $qvxian_cv`;
int $zxb_i =$qvxian_cv[0];
string $bn= $zxb_bns[$zxb_i];
string $modetemp[];
int $temp_int=`tokenize $bian[0] "." $modetemp `;
string $modo=$modetemp[0];
string $sknclustet=`findRelatedSkinCluster $modo`;
for ($ll=0;$ll<size($bian);$ll++)
 {
     int$size=size($zxb_skinves);
     string $temp_dingdian=$bian[$ll];
     $zxb_skinves[$size]=$bian[$ll];
     float$quznzhong=`skinPercent  -t $zxb_zuiba -q   $sknclustet $temp_dingdian`;
     if($quznzhong>0){skinPercent  -tv $bn  $quznzhong  $sknclustet $temp_dingdian;}


 
 }


doMenuComponentSelection ( $modo,"edge");
}




/////////////////////////////

global proc  zxb_zuiba_jisuanquanzhong_A_shuzu(string$all_bn_temp[],string$jisuan_bn_temp,string$temp_qvxian_name)//所有次级骨骼   被抢的权重骨骼    曲线  传递字符串
{
//string$BNS_temp_s=$all_bn_temp;//所有次级骨骼
string$BNS_temp[]= $all_bn_temp;
string$BNS_temp_MM=$jisuan_bn_temp;//被计算骨骼
string$BNS_temp_M[]= stringToStringArray($BNS_temp_MM, " ");
string $zxb_bns[]=$BNS_temp;//骨骼
string$zxb_zuiba;//要抢的权重
string $zxb_skinves[];
string$zxb_zuiba=$BNS_temp_M[0];//要抢的权重
string $qvxian_temp=$temp_qvxian_name;//曲线  
ConvertSelectionToVertices;
string $bian[]=`ls -sl -fl `;
string $qvxian_temp_cv= ($qvxian_temp+".cv[0:999999999]");
select -r  $qvxian_temp_cv;
string $qvxian_temp_cvs[]=`ls -sl -fl `;
int $cvshu=size($qvxian_temp_cvs);//CV数量
int $bnsize=size($zxb_bns); //关节数量
if($cvshu!=$bnsize){error "关节数量 与曲线CV点的数量不一致";}
float $bnsatpos[]=`xform -q -ws -t $zxb_bns[0]`;
float $qvxiansatpos[]=`xform -q -ws -t  $qvxian_temp_cvs[0]`;
float $qvxianendpos[]=`xform -q -ws -t  $qvxian_temp_cvs[(size($qvxian_temp_cvs)-1)]`;
float $kaishidis=mag(<< $bnsatpos[0], $bnsatpos[1], $bnsatpos[2]>>-<< $qvxiansatpos[0], $qvxiansatpos[1], $qvxiansatpos[2]>>);
float $enddis=mag(<< $bnsatpos[0], $bnsatpos[1], $bnsatpos[2]>>-<< $qvxianendpos[0],  $qvxianendpos[1],  $qvxianendpos[2]>>);
if ($kaishidis> $enddis)
{
    reverseCurve -ch 0 -rpo 1 $qvxian_temp;
}
string $poscv="";
float $dis=100000000;
 for ($i=0;$i<size($bian);$i++)
 {
     
     float $pos_A[]=`xform -q -ws -t $bian[$i]`;
   for ($ii=0;$ii<size($qvxian_temp_cvs);$ii++)
   {
    float $pos_B[]=`xform -q -ws -t $qvxian_temp_cvs[$ii]`;
    float $cdis=mag(<<$pos_A[0],$pos_A[1],$pos_A[2]>>-<<$pos_B[0],$pos_B[1],$pos_B[2]>>);
    
    if($cdis<$dis)
    {
     $dis=$cdis;
      $poscv=$qvxian_temp_cvs[$ii];
     }
    }
  }
string $qvxian_cv[];
int $aaaaaa=`tokenize $poscv "["  $qvxian_cv`;
int $aaaaaa=`tokenize $qvxian_cv[1] "]"  $qvxian_cv`;
int $zxb_i =$qvxian_cv[0];
string $bn= $zxb_bns[$zxb_i];
string $modetemp[];
int $temp_int=`tokenize $bian[0] "." $modetemp `;
string $modo=$modetemp[0];
string $sknclustet=`findRelatedSkinCluster $modo`;
for ($ll=0;$ll<size($bian);$ll++)
 {
     int$size=size($zxb_skinves);
     string $temp_dingdian=$bian[$ll];
     $zxb_skinves[$size]=$bian[$ll];
     float$quznzhong=`skinPercent  -t $zxb_zuiba -q   $sknclustet $temp_dingdian`;
     if($quznzhong>0){skinPercent  -tv $bn  $quznzhong  $sknclustet $temp_dingdian;}


 
 }


doMenuComponentSelection ( $modo,"edge");
}






global proc  zxb_zuiba_jisuanquanzhong_chuangjianqvxian_a(string$name)
{

    string $edge_bian[]=`ls -sl -fl `;
    for ($i=0;$i<size( $edge_bian);$i++)
    {
    float $bian_pos_A[]=`xform -q -ws -t  $edge_bian[$i]`;
    if($bian_pos_A[0]<-0.0001) {select -d  $edge_bian[$i];}
    if($bian_pos_A[3]<-0.0001) {select -d  $edge_bian[$i];}
    }
    
    $edge_bian=`ls -sl -fl `;
    polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1 -n $name;
    DeleteHistory;

    
}
global proc  zxb_quanz_lipjoint_proc(string$mode,string$secondary_lip_grp)
{
//string$mode="lip_lay";
string$lip_mode=$mode;//"lip_lay"
string$secondary_lip_grp=$secondary_lip_grp;
zxb_ADD_kongzu_proc($secondary_lip_grp);
string $andbn[]=`listRelatives -p $secondary_lip_grp `;
if($andbn[0]==""){parent  $secondary_lip_grp "lip_secondary";}
string$head_controller=`textFieldGrp -q -tx UI_head_controller `;
string$all_dead_vertex=`textFieldGrp -q -tx UI_all_head_vertex `;
string$mouth_outer_wire=`textFieldGrp -q -tx UI_mouth_outer_wire `;
string$mouth_outer_wires[]=stringToStringArray($mouth_outer_wire ," ");
select -r  $mouth_outer_wires ;
ConvertSelectionToVertices;
string$mouth_outer_wires_evx_s[]=`ls -sl -fl`;
zxb_vex_xuan($lip_mode,$mouth_outer_wires_evx_s);
string$lip_mouth_outer_wires_evx_s[]=`ls -sl -fl`;
string$lr_temp=zxb_vex_RL_PROC($lip_mouth_outer_wires_evx_s);
string$lr_temp_s[]=stringToStringArray($lr_temp," ");
string$All_all_dead_vertexs[]=stringToStringArray($all_dead_vertex ," ");
string$head_mode=`textFieldGrp -q -tx UI_head_mode `;
string$all_up_s=getAttr ($head_controller+".lip_all_joint_UP");
string$all_dw_s=getAttr ($head_controller+".lip_all_joint_DW");
string$temp_root_bn="temp_root_bn";//被计算骨骼
string$con=$temp_root_bn+"_controller";
string$con_grp_A=$con+"_A";
string$con_grp_B=$con+"_B";
string$con_grp_C=$con+"_C";
string$all_bns=$all_up_s+" "+$all_dw_s;
string$All_bn[]=stringToStringArray($all_bns, " ");//所有骨骼

string$lip_mode_temp=$mode+"_temp";
string$lip_mode=$lip_mode_temp;//
string $All_bn_fu[]=`listRelatives -p  $All_bn[0]`;//整体骨骼
int$ex=`objExists$lip_mode_temp`; ///判断
if($ex==0)
{
  select -r $mode;
  duplicate -rr -n $lip_mode_temp;
  parent  $lip_mode_temp $secondary_lip_grp;
  for($i=0;$i<size($All_bn);$i++)
   {
     string$bn_a_temp=$All_bn[$i];
    select -r $bn_a_temp;
    CBdeleteConnection ($bn_a_temp+".rx");
    CBdeleteConnection ($bn_a_temp+".ry");
    CBdeleteConnection ($bn_a_temp+".rz");
   }
  setAttr ($lip_mode+".visibility") 1;  
  setAttr ($head_mode+".visibility") 0;
  int$ex=`objExists $con_grp_C`; ///判断
  if($ex==0)
    {
     select -r $All_bn;
     select -add $All_bn_fu;
     select -add $lip_mode;
     newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui true";   //蒙皮
     select -r $lip_mode ;
     ArtPaintSkinWeightsToolOptions;
     setSmoothSkinInfluence $All_bn_fu[0]; 
     artAttrPaintOperation artAttrSkinPaintCtx Replace;
     artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
     artSkinInflListChanging $All_bn_fu[0] 1;
     artAttrSkinPaintCtx -e -clear `currentCtx`;
     select -cl  ;
     for ($i=0;$i<size($All_bn);$i++)
         {
          string$bn=$All_bn[$i];
          setAttr ($bn+".liw") 1;
          }
    select -cl  ;
    joint -p 0 0 0 -n $temp_root_bn ;
    setAttr ($temp_root_bn+".visibility") 0;
    setAttr -lock true ($temp_root_bn+".v");
    circle -c 0 0 0 -nr 0 1 0 -sw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n$con ;
    group -n  $con_grp_A;
    group -n  $con_grp_B;
    group -n  $con_grp_C;
    setAttr ($con_grp_C+".visibility") 0;
    setAttr -lock true ($con_grp_C+".v");
    delete `parentConstraint  $All_bn_fu[0]  $temp_root_bn`;
    delete `parentConstraint  $All_bn_fu[0]  $con_grp_C`;
    parentConstraint $con $temp_root_bn;
    parent $temp_root_bn  $secondary_lip_grp;
    parent $con_grp_C  $secondary_lip_grp;
    select -r $temp_root_bn; 
    select -add $lip_mode ; 
    skinClusterInfluence 1 "-ug -dr 4 -ps 0 -ns 10 -lw true -wt 0";
    setAttr temp_root_bn.liw 0;
    setAttr temp_root_bn.liw 0;
     print "检查 12691"; 
    }
  select -r $lip_mode ;
  ArtPaintSkinWeightsToolOptions;
  setSmoothSkinInfluence $All_bn_fu[0]; 
  artAttrPaintOperation artAttrSkinPaintCtx Replace;
  artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
  artSkinInflListChanging $All_bn_fu[0] 1;
  artAttrSkinPaintCtx -e -clear `currentCtx`;
  select -cl  ;
  for($i=0;$i<size($All_bn);$i++)
     {
      string$bn=$All_bn[$i];
      setAttr ($bn+".liw") 1;
     }
  select -cl  ;
  setAttr temp_root_bn.liw 0;
  setAttr temp_root_bn.liw 0;
  select -r "lip_mode_plane.vtx[0:9999999999999999]" ;
  string$lip_mode_plane_cvs[]=`ls -sl -fl`;
  zxb_vex_xuan($lip_mode,$lip_mode_plane_cvs);
  string$lip_cv_s[]=`ls -sl -fl`;
  ArtPaintSkinWeightsToolOptions;
  setSmoothSkinInfluence $temp_root_bn;
  artSkinInflListChanging $temp_root_bn 1;
  artAttrSkinPaintCtx -e -clear `currentCtx`;
  zxb_vex_xuan($lip_mode,$All_all_dead_vertexs);
  string$all_ex[]=`ls -sl -fl`;
  select -r $all_ex;
  select -d  $lip_cv_s;
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for ($i=0;$i<10;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }
    print "检查 12727"; 
  select -cl  ;
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("查找顶点...") -bp -ii 1 -min 0 -max `size($all_ex)` $gMainProgressBar;
  string $skinCluster=`findRelatedSkinCluster $lip_mode` ;//访问蒙皮节点     
  for ($i=0;$i<size($all_ex);$i++)     
      {
       if(`progressBar -q -ic $gMainProgressBar`)
          break;
          progressBar -e -s 1 $gMainProgressBar;
        string$ex_temp= $all_ex[$i];
         float$quznhzong=`skinPercent -t $temp_root_bn -q $skinCluster    $ex_temp`;//查询权重
        if($quznhzong>0){select -add$ex_temp; }
      }
  progressBar -e -ep $gMainProgressBar;
  select -d  $lip_cv_s;
  string$temp_lip_aa[]=`ls -sl -fl`;  
  select -r  $temp_lip_aa;   
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for($i=0;$i<100;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }   
   print "检查 12753";     
  select -r "lip_mode_plane_nei.vtx[0:999999999999999999999]" ;
  string$temp_lip_all_nei[]=`ls -sl -fl`;  
  zxb_vex_xuan($lip_mode,$temp_lip_all_nei);
  string$lip_all_nei[]=`ls -sl -fl`; 
  select -r  $temp_lip_aa;  
  select -d $lip_all_nei;
  string$lip_all_wai[]=`ls -sl -fl`; 
  string$cheek_mian=`textFieldGrp -q -tx UI_cheek_face `;
  string$cheek_mians[]=stringToStringArray($cheek_mian," ");
  select -r  $cheek_mians;
  ConvertSelectionToVertices;
  string$lip_cheekTemps[]=`ls -sl -fl`; 
  zxb_vex_xuan($lip_mode,$lip_cheekTemps) ; 
  symmetricModelling -e -symmetry true; 
  if (true) SymmetrizeSelection;
  symmetricModelling -e -symmetry false;
  if (false) SymmetrizeSelection;
  string$lip_cheek[]=`ls -sl -fl`; 
  select -r $lip_cheek  ;
  select -add $lip_all_wai ;
  string$lip_all_exv_a[]=`ls -sl -fl`; 
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for ($i=0;$i<50;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }  
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;  
  progressBar -e -st ("查找顶点...") -bp -ii 1 -min 0 -max `size($lip_all_exv_a)` $gMainProgressBar;
  string $skinCluster=`findRelatedSkinCluster $lip_mode` ;//访问蒙皮节点     
  for ($i=0;$i<size($lip_all_exv_a);$i++)     
     {
       if(`progressBar -q -ic $gMainProgressBar`)
          break;
          progressBar -e -s 1 $gMainProgressBar;
        string$ex_temp= $lip_all_exv_a[$i];
         float$quznhzong=`skinPercent -t $temp_root_bn -q $skinCluster    $ex_temp`;//查询权重
        if($quznhzong>0&&$quznhzong<0.9){select -add$ex_temp; }
      }
  progressBar -e -ep $gMainProgressBar;
  ArtPaintSkinWeightsToolOptions; 
  artAttrPaintOperation artAttrSkinPaintCtx Replace;
  artSkinSetSelectionValue 0.9 false artAttrSkinPaintCtx artAttrSkin;
  artAttrSkinPaintCtx -e -clear `currentCtx`;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for($i=0;$i<40;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }
  select -cl  ;
     print "检查 12806";   
  select -r $lip_all_exv_a;  
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for($i=0;$i<2;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      } 
  float $temp_pos[]=`xform -q -ws -t $lr_temp_s[0]`;//////查询位置
  select -cl  ;
  string$temp_up="";
  string$temp_dw="";
  for($i=0;$i<size($lip_all_exv_a);$i++)
    {
   string$temp_exc_name=$lip_all_exv_a[$i];
   float $temp_pos_a[]=`xform -q -ws -t $temp_exc_name`;//////查询位置
   if( $temp_pos_a[1]<$temp_pos[1]){$temp_dw+=$temp_exc_name+" "; }else{$temp_up+=$temp_exc_name+" ";}
    }
  string$temp_dws[]=stringToStringArray($temp_dw," ");
  string$temp_ups[]=stringToStringArray($temp_up," ");
  select -r $all_ex;
  select -d$temp_ups $lip_all_exv_a $lip_all_nei $lip_cv_s;
  string$lip_temp_dw_all_s[]=`ls -sl -fl`; 
  string$temp_up_a="";
  string$temp_dw_a="";
  for ($i=0;$i<size($lip_temp_dw_all_s);$i++)
    {
   string$temp_exc_name=$lip_temp_dw_all_s[$i];
    float $temp_pos_a[]=`xform -q -ws -t $temp_exc_name`;//////查询位置
   if( $temp_pos_a[1]<$temp_pos[1]){$temp_dw_a+=$temp_exc_name+" "; }else{$temp_up_a+=$temp_exc_name+" ";}
   }
  string$temp_dws_a[]=stringToStringArray($temp_dw_a," ");
  string$temp_ups_a[]=stringToStringArray($temp_up_a," ");
  select -r  $temp_dws_a;
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for($i=0;$i<3;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }
      
   print "检查 12842";   
  global string $gSelect;
  global string $gMainProgressBar;
  setToolTo $gSelect;
  progressBar -e -st ("查找顶点...") -bp -ii 1 -min 0 -max `size($temp_dws_a)` $gMainProgressBar;
  string $skinCluster=`findRelatedSkinCluster $lip_mode` ;//访问蒙皮节点     
  for ($i=0;$i<size($temp_dws_a);$i++)     
     {
       if(`progressBar -q -ic $gMainProgressBar`)
          break;
          progressBar -e -s 1 $gMainProgressBar;
        string$ex_temp=$temp_dws_a[$i];
         float$quznhzong=`skinPercent -t $temp_root_bn -q $skinCluster    $ex_temp`;//查询权重
        if($quznhzong<0.9&&$quznhzong>0.01){select -add$ex_temp; }
      }
  progressBar -e -ep $gMainProgressBar;
  select -add  $temp_dws;  
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for($i=0;$i<40;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }
  select -cl  ;
  select -r $all_ex; 
  ArtPaintSkinWeightsToolOptions;
  artAttrPaintOperation artAttrSkinPaintCtx Smooth;
  for ($i=0;$i<1;$i++)
     {
      artAttrSkinPaintCtx -e -clear `currentCtx`;
      }
  select -cl  ;    
}
print "检查 12875";
 
string$temp_mode=zxb_quanzhong_lip_jicji_proc($lip_mode,$temp_root_bn,$All_bn_fu[0],$all_bns,$secondary_lip_grp);
print "检查 12883";
/*select -r  $temp_mode; 
select -add $lip_mode ; 
CopySkinWeights;*/
select -cl  ;  
float$ex_vs=getAttr ($temp_mode+".visibility");
if($ex_vs==1)
  {
  setAttr ($temp_mode+".visibility") 0;
  setAttr -lock true ($temp_mode+".v");
  }
float$ex_vs_a=getAttr ($lip_mode+".visibility");
if($ex_vs_a==1)
  {
  setAttr ($lip_mode+".visibility") 0;
  setAttr -lock true ($lip_mode+".v");
  }

setAttr ($head_mode+".visibility") 1;

 string $skinCluster_a=`findRelatedSkinCluster $mode` ;//访问蒙皮节点 
 int $ex_skinCluster=`objExists $skinCluster_a`;
 if($ex_skinCluster==0)
   {
   select -r $All_bn  ;
   select -add $All_bn_fu[0];
   select -add $mode;
   newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui true";   //蒙皮
   }

select -r $temp_mode;
select -add $mode;
CopySkinWeights;
print "检查 12915";
select -cl  ;
}




global proc  zxb_button_lipjoint_proc()
{
  string$Cluster=zxb_zuibajici_joint_proc(0,"lip"); //创建次级关节  返回蔟的名字
  string $head_qvxian=`textFieldGrp -q -tx UI_head_controller `;
  zxb_ADD_shuxing_string_proc($head_qvxian,"lip_Cluster");
  setAttr -type "string"($head_qvxian+".lip_Cluster") $Cluster;//保存蔟的名字
  zxb_secondary_controller;//创建次级控制器
  select -cl  ;
  zxb_lip_ciji_controller_genshui;
  select -cl  ;
  zxb_quanz_lipjoint_proc("lip_lay","secondary_lip_grp");
  select -cl  ;
  
  button -e -en 0 headhunhebianxing_edit_button;
  
}

global proc  zxb_zuiba_lipjoint_quanzhongchongxiangjisuan_proc()
{
zxb_quanz_lipjoint_proc("lip_lay","secondary_lip_grp");
select -cl  ;
}


///////////////////////////////////////嘴巴次级控制器///////////////////////////////////////////////////



///////////////////////////////////////////创建眼睛控制器//////////////////////////////////////////
global proc zxb_chuangjianyanjingguyanjie_fangfa_proc()
{
string $xiaba_bn=`textFieldGrp -q -tx  UI_zxb_eye`;
string $toubukongzhiqi=`textFieldGrp -q -tx UI_head_controller `;
string $toubuguanjie=`textFieldGrp -q -tx UI_head_bn `;
string$con=`textFieldGrp -q -tx UI_head_controller `;
string $con_sheps[]=`listRelatives -s $con`;
float$obx_Max[]=`getAttr ($con_sheps[0]+".boundingBoxMax")`;////绑定box节点
float$soce=$obx_Max[0]*0.1;
int$xingwei=`checkBox -q  -value  xingwei`;
int$duicheng_bn=`checkBox -q  -value   duicheng`;
string$bns[];
clear $bns;
int $nemt=`tokenize $xiaba_bn" " $bns`;//分离字符串存到变量
string$bn=$bns[0];
float$bn_pos_aa[]=`xform -q -ws -t $bn`;
string$LLRR_qianzui="";
if($bn_pos_aa[0]>0){$LLRR_qianzui="L";}else{$LLRR_qianzui="R";}
string$temp_lingshi_bn="zxb_Eye_"+$LLRR_qianzui;
string$eye_End=$temp_lingshi_bn+"_End";
int$panduan_A=`objExists $temp_lingshi_bn`;
if($panduan_A==0)
  {  
  select -cl;
  joint -p 0 0 0 -n $temp_lingshi_bn ;
  joint -p 0 0 $soce  -n $eye_End;
  delete`pointConstraint $bn $temp_lingshi_bn` ;
  select -r $temp_lingshi_bn;
  joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
  setAttr ($eye_End+".jointOrientY") 0;
  }
string$bn=$temp_lingshi_bn;
float$temp_poss_A=`getAttr  ($eye_End+".translateX")`;
float$temp_poss=$temp_poss_A*3;
float$bn_pos[]=`xform -q -ws -t $bn`;
string$LLRR="";
string$jingxiang="";
string$array[];
clear $array;
if($bn_pos[0]>0.001)
 {
  $LLRR="L";  
  $jingxiang="R";
  $array= stringToStringArray($bn, $LLRR);//字符串转化数组
  int$size=size($array);
  if($size<1){error "关节利面没有镜像名称";}
  select -r  $bn;
  if($duicheng_bn==1)
    {
      if($xingwei==0)
         {
         mirrorJoint -mirrorYZ -mirrorBehavior -searchReplace $LLRR $jingxiang;
          }else
              {
                mirrorJoint -mirrorYZ -searchReplace $LLRR $jingxiang;
              }
    
         }
    }
    if($bn_pos[0]<0.001)
   {
     $LLRR="R";  
     $jingxiang="L";
     $array= stringToStringArray($bn, $LLRR);//字符串转化数组
     int$size=size($array);
     if($size<1){error "关节利面没有镜像名称";}
      select -r  $bn;
    if($duicheng_bn==1)
      {
       if($xingwei==0)
          {
           mirrorJoint -mirrorYZ -mirrorBehavior -searchReplace $LLRR $jingxiang;
          }else
              {
                mirrorJoint -mirrorYZ -searchReplace $LLRR $jingxiang;
                }
       }
  }
string$temp_bn=($array[0]+$jingxiang+$array[1]);
select -r $bn; 
if($duicheng_bn==1){select -add $temp_bn; }
string$alleyebns[]=`ls -sl`;  
string$kongzhiqi_D=($bn+"_eye_kongzhiqi_D");
string$kongzhiqi_D_GRP_A=($bn+"_eye_kongzhiqi_D_grp_A");
string$kongzhiqi_D_GRP_B=($bn+"_eye_kongzhiqi_D_grp_B");
string$kongzhiqi_D_GRP_C=($bn+"_eye_kongzhiqi_D_grp_C"); 
string$loc=$bn+"dingwei_loc";
string$loc_grp_A=$bn+"dingwei_loc_grp_A";
spaceLocator -p 0 0 0 -n $loc ;
group -n $loc_grp_A;
string$eye_grp="Eye_all_grp";
zxb_ADD_kongzu_proc($eye_grp);
parent  $eye_grp "Face_Group";
parent  $loc_grp_A $eye_grp;
setAttr -type float3 ($loc_grp_A+".translate") 0 0 0;
setAttr -type float3  ($loc_grp_A+".rotate") 0 0 0 ;
string$head_gep_temp="eye_controller_all_grp";
zxb_ADD_kongzu_proc($head_gep_temp);
delete`parentConstraint   $toubuguanjie $head_gep_temp `;
parent $head_gep_temp  $eye_grp;
parentConstraint  -mo  $toubuguanjie $head_gep_temp;
scaleConstraint -mo $toubuguanjie $head_gep_temp;
delete`parentConstraint  $toubuguanjie $loc_grp_A` ;
parentConstraint  -mo $toubuguanjie  $loc_grp_A;
scaleConstraint -mo $toubuguanjie  $loc_grp_A;
setAttr ($loc_grp_A+".visibility") 0;
setAttr -lock true ($loc_grp_A+".v");
string$kongzhiqi="";
string$kongzhiqi_BB="";
   for ($i=0;$i<size($alleyebns);$i++)
       {
       string$temp_BN=$alleyebns[$i];
       string$BN=$temp_BN+"_zhengti";
       string$en_BN=$BN+"_End";
       string$kongzhiqi_A=($temp_BN+"_eye_kongzhiqi_A");
       string$kongzhiqi_A_GRP_A=($temp_BN+"_eye_kongzhiqi_A_GRP_A");
       string$kongzhiqi_A_GRP_B=($temp_BN+"_eye_kongzhiqi_A_GRP_B");
       string$kongzhiqi_A_GRP_C=($temp_BN+"_eye_kongzhiqi_A_GRP_C");
       string$kongzhiqi_B=($temp_BN+"_eye_kongzhiqi_B");
       string$kongzhiqi_B_GRP_A=($temp_BN+"_eye_kongzhiqi_B_grp_A");
       string$kongzhiqi_B_GRP_B=($temp_BN+"_eye_kongzhiqi_B_grp_B");
       string$kongzhiqi_B_GRP_C=($temp_BN+"_eye_kongzhiqi_B_grp_C");
       string$kongzhiqi_B_GRP_D=($temp_BN+"_eye_kongzhiqi_B_grp_D");
       string$kongzhiqi_C=($temp_BN+"_eye_kongzhiqi_C");
       string$kongzhiqi_C_GRP_A=($temp_BN+"_eye_kongzhiqi_C_grp_A");
       string$kongzhiqi_C_GRP_B=($temp_BN+"_eye_kongzhiqi_C_grp_B");
       string$kongzhiqi_C_GRP_C=($temp_BN+"_eye_kongzhiqi_C_grp_C");
       $kongzhiqi+=$kongzhiqi_A+" ";
       $kongzhiqi_BB+=$kongzhiqi_B+" ";
       select -r  $temp_BN;
       duplicate -rr -n $BN ;
       string$BN_end[]=`listRelatives -c -pa $BN`;
       rename $BN_end[0]  $en_BN;
       select -r  $en_BN;
       setAttr ($en_BN+".translateX") ($temp_poss*0.5);
       circle -c 0 0 0 -nr 1 0 0 -sw 360 -r ($temp_poss*0.2) -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $kongzhiqi_A; 
       group -n $kongzhiqi_A_GRP_A;
       group -n $kongzhiqi_A_GRP_B;    
       group -n $kongzhiqi_A_GRP_C;
       setAttr ($kongzhiqi_A+".overrideEnabled") 1;
       setAttr  ($kongzhiqi_A+".overrideColor") 13;
       delete`parentConstraint $temp_BN  $kongzhiqi_A_GRP_C`;
       select -r ($kongzhiqi_A+".cv[0:999]") ;
       move -r -os -wd $temp_poss 0 0 ;
       parentConstraint  $kongzhiqi_A $BN ;
       circle -c 0 0 0 -nr 1 0 0 -sw 360 -r ($temp_poss*0.1) -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $kongzhiqi_B; 
       group -n $kongzhiqi_B_GRP_A;
       group -n $kongzhiqi_B_GRP_B;    
       group -n $kongzhiqi_B_GRP_C;
       group -n $kongzhiqi_B_GRP_D;
       string$qvxian_shap_B[]=`listRelatives -s $kongzhiqi_B`;
       setAttr ($kongzhiqi_B+".overrideEnabled") 1;
       setAttr  ($kongzhiqi_B+".overrideColor") 17;
       delete`parentConstraint $temp_BN  $kongzhiqi_B_GRP_D`;
       select -r ($kongzhiqi_B+".cv[0:999]") ;
       move -r -os -wd $temp_poss 0 0 ;
       parentConstraint  $kongzhiqi_B $temp_BN ;
       string$bn_dingwei=$temp_BN+"_temp";
       select -r $temp_BN;
       duplicate -rr -n $bn_dingwei;
       select -r $bn_dingwei;
       move -r -os -wd ($temp_poss*3) 0 0 ;
       circle -c 0 0 0 -nr 1 0 0 -sw 360 -r ($temp_poss*0.2) -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $kongzhiqi_C; 
       group -n $kongzhiqi_C_GRP_A;
       group -n $kongzhiqi_C_GRP_B;    
       group -n $kongzhiqi_C_GRP_C;
       setAttr ($kongzhiqi_C+".overrideEnabled") 1;
       setAttr  ($kongzhiqi_C+".overrideColor") 17;
       delete`parentConstraint $bn_dingwei  $kongzhiqi_C_GRP_C`;
       int$ex=`objExists $kongzhiqi_D`;
       if($ex==0)
         {  
         circle -c 0 0 0 -nr 1 0 0 -sw 360 -r ($temp_poss) -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $kongzhiqi_D; 
         group -n $kongzhiqi_D_GRP_A;
         group -n $kongzhiqi_D_GRP_B;    
         group -n $kongzhiqi_D_GRP_C;
         setAttr ($kongzhiqi_D+".overrideEnabled") 1;
         setAttr  ($kongzhiqi_D+".overrideColor") 17;
         delete`parentConstraint $bn_dingwei  $kongzhiqi_D_GRP_C`;
         setAttr ($kongzhiqi_D_GRP_C+".translateX") 0;
         setAttr -type float3 ($kongzhiqi_D_GRP_C+".r") 0 -90 0;
         select -r ($kongzhiqi_D+".cv[0:7]") ;
          }  
      delete $bn_dingwei;
      parent $kongzhiqi_A_GRP_C  $head_gep_temp;
      parent $kongzhiqi_B_GRP_D  $head_gep_temp;
      parent $kongzhiqi_C_GRP_C  $kongzhiqi_D;
      if($i==0){parent $kongzhiqi_D_GRP_C   $head_gep_temp;}
      parent  $temp_BN $toubuguanjie;
      parent  $BN $toubuguanjie ;
      select -r $kongzhiqi_C;
      select -add $kongzhiqi_B_GRP_C;
      aimConstraint -offset 0 0 0 -weight 1 -aimVector 1 0 0 -upVector 0 1 0 -worldUpType "objectrotation" -worldUpVector 0 1 0 -worldUpObject $loc;
      connectAttr -f ($kongzhiqi_B_GRP_C+".rotate") ($kongzhiqi_A_GRP_B+".rotate");
      connectAttr -f ($kongzhiqi_B_GRP_C+".t") ($kongzhiqi_A_GRP_B+".t");
      connectAttr -f ($kongzhiqi_A+".t") ($kongzhiqi_B_GRP_B+".t");
      connectAttr -f ($kongzhiqi_A+".r") ($kongzhiqi_B_GRP_B+".r");
      connectAttr -f ($kongzhiqi_A+".s") ($temp_BN+".s");
      connectAttr -f ($kongzhiqi_A+".s") ( $BN+".s");
      connectAttr -f ($kongzhiqi_A+".s") ( $kongzhiqi_B_GRP_C+".s");
      }   
zxb_ADD_shuxing_string_proc($toubukongzhiqi,"eye_con");
zxb_ADD_shuxing_string_proc($toubukongzhiqi,"eye_con_b");
setAttr -type "string" ($toubukongzhiqi+".eye_con") $kongzhiqi ;
setAttr -type "string" ($toubukongzhiqi+".eye_con_b") $kongzhiqi_BB ;

}






////////////////////////////////////创建眼皮绑定//////////////////////////////////////////
global proc zxb_chuangjianyanpiguanjie_fangfa_proc()
{
string $xiaba_bn=`textFieldGrp -q -tx  UI_zxb_eye`;//眼球关节
string $toubukongzhiqi=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
string $toubuguanjie=`textFieldGrp -q -tx UI_head_bn `;//头部关节
string$temp_commm=`getAttr ($toubukongzhiqi+".eye_con")`;
string $eye_con=$temp_commm;//眼球控制器
string $eye_cons[]= stringToStringArray($eye_con, " ");//字符串转化数组
string $diana=`textFieldGrp -q -tx UI_zxb_eye_point_up`;
string $dianb=`textFieldGrp -q -tx  UI_zxb_eye_point_dw`;
zxb_ADD_shuxing_string_proc($toubukongzhiqi,"eye_lip_ik");
zxb_ADD_kongzu_proc("zxb_fase_eye_loc");
zxb_ADD_kongzu_proc("zxb_fase_eye_ikHandle");
zxb_ADD_kongzu_proc("zxb_fase_eye_joints");
zxb_ADD_kongzu_proc("zxb_fase_eye_grp");
zxb_ADD_kongzu_proc("Face_Group");
zxb_ADD_kongzu_proc("zxb_eye_loc");
setAttr "zxb_fase_eye_joints.visibility" 0;
setAttr -lock true "zxb_fase_eye_joints.v";
parent ("zxb_eye_loc")("Eye_all_grp");
parent ("zxb_fase_eye_loc")("Eye_all_grp");
parent ("zxb_fase_eye_ikHandle")("Eye_all_grp");
parent ("zxb_fase_eye_joints")("Eye_all_grp");
parent("zxb_fase_eye_grp")("Eye_all_grp");
string$ik_eye_ikHandle="";
float$diana_pos[]=`xform -q -ws -t $diana`;
float$dianb_pos[]=`xform -q -ws -t $dianb`;
int$xingwei=`checkBox -q  -value  xingwei`;
int$duicheng_bn=`checkBox -q  -value   duicheng`;
string$bns[];
clear $bns;
int $nemt=`tokenize $xiaba_bn" " $bns`;//分离字符串存到变量
string$bn=$bns[0];
string$yanpi_UP_bn=$bn+"_UP_yanpi";
string$yanpi_UP_bn_end=$bn+"_UP_yanpi_end";
string$yanpi_DW_bn=$bn+"_DW_yanpi";
string$yanpi_UP_DW_end=$bn+"_DW_yanpi_end";
select -r  $bn;
duplicate -rr -n $yanpi_UP_bn;
string$bn_end[]=`listRelatives -c -pa -type "joint" $yanpi_UP_bn`;
string$bn_end_a[]=`listRelatives -c -pa  $yanpi_UP_bn`;
select -r $bn_end_a;
select -d $bn_end[0];
doDelete;
rename $bn_end[0] $yanpi_UP_bn_end;
float$temp_poss=`getAttr  ($yanpi_UP_bn_end+".tx")`;
select -r $yanpi_UP_bn;
move -r -os -wd 0 ($temp_poss*0.025) 0 ;
select -r  $bn;
duplicate -rr -n $yanpi_DW_bn;
string$bn_end_dw[]=`listRelatives -c -pa -type "joint" $yanpi_DW_bn`;
string$bn_end_dwa[]=`listRelatives -c -pa  $yanpi_DW_bn`;
select -r $bn_end_dwa;
select -d $bn_end_dw[0];
doDelete;
rename$bn_end_dw[0] $yanpi_UP_DW_end;
float$temp_posd=`getAttr  ($yanpi_UP_DW_end+".tx")`;
select -r $yanpi_DW_bn;
move -r -os -wd 0 ($temp_posd*-0.025) 0 ;

string $tepup_loc=$bn+"_temp_uploca";
string $tepdw_loc=$bn+"_temp_dwloca";
spaceLocator -p 0 0 0  -n $tepup_loc ;
parent $tepup_loc $yanpi_UP_bn_end;
setAttr -type float3 ($tepup_loc+".translate") 0 0 0;
spaceLocator -p 0 0 0  -n $tepdw_loc ;
parent $tepdw_loc $yanpi_UP_DW_end;
setAttr -type float3 ($tepdw_loc+".translate") 0 0 0;
float$diss=10000000;
select -r  $yanpi_DW_bn ;
select -add  $yanpi_UP_bn ;
string $bianliang[]=`ls -sl`;
float$rz=0;
for ($i=0;$i<size($bianliang);$i++)
    {
     string$guge=$bianliang[$i];
     string$temp_zi[]=`listRelatives -c  $guge`;
     string$temp_loc[]=`listRelatives -c  $temp_zi[0]`;
     float$temp_po[];
     clear$temp_po;
     if($i==0){$temp_po=$diana_pos;}else{$temp_po=$dianb_pos;$diss=10000000; }
     for ($ii=0;$ii<360;$ii++)
         {
          setAttr ($guge+".rotateZ") $ii;
          float$pos[]=`xform -q -ws -t $temp_loc[0]`;
          float$cdiss=mag(<<$temp_po[0],$temp_po[1],$temp_po[2]>>-<<$pos[0],$pos[1],$pos[2]>>);
          if($cdiss<$diss)
            {
            $diss=$cdiss;
            $rz=$ii;
             }
             
          }
    setAttr ($guge+".rotateZ") $rz;
    }
        
        
float$diss=10000000;
select -r $yanpi_DW_bn ;
select -add $yanpi_UP_bn;
string $bianliang[]=`ls -sl`;
float$rz=0;
for ($i=0;$i<size($bianliang);$i++)
    {
     string$guge=$bianliang[$i];
     string$temp_zi[]=`listRelatives -c  $guge`;
     string$temp_loc[]=`listRelatives -c  $temp_zi[0]`;
     float$temp_po[];
     clear$temp_po;
     if($i==0){$temp_po=$diana_pos;}else{$temp_po=$dianb_pos;$diss=10000000; }
     for ($ii=0;$ii<360;$ii++)
         {
         setAttr ($guge+".rotateY") $ii;
         float$pos[]=`xform -q -ws -t $temp_loc[0]`;
         float$cdiss=mag(<<$temp_po[0],$temp_po[1],$temp_po[2]>>-<<$pos[0],$pos[1],$pos[2]>>);
         if($cdiss<$diss)
           {
            $diss=$cdiss;
             $rz=$ii;
            }
             
         }
     setAttr ($guge+".rotateY") $rz;
    }
             
             
             
delete  $tepup_loc  $tepdw_loc;

float$upry=` getAttr  ($yanpi_UP_bn+".ry")`;
float$dwry=` getAttr  ($yanpi_DW_bn+".ry")`;
float$rot=($upry+$dwry)*0.5;
setAttr  ($yanpi_UP_bn+".ry")  $rot;
setAttr  ($yanpi_DW_bn+".ry")  $rot;
select -r  $yanpi_UP_bn $yanpi_DW_bn;
FreezeTransformations;
parent -w;
string$root_bn=($bn+"_root_bn");
float$temp_pos[]=`xform -q -ws -t $yanpi_UP_bn`;
select -cl  ;
joint -p 0 $temp_pos[1]  $temp_pos[2] -n $root_bn;
parent $root_bn("zxb_fase_eye_joints");
string$AA="";
string$bb="";
string$R_bn="";
if($duicheng_bn==1)
  {
   float$aa_pos[]=`xform -q -ws -t  $bn`;
   if($aa_pos[0]<0){$AA="R";$bb="L";}else{$AA="L";$bb="R";}
   string$zhuguanjioeS[]= stringToStringArray($bn, $AA);//字符串转化数组
   int$size=size($zhuguanjioeS);
   if($size<1){error "关节利面没有镜像名称";}
   $R_bn=$zhuguanjioeS[0]+$bb+$zhuguanjioeS[1];
   /*select -r $bn;
   mirrorJoint -mirrorYZ -mirrorBehavior -searchReplace $AA $bb;*/
  }
if($duicheng_bn==1){select -r  $bn  $R_bn;}else{select -r  $bn;} 

string$rrlll[];
clear $rrlll ;
string $RL_bn[]=`ls -sl`;



for ($i=0;$i<size($RL_bn);$i++)
    {   
      string$c_bn=$RL_bn[$i];
      string$kongzu_A= $c_bn+"_ROOT_zu_A";
      string$kongzu_Aa= $c_bn+"_ROOT_zu_Aa";
      string$kongzu_B= $c_bn+"_ROOT_zu_B";
      string$kongzu_Bb= $c_bn+"_ROOT_zu_Bb";
      select -cl  ;
      group -empty -n  $kongzu_A;
      group -n $kongzu_Aa;
      delete`parentConstraint $c_bn $kongzu_Aa`;
      parentConstraint   -mo $c_bn $kongzu_Aa;
      parent   $kongzu_Aa ("Eye_all_grp") ;
      select -cl  ;
      group -empty -n  $kongzu_B;
      group -n $kongzu_Bb;
      delete`parentConstraint  $c_bn $kongzu_Bb`;
      parentConstraint  -mo $toubuguanjie $kongzu_Bb;
      parent  $kongzu_Bb ("zxb_eye_loc");
      orientConstraint -mo $kongzu_A $kongzu_B ;
     string$root_gensui_bn_root="zxb_eye_loc_bn_"+$c_bn;;
     float$temp_pos[]=`xform -q -ws -t $yanpi_UP_bn`;
     select -cl  ;
     joint -p 0 0 0 -n $root_gensui_bn_root;
     $rrlll[$i]=$root_gensui_bn_root;
     delete`parentConstraint  $c_bn  $root_gensui_bn_root`;
     select -r $root_gensui_bn_root;
     makeIdentity -apply true -t 0 -r 1 -s 0 -n 0 -pn 1;
     parent $root_gensui_bn_root $root_bn;
     connectAttr -f   ($kongzu_B+".r")   ($root_gensui_bn_root+".r");
   }
string$LLRR="";
string$jingxiang="";
string$array[];
clear $array;
string$up[];
clear$up;
string$dw[];
clear$dw;
//select -r $bianliang;
for ($i=0;$i<size($bianliang);$i++)
    {
         string$temp_bn=$bianliang[$i];
         float$bn_pos[]=`xform -q -ws -t $temp_bn`; 
         if($bn_pos[0]>0)
           {
            $LLRR="L";  
            $jingxiang="R";
            if($bn_pos[0]<0){$AA="R";$bb="L";}else{$AA="L";$bb="R";}
            $array= stringToStringArray($temp_bn, $LLRR);//字符串转化数组
            if($i==0){$dw=$array;}else{$up=$array;}
            int$size=size($array);
            if($size<1){error "关节利面没有镜像名称";}
            select -r  $temp_bn;
            if($duicheng_bn==1)
              {
               mirrorJoint -mirrorYZ -mirrorBehavior -searchReplace $AA $bb;
              } 
          }
        if($bn_pos[0]<0)
          {
          $LLRR="R";  
          $jingxiang="L";
           if($bn_pos[0]<0){$AA="R";$bb="L";}else{$AA="L";$bb="R";}
          $array= stringToStringArray($temp_bn, $LLRR);//字符串转化数组
          if($i==0){$dw=$array;}else{$up=$array;}
          int$size=size($array);
          if($size<=1){error "关节利面没有镜像名称";}
          select -r $temp_bn;
          if($duicheng_bn==1)
            {
            mirrorJoint -mirrorYZ -mirrorBehavior -searchReplace $AA $bb;
         
             }
          }
  
    }

string$shang_bn=$dw[0]+$jingxiang+$dw[1];
string$xia_bn=$up[0]+$jingxiang+$up[1];
if($duicheng_bn==1) 
  { 
  select -r $yanpi_DW_bn  $yanpi_UP_bn $shang_bn $xia_bn ;
   }else
       {
        select -r $yanpi_DW_bn  $yanpi_UP_bn;
        }

string $RL_BNS[]=`ls -sl`;
 select -add ("zxb_fase_eye_joints");
 parent;
 string$jiajian_s[];
 clear $jiajian_s;
  string$fk_c[];
 clear $fk_c;
   string$fk_gensui[];
 clear $fk_gensui;
 
    string$Fk_[];
 clear $Fk_;
 

 for ($i=0;$i<size($RL_BNS);$i++)
     {
      string$temp_bn=$RL_BNS[$i];
      string$upik=$temp_bn+"_IK";
      string$upik_end=$temp_bn+"_IK_end";
      string$upfk=$temp_bn+"_FK";
      string$upfk_end=$temp_bn+"_FK_end";
      string$lik_loc=$temp_bn+"_ik_loc"+$i;
       string$lik_loc_grp=$lik_loc+"_grp";
      
  
     select -r $temp_bn;
     duplicate -rr -n $upik;
     setAttr ($upik+".visibility") 0;
     string$bn_up_end_ik[]=`listRelatives -c -pa  $upik`;
     rename $bn_up_end_ik[0] $upik_end;
  
     select -r $temp_bn;
     duplicate -rr -n $upfk;
     setAttr ($upfk+".visibility") 0;
     string$bn_up_end_fk[]=`listRelatives -c -pa  $upfk`;
     rename $bn_up_end_fk[0] $upfk_end;
     
     string$jiajianjiedian=($temp_bn+"_plusMinusAverage_eye_A");
     int $ex=`objExists $jiajianjiedian`;//查询这个物体是否纯在
     if($ex==1){delete $jiajianjiedian;}
      shadingNode -asUtility plusMinusAverage -n $jiajianjiedian;//创建加减节点
      $jiajian_s[$i]=$jiajianjiedian;
      connectAttr -f ($upik+".rotateZ") ($jiajianjiedian+".input3D[0].input3Dz");
      connectAttr -f ($upfk+".rotate") ($jiajianjiedian+".input3D[1]");

      connectAttr -f ($jiajianjiedian+".output3D") ($temp_bn+".rotate");
      
      spaceLocator -p 0 0 0 -n $lik_loc ;
      group -n  $lik_loc_grp;
      setAttr  ($lik_loc+".visibility") 0;
     setAttr -lock true ($lik_loc+".v");
      parent $lik_loc_grp("zxb_fase_eye_loc");
      parent $upik $root_bn;
      parent $upfk $root_bn;
      select -r $upik;
      select -add $upik_end;
     string$ikhade[]=`ikHandle`;
     delete`parentConstraint  $ikhade[0]  $lik_loc_grp`;
     parent$ikhade[0]("zxb_fase_eye_ikHandle");
     $ik_eye_ikHandle+=$ikhade[0]+" ";
     setAttr  ($ikhade[0]+".visibility") 0;
     setAttr -lock true ($ikhade[0]+".v");
     select -r $lik_loc_grp;
     move -r -os -wd 0.2 0.2 0 ;
     select -r $lik_loc;
     select -add $ikhade[0];
     poleVectorConstraint -weight 1;
     float$rx=`getAttr ($temp_bn+".rx")`;
     if($i<=1)
       {
        if($rx>0){$rx=$rx*-1;}else{float$abs=abs($rx);$rx=$abs;}
        }
     
     setAttr ($ikhade[0]+".twist") $rx;
     // parent $temp_bn $root_bn; 
     //select -add $yanpi_UP_bn;
     
      string$upfk_C=$temp_bn+"_FK_C";
      string$upfkC_end=$temp_bn+"_FK_end_C";
      select -r $temp_bn;
      duplicate -rr -n $upfk_C;  
      setAttr ($upfk_C+".visibility") 0;
      string$bn_up_end_fkC[]=`listRelatives -c -pa  $upfk_C`;
      rename $bn_up_end_fkC[0] $upfkC_end;
      
      string$upfk_gensui=$temp_bn+"_FK_gensui";
      string$upfk_gensui_end=$temp_bn+"_FK_end_gensui";
      select -r $temp_bn;
      duplicate -rr -n $upfk_gensui;  
      setAttr ($upfk_gensui+".visibility") 0;
      string$bn_upfk_gensui[]=`listRelatives -c -pa  $upfk_gensui`;
      rename $bn_upfk_gensui[0] $upfk_gensui_end;
      
      
      orientConstraint   $upfk_gensui  $upfk_C;
      string $fk_qvxian=$temp_bn+"_fk_com";
      string$fk_qvxian_grp_A=$fk_qvxian+"_A";
      string$fk_qvxian_grp_B=$fk_qvxian+"_B";


      parent  $upfk_C $root_bn;
      string$rrll_bn="";
      if($i<=1){$rrll_bn=$rrlll[0];}else{$rrll_bn=$rrlll[1];}
      parent  $upfk_gensui  $rrll_bn ;
      $fk_c[$i]=$upfk_C;
     $fk_gensui[$i]=$upfk_gensui;
     $Fk_[$i]=$upfk;
  }
  
 for ($i=0;$i<size($eye_cons);$i++)
   {

      int$a=0;
      int$b=1;
      if($i==1){$a=2; $b=3;}
      
       string$con=$eye_cons[$i];
       addAttr -ln "shang"  -at double  -dv 0 -k 1 $con ;
       addAttr -ln "xia"  -at double   -dv 0 -k 1 $con ;
       addAttr -ln "biyan"  -at double   -dv 0 -k 1 $con ;
       addAttr -ln "beishu"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
       addAttr -ln "shangxia"  -at double   -dv 0 -k 1 $con ;
       
       
     addAttr -ln "gensui_rx_up"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     addAttr -ln "gensui_ry_up"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     addAttr -ln "gensui_rz_up"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     
     addAttr -ln "gensui_rx_dw"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     addAttr -ln "gensui_ry_dw"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     addAttr -ln "gensui_rz_dw"  -at double  -min 0 -max 1 -dv 0.5 -k 1 $con ;
     
     setAttr -keyable false -channelBox true($con+".gensui_rx_up");
     setAttr -keyable false -channelBox true($con+".gensui_ry_up");
     setAttr -keyable false -channelBox true($con+".gensui_rz_up");
     setAttr -keyable false -channelBox true($con+".gensui_rx_dw");
     setAttr -keyable false -channelBox true($con+".gensui_ry_dw");
     setAttr -keyable false -channelBox true($con+".gensui_rz_dw");
     
     
     setAttr -keyable false -channelBox true($con+".beishu");
     string$chengchu_A=$con+"_multiplyDivide_A";
     string$chengchu_B=$con+"_multiplyDivide_B";
     
      string$chengchu_C=$con+"_multiplyDivide_C";
     
     string$chengchu_D=$con+"_multiplyDivide_D";
      string$chengchu_E=$con+"_multiplyDivide_E";
     string$chengchu_F=$con+"_multiplyDivide_F";
     int $ex=`objExists $chengchu_A`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_A;}
     shadingNode -asUtility multiplyDivide -n $chengchu_A;//创建乘除节点
     
     int $ex=`objExists $chengchu_B`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_B;}
     shadingNode -asUtility multiplyDivide -n $chengchu_B;//创建乘除节点
     
      int $ex=`objExists $chengchu_C`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_C;}
     shadingNode -asUtility multiplyDivide -n $chengchu_C;//创建乘除节点
     
     int $ex=`objExists $chengchu_D`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_D;}
     shadingNode -asUtility multiplyDivide -n $chengchu_D;//创建乘除节点
     
     
     int $ex=`objExists $chengchu_E`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_E;}
     shadingNode -asUtility multiplyDivide -n $chengchu_E;//创建乘除节点
     
     int $ex=`objExists $chengchu_F`;//查询这个物体是否纯在
     if($ex==1){delete $chengchu_F;}
     shadingNode -asUtility multiplyDivide -n $chengchu_F;//创建乘除节点
     
     
    connectAttr -f   ($con+".biyan") ($chengchu_A+".input1X");
    connectAttr -f   ($con+".beishu") ($chengchu_A+".input2X");
    connectAttr -f ($chengchu_A+".outputX") ($jiajian_s[$b]+".input3D[2].input3Dz");
    setAttr ($chengchu_B+".input2X") -1;
    connectAttr -f   ($con+".biyan") ($chengchu_B+".input1X");
    connectAttr -f ($chengchu_B+".outputX") ($jiajian_s[$a]+".input3D[2].input3Dz");
    
    
    connectAttr -f($con+".shang")  ($chengchu_C+".input1X");
    connectAttr -f($con+".xia")  ($chengchu_D+".input1X");
    setAttr  ($chengchu_D+".input2X") -1;

    connectAttr -f ($chengchu_C+".outputX") ($jiajian_s[$b]+".input3D[3].input3Dz");
    connectAttr -f ($chengchu_D+".outputX") ($jiajian_s[$a]+".input3D[3].input3Dz");

    connectAttr -f ($con+".shangxia")  ($jiajian_s[$b]+".input3D[4].input3Dz");
    connectAttr -f ($con+".shangxia")  ($jiajian_s[$a]+".input3D[4].input3Dz");
    
    connectAttr -f ($con+".gensui_rx_up")  ($chengchu_E+".input1X");
    connectAttr -f ($con+".gensui_ry_up")  ($chengchu_E+".input1Y");
    connectAttr -f ($con+".gensui_rz_up")  ($chengchu_E+".input1Z");
    
    connectAttr -f ($fk_c[$a]+".r")     ($chengchu_E+".input2");
    connectAttr -f ($chengchu_E+".output") ($Fk_[$a]+".r")   ; 
    
    
     connectAttr -f ($con+".gensui_rx_dw")  ($chengchu_F+".input1X");
    connectAttr -f ($con+".gensui_ry_dw")  ($chengchu_F+".input1Y");
    connectAttr -f ($con+".gensui_rz_dw")  ($chengchu_F+".input1Z");
    
    connectAttr -f ($fk_c[$b]+".r")     ($chengchu_F+".input2");
    connectAttr -f ($chengchu_F+".output") ($Fk_[$b]+".r")   ; 
     // parent $yanpi_UP_bn  $root_bn;
     // parent $yanpi_DW_bn  $root_bn;
 }
 
 setAttr -type "string" ($toubukongzhiqi+".eye_lip_ik") $ik_eye_ikHandle;
zxb_eye_lip_con_controller;
} 

/////////////////////眼皮权重计算/////////////////////////////
global proc zxb_eye_lip_quanzhong_jisuan()
{

string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;

string$all_bs_ss=`getAttr ($UI_head_controller+".base_bs_mode")`;//混合变形模型
string$all_bs_s_mode[]=stringToStringArray($all_bs_ss, " ");//拷贝权重模型
string$quanzong_mode=$all_bs_s_mode[6];//拷贝权重模型

string$all_bn_ss=`getAttr ($UI_head_controller+".eye_bn_R")`;//眼皮所有次级骨骼
string$all_bn_s_R[]=stringToStringArray($all_bn_ss, " ");//眼皮所有次级骨骼
string$all_bn_sL=`getAttr ($UI_head_controller+".eye_bn_L")`;//眼皮所有次级骨骼
string$all_bn_s_L[]=stringToStringArray($all_bn_sL, " ");//眼皮所有次级骨骼
string $UI_eye_inside_wire=`textFieldGrp -q -tx UI_eye_inside_wire `;
string $UI_eye_inside_wires[]=stringToStringArray( $UI_eye_inside_wire, " ");
string $UI_annular_side=`textFieldGrp -q -tx UI_annular_side `;
string $UI_annular_side_s[]=stringToStringArray( $UI_annular_side, " ");

string $UI_all_face=`textFieldGrp -q -tx UI_all_face `;
string $UI_all_face_s[]=stringToStringArray($UI_all_face, " ");//面部所有面

select -r $UI_eye_inside_wires;
ConvertSelectionToVertices;
string$UI_eye_inside_wires_s[]=`ls -sl -fl`;
select -cl  ;
string $UI_head_mode=`textFieldGrp -q -tx  UI_head_mode`;
string $UI_eye_inside_wire=`textFieldGrp -q -tx UI_eye_middle_wire `;
string$UI_eye_inside_wire_ss[]=stringToStringArray($UI_eye_inside_wire, " ");

//////////查询最靠左边的曲线/////////////////////////
string$eye_lip_mode="eye_fenli_mode1";
select -r  $UI_eye_inside_wire_ss;
string$string_ext_s[]=`ls -sl -fl`;
float$mag_temp=-10000000000000000;
string$qvdiao_ext="";
for ($i=0;$i<size($string_ext_s);$i++)
    {
    string$ext_temp=$string_ext_s[$i];
    float $temp_pos[]=`xform -q -ws -t $ext_temp`;//////查询位置
    if($temp_pos[0]>$mag_temp)
      {
      $mag_temp=$temp_pos[0];
      $qvdiao_ext=$ext_temp;
      }
    
    }
    
/////////创建曲线 并且按照顺序保存关节名称   如果曲线存在则不创建  ////////////
string$qvxian_eye_lip="eye_lip_qvxian";
select -r  $UI_eye_inside_wire_ss;
select -d  $qvdiao_ext;
int$ex=`objExists $qvxian_eye_lip`; ///判断
if($ex==0)
  {
  string$qvxian_ss[]=`polyToCurve -form 2 -degree 1 -conformToSmoothMeshPreview 1`;
  rename $qvxian_ss[0] $qvxian_eye_lip;
  select -r  $qvxian_eye_lip;
  DeleteHistory;
  }
select -r ($qvxian_eye_lip+".cv[0:99999999999]") ;
string $all_cv_s[]=`ls -sl -fl`;
float$mag_A_temp=-10000000000000000;
int$size_temp_a=size($all_cv_s);
int$size_temp_b=size($all_bn_s_R);
if($size_temp_a!=$size_temp_b){error "骨骼跟CV点不一致";}
string$all_bn_s="";
for ($i=0;$i<size($all_cv_s);$i++)
    {
    string$temp_cv=$all_cv_s[$i];
    float $temp_pos_a[]=`xform -q -ws -t $temp_cv`;//////查询位置
    float$temp_mag=1000000000000000;
    string$all_bn_s_temp="";
    for ($ii=0;$ii<size($all_bn_s_R);$ii++)
         {
         string$temp_bn=$all_bn_s_R[$ii];
         float $temp_pos_b[]=`xform -q -ws -t $temp_bn`;//////查询位置
         float $weizhi=mag(<<$temp_pos_a[0],$temp_pos_a[1],$temp_pos_a[2]>>-<<$temp_pos_b[0] ,$temp_pos_b[1] ,$temp_pos_b[2]>>);////////计算距离
         if($weizhi<$temp_mag)
           {
           	$temp_mag=$weizhi;
           	$all_bn_s_temp=$temp_bn;
           	
           	}
         
         }
    $all_bn_s+=$all_bn_s_temp+" ";
    
    }
string$all_bn_s_ss[]=stringToStringArray($all_bn_s, " ");//所有关节/////按顺序保存////////////////////////////
int$ex_Face=0;//判断是否P给眼睛组
string$mode_eye_temp=$UI_head_mode+"eye_mode_temp_ciji";
string$mode_eye_temp_grp=$UI_head_mode+$mode_eye_temp+"_grp";
string$mode_eye_temp_joint=$UI_head_mode+"eye_mode_temp_ciji_joint";
string$mode_eye_temp_joint_root=$UI_head_mode+"eye_mode_temp_ciji_joint_root";
string$mode_eye_temp_circle=$UI_head_mode+"eye_mode_temp_ciji_circle";
string$mode_eye_temp_circle_grp=$UI_head_mode+"eye_mode_temp_ciji_circle_grp";
string $bn_fu_temp[]=`listRelatives -p $all_bn_s_R[0]`;
string$bn_root_eye= $bn_fu_temp[0];


//////////////创建整体权重模型  如果模型存在 则不创建///////////////////////////////////
int$ex=`objExists $mode_eye_temp`; ///判断
if($ex==0)
 {
 select -r  $UI_head_mode;
 duplicate -rr -n $mode_eye_temp ;
 setAttr ($mode_eye_temp+".visibility") 0;
setAttr -lock true ($mode_eye_temp+".v");

 zxb_ADD_kongzu_proc($mode_eye_temp_grp);
 parent  $mode_eye_temp $mode_eye_temp_grp ; 
 select -cl -sym  ;
 joint -p 0 0 0   -n $mode_eye_temp_joint ;
 select -cl -sym  ;
 joint -p 0 0 0   -n $mode_eye_temp_joint_root ;
 delete `parentConstraint $bn_root_eye  $mode_eye_temp_joint`;
 delete `  pointConstraint -offset 0 0 0 -skip x -skip z -weight 1 $bn_root_eye  $mode_eye_temp_joint_root`;
 circle -c 0 0 0 -nr 0 1 0 -sw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $mode_eye_temp_circle;
 delete   `parentConstraint $bn_root_eye  $mode_eye_temp_circle`;
 zxb_ADD_kongzu_proc($mode_eye_temp_circle_grp);
 delete   `parentConstraint $bn_root_eye  $mode_eye_temp_circle_grp`;
 parent $mode_eye_temp_joint  $mode_eye_temp_circle;
 parent  $mode_eye_temp_circle $mode_eye_temp_circle_grp;
 parent $mode_eye_temp_joint_root    $mode_eye_temp_circle_grp;
 
  
setAttr ($mode_eye_temp_circle+".visibility") 0;
setAttr -lock true ($mode_eye_temp_circle+".v");

setAttr ($mode_eye_temp_joint+".visibility") 0;
setAttr -lock true ($mode_eye_temp_joint+".v");

setAttr ($mode_eye_temp_joint_root+".visibility") 0;
setAttr -lock true ($mode_eye_temp_joint_root+".v");
 if($ex_Face==0)
   {
    parent  $mode_eye_temp_circle_grp  "Eye_all_grp";
    parent $mode_eye_temp_grp "Eye_all_grp";
    select -cl -sym  ;
   }else
       {
       zxb_ADD_kongzu_proc("Face_Group");
       parent  $mode_eye_temp_circle_grp  "Face_Group";
       parent $mode_eye_temp_grp "Face_Group";
       select -cl -sym  ;
       }
 
 select -r  $mode_eye_temp_joint;
 select -add $mode_eye_temp_joint_root;
 select -add $mode_eye_temp ;
 newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui 0";  
 select -cl -sym  ;
 select -r -sym eye_fenli_mode.vtx[0:9999999999999999] ;
 string$eye_lip_all_ext[]=`ls -sl -fl`;
 zxb_vex_xuan($mode_eye_temp,$eye_lip_all_ext);
 string$eye_lip_all_ext_a[]=`ls -sl -fl`;
 select -cl -sym  ;
 select -r $mode_eye_temp;
 ArtPaintSkinWeightsToolOptions; 
 setSmoothSkinInfluence $mode_eye_temp_joint_root;
 artAttrPaintOperation artAttrSkinPaintCtx Replace;
 artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
 artAttrSkinPaintCtx -e -clear `currentCtx`;
 select -cl -sym  ; 
 select -r $eye_lip_all_ext_a;
 ArtPaintSkinWeightsToolOptions; 
 setSmoothSkinInfluence $mode_eye_temp_joint;
 artAttrPaintOperation artAttrSkinPaintCtx Replace;
 artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
 artAttrSkinPaintCtx -e -clear `currentCtx`;
 artAttrPaintOperation artAttrSkinPaintCtx Smooth;
 for($iii=0;$iii<10;$iii++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }

  }
  
select -cl  ;
setAttr ($mode_eye_temp_joint_root+".liw") 1;
setAttr ($mode_eye_temp_joint_root+".liw") 1;
select -cl  ;
  
/////////////////创建临时拷贝权重的简模   如果存在就拷贝权重/////////////////////
string$cop_mode_name="EYE_ALL_fase_temp";
int$ex=`objExists $cop_mode_name`; ///判断
string$cop_mode_name_temp=$cop_mode_name+"_temp";

if($ex==0)
  {
   select -r   "EYE_ALL_fase";
   duplicate -rr -n $cop_mode_name; 
   string $cop_mode_name_shepe[]=`listRelatives -s $cop_mode_name`; 
   zxb_vex_xuan($cop_mode_name,$UI_eye_inside_wires_s);
   ConvertSelectionToContainedEdges;
   DetachComponent;
   string$mode_fen_name[]=`polySeparate -ch 0 $cop_mode_name_shepe[0]`;
   select -r ($mode_fen_name[0]+".vtx[0:99999999999999999999999]") ;
   string$all_mode_ext_a[]=`ls -sl -fl`;
   select -r ($mode_fen_name[1]+".vtx[0:99999999999999999999999]") ;
   string$all_mode_ext_b[]=`ls -sl -fl`;
   int$temp_int_a=size($all_mode_ext_a);
   int$temp_int_b=size($all_mode_ext_b);
   if($temp_int_a>$temp_int_b)
     {
     rename $mode_fen_name[0] $cop_mode_name_temp;
     parent $cop_mode_name_temp $mode_eye_temp_grp;
     delete  $cop_mode_name;
     }else
         {
          rename $mode_fen_name[1] $cop_mode_name_temp;
          parent $cop_mode_name_temp $mode_eye_temp_grp;
          delete  $cop_mode_name;
         }
         
   rename  $cop_mode_name_temp  $cop_mode_name;
   setAttr ($cop_mode_name+".visibility") 0;
   string $skinCluster_A=`findRelatedSkinCluster $mode_eye_temp` ;//访问蒙皮节点
   string $All_bn[]=`skinCluster -q  -inf  $skinCluster_A`;//查询蒙皮的所有关节
   select -r  $All_bn;
   select -add  $cop_mode_name;
   newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui true";  
   select -r  $mode_eye_temp;
   select -add  $cop_mode_name;
   copySkinWeights  -noMirror -surfaceAssociation closestPoint -influenceAssociation closestJoint;
   select -r $all_bn_s_R $all_bn_s_L;
   select -add $cop_mode_name;
   skinClusterInfluence 1 "-ug -dr 4 -ps 0 -ns 10 -lw true -wt 0";
   setAttr ($mode_eye_temp_joint_root+".liw") 1;
   setAttr ($mode_eye_temp_joint_root+".liw") 1;
  }else
      {
        select -r  $mode_eye_temp;
        select -add  $cop_mode_name;
        copySkinWeights  -noMirror -surfaceAssociation closestPoint -influenceAssociation closestJoint;
        select -r $all_bn_s_R $all_bn_s_L;
        select -add $cop_mode_name;
        skinClusterInfluence 1 "-ug -dr 4 -ps 0 -ns 10 -lw true -wt 0";
        setAttr ($mode_eye_temp_joint_root+".liw") 1;
        setAttr ($mode_eye_temp_joint_root+".liw") 1;
      }

select -r ($cop_mode_name+".e[0:99999999999999999999999]") ;
string$cop_mode_e_s[]=`ls -sl -fl`;
string $mode_sape[]=`listRelatives -s $cop_mode_name`; 
select -r $UI_annular_side_s ;
string$all_xian="";
global string $gSelect;
global string $gMainProgressBar;
setToolTo $gSelect;
progressBar -e -st ("查找环线...") -bp -ii 1 -min 0 -max `size($UI_annular_side_s)` $gMainProgressBar;

for($j=0;$j<size($UI_annular_side_s);$j++)
   {
   	if(`progressBar -q -ic $gMainProgressBar`)
   break;
   progressBar -e -s 1 $gMainProgressBar;
   string$temp_dian=$UI_annular_side_s[$j];
   select -r$temp_dian;
   ConvertSelectionToVertices;
   string$temp_xian_dian_s[]=`ls -sl -fl`;
   zxb_vex_xuan($cop_mode_name,$temp_xian_dian_s);
   ConvertSelectionToContainedEdges;
   SelectEdgeLoopSp;
   zxb_zuiba_jisuanquanzhong_A_shuzu($all_bn_s_ss,$mode_eye_temp_joint,$qvxian_eye_lip);//所有次级骨骼   被抢的权重骨骼    曲线
  
 }
progressBar -e -ep $gMainProgressBar;
delete $qvxian_eye_lip;
select -r $cop_mode_name;
zxb_zuiba_jisuanquanzhong_pinghua_a_shuzu($all_bn_s_ss,$mode_eye_temp_joint,$mode_eye_temp_joint_root);
string$SkinCluster=`findRelatedSkinCluster $quanzong_mode`;
int$ex_SkinCluster=`objExists $SkinCluster`; ///判断
if($ex_SkinCluster==0)
  {
  string$SkinCluster_b=`findRelatedSkinCluster $cop_mode_name`;
  string $All_bn_temp_chauxn[]=`skinCluster -q  -inf  $SkinCluster_b`;//查询蒙皮的所有关节
  select -r $All_bn_temp_chauxn;
  select -add  $quanzong_mode;
  newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui 0";  
  select -r  $cop_mode_name;
  select -add  $quanzong_mode;
  CopySkinWeights;
  }else
      {
      select -r  $cop_mode_name;
      select -add  $quanzong_mode;
      CopySkinWeights;
      }
}

////////////////////创建眼皮模型/////////////////////////////////////////
//////////////////////生成眼模型/////////////////////
global proc zxb_changcheng_eye_mode_proc()
{
string $UI_all_face=`textFieldGrp -q -tx UI_all_face `;
string $UI_all_face_s[]=stringToStringArray($UI_all_face, " ");//面部所有面
string $UI_head_mode=`textFieldGrp -q -tx UI_head_mode`;//外环线	
//找到眼睛3条环线
string $UI_eye_outer_wiress=`textFieldGrp -q -tx UI_eye_outer_wire`;//外环线
string $UI_eye_outer_wires_temp[]= stringToStringArray($UI_eye_outer_wiress, " ");
string $UI_eye_middle_wiress=`textFieldGrp -q -tx UI_eye_middle_wire`;//中间环线
string $UI_eye_middle_wires_temp[]= stringToStringArray($UI_eye_middle_wiress, " ");
string $UI_eye_inside_wiress=`textFieldGrp -q -tx UI_eye_inside_wire`;//内环线
string $UI_eye_inside_wires_temp[]=stringToStringArray($UI_eye_inside_wiress, " ");
string $UI_head_mode=`textFieldGrp -q -tx UI_head_mode `;//头部关节
string$eye_mode_grp="EYE_mode_grp";
zxb_ADD_kongzu_proc($eye_mode_grp);
parent $eye_mode_grp "Face_Group";
string$temp_eye_fenli_mode="temp_eye_fenli_mode";
select -r $UI_head_mode ;
duplicate -rr -n $temp_eye_fenli_mode;
parent $temp_eye_fenli_mode  $eye_mode_grp;
//找到复制出来的模型环线
string$eye_outer_wiress=zxb_mode_huanxian($UI_eye_outer_wires_temp,$temp_eye_fenli_mode);
string $eye_outer_wires[]= stringToStringArray($eye_outer_wiress, " ");
string$eye_middle_wires_tempss=zxb_mode_huanxian($UI_eye_middle_wires_temp,$temp_eye_fenli_mode);
string$eye_middle_wires_temps[]= stringToStringArray($eye_middle_wires_tempss, " ");
string $eye_inside_wires_tempss=zxb_mode_huanxian( $UI_eye_inside_wires_temp,$temp_eye_fenli_mode);
string $eye_inside_wires_temps[]= stringToStringArray($eye_inside_wires_tempss, " ");
string $temp_eye_fenli_mode_shapes[]=`listRelatives -s $temp_eye_fenli_mode`; 

/////////提取眼眶模型//////
select -r $eye_outer_wires  $eye_inside_wires_temps;
DetachComponent;
select -r $eye_middle_wires_temps;
ConvertSelectionToShell;
ConvertSelectionToFaces;
doMenuComponentSelectionExt($temp_eye_fenli_mode, "facet", 0);
string $temp_eye_fenli_mode_shapes[]=`listRelatives -s $temp_eye_fenli_mode`; 
string$modes_temp_fenli[]= `polySeparate -rs 1 -ch 0 $temp_eye_fenli_mode_shapes[0]`;
string$mode_fenli="eye_fenli_mode";
select -r ($modes_temp_fenli[0]+".vtx[0:999999999999999]") ;
string$temp_sl_a[]=`ls -sl -fl`;
select -r ($modes_temp_fenli[1]+".vtx[0:99999999999999999]") ;
string$temp_sl_b[]=`ls -sl -fl`;
int$temp_siaze_a=size($temp_sl_a);
int$temp_siaze_b=size($temp_sl_b);
if($temp_siaze_a<$temp_siaze_b)
  {
  	
  rename $modes_temp_fenli[0] $mode_fenli; 
  parent  $mode_fenli $eye_mode_grp;  
  delete  $temp_eye_fenli_mode;
  setAttr ($mode_fenli+".visibility") 0;
   }else
       {
       	rename $modes_temp_fenli[1] $mode_fenli;
       	parent  $mode_fenli$eye_mode_grp;
        delete  $temp_eye_fenli_mode;
       setAttr ($mode_fenli+".visibility") 0;
       }


////找到区分上下的线段
string$mode_fenli_temp=$mode_fenli+"_temp";
select -r $mode_fenli;
duplicate -rr -n $mode_fenli_temp;
string $UI_eye_boundary_Rss=`textFieldGrp -q -tx UI_eye_boundary_R`;//外环线
string $UI_eye_boundary_Rss_temp[]= stringToStringArray( $UI_eye_boundary_Rss, " ");
string $UI_eye_boundary_Lss=`textFieldGrp -q -tx UI_eye_boundary_L`;//中间环线
string $UI_eye_middle_wires_temp[]= stringToStringArray($UI_eye_boundary_Lss, " ");
select -r $UI_eye_boundary_Rss_temp;
ConvertSelectionToVertices;
string$temp_R_eye_boundary[]=`ls -sl -fl`;
zxb_vex_xuan($mode_fenli_temp,$temp_R_eye_boundary);
ConvertSelectionToContainedEdges;
string$temp_R_eye_boundary_Edges[]=`ls -sl -fl`;
select -r $UI_eye_middle_wires_temp;
ConvertSelectionToVertices;
string$temp_l_eye_boundary[]=`ls -sl -fl`;
zxb_vex_xuan($mode_fenli_temp,$temp_l_eye_boundary);
ConvertSelectionToContainedEdges;
string$temp_l_eye_boundary_Edges[]=`ls -sl -fl`;
string $mode_fenli_temp_shapes[]=`listRelatives -s $mode_fenli_temp`; 
select -r $temp_R_eye_boundary_Edges  $temp_l_eye_boundary_Edges;
doMenuComponentSelectionExt($mode_fenli_temp, "edge", 1);
select -cl  ;
select -r $temp_R_eye_boundary_Edges  $temp_l_eye_boundary_Edges;
DetachComponent;
select -r $mode_fenli_temp;
string$mode_fenli_temp_polySep[]= ` polySeparate -ch 0 $mode_fenli_temp_shapes[0]`;
string$mian_up="eye_up_fengli_mode";
string$mian_dw="eye_dw_fengli_mode";
select -r ($mode_fenli_temp_polySep[0]+".vtx[0:999999999999999]") ;
string$temp_Cluster_A="temp_Cluster_A";
string$Cluster[]=`newCluster " -envelope 1"`;
rename $Cluster[1] $temp_Cluster_A;
spaceLocator -p 0 0 0 -n "temp_loc";
delete`parentConstraint  $temp_Cluster_A "temp_loc"`;
float $trs_a[]=`xform -q -ws -t "temp_loc"`;//查询世界坐标的变量位移
delete "temp_loc"  $temp_Cluster_A;
select -r ($mode_fenli_temp_polySep[1]+".vtx[0:999999999999999]") ;
string$temp_Cluster_B="temp_Cluster_B";
string$Cluster[]=`newCluster " -envelope 1"`;
rename $Cluster[1] $temp_Cluster_B;
spaceLocator -p 0 0 0 -n "temp_loc";
delete`parentConstraint  $temp_Cluster_B "temp_loc"`;
float $trs_b[]=`xform -q -ws -t "temp_loc"`;//查询世界坐标的变量位移
delete  "temp_loc" $temp_Cluster_B;
if($trs_a[1]>$trs_b[1]){rename $mode_fenli_temp_polySep[0]  $mian_up ; rename $mode_fenli_temp_polySep[1]  $mian_dw;}else{rename $mode_fenli_temp_polySep[0]  $mian_dw ; rename $mode_fenli_temp_polySep[1] $mian_up ;}
parent  $mian_up $eye_mode_grp;
parent  $mian_dw $eye_mode_grp;
setAttr ($mian_up+".visibility") 0;
setAttr ($mian_dw+".visibility") 0;
delete  $mode_fenli_temp;




string$cop_mode_name="EYE_ALL_fase";
string$cop_mode_name_temp=$cop_mode_name+"_temp";

select -r  $UI_head_mode;
duplicate -rr -n $cop_mode_name; 
string $cop_mode_name_shepe[]=`listRelatives -s $cop_mode_name`; 
select -r 	$UI_all_face_s;
ConvertSelectionToVertices;
string$all_head_ext[]=`ls -sl -fl`;
zxb_vex_xuan($cop_mode_name,$all_head_ext);
ConvertSelectionToContainedFaces;
ExtractFace;
string$mode_fen_name[]=`polySeparate -ch 0 $cop_mode_name_shepe[0]`;
int$size_temp=size($mode_fen_name);
if($size_temp>=3){ error"请重新选择面部表情面 模型分离后不能大于3个物体";}
select -r ($mode_fen_name[0]+".vtx[0:99999999999999]") ;
string$all_head_ext_temp_a[]=`ls -sl -fl`;
select -r ($mode_fen_name[1]+".vtx[0:99999999999999]") ;
string$all_head_ext_temp_b[]=`ls -sl -fl`;
int$ex_a=size($all_head_ext_temp_a);
int$ex_b=size($all_head_ext_temp_b);
select -cl -sym  ;
if($ex_a>$ex_b)
   {
    delete $mode_fen_name[0]; 
    parent $mode_fen_name[1]$eye_mode_grp;
    delete  $cop_mode_name ; 
    rename  $mode_fen_name[1] $cop_mode_name;
   }else
      {
         delete $mode_fen_name[1]; 
      	 parent $mode_fen_name[0] $eye_mode_grp;
        delete  $cop_mode_name ; 
        rename  $mode_fen_name[0] $cop_mode_name;
        }
setAttr ($cop_mode_name+".visibility") 0;
}
global proc zxb_eye_con_bn_proc()
{
	
	zxb_chuangjianyanjingguyanjie_fangfa_proc;
	zxb_chuangjianyanpiguanjie_fangfa_proc;
	 zxb_eye_quanzong_proc;
	 button -e -en 0 hedemianbankuan_button;
}


///////////////眼皮权重计算//////////////////////////////////
global proc zxb_eye_quanzong_proc()
{
//setAttr "eye_lip_lay.visibility" 1;
select -cl  ;
string$mode="eye_lip_lay";
string$beifen_eye_mode=$mode+"_temp_mode";
string$Eye_R_root_bn="Eye_R_root_bn";

string$Eye_R_DW_yanpi="Eye_R_DW_yanpi";
string$Eye_R_UP_yanpi="Eye_R_UP_yanpi";

string$Eye_L_DW_yanpi="Eye_L_DW_yanpi";
string$Eye_L_UP_yanpi="Eye_L_UP_yanpi";

spaceLocator -p 0 0 0 -n "temp" ;
delete `pointConstraint $Eye_R_DW_yanpi "temp" `;
float$diana_pos_A[]=`xform -q -ws -t"temp" `;
delete `pointConstraint $Eye_R_UP_yanpi "temp" `;
float$diana_pos_B[]=`xform -q -ws -t "temp"`;
delete  "temp";
if($diana_pos_A[1]>$diana_pos_B[1]){$Eye_R_UP_yanpi="Eye_R_DW_yanpi"; $Eye_R_DW_yanpi="Eye_R_UP_yanpi";}else{$Eye_R_DW_yanpi="Eye_R_DW_yanpi";$Eye_R_UP_yanpi="Eye_R_UP_yanpi";}
 //select -r  $Eye_R_UP_yanpi;
 string $skinCluster2=`findRelatedSkinCluster $mode` ;//访问蒙皮节点
 if($skinCluster2=="")
   {
   
   select -r $Eye_R_root_bn  $Eye_R_DW_yanpi $Eye_R_UP_yanpi $Eye_L_DW_yanpi $Eye_L_UP_yanpi;
  select -add $mode ;
   newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui 0"; 
   select -r  $mode;
   duplicate -rr -n $beifen_eye_mode;
   
   select -r $Eye_R_root_bn ;
  select -add $beifen_eye_mode ;
   newSkinCluster "-toSelectedBones -mi 6 -omi true -dr 6 -rui 0"; 
   parent  $beifen_eye_mode "Eye_all_grp";
   
   setAttr  ($beifen_eye_mode+".visibility") 0;
   setAttr -lock true ($beifen_eye_mode+".v");
   
   
   
   }

select -r  $mode;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artSkinInvLockInf artAttrSkinPaintCtx 1 ;
select -cl  ;



select -r "eye_fenli_mode.vtx[0:9999999999999999999]";
string$eye_temp_mode_exts[]=`ls -sl -fl`;
zxb_vex_xuan($mode,$eye_temp_mode_exts);
string$eye_zhengti_exts[]=`ls -sl -fl`;

select -r $eye_zhengti_exts;
string$Cluster_s[]=`newCluster " -envelope 1"`;
joint -p 0 0 0  -n "temp_joint" ;
circle -c 0 0 0 -nr 0 1 0 -sw 360 -r 1 -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n "temp_joint_con";
group -n "temp_joint_con_grp";
parent "temp_joint" "temp_joint_con";

setAttr "temp_joint_con.visibility" 0;
setAttr -lock true "temp_joint_con.v";

delete `parentConstraint $Cluster_s[1] "temp_joint_con_grp"`;


parent "temp_joint_con_grp" "Eye_all_grp";
select -r  "temp_joint";
select -add   $mode;
skinClusterInfluence 1 "-ug -dr 4 -ps 0 -ns 10 -lw true -wt 0";
delete $Cluster_s[1];






select -r $eye_zhengti_exts;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence temp_joint;
setAttr "temp_joint.liw" 0;
setAttr "temp_joint.liw" 0;
select -cl  ;
select -r $eye_zhengti_exts;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence "temp_joint";
setSmoothSkinInfluence "temp_joint";

artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<10;$i++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }
select -cl  ;
select -r $mode;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artSkinInflListChanged artAttrSkinPaintCtx;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<1;$i++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }
    
   
select -r  "temp_joint";
select -add  $beifen_eye_mode;
skinClusterInfluence 1 "-ug -dr 4 -ps 0 -ns 10 -lw true -wt 0";

select -r  $mode;
select -add  $beifen_eye_mode;
CopySkinWeights;

select -r  $mode;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artSkinInvLockInf artAttrSkinPaintCtx 0;
artAttrPaintOperation artAttrSkinPaintCtx Replace;
artSkinSetSelectionValue 1 false artAttrSkinPaintCtx artAttrSkin;
artAttrSkinPaintCtx -e -clear `currentCtx`;
select -cl  ;
 


string $UI_eye_middle_wire=`textFieldGrp -q  -text UI_eye_middle_wire`;
string $UI_eye_middle_wire_ss[]= stringToStringArray($UI_eye_middle_wire, " ");//眼眶线
string$qvxian_namess=zxb_extract_Curves_proc(1,"eye","normal",$UI_eye_middle_wire);
string$qvxian_names[]=stringToStringArray($qvxian_namess, " ");//眼眶线
string$eye_qvxian="eye_Curves_up_dw_grp";
zxb_ADD_kongzu_proc($eye_qvxian);
parent  $eye_qvxian "Eye_all_grp";
parent  $qvxian_names[0] $eye_qvxian;
parent  $qvxian_names[1] $eye_qvxian;
string$up_ext_s[];
string$dw_ext_s[];
for ($i=0;$i<size($qvxian_names);$i++)
    {
    string$temp_xian=$qvxian_names[$i];
    string$mode_temp="cop_mode_temp"+$i;
    select -r ($temp_xian+".cv[0:9999999999999]") ;
    string$temo_dw_up_bvtx_s[]=`ls -sl -fl`;
    zxb_vex_xuan($mode,$temo_dw_up_bvtx_s);
    string$temo_dw_up_vtx_ss[]=`ls -sl -fl`;
    if($i==0){$up_ext_s=$temo_dw_up_vtx_ss;}
    if($i==1){$dw_ext_s=$temo_dw_up_vtx_ss;}
    string$nearestPointOnCurve_qvxian="nearestPointOnCurve_qvxian_"+$i;
    for ($ii=0;$ii<size($temo_dw_up_vtx_ss);$ii++)
         {
        string$ext=$temo_dw_up_vtx_ss[$ii];
        string$qvxian_temp="";
        string$bn_temp="";
        string$ik_con="zxb_Eye_R_eye_kongzhiqi_A";
        if($i==0){$qvxian_temp=$qvxian_names[1];$bn_temp=$Eye_R_UP_yanpi;$ik_con=$ik_con+".xia"; }
        if($i==1){$qvxian_temp=$qvxian_names[0];$bn_temp=$Eye_R_DW_yanpi;$ik_con=$ik_con+".shang"; }
        
        float$temp_pos_A[]=`xform -q -ws -t $ext`;  
        zxb_ADD_createNode_proc($nearestPointOnCurve_qvxian,"nearestPointOnCurve");
        string $qvxian_shape_s[]=`listRelatives -s $qvxian_temp`; 
        connectAttr -force ($qvxian_shape_s[0]+".worldSpace[0]") ($nearestPointOnCurve_qvxian+".inputCurve");
        string$loc_temp="pos_loc";
        spaceLocator -p 0 0 0 -n $loc_temp;
        connectAttr -f  ($nearestPointOnCurve_qvxian+".position") ($loc_temp+".translate");
        setAttr  -type float3  ($nearestPointOnCurve_qvxian+".inPosition")  $temp_pos_A[0] $temp_pos_A[1] $temp_pos_A[2];
        float$temp_pos_B[]=`xform -q -ws -t $loc_temp`;
        float $dis=mag(<<$temp_pos_A[0],$temp_pos_A[1],$temp_pos_A[2]>>-<<$temp_pos_B[0],$temp_pos_B[1],$temp_pos_B[2]>>);
        string$SkinCluster_temp=findRelatedSkinCluster($mode);//访问蒙皮节点
        skinPercent -tv $bn_temp $dis $SkinCluster_temp $ext;
        delete $loc_temp;

      }
      
  
   }
  
    
    


for ($i=0;$i<size($qvxian_names);$i++)
    {
    string$temp_xian=$qvxian_names[$i];
    string$mode_temp="cop_mode_temp"+$i;
    select -r ($temp_xian+".cv[0:9999999999999]") ;
    string$temo_dw_up_bvtx_s[]=`ls -sl -fl`;
    zxb_vex_xuan($mode,$temo_dw_up_bvtx_s);
    string$temo_dw_up_vtx_ss[]=`ls -sl -fl`;
    if($i==0){$up_ext_s=$temo_dw_up_vtx_ss;}
    if($i==1){$dw_ext_s=$temo_dw_up_vtx_ss;}
    string$nearestPointOnCurve_qvxian="nearestPointOnCurve_qvxian_"+$i;
    for ($ii=0;$ii<size($temo_dw_up_vtx_ss);$ii++)
        {
        
         string$ext=$temo_dw_up_vtx_ss[$ii];
       //  select -r eye_lip_lay.vtx[27538]
        string$qvxian_temp="";
        string$bn_temp="";
        string$ik_con="zxb_Eye_R_eye_kongzhiqi_A";
        if($i==0){$qvxian_temp=$qvxian_names[1];$bn_temp=$Eye_R_UP_yanpi;$ik_con=$ik_con+".xia"; setAttr $ik_con -45;}
        if($i==1){$qvxian_temp=$qvxian_names[0];$bn_temp=$Eye_R_DW_yanpi;$ik_con=$ik_con+".shang"; setAttr $ik_con -45;}
        
        float$temp_pos_A[]=`xform -q -ws -t $ext`;  
        zxb_ADD_createNode_proc($nearestPointOnCurve_qvxian,"nearestPointOnCurve");
        string $qvxian_shape_s[]=`listRelatives -s $qvxian_temp`; 
        connectAttr -force ($qvxian_shape_s[0]+".worldSpace[0]") ($nearestPointOnCurve_qvxian+".inputCurve");
        string$loc_temp="pos_loc";
        spaceLocator -p 0 0 0 -n $loc_temp;
        connectAttr -f  ($nearestPointOnCurve_qvxian+".position") ($loc_temp+".translate");
        setAttr  -type float3  ($nearestPointOnCurve_qvxian+".inPosition")  $temp_pos_A[0] $temp_pos_A[1] $temp_pos_A[2];
        float$temp_pos_B[]=`xform -q -ws -t $loc_temp`;
        float $dis=mag(<<$temp_pos_A[0],$temp_pos_A[1],$temp_pos_A[2]>>-<<$temp_pos_B[0],$temp_pos_B[1],$temp_pos_B[2]>>);
        string$SkinCluster_temp=findRelatedSkinCluster($mode);//访问蒙皮节点
        
         float$temp_pos_A[]=`xform -q -ws -t $ext`; 
        float$temp_pos_B[]=`xform -q -ws -t $loc_temp`;
        float $dis=mag(<<$temp_pos_A[0],$temp_pos_A[1],$temp_pos_A[2]>>-<<$temp_pos_B[0],$temp_pos_B[1],$temp_pos_B[2]>>);
        
        float$quznhzong=`skinPercent -t $bn_temp-q skinCluster145  $ext`;//查询权重
        float$jisuan_dis=0;
        global string $gSelect;
        global string $gMainProgressBar;
        setToolTo $gSelect;
        progressBar -e -st ("计算眼皮权重...") -bp -ii 1 -min 0 -max 100 $gMainProgressBar;//开始
         for ($iii=0;$iii<100;$iii++)
             {
              if(`progressBar -q -ic $gMainProgressBar`)   //循环内
              break;
              progressBar -e -s 1 $gMainProgressBar;  	
             float$trmop_jisuan_dis=$iii*0.01;
             skinPercent -tv $bn_temp $trmop_jisuan_dis $SkinCluster_temp $ext;
             float$temp_pos_AA[]=`xform -q -ws -t $ext`; 
             float$temp_pos_BB[]=`xform -q -ws -t $loc_temp`;
             float $dis_a=mag(<<$temp_pos_AA[0],$temp_pos_AA[1],$temp_pos_AA[2]>>-<<$temp_pos_BB[0],$temp_pos_BB[1],$temp_pos_BB[2]>>);
             if($dis_a<$dis){$jisuan_dis=$trmop_jisuan_dis;} 
              
             }
         progressBar -e -ep $gMainProgressBar;  //结束 
        skinPercent -tv $bn_temp $jisuan_dis$SkinCluster_temp $ext;
        setAttr  $ik_con 0;
        delete $loc_temp;
       }
     }

setAttr temp_joint.liw 1;
setAttr temp_joint.liw 1;
setAttr($Eye_L_DW_yanpi+".liw") 1;
setAttr($Eye_L_UP_yanpi+".liw") 1;

select -r $eye_zhengti_exts;
select -d $dw_ext_s;
select -d $up_ext_s;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<50;$i++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }


select -r "eye_up_fengli_mode.vtx[0:999999999999999999]";
string$all_temo_up_vtx_ss[]=`ls -sl -fl`;
zxb_vex_xuan($mode,$all_temo_up_vtx_ss);
string$all_temo_up_vtx_s[]=`ls -sl -fl`;
for ($i=0;$i<size($all_temo_up_vtx_s);$i++)
    {
      string$ext=$all_temo_up_vtx_s[$i];
      string$SkinCluster_temp=findRelatedSkinCluster($mode);//访问蒙皮节点
       float$quznhzong=`skinPercent -t $Eye_R_DW_yanpi -q $SkinCluster_temp  $ext`;//查询权重
       if($quznhzong>0){skinPercent -tv $Eye_R_DW_yanpi 0 $SkinCluster_temp $ext;}
      
    }

setAttr ($Eye_R_DW_yanpi+".liw") 1;
setAttr ($Eye_R_DW_yanpi+".liw") 1;

select -r "eye_dw_fengli_mode.vtx[0:999999999999999999]";
string$all_temo_dw_vtx_ss[]=`ls -sl -fl`;
zxb_vex_xuan($mode,$all_temo_dw_vtx_ss);
string$all_temo_dw_vtx_s[]=`ls -sl -fl`;

for ($i=0;$i<size($all_temo_dw_vtx_s);$i++)
    {
      string$ext=$all_temo_dw_vtx_s[$i];
      string$SkinCluster_temp=findRelatedSkinCluster($mode);//访问蒙皮节点
       float$quznhzong=`skinPercent -t $Eye_R_UP_yanpi -q $SkinCluster_temp  $ext`;//查询权重
       if($quznhzong>0){skinPercent -tv $Eye_R_UP_yanpi 0 $SkinCluster_temp $ext;}
      
    }

select -r$all_temo_dw_vtx_s;
select -d $dw_ext_s;
setAttr ($Eye_R_DW_yanpi+".liw") 0;
setAttr ($Eye_R_DW_yanpi+".liw") 0;
setAttr ($Eye_R_UP_yanpi+".liw") 1;
setAttr ($Eye_R_UP_yanpi+".liw") 1;

ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<50;$i++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }


setAttr ($Eye_R_DW_yanpi+".liw") 1;
setAttr ($Eye_R_DW_yanpi+".liw") 1;
setAttr ($Eye_R_UP_yanpi+".liw") 0;
setAttr ($Eye_R_UP_yanpi+".liw") 0;

select -r$all_temo_up_vtx_s;
select -d $up_ext_s;
ArtPaintSkinWeightsToolOptions;
setSmoothSkinInfluence $Eye_R_root_bn;
artAttrPaintOperation artAttrSkinPaintCtx Smooth;
for ($i=0;$i<50;$i++)
    {
    artAttrSkinPaintCtx -e -clear `currentCtx`;
    }

select -r  $mode;
doMirrorSkinWeightsArgList( 2, { " -mirrorMode YZ -mirrorInverse -surfaceAssociation closestPoint -influenceAssociation closestJoint" } );
select -cl  ;
delete $qvxian_names;
}

//////////////////闭眼闭合曲线自动设置//////////////////////////////////////


global proc zxb_eye_close_qvxian(string$qvxian_a,string$qvxian_b)
{
string$qvxian_UP=$qvxian_a;
string$qvxian_DW=$qvxian_b;
string$curve_temp="curve_name";
select -r ($qvxian_UP+".cv[0:99999999999999]") ;

string$all_cv_ss[]=`ls -sl -fl`;
select -r ($qvxian_DW+".cv[0:99999999999999]") ;
string$all_cv_ss_dw[]=`ls -sl -fl`;


int$size_temp=size($all_cv_ss)-1;
float $temp_pos_A[]=`xform -q -ws -t $all_cv_ss[$size_temp]`;
float $temp_pos_B[]=`xform -q -ws -t $all_cv_ss[0]`;

curve -d 1 -p $temp_pos_A[0] $temp_pos_A[1] $temp_pos_A[2] -p $temp_pos_B[0] $temp_pos_B[1] $temp_pos_B[2] -k 0 -k 1 -n $curve_temp;
string $shepe[]=`listRelatives -s $curve_temp`; 
string$nearestPointOnCurve_A="nearestPointOnCurve_A";
string$pointOnCurveInfo_A="pointOnCurveInfo_A";
zxb_ADD_jiedian_proc($nearestPointOnCurve_A,"nearestPointOnCurve");
zxb_ADD_jiedian_proc($pointOnCurveInfo_A,"pointOnCurveInfo");
connectAttr -force ($shepe[0]+".worldSpace[0]") ($nearestPointOnCurve_A+".inputCurve");
connectAttr -force ($nearestPointOnCurve_A+".parameter") ($pointOnCurveInfo_A+".parameter");
connectAttr -force ($shepe[0]+".worldSpace[0]") ($pointOnCurveInfo_A+".inputCurve");
int$size_TEMP=size($all_cv_ss)-1;
for($j=1;$j<$size_TEMP;$j++)
   {
   string$cv_temp=$all_cv_ss[$j];
   float $temp_pos_C[]=`xform -q -ws -t $cv_temp`;
   setAttr -type float3  ($nearestPointOnCurve_A+".inPosition")  $temp_pos_C[0]  $temp_pos_C[1]  $temp_pos_C[2];
   float $temp_pos_D[]=getAttr ($pointOnCurveInfo_A+".position");
   xform -ws -t  $temp_pos_C[0] $temp_pos_D[1] $temp_pos_C[2]$cv_temp ;//定位器1的位置
   }


int$size_TEMP=size($all_cv_ss_dw)-1;
for($j=1;$j<$size_TEMP;$j++)
   {
   string$cv_temp=$all_cv_ss_dw[$j];
   float $temp_pos_C[]=`xform -q -ws -t $cv_temp`;
   setAttr -type float3  ($nearestPointOnCurve_A+".inPosition")  $temp_pos_C[0]  $temp_pos_C[1]  $temp_pos_C[2];
   float $temp_pos_D[]=getAttr ($pointOnCurveInfo_A+".position");
   xform -ws -t  $temp_pos_C[0] $temp_pos_D[1] $temp_pos_C[2]$cv_temp ;//定位器1的位置
   }
   
delete $curve_temp  $nearestPointOnCurve_A $pointOnCurveInfo_A;
}


global proc zxb_eye_close_qvxian_fangfa()
{
string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
string$eye_setAttr_R=getAttr ($UI_head_controller+".eye_closeR");
string$eye_setAttr_L=getAttr ($UI_head_controller+".eye_closeL");
string$UI_head_controller_R_s[]=stringToStringArray($eye_setAttr_R, " ");
zxb_eye_close_qvxian($UI_head_controller_R_s[0],$UI_head_controller_R_s[1]);

string$UI_head_controller_L_s[]=stringToStringArray($eye_setAttr_L, " ");
zxb_eye_close_qvxian($UI_head_controller_L_s[0],$UI_head_controller_L_s[1]);
}



////////////////////创建睫毛骨骼//////////////////////////////////////////
global proc zxb_eye_eyelash_curve_proc()
 {
 string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
 string$all_string=`getAttr ($UI_head_controller+".jiemao_qvxian_all")`;
 string$all_string_s[]= stringToStringArray($all_string, " ");
 zxb_eye_eyelash_curve($all_string_s[0],$all_string_s[1],$all_string_s[2],$all_string_s[3]) ;
zxb_chuangjiangensui_A_proc;//创建睫毛碰撞
cycleCheck -e off;
 }


global proc zxb_eye_eyelash_curve(string$UP_eyelash,string$DW_eyelash,string$UP_eyelash_W,string$DW_eyelash_W) 
{
/*string$qvxian_UP="UP_eyelash";
string$qvxian_DW="DW_eyelash";
string$qvxian_UP_W="UP_eyelash_W";
string$qvxian_DW_W="DW_eyelash_W";*/


string$qvxian_UP=$UP_eyelash;
string$qvxian_DW=$DW_eyelash;
string$qvxian_UP_W=$UP_eyelash_W;
string$qvxian_DW_W=$DW_eyelash_W;

string$grp="eyelash_GRP";
rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 8 -d 3 -tol 0.001 $qvxian_UP;
DeleteHistory;
rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 8 -d 3 -tol 0.001 $qvxian_DW;
DeleteHistory;
select -r ($qvxian_UP+".cv[0:99999999999999999]") ;
string$all_cv_up[]=`ls -sl -fl`;
select -r ($qvxian_DW+".cv[0:99999999999999999]") ;
string$all_cv_dw[]=`ls -sl -fl`;

float$boxs[]=`getAttr ($qvxian_UP+".boundingBoxSize")`;
float$zz=$boxs[2];

select -r ($qvxian_UP_W+".cv[0:9999999999999]") ;
move -r -os -wd 0 0 $zz ;

float$boxs_B[]=`getAttr ($qvxian_DW+".boundingBoxSize")`;
float$zzX=$boxs_B[2];

select -r ($qvxian_DW_W+".cv[0:9999999999999]") ;
move -r -os -wd 0 0 $zzX ;

zxb_ADD_kongzu_proc($grp);
parent $grp "Face_Group";
parent  $qvxian_UP $grp;
parent  $qvxian_DW $grp;
parent  $qvxian_UP_W $grp;
parent  $qvxian_DW_W $grp;
zxb_eye_eyelash_curve_to_bn($qvxian_UP,$qvxian_DW,$qvxian_UP_W,$qvxian_DW_W)  ;
}

global proc zxb_eye_eyelash_curve_to_bn(string$UP_eyelash,string$DW_eyelash,string$UP_eyelash_W,string$DW_eyelash_W)  
{
/*string$qvxian_UP="UP_eyelash";
string$qvxian_DW="DW_eyelash";
string$qvxian_UP_W="UP_eyelash_W";
string$qvxian_DW_W="DW_eyelash_W";*/

string$qvxian_UP=$UP_eyelash;
string$qvxian_DW=$DW_eyelash;
string$qvxian_UP_W=$UP_eyelash_W;
string$qvxian_DW_W=$DW_eyelash_W;

string$qvxian_UP_RL=$qvxian_UP+"_RL";
string$qvxian_DW_RL=$qvxian_DW+"_RL";
string$qvxian_UP_W_RL=$qvxian_UP_W+"_W_RL";
string$qvxian_DW_W_RL=$qvxian_DW_W+"_W_RL";

rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 8 -d 3 -tol 0.001 $qvxian_UP_W;
DeleteHistory;
rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 1 -s 8 -d 3 -tol 0.001 $qvxian_DW_W;
DeleteHistory;


string$all_qvxian[]={$qvxian_UP,$qvxian_DW,$qvxian_UP_W,$qvxian_DW_W};
float $temp_pos_a[];
clear$temp_pos_a;
float $temp_pos_b[];
clear$temp_pos_b;
for($i=0;$i<size($all_qvxian);$i++)
   {
   string$temp_qvxian=$all_qvxian[$i];
   select -r ($temp_qvxian+".cv[0:99999999999999999]") ;
   string$all_cv_temp[]=`ls -sl -fl`;
   int$size_temp=size($all_cv_temp)-1;
    $temp_pos_a=`xform -q -ws -t $all_cv_temp[0]`;
    $temp_pos_b=`xform -q -ws -t $all_cv_temp[$size_temp]`;
   if($temp_pos_a[0]>$temp_pos_b[0]){reverseCurve -ch 1 -rpo 1 $temp_qvxian; select -r $temp_qvxian  ; DeleteHistory;select -cl  ; }
   
   }


select -r ($qvxian_UP+".cv[0:99999999999999999]") ;
string$all_cv_up[]=`ls -sl -fl`;
select -r ($qvxian_DW+".cv[0:99999999999999999]") ;
string$all_cv_dw[]=`ls -sl -fl`;
select -r ($qvxian_UP_W+".cv[0:99999999999999999]") ;
string$all_cv_up_w[]=`ls -sl -fl`;
select -r ($qvxian_DW_W+".cv[0:99999999999999999]") ;
string$all_cv_dw_w[]=`ls -sl -fl`;
select -cl  ;
int$size_a=size($all_cv_up);
int$size_b=size($all_cv_dw);
int$size_c=size($all_cv_up_w);
int$size_d=size($all_cv_dw_w);
if($size_a!=$size_c){error "cv数量不一致";}
if($size_b!=$size_d){error "cv数量不一致";}
int$size_mm=$size_c/2;
float $temp_pos_aa[]=`xform -q -ws -t $all_cv_dw_w[$size_mm]`;
float $temp_pos_bb[]=`xform -q -ws -t $all_cv_up[0]`;

string$all_root_bn=""; 
string$rr_ll="";
if($temp_pos_a[0]>0){$rr_ll="L";}
if($temp_pos_a[0]<0){$rr_ll="R";}
string$root_bn="eyelash_bn_"+$rr_ll;
int$ex=`objExists $root_bn`; ///判断
if($ex==0)
  {
  	 select -cl  ;
     joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n $root_bn ;
     select -cl  ;
     $all_root_bn+=$root_bn+" ";
     parent  $root_bn  "eyelash_GRP";

  }
  
  

    
int$duicheng=`checkBox -q -value  duicheng`;
if($duicheng==1)
  {
  	int$ex=`objExists $qvxian_UP_RL`; ///判断
  	if($ex==0)
  	  {
  	  select -r $qvxian_UP ;
      duplicate -rr -n $qvxian_UP_RL;
   	  setAttr ($qvxian_UP_RL+".scaleX") -1;
  	  makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;
  	  
  	  setAttr ($qvxian_UP+".visibility") 0;
     setAttr -lock true ($qvxian_UP +".v");
      setAttr ($qvxian_UP_RL+".visibility") 0;
     setAttr -lock true ( $qvxian_UP_RL +".v");
  	
  	  select -r $qvxian_DW ;
  	  duplicate -rr -n $qvxian_DW_RL; 
      setAttr ($qvxian_DW_RL+".scaleX") -1;
      makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;	
  	  setAttr ($qvxian_DW+".visibility") 0;
     setAttr -lock true ($qvxian_DW+".v");
  	 setAttr ($qvxian_DW_RL+".visibility") 0;
     setAttr -lock true ($qvxian_DW_RL +".v");
  	
     select -r $qvxian_UP_W ;
     duplicate -rr -n $qvxian_UP_W_RL;
     setAttr ($qvxian_UP_W_RL+".scaleX") -1;
  	 makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;	
     setAttr ($qvxian_UP_W+".visibility") 0;
     setAttr -lock true ($qvxian_UP_W+".v");
      setAttr ($qvxian_UP_W_RL+".visibility") 0;
     setAttr -lock true ($qvxian_UP_W_RL+".v");
    
     select -r $qvxian_DW_W ;
     duplicate -rr -n $qvxian_DW_W_RL;
     setAttr ($qvxian_DW_W_RL+".scaleX") -1;
  	 makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;	
  	  

       setAttr ($qvxian_DW_W+".visibility") 0;
      setAttr -lock true ($qvxian_DW_W+".v");
  	   setAttr ($qvxian_DW_W_RL+".visibility") 0;
      setAttr -lock true ($qvxian_DW_W_RL+".v");
  	  
  	  }
  	
    
  	
  }  
  
string$up_all_bn_R="";  
string$dw_all_bn_R="";  
for($j=0;$j<size($all_cv_up);$j++)
   {
    string$temp_cv_a=$all_cv_up[$j];
    string$temp_cv_b=$all_cv_dw[$j];
    string$temp_cv_c=$all_cv_up_w[$j];
    string$temp_cv_d=$all_cv_dw_w[$j];
    string$eyelash_up_bn="eyelash_up_"+$rr_ll+$j;
    string$eyelash_up_bn_end="eyelash_up_end"+$rr_ll+$j;
    string$eyelash_dw_bn="eyelash_dw_"+$rr_ll+$j;
    string$eyelash_dw_bn_end="eyelash_dw_end"+$rr_ll+$j;
    float $temp_pos_a[]=`xform -q -ws -t $temp_cv_a`;
    float $temp_pos_b[]=`xform -q -ws -t $temp_cv_c`;
    select -cl  ;
    joint -p $temp_pos_a[0] $temp_pos_a[1] $temp_pos_a[2] -n $eyelash_up_bn ;
    select -cl  ;
    joint  -p $temp_pos_b[0] $temp_pos_b[1] $temp_pos_b[2] -n $eyelash_up_bn_end;
    parent  $eyelash_up_bn_end $eyelash_up_bn;
    select -r $eyelash_up_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_up_bn $root_bn ;
   

    
    float $temp_pos_c[]=`xform -q -ws -t $temp_cv_b`;
    float $temp_pos_d[]=`xform -q -ws -t $temp_cv_d`;
    select -cl  ;
    joint -p $temp_pos_c[0] $temp_pos_c[1] $temp_pos_c[2] -n $eyelash_dw_bn ;
    select -cl  ;
    joint  -p $temp_pos_d[0] $temp_pos_d[1] $temp_pos_d[2] -n $eyelash_dw_bn_end;
    parent  $eyelash_dw_bn_end $eyelash_dw_bn;
    select -r $eyelash_dw_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
     parent  $eyelash_dw_bn $root_bn ;
     $dw_all_bn_R+=$eyelash_dw_bn+" ";
     $up_all_bn_R+=$eyelash_up_bn+" ";

    
   }
   



   

string$up_all_bn_L="";  
string$dw_all_bn_L=""; 
if($duicheng==1)
  {
  	
  select -r ($qvxian_UP_RL+".cv[0:99999999999999999]") ;
  string$all_cv_up[]=`ls -sl -fl`;
  select -r ($qvxian_DW_RL+".cv[0:99999999999999999]") ;
  string$all_cv_dw[]=`ls -sl -fl`;
  select -r ($qvxian_UP_W_RL+".cv[0:99999999999999999]") ;
  string$all_cv_up_w[]=`ls -sl -fl`;
  select -r ($qvxian_DW_W_RL+".cv[0:99999999999999999]") ;
  string$all_cv_dw_w[]=`ls -sl -fl`;
  select -cl  ;
  int$size_a=size($all_cv_up);
  int$size_b=size($all_cv_dw);
  int$size_c=size($all_cv_up_w);
  int$size_d=size($all_cv_dw_w);
  if($size_a!=$size_c){error "cv数量不一致";}
  if($size_b!=$size_d){error "cv数量不一致";}
  int$size_mm=$size_c/2;
  float $temp_pos_aa[]=`xform -q -ws -t $all_cv_dw_w[$size_mm]`;
  float $temp_pos_bb[]=`xform -q -ws -t $all_cv_up[0]`;
  select -r ($qvxian_UP_RL+".cv[0:99999999999999999]") ;
  string$all_cv_temp[]=`ls -sl -fl`;
  int$size_temp=size($all_cv_temp)-1;
  $temp_pos_a=`xform -q -ws -t $all_cv_temp[0]`;
  $temp_pos_b=`xform -q -ws -t $all_cv_temp[$size_temp]`;
  if($temp_pos_a[0]>0){$rr_ll="L";}
  if($temp_pos_a[0]<0){$rr_ll="R";}
  string$root_bn="eyelash_bn_"+$rr_ll;
  int$ex=`objExists $root_bn`; ///判断
  if($ex==0)
    {
  	 select -cl  ;
     joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n $root_bn ;
     select -cl  ;
     $all_root_bn+=$root_bn+" ";
     parent  $root_bn  "eyelash_GRP";
     }
  for($j=0;$j<size($all_cv_up);$j++)
   {
    string$temp_cv_a=$all_cv_up[$j];
    string$temp_cv_b=$all_cv_dw[$j];
    string$temp_cv_c=$all_cv_up_w[$j];
    string$temp_cv_d=$all_cv_dw_w[$j];
    
    string$eyelash_up_bn="eyelash_up_"+$rr_ll+$j;
    string$eyelash_up_bn_end="eyelash_up_end"+$rr_ll+$j;
    string$eyelash_dw_bn="eyelash_dw_"+$rr_ll+$j;
    string$eyelash_dw_bn_end="eyelash_dw_end"+$rr_ll+$j;
    float $temp_pos_a[]=`xform -q -ws -t $temp_cv_a`;
    float $temp_pos_b[]=`xform -q -ws -t $temp_cv_c`;
    select -cl  ;
    joint -p $temp_pos_a[0] $temp_pos_a[1] $temp_pos_a[2] -n $eyelash_up_bn ;
    select -cl  ;
    joint  -p $temp_pos_b[0] $temp_pos_b[1] $temp_pos_b[2] -n $eyelash_up_bn_end;
    parent  $eyelash_up_bn_end $eyelash_up_bn;
    select -r $eyelash_up_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_up_bn $root_bn ;
    
    float $temp_pos_c[]=`xform -q -ws -t $temp_cv_b`;
    float $temp_pos_d[]=`xform -q -ws -t $temp_cv_d`;
    select -cl  ;
    joint -p $temp_pos_c[0] $temp_pos_c[1] $temp_pos_c[2] -n $eyelash_dw_bn ;
    select -cl  ;
    joint  -p $temp_pos_d[0] $temp_pos_d[1] $temp_pos_d[2] -n $eyelash_dw_bn_end;
    parent  $eyelash_dw_bn_end $eyelash_dw_bn;
    select -r $eyelash_dw_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_dw_bn $root_bn ;
    $dw_all_bn_L+=$eyelash_dw_bn+" ";
    $up_all_bn_L+=$eyelash_up_bn+" ";
   }

  
  }



string$dw_all_bn_R_shuxing="eyelash_dw_all_bn_R";
string$up_all_bn_R_shuxing="eyelash_up_all_bn_R";
string$dw_all_bn_L_shuxing="eyelash_dw_all_bn_L";
string$up_all_bn_L_shuxing="eyelash_up_all_bn_L";

string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
zxb_ADD_shuxing_string_proc($UI_head_controller,$dw_all_bn_R_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$dw_all_bn_R_shuxing) $dw_all_bn_R;


zxb_ADD_shuxing_string_proc($UI_head_controller,$up_all_bn_R_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$up_all_bn_R_shuxing) $up_all_bn_R;

zxb_ADD_shuxing_string_proc($UI_head_controller,$up_all_bn_L_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$up_all_bn_L_shuxing) $up_all_bn_L;

zxb_ADD_shuxing_string_proc($UI_head_controller,$dw_all_bn_L_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$dw_all_bn_L_shuxing) $dw_all_bn_L;

string$all_root_bn_ss=$all_root_bn;
string $all_root_bns[]=stringToStringArray($all_root_bn_ss," ");//被附着的对象模型
string $root_bns[]=$all_root_bns;//选择跟关节创建控制器
float$bbobx_Min[]=`getAttr ($root_bns[0]+".boundingBoxMin")`;////绑定box节点
string$bns[]=`listRelatives -c  $root_bns[0]`;
string$bnss[]=`listRelatives -c  $root_bns[1]`;
string$alll_sss[]=stringArrayCatenate($bns,$bnss);
float$banjin=$bbobx_Min[2]*0.02;
string$cbn_gra_root_grp=($root_bns[0]+"_GRP_root");
int$ex=`objExists $cbn_gra_root_grp`;
if($ex==0){group -empty -n $cbn_gra_root_grp;  parent $cbn_gra_root_grp "eyelash_GRP"; }
string $xiaba_head_con=`textFieldGrp -q -tx UI_head_controller `;//头部控制器
string$UV_mode=`getAttr  ($xiaba_head_con+".zxb_face_UV_mode")`;
string$grp_temp="";
for($i=0;$i<size($alll_sss);$i++)
   {
       string$cbn=$alll_sss[$i];
       string$bnss[]=`listRelatives -c  $cbn`;
       //float$tx=`getAttr ($bnss[0]+".tx")`;
       float$tx=$banjin;
       string$cbn_con=($cbn+"_kongzhi");
       string$cbn_gra_A=($cbn+"_GRP_A");
       string$cbn_gra_B=($cbn+"_GRP_B");
       string$cbn_gra_C=($cbn+"_GRP_C");
       $grp_temp+=$cbn_gra_C+" ";
       circle -c 0 0 0 -nr 1 0 0 -sw 360 -r $tx -d 3 -ut 0 -tol 0.01 -s 8 -ch 0 -n $cbn_con ;
       group -n $cbn_gra_A;
       group -n $cbn_gra_B;
       group -n $cbn_gra_C;
       select -r ($cbn_con+".cv[0:99999]");
       float$tx_q=$banjin*10;
       move -r -os -wd  $tx_q 0  0 ;
      
       parent $cbn_gra_C $cbn_gra_root_grp;
       delete`parentConstraint  $cbn $cbn_gra_C`;
       connectAttr -force  ($cbn_con+".r") ($cbn+".r");
       string $qvxianshap[]=`listRelatives -s  $cbn_con`;
       setAttr ($qvxianshap[0]+".overrideEnabled") 1;
       setAttr($qvxianshap[0]+".overrideColor") 18;
   }
   
string $all_zu_temp[]=stringToStringArray($grp_temp," ");
string$Follicle_grp=zxb_maonang_Follicle_grp(1,$all_zu_temp,$UV_mode);//int 判断是否保持原位置  ,被控制物体，  模型或者曲面
parent $Follicle_grp "eyelash_GRP";






//////////创建碰撞骨骼
zxb_eyelash_bn;
button -e -en 0 hedemianbankuan_bianji_button;
}


///////////////创建睫毛碰撞骨骼////////////////////////////////////////////////////

global proc zxb_eyelash_bn()
{
string $UI_Collisionline=`textFieldGrp -q -tx UI_Collisionline `;
string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
string$all_string=`getAttr ($UI_head_controller+".jiemao_qvxian_all")`;
string$all_string_s[]= stringToStringArray($all_string, " ");
zxb_eye_eyelash_A_curve_to_bn($all_string_s[0],$all_string_s[1],$all_string_s[2],$all_string_s[3]);
} 

global proc zxb_eye_eyelash_A_curve_to_bn(string$UP_eyelash,string$DW_eyelash,string$UP_eyelash_W,string$DW_eyelash_W)  
{
string$qvxian_UP=$UP_eyelash;
string$qvxian_DW=$DW_eyelash;
string$qvxian_UP_W=$UP_eyelash_W;
string$qvxian_DW_W=$DW_eyelash_W;

string$qvxian_UP_RL=$qvxian_UP+"_RL";
string$qvxian_DW_RL=$qvxian_DW+"_RL";
string$qvxian_UP_W_RL=$qvxian_UP_W+"_W_RL";
string$qvxian_DW_W_RL=$qvxian_DW_W+"_W_RL";

string$all_qvxian[]={$qvxian_UP,$qvxian_DW,$qvxian_UP_W,$qvxian_DW_W};
float $temp_pos_a[];
clear$temp_pos_a;
float $temp_pos_b[];
clear$temp_pos_b;
for($i=0;$i<size($all_qvxian);$i++)
   {
   string$temp_qvxian=$all_qvxian[$i];
   select -r ($temp_qvxian+".cv[0:99999999999999999]") ;
   string$all_cv_temp[]=`ls -sl -fl`;
   int$size_temp=size($all_cv_temp)-1;
    $temp_pos_a=`xform -q -ws -t $all_cv_temp[0]`;
    $temp_pos_b=`xform -q -ws -t $all_cv_temp[$size_temp]`;
   if($temp_pos_a[0]>$temp_pos_b[0]){reverseCurve -ch 1 -rpo 1 $temp_qvxian; select -r $temp_qvxian  ; DeleteHistory;select -cl  ; }
   
   }


select -r ($qvxian_UP+".cv[0:99999999999999999]") ;
string$all_cv_up[]=`ls -sl -fl`;
select -r ($qvxian_DW+".cv[0:99999999999999999]") ;
string$all_cv_dw[]=`ls -sl -fl`;
select -r ($qvxian_UP_W+".cv[0:99999999999999999]") ;
string$all_cv_up_w[]=`ls -sl -fl`;
select -r ($qvxian_DW_W+".cv[0:99999999999999999]") ;
string$all_cv_dw_w[]=`ls -sl -fl`;
select -cl  ;
int$size_a=size($all_cv_up);
int$size_b=size($all_cv_dw);
int$size_c=size($all_cv_up_w);
int$size_d=size($all_cv_dw_w);
if($size_a!=$size_c){error "cv数量不一致";}
if($size_b!=$size_d){error "cv数量不一致";}
int$size_mm=$size_c/2;
float $temp_pos_aa[]=`xform -q -ws -t $all_cv_dw_w[$size_mm]`;
float $temp_pos_bb[]=`xform -q -ws -t $all_cv_up[0]`;

string$all_root_bn=""; 
string$rr_ll="";
if($temp_pos_a[0]>0){$rr_ll="L";}
if($temp_pos_a[0]<0){$rr_ll="R";}
int$duicheng=`checkBox -q -value  duicheng`;
string$up_all_bn_R="";  
string$dw_all_bn_R="";  
string$root_bn_UP_R="";
string$root_bn_DW_R="";
for($j=0;$j<size($all_cv_up);$j++)
   {
   	$root_bn_UP_R="eyelash_A_bn_UP"+$rr_ll;
    int$ex=`objExists $root_bn_UP_R`; ///判断
    if($ex==0)
      {
  	   select -cl  ;
       joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n 	$root_bn_UP_R ;
       select -cl  ;
       $all_root_bn+=	$root_bn_UP_R+" ";
       parent  	$root_bn_UP_R  "eyelash_GRP";

     }
   	$root_bn_DW_R="eyelash_A_bn_DW"+$rr_ll;
    int$ex=`objExists $root_bn_DW_R`; ///判断
    if($ex==0)
      {
  	   select -cl  ;
       joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n $root_bn_DW_R ;
       select -cl  ;
       $all_root_bn+=$root_bn_DW_R+" ";
       parent  $root_bn_DW_R  "eyelash_GRP";

     }
    string$temp_cv_a=$all_cv_up[$j];
    string$temp_cv_b=$all_cv_dw[$j];
    string$temp_cv_c=$all_cv_up_w[$j];
    string$temp_cv_d=$all_cv_dw_w[$j];
    string$eyelash_up_bn="eyelash_up_A"+$rr_ll+$j;
    string$eyelash_up_bn_end="eyelash_up_A_end"+$rr_ll+$j;
    string$eyelash_dw_bn="eyelash_dw_A_"+$rr_ll+$j;
    string$eyelash_dw_bn_end="eyelash_dw_A_end"+$rr_ll+$j;
    float $temp_pos_a[]=`xform -q -ws -t $temp_cv_a`;
    float $temp_pos_b[]=`xform -q -ws -t $temp_cv_c`;
    select -cl  ;
    joint -p $temp_pos_a[0] $temp_pos_a[1] $temp_pos_a[2] -n $eyelash_up_bn ;
    select -cl  ;
    joint  -p $temp_pos_b[0] $temp_pos_b[1] $temp_pos_b[2] -n $eyelash_up_bn_end;
    parent  $eyelash_up_bn_end $eyelash_up_bn;
    select -r $eyelash_up_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_up_bn $root_bn_UP_R ;
    float $temp_pos_c[]=`xform -q -ws -t $temp_cv_b`;
    float $temp_pos_d[]=`xform -q -ws -t $temp_cv_d`;
    select -cl  ;
    joint -p $temp_pos_c[0] $temp_pos_c[1] $temp_pos_c[2] -n $eyelash_dw_bn ;
    select -cl  ;
    joint  -p $temp_pos_d[0] $temp_pos_d[1] $temp_pos_d[2] -n $eyelash_dw_bn_end;
    parent  $eyelash_dw_bn_end $eyelash_dw_bn;
    select -r $eyelash_dw_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
     parent  $eyelash_dw_bn $root_bn_DW_R ;
     $dw_all_bn_R+=$eyelash_dw_bn+" ";
     $up_all_bn_R+=$eyelash_up_bn+" ";
   }


string$up_all_bn_L="";  
string$dw_all_bn_L=""; 
string$root_bn_UP_L="";
string$root_bn_DW_L="";
if($duicheng==1)
  {
  	
  select -r ($qvxian_UP_RL+".cv[0:99999999999999999]") ;
  string$all_cv_up[]=`ls -sl -fl`;
  select -r ($qvxian_DW_RL+".cv[0:99999999999999999]") ;
  string$all_cv_dw[]=`ls -sl -fl`;
  select -r ($qvxian_UP_W_RL+".cv[0:99999999999999999]") ;
  string$all_cv_up_w[]=`ls -sl -fl`;
  select -r ($qvxian_DW_W_RL+".cv[0:99999999999999999]") ;
  string$all_cv_dw_w[]=`ls -sl -fl`;
  select -cl  ;
  int$size_a=size($all_cv_up);
  int$size_b=size($all_cv_dw);
  int$size_c=size($all_cv_up_w);
  int$size_d=size($all_cv_dw_w);
  if($size_a!=$size_c){error "cv数量不一致";}
  if($size_b!=$size_d){error "cv数量不一致";}
  int$size_mm=$size_c/2;
  float $temp_pos_aa[]=`xform -q -ws -t $all_cv_dw_w[$size_mm]`;
  float $temp_pos_bb[]=`xform -q -ws -t $all_cv_up[0]`;
  select -r ($qvxian_UP_RL+".cv[0:99999999999999999]") ;
  string$all_cv_temp[]=`ls -sl -fl`;
  int$size_temp=size($all_cv_temp)-1;
  $temp_pos_a=`xform -q -ws -t $all_cv_temp[0]`;
  $temp_pos_b=`xform -q -ws -t $all_cv_temp[$size_temp]`;
  if($temp_pos_a[0]>0){$rr_ll="L";}
  if($temp_pos_a[0]<0){$rr_ll="R";}
  
  
  $root_bn_UP_L="eyelash_A_bn_UP_"+$rr_ll;
  int$ex=`objExists $root_bn_UP_L`; ///判断
  if($ex==0)
    {
  	 select -cl  ;
     joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n $root_bn_UP_L ;
     select -cl  ;
     $all_root_bn+=$root_bn_UP_L+" ";
     parent  $root_bn_UP_L "eyelash_GRP";
     }
     
     
  $root_bn_DW_L="eyelash_A_bn_DW_"+$rr_ll;
  int$ex=`objExists $root_bn_DW_L`; ///判断
  if($ex==0)
    {
  	 select -cl  ;
     joint -p $temp_pos_aa[0]  $temp_pos_bb[1] $temp_pos_bb[2]  -n $root_bn_DW_L ;
     select -cl  ;
     $all_root_bn+=$root_bn_DW_L+" ";
     parent  $root_bn_DW_L"eyelash_GRP";
     }
     
     
  for($j=0;$j<size($all_cv_up);$j++)
   {
    string$temp_cv_a=$all_cv_up[$j];
    string$temp_cv_b=$all_cv_dw[$j];
    string$temp_cv_c=$all_cv_up_w[$j];
    string$temp_cv_d=$all_cv_dw_w[$j];
    
    string$eyelash_up_bn="eyelash_A_up_"+$rr_ll+$j;
    string$eyelash_up_bn_end="eyelash_A_up_end"+$rr_ll+$j;
    string$eyelash_dw_bn="eyelash_A_dw_"+$rr_ll+$j;
    string$eyelash_dw_bn_end="eyelash_A_dw_end"+$rr_ll+$j;
    float $temp_pos_a[]=`xform -q -ws -t $temp_cv_a`;
    float $temp_pos_b[]=`xform -q -ws -t $temp_cv_c`;
    select -cl  ;
    joint -p $temp_pos_a[0] $temp_pos_a[1] $temp_pos_a[2] -n $eyelash_up_bn ;
    select -cl  ;
    joint  -p $temp_pos_b[0] $temp_pos_b[1] $temp_pos_b[2] -n $eyelash_up_bn_end;
    parent  $eyelash_up_bn_end $eyelash_up_bn;
    select -r $eyelash_up_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_up_bn $root_bn_UP_L ;
    
    float $temp_pos_c[]=`xform -q -ws -t $temp_cv_b`;
    float $temp_pos_d[]=`xform -q -ws -t $temp_cv_d`;
    select -cl  ;
    joint -p $temp_pos_c[0] $temp_pos_c[1] $temp_pos_c[2] -n $eyelash_dw_bn ;
    select -cl  ;
    joint  -p $temp_pos_d[0] $temp_pos_d[1] $temp_pos_d[2] -n $eyelash_dw_bn_end;
    parent  $eyelash_dw_bn_end $eyelash_dw_bn;
    select -r $eyelash_dw_bn;
    joint -e  -oj xyz -secondaryAxisOrient yup -ch -zso;
    select -cl  ;
    parent  $eyelash_dw_bn $root_bn_DW_L ;
    $dw_all_bn_L+=$eyelash_dw_bn+" ";
    $up_all_bn_L+=$eyelash_up_bn+" ";
   }

  
  }

string$dw_all_bn_R_shuxing="eyelash_dw_ROOT_all_bn_R";
string$up_all_bn_R_shuxing="eyelash_up_ROOT_all_bn_R";
string$dw_all_bn_L_shuxing="eyelash_dw_ROOT_all_bn_L";
string$up_all_bn_L_shuxing="eyelash_up_ROOT_all_bn_L";
string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
zxb_ADD_shuxing_string_proc($UI_head_controller,$dw_all_bn_R_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$dw_all_bn_R_shuxing) $root_bn_DW_R ;
zxb_ADD_shuxing_string_proc($UI_head_controller,$up_all_bn_R_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$up_all_bn_R_shuxing) $root_bn_UP_R;
zxb_ADD_shuxing_string_proc($UI_head_controller,$up_all_bn_L_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$up_all_bn_L_shuxing) $root_bn_UP_L;
zxb_ADD_shuxing_string_proc($UI_head_controller,$dw_all_bn_L_shuxing);
setAttr -type "string" ($UI_head_controller+"."+$dw_all_bn_L_shuxing) $root_bn_DW_L;
}


global proc  zxb_biaoqing_shengcheng()
{
zxb_xiababangding_proc;
select -cl -sym  ;
print"11111111111111111111111111111111111111\n";
zxb_jaw_jisuanquanzhong;
select -cl -sym  ;
print"22222222222222222222222222222222\n";
zxb_zuibalalian_all_proc;
select -cl -sym  ;
print"33333333333333333333333333333333333\n";
zxb_lalianbaoguo_A_poc;
select -cl -sym  ;
print"44444444444444444444444444444444444\n";
zxb_button_lipjoint_proc;
select -cl -sym  ;
print"5555555555555555555555555555\n";
zxb_face_to_Cluster_proc;
select -cl -sym  ;
print"66666666666666666666666666666\n";
zxb_eye_con_bn_proc;
select -cl -sym  ;
print"77777777777777777777777777777\n";
zxb_yanjing_yanpi_qvxian_fangfa_proc;
select -cl -sym  ;
print"88888888888888888888888888\n";
zxb_zxb_all_faceFrame_proc;
select -cl -sym  ;
print"999999999999999999999999\n";
}




///////////////创建睫毛曲线//////////////////////////
global proc  zxb_jiemao_qvxian_ex() 
{
string $UI_eye_middle_wire=`textFieldGrp -q -tx UI_eye_middle_wire `;
string $UI_head_controller=`textFieldGrp -q -tx UI_head_controller `;
string $UI_eye_middle_wire_s[]=stringToStringArray($UI_eye_middle_wire," ");
string $UI_head_mode=`textFieldGrp -q -tx UI_head_mode `;
select -r $UI_eye_middle_wire_s;
float$ex=zxb_normal_pingjunshu($UI_head_mode);
int$ex_int=0;
if($ex>0){$ex_int=0;}else{$ex_int=1;}
string$qvxian_s=zxb_extract_Curves_proc($ex_int,"Curves","eye_jiemao_temp",$UI_eye_middle_wire);
string $qvxian_ss[]=stringToStringArray($qvxian_s," ");
float$bbobx_Min[]=`getAttr ($qvxian_ss[0]+".boundingBoxMin")`;////绑定box节点
float$weiyi=$bbobx_Min[2]*0.2;
string$name_A="";
string$name_B="";
string$qvxian_grp="eye_qvxian_grp";
zxb_ADD_kongzu_proc($qvxian_grp);
parent $qvxian_grp "Face_Group";
for ($i=0;$i<size($qvxian_ss);$i++)
    {
    string$qvxian_A=$qvxian_ss[$i];
    string$wai=$qvxian_A+"_temp";
    $name_A+=$qvxian_A+" ";
    $name_B+=$wai+" ";
    }
    
for ($i=0;$i<size($qvxian_ss);$i++)
    {
    	string$qvxian_A=$qvxian_ss[$i];
    	string$wai=$qvxian_A+"_temp";
    	select -r  $qvxian_A;
    	duplicate -rr -n $wai;
    	select -r ($wai+".cv[0:18]");
    	move -r 0 0 $weiyi ;
    	parent  $qvxian_A  $qvxian_grp;
    	parent  $wai $qvxian_grp;
    	
    }
string$all_neme=$name_A+$name_B;
zxb_ADD_shuxing_string_proc($UI_head_controller,"jiemao_qvxian_all");
setAttr -type "string" ($UI_head_controller+".jiemao_qvxian_all") $all_neme;

 }
 
 
 
 
 //////////////////////////////创建睫毛碰撞//////////////////////////////////////
 global proc zxb_chuangjiangensui_A_proc()
{
string$UI_Collisionline=`textFieldGrp -q -tx  UI_Collisionline`;
string$lr_temp_s[]=stringToStringArray($UI_Collisionline," ");
 zxb_zuiba_tiqvqvxianfangfa_proc(1,"eyelash_collision_R","eye",$UI_Collisionline);
 // zxb_zuiba_tiqvqvxianfangfa_proc(1,"eyelash_collision_L","eye",$UI_Collisionline);
string$xian_up_L="eye_eyelash_collision_L_UP"; 
string$xian_dw_L="eye_eyelash_collision_L_DW"; 

string$xian_up_R="eye_eyelash_collision_R_UP"; 
string$xian_dw_R="eye_eyelash_collision_R_DW";
int$duichen=`checkBox -q -v  duicheng`;
if($duichen==1)
  {
  	select -r $xian_up_R;
  	DeleteHistory;
  	duplicate -rr -n  $xian_up_L;
  	select -r $xian_dw_R;
  	DeleteHistory;
  	duplicate -rr -n  $xian_dw_L;
  	
  	setAttr ($xian_up_L+".scaleX") -1;
    setAttr ($xian_dw_L+".scaleX") -1;
    select -r $xian_up_L;
    makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;
    select -r $xian_dw_L; 
    makeIdentity -apply true -t 1 -r 1 -s 1 -n 0 -pn 1;
  	
  }
string$all_qvxian_name="";
if($duichen==1)
  {
  	$all_qvxian_name=$xian_up_R+" "+$xian_dw_R+" "+$xian_up_L+" "+$xian_dw_L+" ";
  
  }else
      {
      $all_qvxian_name=$xian_up_R+" "+$xian_dw_R+" ";
      }
   
 zxb_mesh_nurbsSurface_to_obj_A_proc($all_qvxian_name);   
string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//    
string$pengzhuang_qvxian_L_UP=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_L_UP")`;
string$pengzhuang_qvxian_L_DW=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_L_DW")`;
string$pengzhuang_qvxian_R_UP=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_R_UP")`;
string$pengzhuang_qvxian_R_DW=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_R_DW")`;


string$eyelash_dw_ROOT_all_bn_R=`getAttr   ($UI_head_controller+".eyelash_dw_ROOT_all_bn_R")`;
string$eyelash_up_ROOT_all_bn_R=`getAttr   ($UI_head_controller+".eyelash_up_ROOT_all_bn_R")`;
string$eyelash_dw_ROOT_all_bn_L=`getAttr   ($UI_head_controller+".eyelash_dw_ROOT_all_bn_L")`;
string$eyelash_up_ROOT_all_bn_L=`getAttr   ($UI_head_controller+".eyelash_up_ROOT_all_bn_L")`;

string $eyelash_dw_ROOT_all_bn_R_S[]=`listRelatives -c $eyelash_dw_ROOT_all_bn_R`; 
string $eyelash_up_ROOT_all_bn_R_S[]=`listRelatives -c $eyelash_up_ROOT_all_bn_R`; 
string $eyelash_dw_ROOT_all_bn_L_S[]=`listRelatives -c $eyelash_dw_ROOT_all_bn_L`; 
string $eyelash_up_ROOT_all_bn_L_S[]=`listRelatives -c $eyelash_up_ROOT_all_bn_L`; 


select -r  $pengzhuang_qvxian_R_UP $eyelash_up_ROOT_all_bn_R_S;

zxb_jiemao_pengzhuangguanjie_chengxu_A_proc($pengzhuang_qvxian_R_UP,$eyelash_up_ROOT_all_bn_R_S);
zxb_jiemao_pengzhuangguanjie_chengxu_A_proc($pengzhuang_qvxian_R_DW,$eyelash_dw_ROOT_all_bn_R_S);
zxb_jiemao_pengzhuangguanjie_chengxu_A_proc($pengzhuang_qvxian_L_UP,$eyelash_up_ROOT_all_bn_L_S);
zxb_jiemao_pengzhuangguanjie_chengxu_A_proc($pengzhuang_qvxian_L_DW,$eyelash_dw_ROOT_all_bn_L_S);    

string$pengzhuang_qvxian_R_UP=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_R_UP")`;
string$pengzhuang_qvxian_R_DW=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_R_DW")`;
string$pengzhuang_qvxian_L_UP=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_L_UP")`;
string$pengzhuang_qvxian_L_DW=`getAttr   ($UI_head_controller+".pengzhuang_qvxian_L_DW")`;

string $all_pengzhuangqvxian[]={$pengzhuang_qvxian_L_UP,$pengzhuang_qvxian_L_DW,$pengzhuang_qvxian_R_UP,$pengzhuang_qvxian_R_DW};

zxb_jiemao_pengzhuang_A_proc($all_pengzhuangqvxian);

} 
 
 
 
///////////////////////////////////////睫毛碰撞//////////////////////////////////////////////////////////


global proc zxb_jiemao_pengzhuang_A_proc(string$qvxian_temp_s[])
{
/*string$pengzhuang_qvxian_ss[]={"UI_jiemao_pengzhuang_bn_up_L","UI_jiemao_pengzhuang_bn_dw_L","UI_jiemao_pengzhuang_bn_up_R","UI_jiemao_pengzhuang_bn_dw_R"};

*/
string$pengzhuang_shuxing_s[]={"pengzhuang_qvxian_L_UP","pengzhuang_qvxian_L_DW","pengzhuang_qvxian_R_UP","pengzhuang_qvxian_R_DW"};

string $toubukongzhiqi=`textFieldGrp -q -tx UI_head_controller `;
string$eye_coms=`getAttr ($toubukongzhiqi+".eye_con")`;
string$eye_coma[]=stringToStringArray($eye_coms, " ");



string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//    
string$eyelash_dw_ROOT_all_bn_R=`getAttr   ($UI_head_controller+".eyelash_dw_ROOT_all_bn_R")`;
string$eyelash_up_ROOT_all_bn_R=`getAttr   ($UI_head_controller+".eyelash_up_ROOT_all_bn_R")`;
string$eyelash_dw_ROOT_all_bn_L=`getAttr   ($UI_head_controller+".eyelash_dw_ROOT_all_bn_L")`;
string$eyelash_up_ROOT_all_bn_L=`getAttr   ($UI_head_controller+".eyelash_up_ROOT_all_bn_L")`;


string $all_pengzhuangqvxian_bn[]={$eyelash_up_ROOT_all_bn_L,$eyelash_dw_ROOT_all_bn_L,$eyelash_up_ROOT_all_bn_R,$eyelash_dw_ROOT_all_bn_R};
string$all_bns_ss[]=$all_pengzhuangqvxian_bn;
for ($i=0;$i<size($qvxian_temp_s);$i++)
    {
     string$all_temp_bn_s_root=$all_pengzhuangqvxian_bn[$i];
     string $all_temp_bn_S[]=`listRelatives -c $all_temp_bn_s_root`; 
     string$pengzhuang_shuxing=$pengzhuang_shuxing_s[$i];
     string$quanzhong_bn=$pengzhuang_shuxing+"_bn";
     int$qvyu=$i%2;
     string$eye_zongkongzhi="";
     string$xian_temp=$qvxian_temp_s[$i];
     if($i<=1){$eye_zongkongzhi=$eye_coma[0];}else{$eye_zongkongzhi=$eye_coma[1];}//眼睛控制器
     int$ex_A=`objExists $xian_temp`;//判断曲线是否存在
     if($ex_A==1)
       {
       	zxb_ADD_shuxing_string_proc($UI_head_controller,$quanzhong_bn) ;
        select -r $all_temp_bn_S;  
        string$tempname=zxb_jiemao_pengzhuangyuesu_zhucengxu_proc($qvyu,$xian_temp,$eye_zongkongzhi);
        setAttr -type "string" ($UI_head_controller+"."+$quanzhong_bn) $tempname;
        }
     }

}



 /////////////////////////////////曲线跟随模型或者曲面//////////////////////////////////////////////////////////////
global proc zxb_mesh_nurbsSurface_to_obj_A_proc(string$name_s)
{
string $UI_head_controller=`textFieldGrp -q -tx  UI_head_controller`;//
string$uv_mode=`getAttr ($UI_head_controller+".zxb_face_UV_mode")`;
string $UI_head_mode=$uv_mode;//
string $UI_head_bn=`textFieldGrp -q -tx  UI_head_bn`;//
string$headbn=$UI_head_bn;//载入头部关节 缩放毛囊需要用到

zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian");
string $temp_all_tex=$name_s;
string$qvxian_head_temp="";
string$qvxian_grp_s[]=stringToStringArray($temp_all_tex, " ");
for($iii=0;$iii<size($qvxian_grp_s);$iii++)
   {
    string$temp_qvxian=$qvxian_grp_s[$iii];
    int$ex=`objExists $temp_qvxian`;//判断曲线是否存在

    if($ex==1)//如果存在就执行内容
      {

       
     
      select -r $temp_qvxian;
      select -add $UI_head_mode;
      string $bianliang[]=`ls -sl`;//选择曲线  加选曲面
      
      ////////////判断曲面还是曲线//////////////////
      int$size=size($bianliang);
      if($size!=2){error "请选中一个曲线和一个曲面两个物体";}
      string$qvxian_temp="";
      string$qvmian_temp="";
      string$shape_a[]=`listRelatives -s $bianliang[0]`; 
      string$shape_b[]=`listRelatives -s $bianliang[1]`; 
      
      int$ex_a=`objExists $shape_a[0]`;
      if($ex_a==0){error "选中的第一个物体没有型节点";}
      int$ex_b=`objExists $shape_b[0]`;
      if($ex_b==0){error "选中的第二个物体没有型节点";}
      string$type_a=`nodeType $shape_a[0]`;
      if($type_a=="nurbsCurve")
        {
        $qvxian_temp=$bianliang[0];
        $qvmian_temp=$bianliang[1];
        }
     else
       {
        $qvxian_temp=$bianliang[1];
        $qvmian_temp=$bianliang[0];
       }

     select -r  $qvxian_temp;
     string$shape_b[]=`listRelatives -s $qvmian_temp`; 
     string$shape_mode=$shape_b[0];
     string$type_b=`nodeType $shape_b[0]`;
    if($type_b=="nurbsSurface")///
      {
       /////////////////////////////创建曲面信息节点/////////////////////////////////////////////////////
      string$qvmian_closestPointOnSurface=($qvxian_temp+"_closestPointOnSurface_yanpi");
      string$qvmian_shape[]=`listRelatives -s $qvmian_temp`; 
      string$qvmianshape=$qvmian_shape[0];
      int$panduan_B=`objExists $qvmian_closestPointOnSurface`;
      if($panduan_B==1){delete $qvmian_closestPointOnSurface;}
      shadingNode -asUtility closestPointOnSurface  -n $qvmian_closestPointOnSurface;
      connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_closestPointOnSurface+".inputSurface");

      /////////////选中曲线////////////////////////
      select -r ($qvxian_temp+".cv[0:999999999]");
      string $cvs[]=`ls -sl -fl`;
      for ($i=0;$i<size($cvs);$i++)
          {
           ////////////////////曲面最近点节点 赋值最近点节点////////////////////////////
           string$cv=$cvs[$i];
           string$qvmian_pointOnSurfaceInfo=($qvxian_temp+"_pointOnSurfaceInfo_yanpi"+$i);
           int$panduan_A=`objExists $qvmian_pointOnSurfaceInfo`;
           if($panduan_A==1){delete $qvmian_pointOnSurfaceInfo;}
           shadingNode -asUtility pointOnSurfaceInfo  -n $qvmian_pointOnSurfaceInfo;     
           float$pos_dia[]=`xform -q -ws -t $cv`;
           setAttr -type float3 ($qvmian_closestPointOnSurface+".inPosition") $pos_dia[0] $pos_dia[1] $pos_dia[2];
           float$U=`getAttr ($qvmian_closestPointOnSurface+".parameterU")`;
           float$V=`getAttr ($qvmian_closestPointOnSurface+".parameterV")`;
           setAttr ($qvmian_pointOnSurfaceInfo+".parameterU") $U;//获得U值
           setAttr ($qvmian_pointOnSurfaceInfo+".parameterV") $V;//获得V值
           connectAttr -force ($qvmianshape+".worldSpace[0]") ($qvmian_pointOnSurfaceInfo+".inputSurface");//连接曲面
   
           ///////////////////////////创建定位器连接到曲线上（定位器被曲面控制 定位器控制曲线）//////////////////////////////////////////////////
           string$zu_A=($qvxian_temp+"_eye_grp_loc");
           string$eye_loc=($qvxian_temp+"_eye_loc_"+$i);
           string$eye_loc_grp_a=($eye_loc+"_GRP_A");
           string$eye_loc_grp_b=($eye_loc+"_GRP_B");
           string$all_eye_jiemao_grp="all_eye_jiemao_grp";
           zxb_ADD_kongzu_proc($all_eye_jiemao_grp);
           string$mode_ex_grp[]=`listRelatives -p $all_eye_jiemao_grp`; 
           if($mode_ex_grp[0]!="Face_Group"){parent $all_eye_jiemao_grp "Face_Group";}
           string$ex_grps[]=`listRelatives -p $temp_qvxian`; 
           if($ex_grps[0]!=$all_eye_jiemao_grp){parent $temp_qvxian $all_eye_jiemao_grp;}
           int$panduan_A=`objExists $zu_A`;
           if($panduan_A==0)
             {
              select -cl  ;
              group -empty -n  $zu_A;
              setAttr ($zu_A+".visibility") 0;
              setAttr -lock true ($zu_A+".v");   
              string$qvmian_zu[]=`listRelatives -p $qvmian_temp`; 
              //int$panduan_A=`objExists $qvmian_zu[0]`;
              if($qvmian_zu[0]!=$all_eye_jiemao_grp){ parent $zu_A $all_eye_jiemao_grp;}
             }
          spaceLocator -p 0 0 0 -n $eye_loc;
          group -n $eye_loc_grp_a;
          group -n $eye_loc_grp_b;
          parent $eye_loc_grp_b $zu_A;
          scaleConstraint  $headbn $eye_loc_grp_b;//缩放约束
          connectAttr -f ($qvmian_pointOnSurfaceInfo+".position") ($eye_loc_grp_b+".t");//连接定位器  这个位置是曲面的位置  与曲线顶点的位置有偏移
          ///////////////////矫正偏移  保证定位器一点在曲线点上/////////////////////
          xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_a;
          string$loc_sheps[]=`listRelatives -s $eye_loc`; 
          string$loc_shep=$loc_sheps[0];
          connectAttr -f ($loc_shep+".worldPosition[0]")  ($qvxian_temp+".controlPoints["+$i+"]");//定位器控制曲线
          
          
           } 
        delete $qvmian_closestPointOnSurface;
     
     }
  
  
  
    if($type_b=="mesh")///如果是模型
      {
       /////////////////////////////创建曲面信息节点/////////////////////////////////////////////////////
       string$qvmian_closestPointOnSurface=($qvxian_temp+"_closestPointOnMesh_yanpi");
       string$qvmian_shape[]=`listRelatives -s $qvmian_temp`; 
       string$qvmianshape=$qvmian_shape[0];
       int$panduan_B=`objExists $qvmian_closestPointOnSurface`;
       if($panduan_B==1){delete $qvmian_closestPointOnSurface;}
       shadingNode -asUtility closestPointOnMesh  -n $qvmian_closestPointOnSurface;
       connectAttr -force ($qvmianshape+".worldMesh[0]") ($qvmian_closestPointOnSurface+".inMesh");
        /////////////选中曲线////////////////////////
      select -r ($qvxian_temp+".cv[0:999999999]");
      string $cvs[]=`ls -sl -fl`;
      for ($i=0;$i<size($cvs);$i++)
         {
         ////////////////////创建毛囊////////////////////////////
         string$cv=$cvs[$i];
         float$pos_dia[]=`xform -q -ws -t $cv`;
         string$maonang=($qvxian_temp+$i+"_gensuiShape");
         createNode "follicle" -n $maonang  ;//创建毛囊
         string$maonang_tt[]=`listRelatives -p $maonang`;
         string$maonang_t=$maonang_tt[0];
         connectAttr -f ($maonang+".outTranslate") ($maonang_t+".translate");
         connectAttr -f ($maonang+".outRotate") ($maonang_t+".rotate");
         setAttr -type float3 ($qvmian_closestPointOnSurface+".inPosition") $pos_dia[0] $pos_dia[1] $pos_dia[2];
         float$U=`getAttr ($qvmian_closestPointOnSurface+".parameterU")`;
         float$V=`getAttr ($qvmian_closestPointOnSurface+".parameterV")`;
         setAttr ($maonang+".parameterU") $U;
         setAttr ($maonang+".parameterV") $V;
         connectAttr -force ($shape_mode+".outMesh") ($maonang+".inputMesh");
         connectAttr -force ($shape_mode+".worldMatrix[0]") ($maonang+".inputWorldMatrix");
  
   
        ///////////////////////////创建定位器连接到曲线上（定位器被曲面控制 定位器控制曲线）//////////////////////////////////////////////////
        string$zu_A=($qvxian_temp+"_eye_grp_loc");
        string$eye_loc=($qvxian_temp+"_eye_loc_"+$i);
        string$eye_loc_grp_a=($eye_loc+"_GRP_A");
        string$eye_loc_grp_b=($eye_loc+"_GRP_B");
        string$all_eye_jiemao_grp="all_eye_jiemao_grp";
        zxb_ADD_kongzu_proc($all_eye_jiemao_grp);  
        string$mode_ex_grp[]=`listRelatives -p $all_eye_jiemao_grp`; 
        if($mode_ex_grp[0]!="Face_Group"){parent $all_eye_jiemao_grp "Face_Group";}
        string$ex_grps[]=`listRelatives -p $temp_qvxian`; 
       if($ex_grps[0]!=$all_eye_jiemao_grp){parent $temp_qvxian $all_eye_jiemao_grp;}
       int$panduan_A=`objExists $zu_A`;
      if($panduan_A==0)
        {
          select -cl  ;
          group -empty -n  $zu_A;
          setAttr ($zu_A+".visibility") 0; 
          setAttr -lock true ($zu_A+".v");  
          string$qvmian_zu[]=`listRelatives -p $qvmian_temp`; 
          if($qvmian_zu[0]!=$all_eye_jiemao_grp){ parent $zu_A $all_eye_jiemao_grp;} 
        }
      
      spaceLocator -p 0 0 0 -n $eye_loc;
      group -n $eye_loc_grp_a;
      group -n $eye_loc_grp_b;
      parent $eye_loc_grp_b $zu_A;
      delete`pointConstraint $maonang_t $eye_loc_grp_b`;
      parent $eye_loc_grp_b $maonang_t ;
      parent $maonang_t  $zu_A;
      scaleConstraint  $headbn $maonang_t;//缩放约束
      //connectAttr -f ($qvmian_pointOnSurfaceInfo+".position") ($eye_loc_grp_b+".t");//连接定位器  这个位置是曲面的位置  与曲线顶点的位置有偏移
      ///////////////////矫正偏移  保证定位器一点在曲线点上/////////////////////
      xform -ws -t $pos_dia[0] $pos_dia[1] $pos_dia[2] $eye_loc_grp_a;
      string$loc_sheps[]=`listRelatives -s $eye_loc`; 
      string$loc_shep=$loc_sheps[0];
      connectAttr -f ($loc_shep+".worldPosition[0]")  ($qvxian_temp+".controlPoints["+$i+"]");//定位器控制曲线
      } 
     delete $qvmian_closestPointOnSurface;
   }
      select -r $temp_qvxian;
      select -add $UI_head_mode;   
      string$yuandi_qvxian=zxb_qvxian_to_qvxian_proc($headbn) ;
      $qvxian_head_temp+=$yuandi_qvxian+" ";
      if($iii==0){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_R_UP");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_R_UP") $yuandi_qvxian ;}
      if($iii==1){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_R_DW");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_R_DW") $yuandi_qvxian ;}
      if($iii==2){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_L_UP");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_L_UP") $yuandi_qvxian ;}
      if($iii==3){ zxb_ADD_shuxing_string_proc($UI_head_controller,"pengzhuang_qvxian_L_DW");setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian_L_DW") $yuandi_qvxian ;}
  
      }
   }

setAttr -type "string" ($UI_head_controller+".pengzhuang_qvxian") $qvxian_head_temp;
}




////////////////////////////////////////计算碰撞关节的角度////////////////////////////////////////////////////////////////
global proc zxb_jiemao_pengzhuangguanjie_chengxu_A_proc(string$xian_name,string$bbn_s[])  //原地碰撞曲线    //所有关节
{  
string $bns[]=$bbn_s;//选择计算关节
string$qv=$xian_name;//载入曲线
int$shuliang=20;
int$jiaodu=360;


string$qvxian_zuijiandian_jiedian=($qv+"_nearestPointOnCurve_jiemao_jiancha");
int$ex=`objExists $qvxian_zuijiandian_jiedian`;
 if($ex==1){delete $qvxian_zuijiandian_jiedian;}
createNode nearestPointOnCurve -n $qvxian_zuijiandian_jiedian;//创建曲线最近点节点
string$qvxian_shaps[]=`listRelatives -s $qv`;
string$qvxian_shap=$qvxian_shaps[0];
connectAttr -force ($qvxian_shap+".worldSpace[0]") ($qvxian_zuijiandian_jiedian+".inputCurve");


for($i=0;$i<size($bns);$i++)
   {      
    
      
      
    string$bn=$bns[$i];
    string$en_bns[]=`listRelatives -c $bn`;
    string$en_bn=$en_bns[0];
    string$loc_grp=($bn+"_loc_temp_grp");
    select -cl  ; 
    group -em -n $loc_grp;
    parentConstraint  $bn $loc_grp;
    float$en_bn_tsx=`getAttr ($en_bn+".tx")`;
    float$zhi=$en_bn_tsx/($shuliang-1);
    for($j=0;$j<$shuliang;$j++)
       {
         string$loc=($bn+"_loc_temp"+$j);
         spaceLocator -p 0 0 0 -n $loc;
          parent $loc $loc_grp;
          delete`parentConstraint  $loc_grp $loc`;
          setAttr($loc+".tx") ($j*$zhi);
       }
       
       
   global string $gSelect;
   global string $gMainProgressBar;
   setToolTo $gSelect;
    progressBar -e -st ("计算位置...") -bp -ii 1 -min 0 -max $jiaodu $gMainProgressBar;
     float$diss=10000000;  
     float$rz=0;
     int$loc_shu=0;
     for($j=0;$j<$jiaodu;$j++)
        {
            
            
        if(`progressBar -q -ic $gMainProgressBar`)
        break;
        progressBar -e -s 1 $gMainProgressBar;  
        setAttr ($bn+".rz") $j;
        
         for($jj=0;$jj<$shuliang;$jj++)
             {
             string$loc=($bn+"_loc_temp"+$jj);
             float$loc_pos[]=`xform -q -ws -t $loc`;
             setAttr ($qvxian_zuijiandian_jiedian+".inPosition") $loc_pos[0] $loc_pos[1] $loc_pos[2];
             float$qvxian_pos[]=`getAttr ($qvxian_zuijiandian_jiedian+".position")`;
             float$cdiss=mag(<<$qvxian_pos[0],$qvxian_pos[1],$qvxian_pos[2]>>-<<$loc_pos[0],$loc_pos[1],$loc_pos[2]>>);
             if($cdiss<$diss)
                {
                $diss=$cdiss;
                $rz=$j;
                $loc_shu=$jj;
                }
             }
        
        
        }
        
        
     
     setAttr ($bn+".rz") $rz;
     float$txx=`getAttr ($bn+"_loc_temp"+$loc_shu+".tx")`;
     setAttr ($en_bn+".tx") $txx;
     delete $loc_grp; 
     progressBar -e -ep $gMainProgressBar;
   
   }
   
delete $qvxian_zuijiandian_jiedian;   
  
}


/////////////////////////////////初始化UI//////////////////////////////////////////////////////
zxb_fase_window_proc;


